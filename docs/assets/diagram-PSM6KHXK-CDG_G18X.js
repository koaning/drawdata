var $;import"./chunk-FPAJGGOC-C0XAW5Os.js";import"./main-CwSdzVhm.js";import{n as A}from"./ordinal-_nQ2r1qQ.js";import{t as T}from"./defaultLocale-BLUna9fQ.js";import"./purify.es-N-2faAGj.js";import{u as D}from"./src-Bp_72rVO.js";import{i as _}from"./chunk-S3R3BYOJ-By1A-M0T.js";import{p as Y,t as Z}from"./treemap-DeGcO9km.js";import{n as h,r as V}from"./src-faGJHwXX.js";import{B as ee,C as te,U as ae,_ as le,a as re,c as se,d as ie,v as oe,y as G,z as ne}from"./chunk-ABZYJK2D-DAD3GlgM.js";import{t as ce}from"./chunk-EXTU4WIE-GbJyzeBy.js";import{i as C,n as de}from"./chunk-ATLVNIR6-DsKp3Ify.js";import"./dist-BA8xhrl2.js";import"./chunk-O7ZBX7Z2-CYcfcXcp.js";import"./chunk-S6J4BHB3-D3MBXPxT.js";import"./chunk-LBM3YZW2-CQVIMcAR.js";import"./chunk-76Q3JFCE-COngPFoW.js";import"./chunk-T53DSG4Q-B6Z3zF7Z.js";import"./chunk-LHMN2FUI-DW2iokr2.js";import"./chunk-FWNWRKHM-XgKeqUvn.js";import{t as pe}from"./chunk-4BX2VUAB-B5-8Pez8.js";import{t as he}from"./mermaid-parser.core-wRO0EX_C.js";import{t as me}from"./chunk-QN33PNHL-C0IBWhei.js";var O=($=class{constructor(){this.nodes=[],this.levels=new Map,this.outerNodes=[],this.classes=new Map,this.setAccTitle=ee,this.getAccTitle=oe,this.setDiagramTitle=ae,this.getDiagramTitle=te,this.getAccDescription=le,this.setAccDescription=ne}getNodes(){return this.nodes}getConfig(){let a=ie,i=G();return _({...a.treemap,...i.treemap??{}})}addNode(a,i){this.nodes.push(a),this.levels.set(a,i),i===0&&(this.outerNodes.push(a),this.root??(this.root=a))}getRoot(){return{name:"",children:this.outerNodes}}addClass(a,i){let r=this.classes.get(a)??{id:a,styles:[],textStyles:[]},n=i.replace(/\\,/g,"\xA7\xA7\xA7").replace(/,/g,";").replace(/§§§/g,",").split(";");n&&n.forEach(s=>{de(s)&&(r!=null&&r.textStyles?r.textStyles.push(s):r.textStyles=[s]),r!=null&&r.styles?r.styles.push(s):r.styles=[s]}),this.classes.set(a,r)}getClasses(){return this.classes}getStylesForClass(a){var i;return((i=this.classes.get(a))==null?void 0:i.styles)??[]}clear(){re(),this.nodes=[],this.levels=new Map,this.outerNodes=[],this.classes=new Map,this.root=void 0}},h($,"TreeMapDB"),$);function U(c){if(!c.length)return[];let a=[],i=[];return c.forEach(r=>{let n={name:r.name,children:r.type==="Leaf"?void 0:[]};for(n.classSelector=r==null?void 0:r.classSelector,r!=null&&r.cssCompiledStyles&&(n.cssCompiledStyles=[r.cssCompiledStyles]),r.type==="Leaf"&&r.value!==void 0&&(n.value=r.value);i.length>0&&i[i.length-1].level>=r.level;)i.pop();if(i.length===0)a.push(n);else{let s=i[i.length-1].node;s.children?s.children.push(n):s.children=[n]}r.type!=="Leaf"&&i.push({node:n,level:r.level})}),a}h(U,"buildHierarchy");var ye=h((c,a)=>{pe(c,a);let i=[];for(let s of c.TreemapRows??[])s.$type==="ClassDefStatement"&&a.addClass(s.className??"",s.styleText??"");for(let s of c.TreemapRows??[]){let d=s.item;if(!d)continue;let y=s.indent?parseInt(s.indent):0,z=fe(d),l=d.classSelector?a.getStylesForClass(d.classSelector):[],w=l.length>0?l.join(";"):void 0,g={level:y,name:z,type:d.$type,value:d.value,classSelector:d.classSelector,cssCompiledStyles:w};i.push(g)}let r=U(i),n=h((s,d)=>{for(let y of s)a.addNode(y,d),y.children&&y.children.length>0&&n(y.children,d+1)},"addNodesRecursively");n(r,0)},"populate"),fe=h(c=>c.name?String(c.name):"","getItemName"),q={parser:{yy:void 0},parse:h(async c=>{var a;try{let i=await he("treemap",c);V.debug("Treemap AST:",i);let r=(a=q.parser)==null?void 0:a.yy;if(!(r instanceof O))throw Error("parser.parser?.yy was not a TreemapDB. This is due to a bug within Mermaid, please report this issue at https://github.com/mermaid-js/mermaid/issues.");ye(i,r)}catch(i){throw V.error("Error parsing treemap:",i),i}},"parse")},ue=10,v=10,M=25,Se={draw:h((c,a,i,r)=>{let n=r.db,s=n.getConfig(),d=s.padding??ue,y=n.getDiagramTitle(),z=n.getRoot(),{themeVariables:l}=G();if(!z)return;let w=y?30:0,g=ce(a),E=s.nodeWidth?s.nodeWidth*v:960,R=s.nodeHeight?s.nodeHeight*v:500,W=E,B=R+w;g.attr("viewBox",`0 0 ${W} ${B}`),se(g,B,W,s.useMaxWidth);let x;try{let e=s.valueFormat||",";if(e==="$0,0")x=h(t=>"$"+T(",")(t),"valueFormat");else if(e.startsWith("$")&&e.includes(",")){let t=/\.\d+/.exec(e),p=t?t[0]:"";x=h(f=>"$"+T(","+p)(f),"valueFormat")}else if(e.startsWith("$")){let t=e.substring(1);x=h(p=>"$"+T(t||"")(p),"valueFormat")}else x=T(e)}catch(e){V.error("Error creating format function:",e),x=T(",")}let L=A().range(["transparent",l.cScale0,l.cScale1,l.cScale2,l.cScale3,l.cScale4,l.cScale5,l.cScale6,l.cScale7,l.cScale8,l.cScale9,l.cScale10,l.cScale11]),J=A().range(["transparent",l.cScalePeer0,l.cScalePeer1,l.cScalePeer2,l.cScalePeer3,l.cScalePeer4,l.cScalePeer5,l.cScalePeer6,l.cScalePeer7,l.cScalePeer8,l.cScalePeer9,l.cScalePeer10,l.cScalePeer11]),F=A().range([l.cScaleLabel0,l.cScaleLabel1,l.cScaleLabel2,l.cScaleLabel3,l.cScaleLabel4,l.cScaleLabel5,l.cScaleLabel6,l.cScaleLabel7,l.cScaleLabel8,l.cScaleLabel9,l.cScaleLabel10,l.cScaleLabel11]);y&&g.append("text").attr("x",W/2).attr("y",w/2).attr("class","treemapTitle").attr("text-anchor","middle").attr("dominant-baseline","middle").text(y);let I=g.append("g").attr("transform",`translate(0, ${w})`).attr("class","treemapContainer"),K=Y(z).sum(e=>e.value??0).sort((e,t)=>(t.value??0)-(e.value??0)),j=Z().size([E,R]).paddingTop(e=>e.children&&e.children.length>0?M+v:0).paddingInner(d).paddingLeft(e=>e.children&&e.children.length>0?v:0).paddingRight(e=>e.children&&e.children.length>0?v:0).paddingBottom(e=>e.children&&e.children.length>0?v:0).round(!0)(K),Q=j.descendants().filter(e=>e.children&&e.children.length>0),k=I.selectAll(".treemapSection").data(Q).enter().append("g").attr("class","treemapSection").attr("transform",e=>`translate(${e.x0},${e.y0})`);k.append("rect").attr("width",e=>e.x1-e.x0).attr("height",M).attr("class","treemapSectionHeader").attr("fill","none").attr("fill-opacity",.6).attr("stroke-width",.6).attr("style",e=>e.depth===0?"display: none;":""),k.append("clipPath").attr("id",(e,t)=>`clip-section-${a}-${t}`).append("rect").attr("width",e=>Math.max(0,e.x1-e.x0-12)).attr("height",M),k.append("rect").attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0).attr("class",(e,t)=>`treemapSection section${t}`).attr("fill",e=>L(e.data.name)).attr("fill-opacity",.6).attr("stroke",e=>J(e.data.name)).attr("stroke-width",2).attr("stroke-opacity",.4).attr("style",e=>{if(e.depth===0)return"display: none;";let t=C({cssCompiledStyles:e.data.cssCompiledStyles});return t.nodeStyles+";"+t.borderStyles.join(";")}),k.append("text").attr("class","treemapSectionLabel").attr("x",6).attr("y",M/2).attr("dominant-baseline","middle").text(e=>e.depth===0?"":e.data.name).attr("font-weight","bold").attr("style",e=>e.depth===0?"display: none;":"dominant-baseline: middle; font-size: 12px; fill:"+F(e.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"+C({cssCompiledStyles:e.data.cssCompiledStyles}).labelStyles.replace("color:","fill:")).each(function(e){if(e.depth===0)return;let t=D(this),p=e.data.name;t.text(p);let f=e.x1-e.x0,S;S=s.showValues!==!1&&e.value?f-10-30-10-6:f-6-6;let m=Math.max(15,S),u=t.node();if(u.getComputedTextLength()>m){let o=p;for(;o.length>0;){if(o=p.substring(0,o.length-1),o.length===0){t.text("..."),u.getComputedTextLength()>m&&t.text("");break}if(t.text(o+"..."),u.getComputedTextLength()<=m)break}}}),s.showValues!==!1&&k.append("text").attr("class","treemapSectionValue").attr("x",e=>e.x1-e.x0-10).attr("y",M/2).attr("text-anchor","end").attr("dominant-baseline","middle").text(e=>e.value?x(e.value):"").attr("font-style","italic").attr("style",e=>e.depth===0?"display: none;":"text-anchor: end; dominant-baseline: middle; font-size: 10px; fill:"+F(e.data.name)+"; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"+C({cssCompiledStyles:e.data.cssCompiledStyles}).labelStyles.replace("color:","fill:"));let X=j.leaves(),P=I.selectAll(".treemapLeafGroup").data(X).enter().append("g").attr("class",(e,t)=>`treemapNode treemapLeafGroup leaf${t}${e.data.classSelector?` ${e.data.classSelector}`:""}x`).attr("transform",e=>`translate(${e.x0},${e.y0})`);P.append("rect").attr("width",e=>e.x1-e.x0).attr("height",e=>e.y1-e.y0).attr("class","treemapLeaf").attr("fill",e=>e.parent?L(e.parent.data.name):L(e.data.name)).attr("style",e=>C({cssCompiledStyles:e.data.cssCompiledStyles}).nodeStyles).attr("fill-opacity",.3).attr("stroke",e=>e.parent?L(e.parent.data.name):L(e.data.name)).attr("stroke-width",3),P.append("clipPath").attr("id",(e,t)=>`clip-${a}-${t}`).append("rect").attr("width",e=>Math.max(0,e.x1-e.x0-4)).attr("height",e=>Math.max(0,e.y1-e.y0-4)),P.append("text").attr("class","treemapLabel").attr("x",e=>(e.x1-e.x0)/2).attr("y",e=>(e.y1-e.y0)/2).attr("style",e=>"text-anchor: middle; dominant-baseline: middle; font-size: 38px;fill:"+F(e.data.name)+";"+C({cssCompiledStyles:e.data.cssCompiledStyles}).labelStyles.replace("color:","fill:")).attr("clip-path",(e,t)=>`url(#clip-${a}-${t})`).text(e=>e.data.name).each(function(e){let t=D(this),p=e.x1-e.x0,f=e.y1-e.y0,S=t.node(),m=p-8,u=f-8;if(m<10||u<10){t.style("display","none");return}let o=parseInt(t.style("font-size"),10),N=.6;for(;S.getComputedTextLength()>m&&o>8;)o--,t.style("font-size",`${o}px`);let b=Math.max(6,Math.min(28,Math.round(o*N))),H=o+2+b;for(;H>u&&o>8&&(o--,b=Math.max(6,Math.min(28,Math.round(o*N))),!(b<6&&o===8));)t.style("font-size",`${o}px`),H=o+2+b;t.style("font-size",`${o}px`),(S.getComputedTextLength()>m||o<8||u<o)&&t.style("display","none")}),s.showValues!==!1&&P.append("text").attr("class","treemapValue").attr("x",e=>(e.x1-e.x0)/2).attr("y",function(e){return(e.y1-e.y0)/2}).attr("style",e=>"text-anchor: middle; dominant-baseline: hanging; font-size: 28px;fill:"+F(e.data.name)+";"+C({cssCompiledStyles:e.data.cssCompiledStyles}).labelStyles.replace("color:","fill:")).attr("clip-path",(e,t)=>`url(#clip-${a}-${t})`).text(e=>e.value?x(e.value):"").each(function(e){let t=D(this),p=this.parentNode;if(!p){t.style("display","none");return}let f=D(p).select(".treemapLabel");if(f.empty()||f.style("display")==="none"){t.style("display","none");return}let S=parseFloat(f.style("font-size")),m=Math.max(6,Math.min(28,Math.round(S*.6)));t.style("font-size",`${m}px`);let u=(e.y1-e.y0)/2+S/2+2;t.attr("y",u);let o=e.x1-e.x0,N=e.y1-e.y0-4,b=o-8;t.node().getComputedTextLength()>b||u+m>N||m<6?t.style("display","none"):t.style("display",null)}),me(g,s.diagramPadding??8,"flowchart",(s==null?void 0:s.useMaxWidth)||!1)},"draw"),getClasses:h(function(c,a){return a.db.getClasses()},"getClasses")},ge={sectionStrokeColor:"black",sectionStrokeWidth:"1",sectionFillColor:"#efefef",leafStrokeColor:"black",leafStrokeWidth:"1",leafFillColor:"#efefef",labelColor:"black",labelFontSize:"12px",valueFontSize:"10px",valueColor:"black",titleColor:"black",titleFontSize:"14px"},xe={parser:q,get db(){return new O},renderer:Se,styles:h(({treemap:c}={})=>{let a=_(ge,c);return`
  .treemapNode.section {
    stroke: ${a.sectionStrokeColor};
    stroke-width: ${a.sectionStrokeWidth};
    fill: ${a.sectionFillColor};
  }
  .treemapNode.leaf {
    stroke: ${a.leafStrokeColor};
    stroke-width: ${a.leafStrokeWidth};
    fill: ${a.leafFillColor};
  }
  .treemapLabel {
    fill: ${a.labelColor};
    font-size: ${a.labelFontSize};
  }
  .treemapValue {
    fill: ${a.valueColor};
    font-size: ${a.valueFontSize};
  }
  .treemapTitle {
    fill: ${a.titleColor};
    font-size: ${a.titleFontSize};
  }
  `},"getStyles")};export{xe as diagram};
