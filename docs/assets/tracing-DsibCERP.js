import{s as O}from"./chunk-LvLJmgfZ.js";import{d as ee,p as te,u as q}from"./useEvent-DlWF5OMa.js";import{t as le}from"./react-BGmjiNul.js";import{Jn as re,W as A,er as se,k as ae}from"./cells-CmJW_FeD.js";import"./react-dom-C9fstfnp.js";import{t as ie}from"./compiler-runtime-DeeZ7FnK.js";import"./config-CENq_7Pd.js";import{t as ne}from"./jsx-runtime-DN_bIXfG.js";import{t as oe}from"./cn-C1rgT0yh.js";import"./dist-CAcX026F.js";import"./cjs-Bj40p_Np.js";import"./main-CwSdzVhm.js";import"./useNonce-EAuSVK-5.js";import{t as ce}from"./createLucideIcon-CW2xpJ57.js";import{n as de,r as U}from"./CellStatus-D1YyNsC9.js";import{_ as me}from"./select-D9lTzMzP.js";import{t as pe}from"./chevron-right-CqEd11Di.js";import{t as ue}from"./circle-check-Cr0N4h9T.js";import{t as he}from"./circle-play-r3MHdB-P.js";import"./dist-HGZzCB0y.js";import"./dist-CVj-_Iiz.js";import"./dist-BVf1IY4_.js";import"./dist-Cq_4nPfh.js";import"./dist-RKnr9SNh.js";import{r as fe}from"./useTheme-BSVRc0kJ.js";import"./Combination-D1TsGrBC.js";import{t as J}from"./tooltip-CvjcEpZC.js";import"./vega-loader.browser-C8wT63Va.js";import{r as xe,t as ve}from"./react-vega-CI0fuCLO.js";import"./defaultLocale-BLUna9fQ.js";import"./defaultLocale-DzliDDTm.js";import{t as ge}from"./cell-link-D7bPw7Fz.js";import{t as je}from"./bundle.esm-dxSncdJD.js";import{n as ye,r as Se,t as V}from"./react-resizable-panels.browser.esm-B7ZqbY8M.js";import{t as Ie}from"./empty-state-H6r25Wek.js";import"./multi-icon-6ulZXArq.js";import{t as be}from"./clear-button-B9htnn2a.js";import{n as Ne,t as Te}from"./runs-DGUGtjQH.js";var we=ce("circle-ellipsis",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M17 12h.01",key:"1m0b6t"}],["path",{d:"M12 12h.01",key:"1mp3jc"}],["path",{d:"M7 12h.01",key:"eqddd0"}]]),D=ie(),z=O(le(),1);const W="hoveredCellId",Y="cellHover";var ke="cellNum",G="cell",H="startTimestamp",K="endTimestamp",X="status";function Re(t,e,l,i){let n="hoursminutessecondsmilliseconds";return{$schema:"https://vega.github.io/schema/vega-lite/v6.json",background:i==="dark"?"black":void 0,mark:{type:"bar",cornerRadius:2},params:[{name:W,bind:{element:`#${e}`}},{name:Y,select:{type:"point",on:"mouseover",fields:[G],clear:"mouseout"}}],height:{step:l==="sideBySide"?26:21},encoding:{y:{field:ke,scale:{paddingInner:.2},sort:{field:"sortPriority"},title:"cell",axis:l==="sideBySide"?null:void 0},x:{field:H,type:"temporal",axis:{orient:"top",title:null}},x2:{field:K,type:"temporal"},tooltip:[{field:H,type:"temporal",timeUnit:n,title:"Start"},{field:K,type:"temporal",timeUnit:n,title:"End"}],size:{value:{expr:`${W} == toString(datum.${G}) ? 19.5 : 18`}},color:{field:X,scale:{domain:["success","error"],range:["#37BE5F","red"]},legend:null}},data:{values:t},transform:[{calculate:`datum.${X} === 'queued' ? 9999999999999 : datum.${H}`,as:"sortPriority"}],config:{view:{stroke:"transparent"}}}}function Z(t){try{let e=new Date(t*1e3);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}:${String(e.getSeconds()).padStart(2,"0")}.${String(e.getMilliseconds()).padStart(3,"0")}`}catch{return""}}var r=O(ne(),1),Q=te(new Map);const _e=()=>{let t=(0,D.c)(32),{runIds:e,runMap:l}=q(Te),i=q(Q),{clearRuns:n}=Ne(),{theme:o}=fe(),[a,w]=(0,z.useState)("above"),u;t[0]===a?u=t[1]:(u=()=>{w(a==="above"?"sideBySide":"above")},t[0]=a,t[1]=u);let d=u;if(e.length===0){let s;return t[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,r.jsx)(Ie,{title:"No traces",description:(0,r.jsx)("span",{children:"Cells that have ran will appear here."}),icon:(0,r.jsx)(se,{})}),t[2]=s):s=t[2],s}let m;t[3]===Symbol.for("react.memo_cache_sentinel")?(m=(0,r.jsx)("label",{htmlFor:"chartPosition",className:"text-xs",children:"Inline chart"}),t[3]=m):m=t[3];let x=a==="sideBySide",p;t[4]!==x||t[5]!==d?(p=(0,r.jsxs)("div",{className:"flex flex-row gap-1 items-center",children:[m,(0,r.jsx)("input",{type:"checkbox",name:"chartPosition","data-testid":"chartPosition",onClick:d,defaultChecked:x,className:"h-3 cursor-pointer"})]}),t[4]=x,t[5]=d,t[6]=p):p=t[6];let c;t[7]===n?c=t[8]:(c=(0,r.jsx)(be,{dataTestId:"clear-traces-button",onClick:n}),t[7]=n,t[8]=c);let h;t[9]!==p||t[10]!==c?(h=(0,r.jsxs)("div",{className:"flex flex-row justify-start gap-3",children:[p,c]}),t[9]=p,t[10]=c,t[11]=h):h=t[11];let v;if(t[12]!==a||t[13]!==i||t[14]!==e||t[15]!==l||t[16]!==o){let s;t[18]!==a||t[19]!==i||t[20]!==l||t[21]!==o?(s=(N,T)=>{let b=l.get(N);return b?(0,r.jsx)(Me,{run:b,isExpanded:i.get(b.runId),isMostRecentRun:T===0,chartPosition:a,theme:o},b.runId):null},t[18]=a,t[19]=i,t[20]=l,t[21]=o,t[22]=s):s=t[22],v=e.map(s),t[12]=a,t[13]=i,t[14]=e,t[15]=l,t[16]=o,t[17]=v}else v=t[17];let g;t[23]===v?g=t[24]:(g=(0,r.jsx)("div",{className:"flex flex-col gap-3",children:v}),t[23]=v,t[24]=g);let j;t[25]!==h||t[26]!==g?(j=(0,r.jsx)(V,{defaultSize:50,minSize:30,maxSize:80,children:(0,r.jsxs)("div",{className:"py-1 px-2 overflow-y-scroll h-full",children:[h,g]})}),t[25]=h,t[26]=g,t[27]=j):j=t[27];let I;t[28]===Symbol.for("react.memo_cache_sentinel")?(I=(0,r.jsx)(Se,{className:"w-1 bg-border hover:bg-primary/50 transition-colors"}),t[28]=I):I=t[28];let f;t[29]===Symbol.for("react.memo_cache_sentinel")?(f=(0,r.jsx)(V,{defaultSize:50,children:(0,r.jsx)("div",{})}),t[29]=f):f=t[29];let y;return t[30]===j?y=t[31]:(y=(0,r.jsxs)(ye,{direction:"horizontal",className:"h-full",children:[j,I,f]}),t[30]=j,t[31]=y),y};var Me=({run:t,isMostRecentRun:e,chartPosition:l,isExpanded:i,theme:n})=>{let o=ee(Q);i??(i=e);let a=()=>{o(d=>{let m=new Map(d);return m.set(t.runId,!i),m})},w=(0,r.jsx)(i?me:pe,{height:16,className:"inline"}),u=(0,r.jsxs)("span",{className:"text-sm cursor-pointer",onClick:a,children:["Run - ",A(t.runStartTime),w]});return i?(0,r.jsx)($e,{run:t,chartPosition:l,theme:n,title:u},t.runId):(0,r.jsx)("div",{className:"flex flex-col",children:(0,r.jsx)("pre",{className:"font-mono font-semibold",children:u})},t.runId)},$e=t=>{let e=(0,D.c)(40),{run:l,chartPosition:i,theme:n,title:o}=t,[a,w]=(0,z.useState)(),u=(0,z.useRef)(null),{ref:d,width:m}=je(),x=m===void 0?300:m,p=ae(),c,h;if(e[0]!==p||e[1]!==i||e[2]!==l.cellRuns||e[3]!==l.runId||e[4]!==n){let k=[...l.cellRuns.values()].map(S=>{let R=S.elapsedTime??0;return{cell:S.cellId,cellNum:p.inOrderIds.indexOf(S.cellId),startTimestamp:Z(S.startTime),endTimestamp:Z(S.startTime+R),elapsedTime:U(R*1e3),status:S.status}});c=`hiddenInputElement-${l.runId}`,h=xe(Re(k,c,i,n)),e[0]=p,e[1]=i,e[2]=l.cellRuns,e[3]=l.runId,e[4]=n,e[5]=c,e[6]=h}else c=e[5],h=e[6];let v=h.spec,g=n==="dark"?"dark":void 0,j=x-50,I=i==="above"?120:100,f;e[7]!==g||e[8]!==j||e[9]!==I?(f={theme:g,width:j,height:I,actions:!1,mode:"vega",renderer:"canvas"},e[7]=g,e[8]=j,e[9]=I,e[10]=f):f=e[10];let y;e[11]!==f||e[12]!==v?(y={ref:u,spec:v,options:f},e[11]=f,e[12]=v,e[13]=y):y=e[13];let s=ve(y),N;e[14]===(s==null?void 0:s.view)?N=e[15]:(N=()=>{let k=[{signalName:Y,handler:(S,R)=>{var L;let C=(L=R.cell)==null?void 0:L[0];w(C??null)}}];return k.forEach(S=>{let{signalName:R,handler:C}=S;s==null||s.view.addSignalListener(R,C)}),()=>{k.forEach(S=>{let{signalName:R,handler:C}=S;s==null||s.view.removeSignalListener(R,C)})}},e[14]=s==null?void 0:s.view,e[15]=N);let T;e[16]===s?T=e[17]:(T=[s],e[16]=s,e[17]=T),(0,z.useEffect)(N,T);let b;e[18]!==c||e[19]!==a||e[20]!==l?(b=(0,r.jsx)(ze,{run:l,hoveredCellId:a,hiddenInputElementId:c}),e[18]=c,e[19]=a,e[20]=l,e[21]=b):b=e[21];let _=b,F=i==="sideBySide"?"-mt-0.5 flex-1":"",E;e[22]===Symbol.for("react.memo_cache_sentinel")?(E=(0,r.jsx)(z.Suspense,{children:(0,r.jsx)("div",{ref:u})}),e[22]=E):E=e[22];let P;e[23]!==d||e[24]!==F?(P=(0,r.jsx)("div",{className:F,ref:d,children:E}),e[23]=d,e[24]=F,e[25]=P):P=e[25];let M=P;if(i==="above"){let k;e[26]!==M||e[27]!==o||e[28]!==_?(k=(0,r.jsxs)("pre",{className:"font-mono font-semibold",children:[o,M,_]}),e[26]=M,e[27]=o,e[28]=_,e[29]=k):k=e[29];let S;return e[30]!==l.runId||e[31]!==k?(S=(0,r.jsx)("div",{className:"flex flex-col",children:k},l.runId),e[30]=l.runId,e[31]=k,e[32]=S):S=e[32],S}let $;e[33]!==o||e[34]!==_?($=(0,r.jsxs)("pre",{className:"font-mono font-semibold",children:[o,_]}),e[33]=o,e[34]=_,e[35]=$):$=e[35];let B;return e[36]!==M||e[37]!==l.runId||e[38]!==$?(B=(0,r.jsxs)("div",{className:"flex flex-row",children:[$,M]},l.runId),e[36]=M,e[37]=l.runId,e[38]=$,e[39]=B):B=e[39],B},ze=t=>{let e=(0,D.c)(12),{run:l,hoveredCellId:i,hiddenInputElementId:n}=t,o=(0,z.useRef)(null),a;e[0]===Symbol.for("react.memo_cache_sentinel")?(a=c=>{o.current&&(o.current.value=String(c),o.current.dispatchEvent(new Event("input",{bubbles:!0})))},e[0]=a):a=e[0];let w=a,u=i||"",d;e[1]!==n||e[2]!==u?(d=(0,r.jsx)("input",{type:"text",id:n,defaultValue:u,hidden:!0,ref:o}),e[1]=n,e[2]=u,e[3]=d):d=e[3];let m;e[4]===l.cellRuns?m=e[5]:(m=[...l.cellRuns.values()],e[4]=l.cellRuns,e[5]=m);let x;e[6]!==i||e[7]!==m?(x=m.map(c=>(0,r.jsx)(Ee,{cellRun:c,hovered:c.cellId===i,dispatchHoverEvent:w},c.cellId)),e[6]=i,e[7]=m,e[8]=x):x=e[8];let p;return e[9]!==d||e[10]!==x?(p=(0,r.jsxs)("div",{className:"text-xs mt-0.5 ml-3 flex flex-col gap-0.5",children:[d,x]}),e[9]=d,e[10]=x,e[11]=p):p=e[11],p},Ce={success:(0,r.jsx)(ue,{color:"green",size:14}),running:(0,r.jsx)(he,{color:"var(--blue-10)",size:14}),error:(0,r.jsx)(re,{color:"red",size:14}),queued:(0,r.jsx)(we,{color:"grey",size:14})},Ee=t=>{let e=(0,D.c)(39),{cellRun:l,hovered:i,dispatchHoverEvent:n}=t,o;e[0]===l.elapsedTime?o=e[1]:(o=l.elapsedTime?U(l.elapsedTime*1e3):"-",e[0]=l.elapsedTime,e[1]=o);let a=o,w;e[2]!==l.elapsedTime||e[3]!==a?(w=l.elapsedTime?(0,r.jsxs)("span",{children:["This cell took ",(0,r.jsx)(de,{elapsedTime:a})," to run"]}):(0,r.jsx)("span",{children:"This cell has not been run"}),e[2]=l.elapsedTime,e[3]=a,e[4]=w):w=e[4];let u=w,d;e[5]!==l.cellId||e[6]!==n?(d=()=>{n(l.cellId)},e[5]=l.cellId,e[6]=n,e[7]=d):d=e[7];let m=d,x;e[8]===n?x=e[9]:(x=()=>{n(null)},e[8]=n,e[9]=x);let p=x,c=i&&"bg-(--gray-3) opacity-100",h;e[10]===c?h=e[11]:(h=oe("flex flex-row gap-2 py-1 px-1 opacity-70 hover:bg-(--gray-3) hover:opacity-100",c),e[10]=c,e[11]=h);let v;e[12]===l.startTime?v=e[13]:(v=A(l.startTime),e[12]=l.startTime,e[13]=v);let g;e[14]===v?g=e[15]:(g=(0,r.jsxs)("span",{className:"text-(--gray-10) dark:text-(--gray-11)",children:["[",v,"]"]}),e[14]=v,e[15]=g);let j;e[16]===l.cellId?j=e[17]:(j=(0,r.jsxs)("span",{className:"text-(--gray-10) w-16",children:["(",(0,r.jsx)(ge,{cellId:l.cellId}),")"]}),e[16]=l.cellId,e[17]=j);let I;e[18]===l.code?I=e[19]:(I=(0,r.jsx)("span",{className:"w-40 truncate -ml-1",children:l.code}),e[18]=l.code,e[19]=I);let f;e[20]===a?f=e[21]:(f=(0,r.jsx)("span",{className:"text-(--gray-10) dark:text-(--gray-11)",children:a}),e[20]=a,e[21]=f);let y;e[22]!==u||e[23]!==f?(y=(0,r.jsx)(J,{content:u,children:f}),e[22]=u,e[23]=f,e[24]=y):y=e[24];let s=Ce[l.status],N;e[25]!==l.status||e[26]!==s?(N=(0,r.jsx)(J,{content:l.status,children:s}),e[25]=l.status,e[26]=s,e[27]=N):N=e[27];let T;e[28]!==y||e[29]!==N?(T=(0,r.jsxs)("div",{className:"flex flex-row gap-1 w-16 justify-end -ml-2",children:[y,N]}),e[28]=y,e[29]=N,e[30]=T):T=e[30];let b;return e[31]!==m||e[32]!==p||e[33]!==I||e[34]!==T||e[35]!==h||e[36]!==g||e[37]!==j?(b=(0,r.jsxs)("div",{className:h,onMouseEnter:m,onMouseLeave:p,children:[g,j,I,T]}),e[31]=m,e[32]=p,e[33]=I,e[34]=T,e[35]=h,e[36]=g,e[37]=j,e[38]=b):b=e[38],b};export{_e as Tracing};
