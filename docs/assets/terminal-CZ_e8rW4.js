var oi,ai,hi;import{s as Mt,t as At}from"./chunk-LvLJmgfZ.js";import{n as $e}from"./useEvent-DlWF5OMa.js";import{t as Li}from"./react-BGmjiNul.js";import"./react-dom-C9fstfnp.js";import{t as xi}from"./compiler-runtime-DeeZ7FnK.js";import{d as Ze}from"./hotkeys-uKX61F1_.js";import{O as Ei,o as ki}from"./config-CENq_7Pd.js";import{t as Di}from"./jsx-runtime-DN_bIXfG.js";import{t as Tt}from"./cn-C1rgT0yh.js";import{t as Ri}from"./createLucideIcon-CW2xpJ57.js";import{t as Mi}from"./clipboard-paste-CusmeEPf.js";import{t as Ai}from"./copy-gBVL4NN-.js";import{t as Ti}from"./trash-2-C-lF7BNB.js";import"./Combination-D1TsGrBC.js";import{n as Bi}from"./useDebounce-em3gna-v.js";import{t as Oi}from"./copy-DRhpWiOq.js";import{n as Pi}from"./renderShortcut-BzTDKVab.js";import{n as Ii,t as Hi}from"./state-D4d80DfQ.js";var Fi=Ri("text-select",[["path",{d:"M14 21h1",key:"v9vybs"}],["path",{d:"M14 3h1",key:"1ec4yj"}],["path",{d:"M19 3a2 2 0 0 1 2 2",key:"18rm91"}],["path",{d:"M21 14v1",key:"169vum"}],["path",{d:"M21 19a2 2 0 0 1-2 2",key:"1j7049"}],["path",{d:"M21 9v1",key:"mxsmne"}],["path",{d:"M3 14v1",key:"vnatye"}],["path",{d:"M3 9v1",key:"1r0deq"}],["path",{d:"M5 21a2 2 0 0 1-2-2",key:"sbafld"}],["path",{d:"M5 3a2 2 0 0 0-2 2",key:"y57alp"}],["path",{d:"M7 12h10",key:"b7w52i"}],["path",{d:"M7 16h6",key:"1vyc9m"}],["path",{d:"M7 8h8",key:"1jbsf9"}],["path",{d:"M9 21h1",key:"15o7lz"}],["path",{d:"M9 3h1",key:"1yesri"}]]),Wi=xi(),$i=class{constructor(g,_){this._disposables=[],this._socket=g,this._socket.binaryType="arraybuffer",this._bidirectional=!(_&&_.bidirectional===!1)}activate(g){this._disposables.push(et(this._socket,"message",_=>{let b=_.data;g.write(typeof b=="string"?b:new Uint8Array(b))})),this._bidirectional&&(this._disposables.push(g.onData(_=>this._sendData(_))),this._disposables.push(g.onBinary(_=>this._sendBinary(_)))),this._disposables.push(et(this._socket,"close",()=>this.dispose())),this._disposables.push(et(this._socket,"error",()=>this.dispose()))}dispose(){for(let g of this._disposables)g.dispose()}_sendData(g){this._checkOpenSocket()&&this._socket.send(g)}_sendBinary(g){if(!this._checkOpenSocket())return;let _=new Uint8Array(g.length);for(let b=0;b<g.length;++b)_[b]=g.charCodeAt(b)&255;this._socket.send(_)}_checkOpenSocket(){switch(this._socket.readyState){case WebSocket.OPEN:return!0;case WebSocket.CONNECTING:throw Error("Attach addon was loaded before socket was open");case WebSocket.CLOSING:return console.warn("Attach addon socket is closing"),!1;case WebSocket.CLOSED:throw Error("Attach addon socket is closed");default:throw Error("Unexpected socket state")}}};function et(g,_,b){return g.addEventListener(_,b),{dispose:()=>{b&&g.removeEventListener(_,b)}}}var Ni=At(((g,_)=>{(function(b,E){typeof g=="object"&&typeof _=="object"?_.exports=E():typeof define=="function"&&define.amd?define([],E):typeof g=="object"?g.CanvasAddon=E():b.CanvasAddon=E()})(self,(()=>(()=>{var b={903:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BaseRenderLayer=void 0;let l=a(274),u=a(627),n=a(237),f=a(860),p=a(374),S=a(296),r=a(345),e=a(859),o=a(399),s=a(855);class i extends e.Disposable{get canvas(){return this._canvas}get cacheCanvas(){var d;return(d=this._charAtlas)==null?void 0:d.pages[0].canvas}constructor(d,c,v,C,k,D,x,y,L,M){super(),this._terminal=d,this._container=c,this._alpha=k,this._themeService=D,this._bufferService=x,this._optionsService=y,this._decorationService=L,this._coreBrowserService=M,this._deviceCharWidth=0,this._deviceCharHeight=0,this._deviceCellWidth=0,this._deviceCellHeight=0,this._deviceCharLeft=0,this._deviceCharTop=0,this._selectionModel=(0,S.createSelectionRenderModel)(),this._bitmapGenerator=[],this._charAtlasDisposable=this.register(new e.MutableDisposable),this._onAddTextureAtlasCanvas=this.register(new r.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._cellColorResolver=new l.CellColorResolver(this._terminal,this._optionsService,this._selectionModel,this._decorationService,this._coreBrowserService,this._themeService),this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add(`xterm-${v}-layer`),this._canvas.style.zIndex=C.toString(),this._initCanvas(),this._container.appendChild(this._canvas),this._refreshCharAtlas(this._themeService.colors),this.register(this._themeService.onChangeColors((B=>{this._refreshCharAtlas(B),this.reset(),this.handleSelectionChanged(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}))),this.register((0,e.toDisposable)((()=>{this._canvas.remove()})))}_initCanvas(){this._ctx=(0,p.throwIfFalsy)(this._canvas.getContext("2d",{alpha:this._alpha})),this._alpha||this._clearAll()}handleBlur(){}handleFocus(){}handleCursorMove(){}handleGridChanged(d,c){}handleSelectionChanged(d,c,v=!1){this._selectionModel.update(this._terminal._core,d,c,v)}_setTransparency(d){if(d===this._alpha)return;let c=this._canvas;this._alpha=d,this._canvas=this._canvas.cloneNode(),this._initCanvas(),this._container.replaceChild(this._canvas,c),this._refreshCharAtlas(this._themeService.colors),this.handleGridChanged(0,this._bufferService.rows-1)}_refreshCharAtlas(d){if(!(this._deviceCharWidth<=0&&this._deviceCharHeight<=0)){this._charAtlas=(0,u.acquireTextureAtlas)(this._terminal,this._optionsService.rawOptions,d,this._deviceCellWidth,this._deviceCellHeight,this._deviceCharWidth,this._deviceCharHeight,this._coreBrowserService.dpr),this._charAtlasDisposable.value=(0,r.forwardEvent)(this._charAtlas.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas),this._charAtlas.warmUp();for(let c=0;c<this._charAtlas.pages.length;c++)this._bitmapGenerator[c]=new h(this._charAtlas.pages[c].canvas)}}resize(d){this._deviceCellWidth=d.device.cell.width,this._deviceCellHeight=d.device.cell.height,this._deviceCharWidth=d.device.char.width,this._deviceCharHeight=d.device.char.height,this._deviceCharLeft=d.device.char.left,this._deviceCharTop=d.device.char.top,this._canvas.width=d.device.canvas.width,this._canvas.height=d.device.canvas.height,this._canvas.style.width=`${d.css.canvas.width}px`,this._canvas.style.height=`${d.css.canvas.height}px`,this._alpha||this._clearAll(),this._refreshCharAtlas(this._themeService.colors)}clearTextureAtlas(){var d;(d=this._charAtlas)==null||d.clearTexture()}_fillCells(d,c,v,C){this._ctx.fillRect(d*this._deviceCellWidth,c*this._deviceCellHeight,v*this._deviceCellWidth,C*this._deviceCellHeight)}_fillMiddleLineAtCells(d,c,v=1){let C=Math.ceil(.5*this._deviceCellHeight);this._ctx.fillRect(d*this._deviceCellWidth,(c+1)*this._deviceCellHeight-C-this._coreBrowserService.dpr,v*this._deviceCellWidth,this._coreBrowserService.dpr)}_fillBottomLineAtCells(d,c,v=1,C=0){this._ctx.fillRect(d*this._deviceCellWidth,(c+1)*this._deviceCellHeight+C-this._coreBrowserService.dpr-1,v*this._deviceCellWidth,this._coreBrowserService.dpr)}_curlyUnderlineAtCell(d,c,v=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;let C=this._coreBrowserService.dpr;this._ctx.lineWidth=C;for(let k=0;k<v;k++){let D=(d+k)*this._deviceCellWidth,x=(d+k+.5)*this._deviceCellWidth,y=(d+k+1)*this._deviceCellWidth,L=(c+1)*this._deviceCellHeight-C-1,M=L-C,B=L+C;this._ctx.moveTo(D,L),this._ctx.bezierCurveTo(D,M,x,M,x,L),this._ctx.bezierCurveTo(x,B,y,B,y,L)}this._ctx.stroke(),this._ctx.restore()}_dottedUnderlineAtCell(d,c,v=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;let C=this._coreBrowserService.dpr;this._ctx.lineWidth=C,this._ctx.setLineDash([2*C,C]);let k=d*this._deviceCellWidth,D=(c+1)*this._deviceCellHeight-C-1;this._ctx.moveTo(k,D);for(let x=0;x<v;x++){let y=(d+v+x)*this._deviceCellWidth;this._ctx.lineTo(y,D)}this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_dashedUnderlineAtCell(d,c,v=1){this._ctx.save(),this._ctx.beginPath(),this._ctx.strokeStyle=this._ctx.fillStyle;let C=this._coreBrowserService.dpr;this._ctx.lineWidth=C,this._ctx.setLineDash([4*C,3*C]);let k=d*this._deviceCellWidth,D=(d+v)*this._deviceCellWidth,x=(c+1)*this._deviceCellHeight-C-1;this._ctx.moveTo(k,x),this._ctx.lineTo(D,x),this._ctx.stroke(),this._ctx.closePath(),this._ctx.restore()}_fillLeftLineAtCell(d,c,v){this._ctx.fillRect(d*this._deviceCellWidth,c*this._deviceCellHeight,this._coreBrowserService.dpr*v,this._deviceCellHeight)}_strokeRectAtCell(d,c,v,C){let k=this._coreBrowserService.dpr;this._ctx.lineWidth=k,this._ctx.strokeRect(d*this._deviceCellWidth+k/2,c*this._deviceCellHeight+k/2,v*this._deviceCellWidth-k,C*this._deviceCellHeight-k)}_clearAll(){this._alpha?this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(0,0,this._canvas.width,this._canvas.height))}_clearCells(d,c,v,C){this._alpha?this._ctx.clearRect(d*this._deviceCellWidth,c*this._deviceCellHeight,v*this._deviceCellWidth,C*this._deviceCellHeight):(this._ctx.fillStyle=this._themeService.colors.background.css,this._ctx.fillRect(d*this._deviceCellWidth,c*this._deviceCellHeight,v*this._deviceCellWidth,C*this._deviceCellHeight))}_fillCharTrueColor(d,c,v){this._ctx.font=this._getFont(!1,!1),this._ctx.textBaseline=n.TEXT_BASELINE,this._clipRow(v);let C=!1;this._optionsService.rawOptions.customGlyphs!==!1&&(C=(0,f.tryDrawCustomChar)(this._ctx,d.getChars(),c*this._deviceCellWidth,v*this._deviceCellHeight,this._deviceCellWidth,this._deviceCellHeight,this._optionsService.rawOptions.fontSize,this._coreBrowserService.dpr)),C||this._ctx.fillText(d.getChars(),c*this._deviceCellWidth+this._deviceCharLeft,v*this._deviceCellHeight+this._deviceCharTop+this._deviceCharHeight)}_drawChars(d,c,v){var L,M,B,P;let C=d.getChars(),k=d.getCode(),D=d.getWidth();if(this._cellColorResolver.resolve(d,c,this._bufferService.buffer.ydisp+v,this._deviceCellWidth),!this._charAtlas)return;let x;if(x=C&&C.length>1?this._charAtlas.getRasterizedGlyphCombinedChar(C,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0):this._charAtlas.getRasterizedGlyph(d.getCode()||s.WHITESPACE_CELL_CODE,this._cellColorResolver.result.bg,this._cellColorResolver.result.fg,this._cellColorResolver.result.ext,!0),!x.size.x||!x.size.y)return;this._ctx.save(),this._clipRow(v),this._bitmapGenerator[x.texturePage]&&this._charAtlas.pages[x.texturePage].canvas!==this._bitmapGenerator[x.texturePage].canvas&&((M=(L=this._bitmapGenerator[x.texturePage])==null?void 0:L.bitmap)==null||M.close(),delete this._bitmapGenerator[x.texturePage]),this._charAtlas.pages[x.texturePage].version!==((B=this._bitmapGenerator[x.texturePage])==null?void 0:B.version)&&(this._bitmapGenerator[x.texturePage]||(this._bitmapGenerator[x.texturePage]=new h(this._charAtlas.pages[x.texturePage].canvas)),this._bitmapGenerator[x.texturePage].refresh(),this._bitmapGenerator[x.texturePage].version=this._charAtlas.pages[x.texturePage].version);let y=x.size.x;this._optionsService.rawOptions.rescaleOverlappingGlyphs&&(0,p.allowRescaling)(k,D,x.size.x,this._deviceCellWidth)&&(y=this._deviceCellWidth-1),this._ctx.drawImage(((P=this._bitmapGenerator[x.texturePage])==null?void 0:P.bitmap)||this._charAtlas.pages[x.texturePage].canvas,x.texturePosition.x,x.texturePosition.y,x.size.x,x.size.y,c*this._deviceCellWidth+this._deviceCharLeft-x.offset.x,v*this._deviceCellHeight+this._deviceCharTop-x.offset.y,y,x.size.y),this._ctx.restore()}_clipRow(d){this._ctx.beginPath(),this._ctx.rect(0,d*this._deviceCellHeight,this._bufferService.cols*this._deviceCellWidth,this._deviceCellHeight),this._ctx.clip()}_getFont(d,c){return`${c?"italic":""} ${d?this._optionsService.rawOptions.fontWeightBold:this._optionsService.rawOptions.fontWeight} ${this._optionsService.rawOptions.fontSize*this._coreBrowserService.dpr}px ${this._optionsService.rawOptions.fontFamily}`}}t.BaseRenderLayer=i;class h{get bitmap(){return this._bitmap}constructor(d){this.canvas=d,this._state=0,this._commitTimeout=void 0,this._bitmap=void 0,this.version=-1}refresh(){var d;(d=this._bitmap)==null||d.close(),this._bitmap=void 0,o.isSafari||(this._commitTimeout===void 0&&(this._commitTimeout=window.setTimeout((()=>this._generate()),100)),this._state===1&&(this._state=2))}_generate(){var d;this._state===0&&((d=this._bitmap)==null||d.close(),this._bitmap=void 0,this._state=1,window.createImageBitmap(this.canvas).then((c=>{this._state===2?this.refresh():this._bitmap=c,this._state=0})),this._commitTimeout&&(this._commitTimeout=void 0))}}},949:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CanvasRenderer=void 0;let l=a(627),u=a(56),n=a(374),f=a(345),p=a(859),S=a(873),r=a(43),e=a(630),o=a(744);class s extends p.Disposable{constructor(h,m,d,c,v,C,k,D,x,y,L){super(),this._terminal=h,this._screenElement=m,this._bufferService=c,this._charSizeService=v,this._optionsService=C,this._coreBrowserService=x,this._themeService=L,this._observerDisposable=this.register(new p.MutableDisposable),this._onRequestRedraw=this.register(new f.EventEmitter),this.onRequestRedraw=this._onRequestRedraw.event,this._onChangeTextureAtlas=this.register(new f.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new f.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event;let M=this._optionsService.rawOptions.allowTransparency;this._renderLayers=[new o.TextRenderLayer(this._terminal,this._screenElement,0,M,this._bufferService,this._optionsService,k,y,this._coreBrowserService,L),new e.SelectionRenderLayer(this._terminal,this._screenElement,1,this._bufferService,this._coreBrowserService,y,this._optionsService,L),new r.LinkRenderLayer(this._terminal,this._screenElement,2,d,this._bufferService,this._optionsService,y,this._coreBrowserService,L),new S.CursorRenderLayer(this._terminal,this._screenElement,3,this._onRequestRedraw,this._bufferService,this._optionsService,D,this._coreBrowserService,y,L)];for(let B of this._renderLayers)(0,f.forwardEvent)(B.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas);this.dimensions=(0,n.createRenderDimensions)(),this._devicePixelRatio=this._coreBrowserService.dpr,this._updateDimensions(),this._observerDisposable.value=(0,u.observeDevicePixelDimensions)(this._renderLayers[0].canvas,this._coreBrowserService.window,((B,P)=>this._setCanvasDevicePixelDimensions(B,P))),this.register(this._coreBrowserService.onWindowChange((B=>{this._observerDisposable.value=(0,u.observeDevicePixelDimensions)(this._renderLayers[0].canvas,B,((P,H)=>this._setCanvasDevicePixelDimensions(P,H)))}))),this.register((0,p.toDisposable)((()=>{for(let B of this._renderLayers)B.dispose();(0,l.removeTerminalFromCache)(this._terminal)})))}get textureAtlas(){return this._renderLayers[0].cacheCanvas}handleDevicePixelRatioChange(){this._devicePixelRatio!==this._coreBrowserService.dpr&&(this._devicePixelRatio=this._coreBrowserService.dpr,this.handleResize(this._bufferService.cols,this._bufferService.rows))}handleResize(h,m){this._updateDimensions();for(let d of this._renderLayers)d.resize(this.dimensions);this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}handleCharSizeChanged(){this.handleResize(this._bufferService.cols,this._bufferService.rows)}handleBlur(){this._runOperation((h=>h.handleBlur()))}handleFocus(){this._runOperation((h=>h.handleFocus()))}handleSelectionChanged(h,m,d=!1){this._runOperation((c=>c.handleSelectionChanged(h,m,d))),this._themeService.colors.selectionForeground&&this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}handleCursorMove(){this._runOperation((h=>h.handleCursorMove()))}clear(){this._runOperation((h=>h.reset()))}_runOperation(h){for(let m of this._renderLayers)h(m)}renderRows(h,m){for(let d of this._renderLayers)d.handleGridChanged(h,m)}clearTextureAtlas(){for(let h of this._renderLayers)h.clearTextureAtlas()}_updateDimensions(){if(!this._charSizeService.hasValidSize)return;let h=this._coreBrowserService.dpr;this.dimensions.device.char.width=Math.floor(this._charSizeService.width*h),this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*h),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.top=this._optionsService.rawOptions.lineHeight===1?0:Math.round((this.dimensions.device.cell.height-this.dimensions.device.char.height)/2),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.char.left=Math.floor(this._optionsService.rawOptions.letterSpacing/2),this.dimensions.device.canvas.height=this._bufferService.rows*this.dimensions.device.cell.height,this.dimensions.device.canvas.width=this._bufferService.cols*this.dimensions.device.cell.width,this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/h),this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/h),this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows,this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols}_setCanvasDevicePixelDimensions(h,m){this.dimensions.device.canvas.height=m,this.dimensions.device.canvas.width=h;for(let d of this._renderLayers)d.resize(this.dimensions);this._requestRedrawViewport()}_requestRedrawViewport(){this._onRequestRedraw.fire({start:0,end:this._bufferService.rows-1})}}t.CanvasRenderer=s},873:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CursorRenderLayer=void 0;let l=a(457),u=a(859),n=a(399),f=a(782),p=a(903);class S extends p.BaseRenderLayer{constructor(e,o,s,i,h,m,d,c,v,C){super(e,o,"cursor",s,!0,C,h,m,v,c),this._onRequestRedraw=i,this._coreService=d,this._cursorBlinkStateManager=this.register(new u.MutableDisposable),this._cell=new f.CellData,this._state={x:0,y:0,isFocused:!1,style:"",width:0},this._cursorRenderers={bar:this._renderBarCursor.bind(this),block:this._renderBlockCursor.bind(this),underline:this._renderUnderlineCursor.bind(this),outline:this._renderOutlineCursor.bind(this)},this.register(m.onOptionChange((()=>this._handleOptionsChanged()))),this._handleOptionsChanged()}resize(e){super.resize(e),this._state={x:0,y:0,isFocused:!1,style:"",width:0}}reset(){var e;this._clearCursor(),(e=this._cursorBlinkStateManager.value)==null||e.restartBlinkAnimation(),this._handleOptionsChanged()}handleBlur(){var e;(e=this._cursorBlinkStateManager.value)==null||e.pause(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleFocus(){var e;(e=this._cursorBlinkStateManager.value)==null||e.resume(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}_handleOptionsChanged(){this._optionsService.rawOptions.cursorBlink?this._cursorBlinkStateManager.value||(this._cursorBlinkStateManager.value=new l.CursorBlinkStateManager((()=>this._render(!0)),this._coreBrowserService)):this._cursorBlinkStateManager.clear(),this._onRequestRedraw.fire({start:this._bufferService.buffer.y,end:this._bufferService.buffer.y})}handleCursorMove(){var e;(e=this._cursorBlinkStateManager.value)==null||e.restartBlinkAnimation()}handleGridChanged(e,o){!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isPaused?this._render(!1):this._cursorBlinkStateManager.value.restartBlinkAnimation()}_render(e){if(!this._coreService.isCursorInitialized||this._coreService.isCursorHidden)return void this._clearCursor();let o=this._bufferService.buffer.ybase+this._bufferService.buffer.y,s=o-this._bufferService.buffer.ydisp;if(s<0||s>=this._bufferService.rows)return void this._clearCursor();let i=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1);if(this._bufferService.buffer.lines.get(o).loadCell(i,this._cell),this._cell.content!==void 0){if(!this._coreBrowserService.isFocused){this._clearCursor(),this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css;let h=this._optionsService.rawOptions.cursorStyle,m=this._optionsService.rawOptions.cursorInactiveStyle;m&&m!=="none"&&this._cursorRenderers[m](i,s,this._cell),this._ctx.restore(),this._state.x=i,this._state.y=s,this._state.isFocused=!1,this._state.style=h,this._state.width=this._cell.getWidth();return}if(!this._cursorBlinkStateManager.value||this._cursorBlinkStateManager.value.isCursorVisible){if(this._state){if(this._state.x===i&&this._state.y===s&&this._state.isFocused===this._coreBrowserService.isFocused&&this._state.style===this._optionsService.rawOptions.cursorStyle&&this._state.width===this._cell.getWidth())return;this._clearCursor()}this._ctx.save(),this._cursorRenderers[this._optionsService.rawOptions.cursorStyle||"block"](i,s,this._cell),this._ctx.restore(),this._state.x=i,this._state.y=s,this._state.isFocused=!1,this._state.style=this._optionsService.rawOptions.cursorStyle,this._state.width=this._cell.getWidth()}else this._clearCursor()}}_clearCursor(){this._state&&(this._state=(n.isFirefox||this._coreBrowserService.dpr<1?this._clearAll():this._clearCells(this._state.x,this._state.y,this._state.width,1),{x:0,y:0,isFocused:!1,style:"",width:0}))}_renderBarCursor(e,o,s){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillLeftLineAtCell(e,o,this._optionsService.rawOptions.cursorWidth),this._ctx.restore()}_renderBlockCursor(e,o,s){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillCells(e,o,s.getWidth(),1),this._ctx.fillStyle=this._themeService.colors.cursorAccent.css,this._fillCharTrueColor(s,e,o),this._ctx.restore()}_renderUnderlineCursor(e,o,s){this._ctx.save(),this._ctx.fillStyle=this._themeService.colors.cursor.css,this._fillBottomLineAtCells(e,o),this._ctx.restore()}_renderOutlineCursor(e,o,s){this._ctx.save(),this._ctx.strokeStyle=this._themeService.colors.cursor.css,this._strokeRectAtCell(e,o,s.getWidth(),1),this._ctx.restore()}}t.CursorRenderLayer=S},574:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.GridCache=void 0,t.GridCache=class{constructor(){this.cache=[]}resize(a,l){for(let u=0;u<a;u++){this.cache.length<=u&&this.cache.push([]);for(let n=this.cache[u].length;n<l;n++)this.cache[u].push(void 0);this.cache[u].length=l}this.cache.length=a}clear(){for(let a=0;a<this.cache.length;a++)for(let l=0;l<this.cache[a].length;l++)this.cache[a][l]=void 0}}},43:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkRenderLayer=void 0;let l=a(197),u=a(237),n=a(903);class f extends n.BaseRenderLayer{constructor(S,r,e,o,s,i,h,m,d){super(S,r,"link",e,!0,d,s,i,h,m),this.register(o.onShowLinkUnderline((c=>this._handleShowLinkUnderline(c)))),this.register(o.onHideLinkUnderline((c=>this._handleHideLinkUnderline(c))))}resize(S){super.resize(S),this._state=void 0}reset(){this._clearCurrentLink()}_clearCurrentLink(){if(this._state){this._clearCells(this._state.x1,this._state.y1,this._state.cols-this._state.x1,1);let S=this._state.y2-this._state.y1-1;S>0&&this._clearCells(0,this._state.y1+1,this._state.cols,S),this._clearCells(0,this._state.y2,this._state.x2,1),this._state=void 0}}_handleShowLinkUnderline(S){if(S.fg===u.INVERTED_DEFAULT_COLOR?this._ctx.fillStyle=this._themeService.colors.background.css:S.fg&&(0,l.is256Color)(S.fg)?this._ctx.fillStyle=this._themeService.colors.ansi[S.fg].css:this._ctx.fillStyle=this._themeService.colors.foreground.css,S.y1===S.y2)this._fillBottomLineAtCells(S.x1,S.y1,S.x2-S.x1);else{this._fillBottomLineAtCells(S.x1,S.y1,S.cols-S.x1);for(let r=S.y1+1;r<S.y2;r++)this._fillBottomLineAtCells(0,r,S.cols);this._fillBottomLineAtCells(0,S.y2,S.x2)}this._state=S}_handleHideLinkUnderline(S){this._clearCurrentLink()}}t.LinkRenderLayer=f},630:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionRenderLayer=void 0;let l=a(903);class u extends l.BaseRenderLayer{constructor(f,p,S,r,e,o,s,i){super(f,p,"selection",S,!0,i,r,s,o,e),this._clearState()}_clearState(){this._state={start:void 0,end:void 0,columnSelectMode:void 0,ydisp:void 0}}resize(f){super.resize(f),this._selectionModel.selectionStart&&this._selectionModel.selectionEnd&&(this._clearState(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode))}reset(){this._state.start&&this._state.end&&(this._clearState(),this._clearAll())}handleBlur(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleFocus(){this.reset(),this._redrawSelection(this._selectionModel.selectionStart,this._selectionModel.selectionEnd,this._selectionModel.columnSelectMode)}handleSelectionChanged(f,p,S){super.handleSelectionChanged(f,p,S),this._redrawSelection(f,p,S)}_redrawSelection(f,p,S){if(!this._didStateChange(f,p,S,this._bufferService.buffer.ydisp))return;if(this._clearAll(),!f||!p)return void this._clearState();let r=f[1]-this._bufferService.buffer.ydisp,e=p[1]-this._bufferService.buffer.ydisp,o=Math.max(r,0),s=Math.min(e,this._bufferService.rows-1);if(o>=this._bufferService.rows||s<0)this._state.ydisp=this._bufferService.buffer.ydisp;else{if(this._ctx.fillStyle=(this._coreBrowserService.isFocused?this._themeService.colors.selectionBackgroundTransparent:this._themeService.colors.selectionInactiveBackgroundTransparent).css,S){let i=f[0],h=p[0]-i,m=s-o+1;this._fillCells(i,o,h,m)}else{let i=r===o?f[0]:0,h=o===e?p[0]:this._bufferService.cols;this._fillCells(i,o,h-i,1);let m=Math.max(s-o-1,0);if(this._fillCells(0,o+1,this._bufferService.cols,m),o!==s){let d=e===s?p[0]:this._bufferService.cols;this._fillCells(0,s,d,1)}}this._state.start=[f[0],f[1]],this._state.end=[p[0],p[1]],this._state.columnSelectMode=S,this._state.ydisp=this._bufferService.buffer.ydisp}}_didStateChange(f,p,S,r){return!this._areCoordinatesEqual(f,this._state.start)||!this._areCoordinatesEqual(p,this._state.end)||S!==this._state.columnSelectMode||r!==this._state.ydisp}_areCoordinatesEqual(f,p){return!(!f||!p)&&f[0]===p[0]&&f[1]===p[1]}}t.SelectionRenderLayer=u},744:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextRenderLayer=void 0;let l=a(577),u=a(147),n=a(782),f=a(855),p=a(903),S=a(574);class r extends p.BaseRenderLayer{constructor(o,s,i,h,m,d,c,v,C,k){super(o,s,"text",i,h,k,m,d,v,C),this._characterJoinerService=c,this._characterWidth=0,this._characterFont="",this._characterOverlapCache={},this._workCell=new n.CellData,this._state=new S.GridCache,this.register(d.onSpecificOptionChange("allowTransparency",(D=>this._setTransparency(D))))}resize(o){super.resize(o);let s=this._getFont(!1,!1);this._characterWidth===o.device.char.width&&this._characterFont===s||(this._characterWidth=o.device.char.width,this._characterFont=s,this._characterOverlapCache={}),this._state.clear(),this._state.resize(this._bufferService.cols,this._bufferService.rows)}reset(){this._state.clear(),this._clearAll()}_forEachCell(o,s,i){for(let h=o;h<=s;h++){let m=h+this._bufferService.buffer.ydisp,d=this._bufferService.buffer.lines.get(m),c=this._characterJoinerService.getJoinedCharacters(m);for(let v=0;v<this._bufferService.cols;v++){d.loadCell(v,this._workCell);let C=this._workCell,k=!1,D=v;if(C.getWidth()!==0){if(c.length>0&&v===c[0][0]){k=!0;let x=c.shift();C=new l.JoinedCellData(this._workCell,d.translateToString(!0,x[0],x[1]),x[1]-x[0]),D=x[1]-1}!k&&this._isOverlapping(C)&&D<d.length-1&&d.getCodePoint(D+1)===f.NULL_CELL_CODE&&(C.content&=-12582913,C.content|=8388608),i(C,v,h),v=D}}}}_drawBackground(o,s){let i=this._ctx,h=this._bufferService.cols,m=0,d=0,c=null;i.save(),this._forEachCell(o,s,((v,C,k)=>{let D=null;v.isInverse()?D=v.isFgDefault()?this._themeService.colors.foreground.css:v.isFgRGB()?`rgb(${u.AttributeData.toColorRGB(v.getFgColor()).join(",")})`:this._themeService.colors.ansi[v.getFgColor()].css:v.isBgRGB()?D=`rgb(${u.AttributeData.toColorRGB(v.getBgColor()).join(",")})`:v.isBgPalette()&&(D=this._themeService.colors.ansi[v.getBgColor()].css);let x=!1;this._decorationService.forEachDecorationAtCell(C,this._bufferService.buffer.ydisp+k,void 0,(y=>{y.options.layer!=="top"&&x||(y.backgroundColorRGB&&(D=y.backgroundColorRGB.css),x=y.options.layer==="top")})),c===null&&(m=C,d=k),k===d?c!==D&&(i.fillStyle=c||"",this._fillCells(m,d,C-m,1),m=C,d=k):(i.fillStyle=c||"",this._fillCells(m,d,h-m,1),m=C,d=k),c=D})),c!==null&&(i.fillStyle=c,this._fillCells(m,d,h-m,1)),i.restore()}_drawForeground(o,s){this._forEachCell(o,s,((i,h,m)=>this._drawChars(i,h,m)))}handleGridChanged(o,s){this._state.cache.length!==0&&(this._charAtlas&&this._charAtlas.beginFrame(),this._clearCells(0,o,this._bufferService.cols,s-o+1),this._drawBackground(o,s),this._drawForeground(o,s))}_isOverlapping(o){if(o.getWidth()!==1||o.getCode()<256)return!1;let s=o.getChars();if(this._characterOverlapCache.hasOwnProperty(s))return this._characterOverlapCache[s];this._ctx.save(),this._ctx.font=this._characterFont;let i=Math.floor(this._ctx.measureText(s).width)>this._characterWidth;return this._ctx.restore(),this._characterOverlapCache[s]=i,i}}t.TextRenderLayer=r},274:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellColorResolver=void 0;let l=a(855),u=a(160),n=a(374),f,p=0,S=0,r=!1,e=!1,o=!1,s=0;t.CellColorResolver=class{constructor(i,h,m,d,c,v){this._terminal=i,this._optionService=h,this._selectionRenderModel=m,this._decorationService=d,this._coreBrowserService=c,this._themeService=v,this.result={fg:0,bg:0,ext:0}}resolve(i,h,m,d){if(this.result.bg=i.bg,this.result.fg=i.fg,this.result.ext=268435456&i.bg?i.extended.ext:0,S=0,p=0,e=!1,r=!1,o=!1,f=this._themeService.colors,s=0,i.getCode()!==l.NULL_CELL_CODE&&i.extended.underlineStyle===4){let c=Math.max(1,Math.floor(this._optionService.rawOptions.fontSize*this._coreBrowserService.dpr/15));s=h*d%(2*Math.round(c))}if(this._decorationService.forEachDecorationAtCell(h,m,"bottom",(c=>{c.backgroundColorRGB&&(S=c.backgroundColorRGB.rgba>>8&16777215,e=!0),c.foregroundColorRGB&&(p=c.foregroundColorRGB.rgba>>8&16777215,r=!0)})),o=this._selectionRenderModel.isCellSelected(this._terminal,h,m),o){if(67108864&this.result.fg||50331648&this.result.bg){if(67108864&this.result.fg)switch(50331648&this.result.fg){case 16777216:case 33554432:S=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:S=(16777215&this.result.fg)<<8|255;break;default:S=this._themeService.colors.foreground.rgba}else switch(50331648&this.result.bg){case 16777216:case 33554432:S=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:S=(16777215&this.result.bg)<<8|255}S=u.rgba.blend(S,4294967040&(this._coreBrowserService.isFocused?f.selectionBackgroundOpaque:f.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}else S=(this._coreBrowserService.isFocused?f.selectionBackgroundOpaque:f.selectionInactiveBackgroundOpaque).rgba>>8&16777215;if(e=!0,f.selectionForeground&&(p=f.selectionForeground.rgba>>8&16777215,r=!0),(0,n.treatGlyphAsBackgroundColor)(i.getCode())){if(67108864&this.result.fg&&!(50331648&this.result.bg))p=(this._coreBrowserService.isFocused?f.selectionBackgroundOpaque:f.selectionInactiveBackgroundOpaque).rgba>>8&16777215;else{if(67108864&this.result.fg)switch(50331648&this.result.bg){case 16777216:case 33554432:p=this._themeService.colors.ansi[255&this.result.bg].rgba;break;case 50331648:p=(16777215&this.result.bg)<<8|255}else switch(50331648&this.result.fg){case 16777216:case 33554432:p=this._themeService.colors.ansi[255&this.result.fg].rgba;break;case 50331648:p=(16777215&this.result.fg)<<8|255;break;default:p=this._themeService.colors.foreground.rgba}p=u.rgba.blend(p,4294967040&(this._coreBrowserService.isFocused?f.selectionBackgroundOpaque:f.selectionInactiveBackgroundOpaque).rgba|128)>>8&16777215}r=!0}}this._decorationService.forEachDecorationAtCell(h,m,"top",(c=>{c.backgroundColorRGB&&(S=c.backgroundColorRGB.rgba>>8&16777215,e=!0),c.foregroundColorRGB&&(p=c.foregroundColorRGB.rgba>>8&16777215,r=!0)})),e&&(S=o?i.bg&-150994944|S|50331648:-16777216&i.bg|S|50331648),r&&(p=i.fg&-83886080|p|50331648),67108864&this.result.fg&&(e&&!r&&(p=50331648&this.result.bg?-134217728&this.result.fg|67108863&this.result.bg:-134217728&this.result.fg|16777215&f.background.rgba>>8|50331648,r=!0),!e&&r&&(S=50331648&this.result.fg?-67108864&this.result.bg|67108863&this.result.fg:-67108864&this.result.bg|16777215&f.foreground.rgba>>8|50331648,e=!0)),f=void 0,this.result.bg=e?S:this.result.bg,this.result.fg=r?p:this.result.fg,this.result.ext&=536870911,this.result.ext|=s<<29&3758096384}}},627:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.removeTerminalFromCache=t.acquireTextureAtlas=void 0;let l=a(509),u=a(197),n=[];t.acquireTextureAtlas=function(f,p,S,r,e,o,s,i){let h=(0,u.generateConfig)(r,e,o,s,p,S,i);for(let c=0;c<n.length;c++){let v=n[c],C=v.ownedBy.indexOf(f);if(C>=0){if((0,u.configEquals)(v.config,h))return v.atlas;v.ownedBy.length===1?(v.atlas.dispose(),n.splice(c,1)):v.ownedBy.splice(C,1);break}}for(let c=0;c<n.length;c++){let v=n[c];if((0,u.configEquals)(v.config,h))return v.ownedBy.push(f),v.atlas}let m=f._core,d={atlas:new l.TextureAtlas(document,h,m.unicodeService),config:h,ownedBy:[f]};return n.push(d),d.atlas},t.removeTerminalFromCache=function(f){for(let p=0;p<n.length;p++){let S=n[p].ownedBy.indexOf(f);if(S!==-1){n[p].ownedBy.length===1?(n[p].atlas.dispose(),n.splice(p,1)):n[p].ownedBy.splice(S,1);break}}}},197:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.is256Color=t.configEquals=t.generateConfig=void 0;let l=a(160);t.generateConfig=function(u,n,f,p,S,r,e){let o={foreground:r.foreground,background:r.background,cursor:l.NULL_COLOR,cursorAccent:l.NULL_COLOR,selectionForeground:l.NULL_COLOR,selectionBackgroundTransparent:l.NULL_COLOR,selectionBackgroundOpaque:l.NULL_COLOR,selectionInactiveBackgroundTransparent:l.NULL_COLOR,selectionInactiveBackgroundOpaque:l.NULL_COLOR,ansi:r.ansi.slice(),contrastCache:r.contrastCache,halfContrastCache:r.halfContrastCache};return{customGlyphs:S.customGlyphs,devicePixelRatio:e,letterSpacing:S.letterSpacing,lineHeight:S.lineHeight,deviceCellWidth:u,deviceCellHeight:n,deviceCharWidth:f,deviceCharHeight:p,fontFamily:S.fontFamily,fontSize:S.fontSize,fontWeight:S.fontWeight,fontWeightBold:S.fontWeightBold,allowTransparency:S.allowTransparency,drawBoldTextInBrightColors:S.drawBoldTextInBrightColors,minimumContrastRatio:S.minimumContrastRatio,colors:o}},t.configEquals=function(u,n){for(let f=0;f<u.colors.ansi.length;f++)if(u.colors.ansi[f].rgba!==n.colors.ansi[f].rgba)return!1;return u.devicePixelRatio===n.devicePixelRatio&&u.customGlyphs===n.customGlyphs&&u.lineHeight===n.lineHeight&&u.letterSpacing===n.letterSpacing&&u.fontFamily===n.fontFamily&&u.fontSize===n.fontSize&&u.fontWeight===n.fontWeight&&u.fontWeightBold===n.fontWeightBold&&u.allowTransparency===n.allowTransparency&&u.deviceCharWidth===n.deviceCharWidth&&u.deviceCharHeight===n.deviceCharHeight&&u.drawBoldTextInBrightColors===n.drawBoldTextInBrightColors&&u.minimumContrastRatio===n.minimumContrastRatio&&u.colors.foreground.rgba===n.colors.foreground.rgba&&u.colors.background.rgba===n.colors.background.rgba},t.is256Color=function(u){return(50331648&u)==16777216||(50331648&u)==33554432}},237:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;let l=a(399);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=l.isFirefox||l.isLegacyEdge?"bottom":"ideographic"},457:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CursorBlinkStateManager=void 0,t.CursorBlinkStateManager=class{constructor(a,l){this._renderCallback=a,this._coreBrowserService=l,this.isCursorVisible=!0,this._coreBrowserService.isFocused&&this._restartInterval()}get isPaused(){return!(this._blinkStartTimeout||this._blinkInterval)}dispose(){this._blinkInterval&&(this._blinkInterval=(this._coreBrowserService.window.clearInterval(this._blinkInterval),void 0)),this._blinkStartTimeout&&(this._blinkStartTimeout=(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),void 0)),this._animationFrame&&(this._animationFrame=(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),void 0))}restartBlinkAnimation(){this.isPaused||(this._animationTimeRestarted=Date.now(),this.isCursorVisible=!0,this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0}))))}_restartInterval(a=600){this._blinkInterval&&(this._blinkInterval=(this._coreBrowserService.window.clearInterval(this._blinkInterval),void 0)),this._blinkStartTimeout=this._coreBrowserService.window.setTimeout((()=>{if(this._animationTimeRestarted){let l=600-(Date.now()-this._animationTimeRestarted);if(this._animationTimeRestarted=void 0,l>0)return void this._restartInterval(l)}this.isCursorVisible=!1,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0})),this._blinkInterval=this._coreBrowserService.window.setInterval((()=>{if(this._animationTimeRestarted){let l=600-(Date.now()-this._animationTimeRestarted);this._animationTimeRestarted=void 0,this._restartInterval(l);return}this.isCursorVisible=!this.isCursorVisible,this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._renderCallback(),this._animationFrame=void 0}))}),600)}),a)}pause(){this.isCursorVisible=!0,this._blinkInterval&&(this._blinkInterval=(this._coreBrowserService.window.clearInterval(this._blinkInterval),void 0)),this._blinkStartTimeout&&(this._blinkStartTimeout=(this._coreBrowserService.window.clearTimeout(this._blinkStartTimeout),void 0)),this._animationFrame&&(this._animationFrame=(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),void 0))}resume(){this.pause(),this._animationTimeRestarted=void 0,this._restartInterval(),this.restartBlinkAnimation()}}},860:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tryDrawCustomChar=t.powerlineDefinitions=t.boxDrawingDefinitions=t.blockElementDefinitions=void 0;let l=a(374);t.blockElementDefinitions={"\u2580":[{x:0,y:0,w:8,h:4}],"\u2581":[{x:0,y:7,w:8,h:1}],"\u2582":[{x:0,y:6,w:8,h:2}],"\u2583":[{x:0,y:5,w:8,h:3}],"\u2584":[{x:0,y:4,w:8,h:4}],"\u2585":[{x:0,y:3,w:8,h:5}],"\u2586":[{x:0,y:2,w:8,h:6}],"\u2587":[{x:0,y:1,w:8,h:7}],"\u2588":[{x:0,y:0,w:8,h:8}],"\u2589":[{x:0,y:0,w:7,h:8}],"\u258A":[{x:0,y:0,w:6,h:8}],"\u258B":[{x:0,y:0,w:5,h:8}],"\u258C":[{x:0,y:0,w:4,h:8}],"\u258D":[{x:0,y:0,w:3,h:8}],"\u258E":[{x:0,y:0,w:2,h:8}],"\u258F":[{x:0,y:0,w:1,h:8}],"\u2590":[{x:4,y:0,w:4,h:8}],"\u2594":[{x:0,y:0,w:8,h:1}],"\u2595":[{x:7,y:0,w:1,h:8}],"\u2596":[{x:0,y:4,w:4,h:4}],"\u2597":[{x:4,y:4,w:4,h:4}],"\u2598":[{x:0,y:0,w:4,h:4}],"\u2599":[{x:0,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u259A":[{x:0,y:0,w:4,h:4},{x:4,y:4,w:4,h:4}],"\u259B":[{x:0,y:0,w:4,h:8},{x:4,y:0,w:4,h:4}],"\u259C":[{x:0,y:0,w:8,h:4},{x:4,y:0,w:4,h:8}],"\u259D":[{x:4,y:0,w:4,h:4}],"\u259E":[{x:4,y:0,w:4,h:4},{x:0,y:4,w:4,h:4}],"\u259F":[{x:4,y:0,w:4,h:8},{x:0,y:4,w:8,h:4}],"\u{1FB70}":[{x:1,y:0,w:1,h:8}],"\u{1FB71}":[{x:2,y:0,w:1,h:8}],"\u{1FB72}":[{x:3,y:0,w:1,h:8}],"\u{1FB73}":[{x:4,y:0,w:1,h:8}],"\u{1FB74}":[{x:5,y:0,w:1,h:8}],"\u{1FB75}":[{x:6,y:0,w:1,h:8}],"\u{1FB76}":[{x:0,y:1,w:8,h:1}],"\u{1FB77}":[{x:0,y:2,w:8,h:1}],"\u{1FB78}":[{x:0,y:3,w:8,h:1}],"\u{1FB79}":[{x:0,y:4,w:8,h:1}],"\u{1FB7A}":[{x:0,y:5,w:8,h:1}],"\u{1FB7B}":[{x:0,y:6,w:8,h:1}],"\u{1FB7C}":[{x:0,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB7D}":[{x:0,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7E}":[{x:7,y:0,w:1,h:8},{x:0,y:0,w:8,h:1}],"\u{1FB7F}":[{x:7,y:0,w:1,h:8},{x:0,y:7,w:8,h:1}],"\u{1FB80}":[{x:0,y:0,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB81}":[{x:0,y:0,w:8,h:1},{x:0,y:2,w:8,h:1},{x:0,y:4,w:8,h:1},{x:0,y:7,w:8,h:1}],"\u{1FB82}":[{x:0,y:0,w:8,h:2}],"\u{1FB83}":[{x:0,y:0,w:8,h:3}],"\u{1FB84}":[{x:0,y:0,w:8,h:5}],"\u{1FB85}":[{x:0,y:0,w:8,h:6}],"\u{1FB86}":[{x:0,y:0,w:8,h:7}],"\u{1FB87}":[{x:6,y:0,w:2,h:8}],"\u{1FB88}":[{x:5,y:0,w:3,h:8}],"\u{1FB89}":[{x:3,y:0,w:5,h:8}],"\u{1FB8A}":[{x:2,y:0,w:6,h:8}],"\u{1FB8B}":[{x:1,y:0,w:7,h:8}],"\u{1FB95}":[{x:0,y:0,w:2,h:2},{x:4,y:0,w:2,h:2},{x:2,y:2,w:2,h:2},{x:6,y:2,w:2,h:2},{x:0,y:4,w:2,h:2},{x:4,y:4,w:2,h:2},{x:2,y:6,w:2,h:2},{x:6,y:6,w:2,h:2}],"\u{1FB96}":[{x:2,y:0,w:2,h:2},{x:6,y:0,w:2,h:2},{x:0,y:2,w:2,h:2},{x:4,y:2,w:2,h:2},{x:2,y:4,w:2,h:2},{x:6,y:4,w:2,h:2},{x:0,y:6,w:2,h:2},{x:4,y:6,w:2,h:2}],"\u{1FB97}":[{x:0,y:2,w:8,h:2},{x:0,y:6,w:8,h:2}]};let u={"\u2591":[[1,0,0,0],[0,0,0,0],[0,0,1,0],[0,0,0,0]],"\u2592":[[1,0],[0,0],[0,1],[0,0]],"\u2593":[[0,1],[1,1],[1,0],[1,1]]};t.boxDrawingDefinitions={"\u2500":{1:"M0,.5 L1,.5"},"\u2501":{3:"M0,.5 L1,.5"},"\u2502":{1:"M.5,0 L.5,1"},"\u2503":{3:"M.5,0 L.5,1"},"\u250C":{1:"M0.5,1 L.5,.5 L1,.5"},"\u250F":{3:"M0.5,1 L.5,.5 L1,.5"},"\u2510":{1:"M0,.5 L.5,.5 L.5,1"},"\u2513":{3:"M0,.5 L.5,.5 L.5,1"},"\u2514":{1:"M.5,0 L.5,.5 L1,.5"},"\u2517":{3:"M.5,0 L.5,.5 L1,.5"},"\u2518":{1:"M.5,0 L.5,.5 L0,.5"},"\u251B":{3:"M.5,0 L.5,.5 L0,.5"},"\u251C":{1:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2523":{3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u2524":{1:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252B":{3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u252C":{1:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2533":{3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2534":{1:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253B":{3:"M0,.5 L1,.5 M.5,.5 L.5,0"},"\u253C":{1:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u254B":{3:"M0,.5 L1,.5 M.5,0 L.5,1"},"\u2574":{1:"M.5,.5 L0,.5"},"\u2578":{3:"M.5,.5 L0,.5"},"\u2575":{1:"M.5,.5 L.5,0"},"\u2579":{3:"M.5,.5 L.5,0"},"\u2576":{1:"M.5,.5 L1,.5"},"\u257A":{3:"M.5,.5 L1,.5"},"\u2577":{1:"M.5,.5 L.5,1"},"\u257B":{3:"M.5,.5 L.5,1"},"\u2550":{1:(r,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2551":{1:(r,e)=>`M${.5-r},0 L${.5-r},1 M${.5+r},0 L${.5+r},1`},"\u2552":{1:(r,e)=>`M.5,1 L.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u2553":{1:(r,e)=>`M${.5-r},1 L${.5-r},.5 L1,.5 M${.5+r},.5 L${.5+r},1`},"\u2554":{1:(r,e)=>`M1,${.5-e} L${.5-r},${.5-e} L${.5-r},1 M1,${.5+e} L${.5+r},${.5+e} L${.5+r},1`},"\u2555":{1:(r,e)=>`M0,${.5-e} L.5,${.5-e} L.5,1 M0,${.5+e} L.5,${.5+e}`},"\u2556":{1:(r,e)=>`M${.5+r},1 L${.5+r},.5 L0,.5 M${.5-r},.5 L${.5-r},1`},"\u2557":{1:(r,e)=>`M0,${.5+e} L${.5-r},${.5+e} L${.5-r},1 M0,${.5-e} L${.5+r},${.5-e} L${.5+r},1`},"\u2558":{1:(r,e)=>`M.5,0 L.5,${.5+e} L1,${.5+e} M.5,${.5-e} L1,${.5-e}`},"\u2559":{1:(r,e)=>`M1,.5 L${.5-r},.5 L${.5-r},0 M${.5+r},.5 L${.5+r},0`},"\u255A":{1:(r,e)=>`M1,${.5-e} L${.5+r},${.5-e} L${.5+r},0 M1,${.5+e} L${.5-r},${.5+e} L${.5-r},0`},"\u255B":{1:(r,e)=>`M0,${.5+e} L.5,${.5+e} L.5,0 M0,${.5-e} L.5,${.5-e}`},"\u255C":{1:(r,e)=>`M0,.5 L${.5+r},.5 L${.5+r},0 M${.5-r},.5 L${.5-r},0`},"\u255D":{1:(r,e)=>`M0,${.5-e} L${.5-r},${.5-e} L${.5-r},0 M0,${.5+e} L${.5+r},${.5+e} L${.5+r},0`},"\u255E":{1:(r,e)=>`M.5,0 L.5,1 M.5,${.5-e} L1,${.5-e} M.5,${.5+e} L1,${.5+e}`},"\u255F":{1:(r,e)=>`M${.5-r},0 L${.5-r},1 M${.5+r},0 L${.5+r},1 M${.5+r},.5 L1,.5`},"\u2560":{1:(r,e)=>`M${.5-r},0 L${.5-r},1 M1,${.5+e} L${.5+r},${.5+e} L${.5+r},1 M1,${.5-e} L${.5+r},${.5-e} L${.5+r},0`},"\u2561":{1:(r,e)=>`M.5,0 L.5,1 M0,${.5-e} L.5,${.5-e} M0,${.5+e} L.5,${.5+e}`},"\u2562":{1:(r,e)=>`M0,.5 L${.5-r},.5 M${.5-r},0 L${.5-r},1 M${.5+r},0 L${.5+r},1`},"\u2563":{1:(r,e)=>`M${.5+r},0 L${.5+r},1 M0,${.5+e} L${.5-r},${.5+e} L${.5-r},1 M0,${.5-e} L${.5-r},${.5-e} L${.5-r},0`},"\u2564":{1:(r,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e} M.5,${.5+e} L.5,1`},"\u2565":{1:(r,e)=>`M0,.5 L1,.5 M${.5-r},.5 L${.5-r},1 M${.5+r},.5 L${.5+r},1`},"\u2566":{1:(r,e)=>`M0,${.5-e} L1,${.5-e} M0,${.5+e} L${.5-r},${.5+e} L${.5-r},1 M1,${.5+e} L${.5+r},${.5+e} L${.5+r},1`},"\u2567":{1:(r,e)=>`M.5,0 L.5,${.5-e} M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u2568":{1:(r,e)=>`M0,.5 L1,.5 M${.5-r},.5 L${.5-r},0 M${.5+r},.5 L${.5+r},0`},"\u2569":{1:(r,e)=>`M0,${.5+e} L1,${.5+e} M0,${.5-e} L${.5-r},${.5-e} L${.5-r},0 M1,${.5-e} L${.5+r},${.5-e} L${.5+r},0`},"\u256A":{1:(r,e)=>`M.5,0 L.5,1 M0,${.5-e} L1,${.5-e} M0,${.5+e} L1,${.5+e}`},"\u256B":{1:(r,e)=>`M0,.5 L1,.5 M${.5-r},0 L${.5-r},1 M${.5+r},0 L${.5+r},1`},"\u256C":{1:(r,e)=>`M0,${.5+e} L${.5-r},${.5+e} L${.5-r},1 M1,${.5+e} L${.5+r},${.5+e} L${.5+r},1 M0,${.5-e} L${.5-r},${.5-e} L${.5-r},0 M1,${.5-e} L${.5+r},${.5-e} L${.5+r},0`},"\u2571":{1:"M1,0 L0,1"},"\u2572":{1:"M0,0 L1,1"},"\u2573":{1:"M1,0 L0,1 M0,0 L1,1"},"\u257C":{1:"M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u257D":{1:"M.5,.5 L.5,0",3:"M.5,.5 L.5,1"},"\u257E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u257F":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u250D":{1:"M.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u250E":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2511":{1:"M.5,.5 L.5,1",3:"M.5,.5 L0,.5"},"\u2512":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2515":{1:"M.5,.5 L.5,0",3:"M.5,.5 L1,.5"},"\u2516":{1:"M.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2519":{1:"M.5,.5 L.5,0",3:"M.5,.5 L0,.5"},"\u251A":{1:"M.5,.5 L0,.5",3:"M.5,.5 L.5,0"},"\u251D":{1:"M.5,0 L.5,1",3:"M.5,.5 L1,.5"},"\u251E":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u251F":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2520":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2521":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2522":{1:"M.5,.5 L.5,0",3:"M0.5,1 L.5,.5 L1,.5"},"\u2525":{1:"M.5,0 L.5,1",3:"M.5,.5 L0,.5"},"\u2526":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2527":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L.5,1"},"\u2528":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1"},"\u2529":{1:"M.5,.5 L.5,1",3:"M.5,0 L.5,.5 L0,.5"},"\u252A":{1:"M.5,.5 L.5,0",3:"M0,.5 L.5,.5 L.5,1"},"\u252D":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u252E":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,.5 L1,.5"},"\u252F":{1:"M.5,.5 L.5,1",3:"M0,.5 L1,.5"},"\u2530":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2531":{1:"M.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2532":{1:"M.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2535":{1:"M.5,0 L.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u2536":{1:"M.5,0 L.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u2537":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5"},"\u2538":{1:"M0,.5 L1,.5",3:"M.5,.5 L.5,0"},"\u2539":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u253A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,.5 L1,.5"},"\u253D":{1:"M.5,0 L.5,1 M.5,.5 L1,.5",3:"M.5,.5 L0,.5"},"\u253E":{1:"M.5,0 L.5,1 M.5,.5 L0,.5",3:"M.5,.5 L1,.5"},"\u253F":{1:"M.5,0 L.5,1",3:"M0,.5 L1,.5"},"\u2540":{1:"M0,.5 L1,.5 M.5,.5 L.5,1",3:"M.5,.5 L.5,0"},"\u2541":{1:"M.5,.5 L.5,0 M0,.5 L1,.5",3:"M.5,.5 L.5,1"},"\u2542":{1:"M0,.5 L1,.5",3:"M.5,0 L.5,1"},"\u2543":{1:"M0.5,1 L.5,.5 L1,.5",3:"M.5,0 L.5,.5 L0,.5"},"\u2544":{1:"M0,.5 L.5,.5 L.5,1",3:"M.5,0 L.5,.5 L1,.5"},"\u2545":{1:"M.5,0 L.5,.5 L1,.5",3:"M0,.5 L.5,.5 L.5,1"},"\u2546":{1:"M.5,0 L.5,.5 L0,.5",3:"M0.5,1 L.5,.5 L1,.5"},"\u2547":{1:"M.5,.5 L.5,1",3:"M.5,.5 L.5,0 M0,.5 L1,.5"},"\u2548":{1:"M.5,.5 L.5,0",3:"M0,.5 L1,.5 M.5,.5 L.5,1"},"\u2549":{1:"M.5,.5 L1,.5",3:"M.5,0 L.5,1 M.5,.5 L0,.5"},"\u254A":{1:"M.5,.5 L0,.5",3:"M.5,0 L.5,1 M.5,.5 L1,.5"},"\u254C":{1:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u254D":{3:"M.1,.5 L.4,.5 M.6,.5 L.9,.5"},"\u2504":{1:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2505":{3:"M.0667,.5 L.2667,.5 M.4,.5 L.6,.5 M.7333,.5 L.9333,.5"},"\u2508":{1:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u2509":{3:"M.05,.5 L.2,.5 M.3,.5 L.45,.5 M.55,.5 L.7,.5 M.8,.5 L.95,.5"},"\u254E":{1:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u254F":{3:"M.5,.1 L.5,.4 M.5,.6 L.5,.9"},"\u2506":{1:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u2507":{3:"M.5,.0667 L.5,.2667 M.5,.4 L.5,.6 M.5,.7333 L.5,.9333"},"\u250A":{1:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u250B":{3:"M.5,.05 L.5,.2 M.5,.3 L.5,.45 L.5,.55 M.5,.7 L.5,.95"},"\u256D":{1:(r,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,1,.5`},"\u256E":{1:(r,e)=>`M.5,1 L.5,${.5+e/.15*.5} C.5,${.5+e/.15*.5},.5,.5,0,.5`},"\u256F":{1:(r,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,0,.5`},"\u2570":{1:(r,e)=>`M.5,0 L.5,${.5-e/.15*.5} C.5,${.5-e/.15*.5},.5,.5,1,.5`}},t.powerlineDefinitions={"\uE0B0":{d:"M0,0 L1,.5 L0,1",type:0,rightPadding:2},"\uE0B1":{d:"M-1,-.5 L1,.5 L-1,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B2":{d:"M1,0 L0,.5 L1,1",type:0,leftPadding:2},"\uE0B3":{d:"M2,-.5 L0,.5 L2,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0B4":{d:"M0,0 L0,1 C0.552,1,1,0.776,1,.5 C1,0.224,0.552,0,0,0",type:0,rightPadding:1},"\uE0B5":{d:"M.2,1 C.422,1,.8,.826,.78,.5 C.8,.174,0.422,0,.2,0",type:1,rightPadding:1},"\uE0B6":{d:"M1,0 L1,1 C0.448,1,0,0.776,0,.5 C0,0.224,0.448,0,1,0",type:0,leftPadding:1},"\uE0B7":{d:"M.8,1 C0.578,1,0.2,.826,.22,.5 C0.2,0.174,0.578,0,0.8,0",type:1,leftPadding:1},"\uE0B8":{d:"M-.5,-.5 L1.5,1.5 L-.5,1.5",type:0},"\uE0B9":{d:"M-.5,-.5 L1.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BA":{d:"M1.5,-.5 L-.5,1.5 L1.5,1.5",type:0},"\uE0BC":{d:"M1.5,-.5 L-.5,1.5 L-.5,-.5",type:0},"\uE0BD":{d:"M1.5,-.5 L-.5,1.5",type:1,leftPadding:1,rightPadding:1},"\uE0BE":{d:"M-.5,-.5 L1.5,1.5 L1.5,-.5",type:0}},t.powerlineDefinitions["\uE0BB"]=t.powerlineDefinitions["\uE0BD"],t.powerlineDefinitions["\uE0BF"]=t.powerlineDefinitions["\uE0B9"],t.tryDrawCustomChar=function(r,e,o,s,i,h,m,d){let c=t.blockElementDefinitions[e];if(c)return(function(D,x,y,L,M,B){for(let P=0;P<x.length;P++){let H=x[P],w=M/8,R=B/8;D.fillRect(y+H.x*w,L+H.y*R,H.w*w,H.h*R)}})(r,c,o,s,i,h),!0;let v=u[e];if(v)return(function(D,x,y,L,M,B){let P=n.get(x);P||(P=new Map,n.set(x,P));let H=D.fillStyle;if(typeof H!="string")throw Error(`Unexpected fillStyle type "${H}"`);let w=P.get(H);if(!w){let R=x[0].length,O=x.length,F=D.canvas.ownerDocument.createElement("canvas");F.width=R,F.height=O;let z=(0,l.throwIfFalsy)(F.getContext("2d")),j=new ImageData(R,O),X,K,W,$;if(H.startsWith("#"))X=parseInt(H.slice(1,3),16),K=parseInt(H.slice(3,5),16),W=parseInt(H.slice(5,7),16),$=H.length>7&&parseInt(H.slice(7,9),16)||1;else{if(!H.startsWith("rgba"))throw Error(`Unexpected fillStyle color format "${H}" when drawing pattern glyph`);[X,K,W,$]=H.substring(5,H.length-1).split(",").map((I=>parseFloat(I)))}for(let I=0;I<O;I++)for(let U=0;U<R;U++)j.data[4*(I*R+U)]=X,j.data[4*(I*R+U)+1]=K,j.data[4*(I*R+U)+2]=W,j.data[4*(I*R+U)+3]=x[I][U]*(255*$);z.putImageData(j,0,0),w=(0,l.throwIfFalsy)(D.createPattern(F,null)),P.set(H,w)}D.fillStyle=w,D.fillRect(y,L,M,B)})(r,v,o,s,i,h),!0;let C=t.boxDrawingDefinitions[e];if(C)return(function(D,x,y,L,M,B,P){D.strokeStyle=D.fillStyle;for(let[H,w]of Object.entries(x)){let R;D.beginPath(),D.lineWidth=P*Number.parseInt(H),R=typeof w=="function"?w(.15,.15/B*M):w;for(let O of R.split(" ")){let F=O[0],z=p[F];if(!z){console.error(`Could not find drawing instructions for "${F}"`);continue}let j=O.substring(1).split(",");j[0]&&j[1]&&z(D,S(j,M,B,y,L,!0,P))}D.stroke(),D.closePath()}})(r,C,o,s,i,h,d),!0;let k=t.powerlineDefinitions[e];return!!k&&((function(D,x,y,L,M,B,P,H){let w=new Path2D;w.rect(y,L,M,B),D.clip(w),D.beginPath();let R=P/12;D.lineWidth=H*R;for(let O of x.d.split(" ")){let F=O[0],z=p[F];if(!z){console.error(`Could not find drawing instructions for "${F}"`);continue}let j=O.substring(1).split(",");j[0]&&j[1]&&z(D,S(j,M,B,y,L,!1,H,(x.leftPadding??0)*(R/2),(x.rightPadding??0)*(R/2)))}x.type===1?(D.strokeStyle=D.fillStyle,D.stroke()):D.fill(),D.closePath()})(r,k,o,s,i,h,m,d),!0)};let n=new Map;function f(r,e,o=0){return Math.max(Math.min(r,e),o)}let p={C:(r,e)=>r.bezierCurveTo(e[0],e[1],e[2],e[3],e[4],e[5]),L:(r,e)=>r.lineTo(e[0],e[1]),M:(r,e)=>r.moveTo(e[0],e[1])};function S(r,e,o,s,i,h,m,d=0,c=0){let v=r.map((C=>parseFloat(C)||parseInt(C)));if(v.length<2)throw Error("Too few arguments for instruction");for(let C=0;C<v.length;C+=2)v[C]*=e-d*m-c*m,h&&v[C]!==0&&(v[C]=f(Math.round(v[C]+.5)-.5,e,0)),v[C]+=s+d*m;for(let C=1;C<v.length;C+=2)v[C]*=o,h&&v[C]!==0&&(v[C]=f(Math.round(v[C]+.5)-.5,o,0)),v[C]+=i;return v}},56:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.observeDevicePixelDimensions=void 0;let l=a(859);t.observeDevicePixelDimensions=function(u,n,f){let p=new n.ResizeObserver((S=>{let r=S.find((s=>s.target===u));if(!r)return;if(!("devicePixelContentBoxSize"in r))return p==null||p.disconnect(),void(p=void 0);let e=r.devicePixelContentBoxSize[0].inlineSize,o=r.devicePixelContentBoxSize[0].blockSize;e>0&&o>0&&f(e,o)}));try{p.observe(u,{box:["device-pixel-content-box"]})}catch{p.disconnect(),p=void 0}return(0,l.toDisposable)((()=>p==null?void 0:p.disconnect()))}},374:(A,t)=>{function a(u){return 57508<=u&&u<=57558}function l(u){return u>=128512&&u<=128591||u>=127744&&u<=128511||u>=128640&&u<=128767||u>=9728&&u<=9983||u>=9984&&u<=10175||u>=65024&&u<=65039||u>=129280&&u<=129535||u>=127462&&u<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(u){if(!u)throw Error("value must not be falsy");return u},t.isPowerlineGlyph=a,t.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},t.isEmoji=l,t.allowRescaling=function(u,n,f,p){return n===1&&f>Math.ceil(1.5*p)&&u!==void 0&&u>255&&!l(u)&&!a(u)&&!(function(S){return 57344<=S&&S<=63743})(u)},t.treatGlyphAsBackgroundColor=function(u){return a(u)||(function(n){return 9472<=n&&n<=9631})(u)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(u,n,f=0){return(u-(2*Math.round(n)-f))%(2*Math.round(n))}},296:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(u,n,f,p=!1){if(this.selectionStart=n,this.selectionEnd=f,!n||!f||n[0]===f[0]&&n[1]===f[1])return void this.clear();let S=u.buffers.active.ydisp,r=n[1]-S,e=f[1]-S,o=Math.max(r,0),s=Math.min(e,u.rows-1);o>=u.rows||s<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=p,this.viewportStartRow=r,this.viewportEndRow=e,this.viewportCappedStartRow=o,this.viewportCappedEndRow=s,this.startCol=n[0],this.endCol=f[0])}isCellSelected(u,n,f){return!!this.hasSelection&&(f-=u.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?n>=this.startCol&&f>=this.viewportCappedStartRow&&n<this.endCol&&f<=this.viewportCappedEndRow:n<this.startCol&&f>=this.viewportCappedStartRow&&n>=this.endCol&&f<=this.viewportCappedEndRow:f>this.viewportStartRow&&f<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&f===this.viewportStartRow&&n>=this.startCol&&n<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportEndRow&&n<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportStartRow&&n>=this.startCol)}}t.createSelectionRenderModel=function(){return new a}},509:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TextureAtlas=void 0;let l=a(237),u=a(860),n=a(374),f=a(160),p=a(345),S=a(485),r=a(385),e=a(147),o=a(855),s={texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},offset:{x:0,y:0},size:{x:0,y:0},sizeClipSpace:{x:0,y:0}},i;class h{get pages(){return this._pages}constructor(C,k,D){this._document=C,this._config=k,this._unicodeService=D,this._didWarmUp=!1,this._cacheMap=new S.FourKeyMap,this._cacheMapCombined=new S.FourKeyMap,this._pages=[],this._activePages=[],this._workBoundingBox={top:0,left:0,bottom:0,right:0},this._workAttributeData=new e.AttributeData,this._textureSize=512,this._onAddTextureAtlasCanvas=new p.EventEmitter,this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event,this._onRemoveTextureAtlasCanvas=new p.EventEmitter,this.onRemoveTextureAtlasCanvas=this._onRemoveTextureAtlasCanvas.event,this._requestClearModel=!1,this._createNewPage(),this._tmpCanvas=c(C,4*this._config.deviceCellWidth+4,this._config.deviceCellHeight+4),this._tmpCtx=(0,n.throwIfFalsy)(this._tmpCanvas.getContext("2d",{alpha:this._config.allowTransparency,willReadFrequently:!0}))}dispose(){for(let C of this.pages)C.canvas.remove();this._onAddTextureAtlasCanvas.dispose()}warmUp(){this._didWarmUp||(this._didWarmUp=(this._doWarmUp(),!0))}_doWarmUp(){let C=new r.IdleTaskQueue;for(let k=33;k<126;k++)C.enqueue((()=>{if(!this._cacheMap.get(k,o.DEFAULT_COLOR,o.DEFAULT_COLOR,o.DEFAULT_EXT)){let D=this._drawToCache(k,o.DEFAULT_COLOR,o.DEFAULT_COLOR,o.DEFAULT_EXT);this._cacheMap.set(k,o.DEFAULT_COLOR,o.DEFAULT_COLOR,o.DEFAULT_EXT,D)}}))}beginFrame(){return this._requestClearModel}clearTexture(){if(this._pages[0].currentRow.x!==0||this._pages[0].currentRow.y!==0){for(let C of this._pages)C.clear();this._cacheMap.clear(),this._cacheMapCombined.clear(),this._didWarmUp=!1}}_createNewPage(){if(h.maxAtlasPages&&this._pages.length>=Math.max(4,h.maxAtlasPages)){let k=this._pages.filter((P=>2*P.canvas.width<=(h.maxTextureSize||4096))).sort(((P,H)=>H.canvas.width===P.canvas.width?H.percentageUsed-P.percentageUsed:H.canvas.width-P.canvas.width)),D=-1,x=0;for(let P=0;P<k.length;P++)if(k[P].canvas.width!==x)D=P,x=k[P].canvas.width;else if(P-D==3)break;let y=k.slice(D,D+4),L=y.map((P=>P.glyphs[0].texturePage)).sort(((P,H)=>P>H?1:-1)),M=this.pages.length-y.length,B=this._mergePages(y,M);B.version++;for(let P=L.length-1;P>=0;P--)this._deletePage(L[P]);this.pages.push(B),this._requestClearModel=!0,this._onAddTextureAtlasCanvas.fire(B.canvas)}let C=new m(this._document,this._textureSize);return this._pages.push(C),this._activePages.push(C),this._onAddTextureAtlasCanvas.fire(C.canvas),C}_mergePages(C,k){let D=2*C[0].canvas.width,x=new m(this._document,D,C);for(let[y,L]of C.entries()){let M=y*L.canvas.width%D,B=Math.floor(y/2)*L.canvas.height;x.ctx.drawImage(L.canvas,M,B);for(let H of L.glyphs)H.texturePage=k,H.sizeClipSpace.x=H.size.x/D,H.sizeClipSpace.y=H.size.y/D,H.texturePosition.x+=M,H.texturePosition.y+=B,H.texturePositionClipSpace.x=H.texturePosition.x/D,H.texturePositionClipSpace.y=H.texturePosition.y/D;this._onRemoveTextureAtlasCanvas.fire(L.canvas);let P=this._activePages.indexOf(L);P!==-1&&this._activePages.splice(P,1)}return x}_deletePage(C){this._pages.splice(C,1);for(let k=C;k<this._pages.length;k++){let D=this._pages[k];for(let x of D.glyphs)x.texturePage--;D.version++}}getRasterizedGlyphCombinedChar(C,k,D,x,y){return this._getFromCacheMap(this._cacheMapCombined,C,k,D,x,y)}getRasterizedGlyph(C,k,D,x,y){return this._getFromCacheMap(this._cacheMap,C,k,D,x,y)}_getFromCacheMap(C,k,D,x,y,L=!1){return i=C.get(k,D,x,y),i||(i=this._drawToCache(k,D,x,y,L),C.set(k,D,x,y,i)),i}_getColorFromAnsiIndex(C){if(C>=this._config.colors.ansi.length)throw Error("No color found for idx "+C);return this._config.colors.ansi[C]}_getBackgroundColor(C,k,D,x){if(this._config.allowTransparency)return f.NULL_COLOR;let y;switch(C){case 16777216:case 33554432:y=this._getColorFromAnsiIndex(k);break;case 50331648:let L=e.AttributeData.toColorRGB(k);y=f.channels.toColor(L[0],L[1],L[2]);break;default:y=D?f.color.opaque(this._config.colors.foreground):this._config.colors.background}return y}_getForegroundColor(C,k,D,x,y,L,M,B,P,H){let w=this._getMinimumContrastColor(C,k,D,x,y,L,M,P,B,H);if(w)return w;let R;switch(y){case 16777216:case 33554432:this._config.drawBoldTextInBrightColors&&P&&L<8&&(L+=8),R=this._getColorFromAnsiIndex(L);break;case 50331648:let O=e.AttributeData.toColorRGB(L);R=f.channels.toColor(O[0],O[1],O[2]);break;default:R=M?this._config.colors.background:this._config.colors.foreground}return this._config.allowTransparency&&(R=f.color.opaque(R)),B&&(R=f.color.multiplyOpacity(R,l.DIM_OPACITY)),R}_resolveBackgroundRgba(C,k,D){switch(C){case 16777216:case 33554432:return this._getColorFromAnsiIndex(k).rgba;case 50331648:return k<<8;default:return D?this._config.colors.foreground.rgba:this._config.colors.background.rgba}}_resolveForegroundRgba(C,k,D,x){switch(C){case 16777216:case 33554432:return this._config.drawBoldTextInBrightColors&&x&&k<8&&(k+=8),this._getColorFromAnsiIndex(k).rgba;case 50331648:return k<<8;default:return D?this._config.colors.background.rgba:this._config.colors.foreground.rgba}}_getMinimumContrastColor(C,k,D,x,y,L,M,B,P,H){if(this._config.minimumContrastRatio===1||H)return;let w=this._getContrastCache(P),R=w.getColor(C,x);if(R!==void 0)return R||void 0;let O=this._resolveBackgroundRgba(k,D,M),F=this._resolveForegroundRgba(y,L,M,B),z=f.rgba.ensureContrastRatio(O,F,this._config.minimumContrastRatio/(P?2:1));if(!z)return void w.setColor(C,x,null);let j=f.channels.toColor(z>>24&255,z>>16&255,z>>8&255);return w.setColor(C,x,j),j}_getContrastCache(C){return C?this._config.colors.halfContrastCache:this._config.colors.contrastCache}_drawToCache(C,k,D,x,y=!1){let L=typeof C=="number"?String.fromCharCode(C):C,M=Math.min(this._config.deviceCellWidth*Math.max(L.length,2)+4,this._textureSize);this._tmpCanvas.width<M&&(this._tmpCanvas.width=M);let B=Math.min(this._config.deviceCellHeight+8,this._textureSize);if(this._tmpCanvas.height<B&&(this._tmpCanvas.height=B),this._tmpCtx.save(),this._workAttributeData.fg=D,this._workAttributeData.bg=k,this._workAttributeData.extended.ext=x,this._workAttributeData.isInvisible())return s;let P=!!this._workAttributeData.isBold(),H=!!this._workAttributeData.isInverse(),w=!!this._workAttributeData.isDim(),R=!!this._workAttributeData.isItalic(),O=!!this._workAttributeData.isUnderline(),F=!!this._workAttributeData.isStrikethrough(),z=!!this._workAttributeData.isOverline(),j=this._workAttributeData.getFgColor(),X=this._workAttributeData.getFgColorMode(),K=this._workAttributeData.getBgColor(),W=this._workAttributeData.getBgColorMode();if(H){let V=j;j=K,K=V;let ie=X;X=W,W=ie}let $=this._getBackgroundColor(W,K,H,w);this._tmpCtx.globalCompositeOperation="copy",this._tmpCtx.fillStyle=$.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.globalCompositeOperation="source-over";let I=P?this._config.fontWeightBold:this._config.fontWeight,U=R?"italic":"";this._tmpCtx.font=`${U} ${I} ${this._config.fontSize*this._config.devicePixelRatio}px ${this._config.fontFamily}`,this._tmpCtx.textBaseline=l.TEXT_BASELINE;let q=L.length===1&&(0,n.isPowerlineGlyph)(L.charCodeAt(0)),G=L.length===1&&(0,n.isRestrictedPowerlineGlyph)(L.charCodeAt(0)),Q=this._getForegroundColor(k,W,K,D,X,j,H,w,P,(0,n.treatGlyphAsBackgroundColor)(L.charCodeAt(0)));this._tmpCtx.fillStyle=Q.css;let Y=G?0:4,re=!1;this._config.customGlyphs!==!1&&(re=(0,u.tryDrawCustomChar)(this._tmpCtx,L,Y,Y,this._config.deviceCellWidth,this._config.deviceCellHeight,this._config.fontSize,this._config.devicePixelRatio));let he,J=!q;if(he=typeof C=="number"?this._unicodeService.wcwidth(C):this._unicodeService.getStringCellWidth(C),O){this._tmpCtx.save();let V=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),ie=V%2==1?.5:0;if(this._tmpCtx.lineWidth=V,this._workAttributeData.isUnderlineColorDefault())this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle;else if(this._workAttributeData.isUnderlineColorRGB())J=!1,this._tmpCtx.strokeStyle=`rgb(${e.AttributeData.toColorRGB(this._workAttributeData.getUnderlineColor()).join(",")})`;else{J=!1;let le=this._workAttributeData.getUnderlineColor();this._config.drawBoldTextInBrightColors&&this._workAttributeData.isBold()&&le<8&&(le+=8),this._tmpCtx.strokeStyle=this._getColorFromAnsiIndex(le).css}this._tmpCtx.beginPath();let ae=Y,oe=Math.ceil(Y+this._config.deviceCharHeight)-ie-(y?2*V:0),Le=oe+V,ue=oe+2*V,_e=this._workAttributeData.getUnderlineVariantOffset();for(let le=0;le<he;le++){this._tmpCtx.save();let ne=ae+le*this._config.deviceCellWidth,Z=ae+(le+1)*this._config.deviceCellWidth,Oe=ne+this._config.deviceCellWidth/2;switch(this._workAttributeData.extended.underlineStyle){case 2:this._tmpCtx.moveTo(ne,oe),this._tmpCtx.lineTo(Z,oe),this._tmpCtx.moveTo(ne,ue),this._tmpCtx.lineTo(Z,ue);break;case 3:let He=V<=1?ue:Math.ceil(Y+this._config.deviceCharHeight-V/2)-ie,Fe=V<=1?oe:Math.ceil(Y+this._config.deviceCharHeight+V/2)-ie,kt=new Path2D;kt.rect(ne,oe,this._config.deviceCellWidth,ue-oe),this._tmpCtx.clip(kt),this._tmpCtx.moveTo(ne-this._config.deviceCellWidth/2,Le),this._tmpCtx.bezierCurveTo(ne-this._config.deviceCellWidth/2,Fe,ne,Fe,ne,Le),this._tmpCtx.bezierCurveTo(ne,He,Oe,He,Oe,Le),this._tmpCtx.bezierCurveTo(Oe,Fe,Z,Fe,Z,Le),this._tmpCtx.bezierCurveTo(Z,He,Z+this._config.deviceCellWidth/2,He,Z+this._config.deviceCellWidth/2,Le);break;case 4:let We=_e===0?0:_e>=V?2*V-_e:V-_e;!(_e>=V)==0||We===0?(this._tmpCtx.setLineDash([Math.round(V),Math.round(V)]),this._tmpCtx.moveTo(ne+We,oe),this._tmpCtx.lineTo(Z,oe)):(this._tmpCtx.setLineDash([Math.round(V),Math.round(V)]),this._tmpCtx.moveTo(ne,oe),this._tmpCtx.lineTo(ne+We,oe),this._tmpCtx.moveTo(ne+We+V,oe),this._tmpCtx.lineTo(Z,oe)),_e=(0,n.computeNextVariantOffset)(Z-ne,V,_e);break;case 5:let Qe=Z-ne,Dt=Math.floor(.6*Qe),Rt=Math.floor(.3*Qe),yi=Qe-Dt-Rt;this._tmpCtx.setLineDash([Dt,Rt,yi]),this._tmpCtx.moveTo(ne,oe),this._tmpCtx.lineTo(Z,oe);break;default:this._tmpCtx.moveTo(ne,oe),this._tmpCtx.lineTo(Z,oe)}this._tmpCtx.stroke(),this._tmpCtx.restore()}if(this._tmpCtx.restore(),!re&&this._config.fontSize>=12&&!this._config.allowTransparency&&L!==" "){this._tmpCtx.save(),this._tmpCtx.textBaseline="alphabetic";let le=this._tmpCtx.measureText(L);if(this._tmpCtx.restore(),"actualBoundingBoxDescent"in le&&le.actualBoundingBoxDescent>0){this._tmpCtx.save();let ne=new Path2D;ne.rect(ae,oe-Math.ceil(V/2),this._config.deviceCellWidth*he,ue-oe+Math.ceil(V/2)),this._tmpCtx.clip(ne),this._tmpCtx.lineWidth=3*this._config.devicePixelRatio,this._tmpCtx.strokeStyle=$.css,this._tmpCtx.strokeText(L,Y,Y+this._config.deviceCharHeight),this._tmpCtx.restore()}}}if(z){let V=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/15)),ie=V%2==1?.5:0;this._tmpCtx.lineWidth=V,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(Y,Y+ie),this._tmpCtx.lineTo(Y+this._config.deviceCharWidth*he,Y+ie),this._tmpCtx.stroke()}if(re||this._tmpCtx.fillText(L,Y,Y+this._config.deviceCharHeight),L==="_"&&!this._config.allowTransparency){let V=d(this._tmpCtx.getImageData(Y,Y,this._config.deviceCellWidth,this._config.deviceCellHeight),$,Q,J);if(V)for(let ie=1;ie<=5&&(this._tmpCtx.save(),this._tmpCtx.fillStyle=$.css,this._tmpCtx.fillRect(0,0,this._tmpCanvas.width,this._tmpCanvas.height),this._tmpCtx.restore(),this._tmpCtx.fillText(L,Y,Y+this._config.deviceCharHeight-ie),V=d(this._tmpCtx.getImageData(Y,Y,this._config.deviceCellWidth,this._config.deviceCellHeight),$,Q,J),V);ie++);}if(F){let V=Math.max(1,Math.floor(this._config.fontSize*this._config.devicePixelRatio/10)),ie=this._tmpCtx.lineWidth%2==1?.5:0;this._tmpCtx.lineWidth=V,this._tmpCtx.strokeStyle=this._tmpCtx.fillStyle,this._tmpCtx.beginPath(),this._tmpCtx.moveTo(Y,Y+Math.floor(this._config.deviceCharHeight/2)-ie),this._tmpCtx.lineTo(Y+this._config.deviceCharWidth*he,Y+Math.floor(this._config.deviceCharHeight/2)-ie),this._tmpCtx.stroke()}this._tmpCtx.restore();let Ce=this._tmpCtx.getImageData(0,0,this._tmpCanvas.width,this._tmpCanvas.height),Re;if(Re=this._config.allowTransparency?(function(V){for(let ie=0;ie<V.data.length;ie+=4)if(V.data[ie+3]>0)return!1;return!0})(Ce):d(Ce,$,Q,J),Re)return s;let se=this._findGlyphBoundingBox(Ce,this._workBoundingBox,M,G,re,Y),ee,te;for(;;){if(this._activePages.length===0){let V=this._createNewPage();ee=V,te=V.currentRow,te.height=se.size.y;break}ee=this._activePages[this._activePages.length-1],te=ee.currentRow;for(let V of this._activePages)se.size.y<=V.currentRow.height&&(ee=V,te=V.currentRow);for(let V=this._activePages.length-1;V>=0;V--)for(let ie of this._activePages[V].fixedRows)ie.height<=te.height&&se.size.y<=ie.height&&(ee=this._activePages[V],te=ie);if(te.y+se.size.y>=ee.canvas.height||te.height>se.size.y+2){let V=!1;if(ee.currentRow.y+ee.currentRow.height+se.size.y>=ee.canvas.height){let ie;for(let ae of this._activePages)if(ae.currentRow.y+ae.currentRow.height+se.size.y<ae.canvas.height){ie=ae;break}if(ie)ee=ie;else if(h.maxAtlasPages&&this._pages.length>=h.maxAtlasPages&&te.y+se.size.y<=ee.canvas.height&&te.height>=se.size.y&&te.x+se.size.x<=ee.canvas.width)V=!0;else{let ae=this._createNewPage();ee=ae,te=ae.currentRow,te.height=se.size.y,V=!0}}V||(ee.currentRow.height>0&&ee.fixedRows.push(ee.currentRow),te={x:0,y:ee.currentRow.y+ee.currentRow.height,height:se.size.y},ee.fixedRows.push(te),ee.currentRow={x:0,y:te.y+te.height,height:0})}if(te.x+se.size.x<=ee.canvas.width)break;te===ee.currentRow?(te.x=0,te.y+=te.height,te.height=0):ee.fixedRows.splice(ee.fixedRows.indexOf(te),1)}return se.texturePage=this._pages.indexOf(ee),se.texturePosition.x=te.x,se.texturePosition.y=te.y,se.texturePositionClipSpace.x=te.x/ee.canvas.width,se.texturePositionClipSpace.y=te.y/ee.canvas.height,se.sizeClipSpace.x/=ee.canvas.width,se.sizeClipSpace.y/=ee.canvas.height,te.height=Math.max(te.height,se.size.y),te.x+=se.size.x,ee.ctx.putImageData(Ce,se.texturePosition.x-this._workBoundingBox.left,se.texturePosition.y-this._workBoundingBox.top,this._workBoundingBox.left,this._workBoundingBox.top,se.size.x,se.size.y),ee.addGlyph(se),ee.version++,se}_findGlyphBoundingBox(C,k,D,x,y,L){k.top=0;let M=x?this._config.deviceCellHeight:this._tmpCanvas.height,B=x?this._config.deviceCellWidth:D,P=!1;for(let H=0;H<M;H++){for(let w=0;w<B;w++){let R=H*this._tmpCanvas.width*4+4*w+3;if(C.data[R]!==0){k.top=H,P=!0;break}}if(P)break}k.left=0,P=!1;for(let H=0;H<L+B;H++){for(let w=0;w<M;w++){let R=w*this._tmpCanvas.width*4+4*H+3;if(C.data[R]!==0){k.left=H,P=!0;break}}if(P)break}k.right=B,P=!1;for(let H=L+B-1;H>=L;H--){for(let w=0;w<M;w++){let R=w*this._tmpCanvas.width*4+4*H+3;if(C.data[R]!==0){k.right=H,P=!0;break}}if(P)break}k.bottom=M,P=!1;for(let H=M-1;H>=0;H--){for(let w=0;w<B;w++){let R=H*this._tmpCanvas.width*4+4*w+3;if(C.data[R]!==0){k.bottom=H,P=!0;break}}if(P)break}return{texturePage:0,texturePosition:{x:0,y:0},texturePositionClipSpace:{x:0,y:0},size:{x:k.right-k.left+1,y:k.bottom-k.top+1},sizeClipSpace:{x:k.right-k.left+1,y:k.bottom-k.top+1},offset:{x:-k.left+L+(x||y?Math.floor((this._config.deviceCellWidth-this._config.deviceCharWidth)/2):0),y:-k.top+L+(x||y?this._config.lineHeight===1?0:Math.round((this._config.deviceCellHeight-this._config.deviceCharHeight)/2):0)}}}}t.TextureAtlas=h;class m{get percentageUsed(){return this._usedPixels/(this.canvas.width*this.canvas.height)}get glyphs(){return this._glyphs}addGlyph(C){this._glyphs.push(C),this._usedPixels+=C.size.x*C.size.y}constructor(C,k,D){if(this._usedPixels=0,this._glyphs=[],this.version=0,this.currentRow={x:0,y:0,height:0},this.fixedRows=[],D)for(let x of D)this._glyphs.push(...x.glyphs),this._usedPixels+=x._usedPixels;this.canvas=c(C,k,k),this.ctx=(0,n.throwIfFalsy)(this.canvas.getContext("2d",{alpha:!0}))}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.currentRow.x=0,this.currentRow.y=0,this.currentRow.height=0,this.fixedRows.length=0,this.version++}}function d(v,C,k,D){let x=C.rgba>>>24,y=C.rgba>>>16&255,L=C.rgba>>>8&255,M=k.rgba>>>24,B=k.rgba>>>16&255,P=k.rgba>>>8&255,H=Math.floor((Math.abs(x-M)+Math.abs(y-B)+Math.abs(L-P))/12),w=!0;for(let R=0;R<v.data.length;R+=4)v.data[R]===x&&v.data[R+1]===y&&v.data[R+2]===L||D&&Math.abs(v.data[R]-x)+Math.abs(v.data[R+1]-y)+Math.abs(v.data[R+2]-L)<H?v.data[R+3]=0:w=!1;return w}function c(v,C,k){let D=v.createElement("canvas");return D.width=C,D.height=k,D}},577:function(A,t,a){var l=this&&this.__decorate||function(o,s,i,h){var m,d=arguments.length,c=d<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,i):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,s,i,h);else for(var v=o.length-1;v>=0;v--)(m=o[v])&&(c=(d<3?m(c):d>3?m(s,i,c):m(s,i))||c);return d>3&&c&&Object.defineProperty(s,i,c),c},u=this&&this.__param||function(o,s){return function(i,h){s(i,h,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;let n=a(147),f=a(855),p=a(782),S=a(97);class r extends n.AttributeData{constructor(s,i,h){super(),this.content=0,this.combinedData="",this.fg=s.fg,this.bg=s.bg,this.combinedData=i,this._width=h}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(s){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=r;let e=t.CharacterJoinerService=class li{constructor(s){this._bufferService=s,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new p.CellData}register(s){let i={id:this._nextCharacterJoinerId++,handler:s};return this._characterJoiners.push(i),i.id}deregister(s){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===s)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(s){if(this._characterJoiners.length===0)return[];let i=this._bufferService.buffer.lines.get(s);if(!i||i.length===0)return[];let h=[],m=i.translateToString(!0),d=0,c=0,v=0,C=i.getFg(0),k=i.getBg(0);for(let D=0;D<i.getTrimmedLength();D++)if(i.loadCell(D,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==C||this._workCell.bg!==k){if(D-d>1){let x=this._getJoinedRanges(m,v,c,i,d);for(let y=0;y<x.length;y++)h.push(x[y])}d=D,v=c,C=this._workCell.fg,k=this._workCell.bg}c+=this._workCell.getChars().length||f.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-d>1){let D=this._getJoinedRanges(m,v,c,i,d);for(let x=0;x<D.length;x++)h.push(D[x])}return h}_getJoinedRanges(s,i,h,m,d){let c=s.substring(i,h),v=[];try{v=this._characterJoiners[0].handler(c)}catch(C){console.error(C)}for(let C=1;C<this._characterJoiners.length;C++)try{let k=this._characterJoiners[C].handler(c);for(let D=0;D<k.length;D++)li._mergeRanges(v,k[D])}catch(k){console.error(k)}return this._stringRangesToCellRanges(v,m,d),v}_stringRangesToCellRanges(s,i,h){let m=0,d=!1,c=0,v=s[m];if(v){for(let C=h;C<this._bufferService.cols;C++){let k=i.getWidth(C),D=i.getString(C).length||f.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!d&&v[0]<=c&&(v[0]=C,d=!0),v[1]<=c){if(v[1]=C,v=s[++m],!v)break;v[0]<=c?(v[0]=C,d=!0):d=!1}c+=D}}v&&(v[1]=this._bufferService.cols)}}static _mergeRanges(s,i){let h=!1;for(let m=0;m<s.length;m++){let d=s[m];if(h){if(i[1]<=d[0])return s[m-1][1]=i[1],s;if(i[1]<=d[1])return s[m-1][1]=Math.max(i[1],d[1]),s.splice(m,1),s;s.splice(m,1),m--}else{if(i[1]<=d[0])return s.splice(m,0,i),s;if(i[1]<=d[1])return d[0]=Math.min(i[0],d[0]),s;i[0]<d[1]&&(d[0]=Math.min(i[0],d[0]),h=!0)}}return h?s[s.length-1][1]=i[1]:s.push(i),s}};t.CharacterJoinerService=e=l([u(0,S.IBufferService)],e)},160:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let a=0,l=0,u=0,n=0;var f,p,S,r,e;function o(i){let h=i.toString(16);return h.length<2?"0"+h:h}function s(i,h){return i<h?(h+.05)/(i+.05):(i+.05)/(h+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},(function(i){i.toCss=function(h,m,d,c){return c===void 0?`#${o(h)}${o(m)}${o(d)}`:`#${o(h)}${o(m)}${o(d)}${o(c)}`},i.toRgba=function(h,m,d,c=255){return(h<<24|m<<16|d<<8|c)>>>0},i.toColor=function(h,m,d,c){return{css:i.toCss(h,m,d,c),rgba:i.toRgba(h,m,d,c)}}})(f||(t.channels=f={})),(function(i){function h(m,d){return n=Math.round(255*d),[a,l,u]=e.toChannels(m.rgba),{css:f.toCss(a,l,u,n),rgba:f.toRgba(a,l,u,n)}}i.blend=function(m,d){if(n=(255&d.rgba)/255,n===1)return{css:d.css,rgba:d.rgba};let c=d.rgba>>24&255,v=d.rgba>>16&255,C=d.rgba>>8&255,k=m.rgba>>24&255,D=m.rgba>>16&255,x=m.rgba>>8&255;return a=k+Math.round((c-k)*n),l=D+Math.round((v-D)*n),u=x+Math.round((C-x)*n),{css:f.toCss(a,l,u),rgba:f.toRgba(a,l,u)}},i.isOpaque=function(m){return(255&m.rgba)==255},i.ensureContrastRatio=function(m,d,c){let v=e.ensureContrastRatio(m.rgba,d.rgba,c);if(v)return f.toColor(v>>24&255,v>>16&255,v>>8&255)},i.opaque=function(m){let d=(255|m.rgba)>>>0;return[a,l,u]=e.toChannels(d),{css:f.toCss(a,l,u),rgba:d}},i.opacity=h,i.multiplyOpacity=function(m,d){return n=255&m.rgba,h(m,n*d/255)},i.toColorRGB=function(m){return[m.rgba>>24&255,m.rgba>>16&255,m.rgba>>8&255]}})(p||(t.color=p={})),(function(i){let h,m;try{let d=document.createElement("canvas");d.width=1,d.height=1;let c=d.getContext("2d",{willReadFrequently:!0});c&&(h=c,h.globalCompositeOperation="copy",m=h.createLinearGradient(0,0,1,1))}catch{}i.toColor=function(d){if(d.match(/#[\da-f]{3,8}/i))switch(d.length){case 4:return a=parseInt(d.slice(1,2).repeat(2),16),l=parseInt(d.slice(2,3).repeat(2),16),u=parseInt(d.slice(3,4).repeat(2),16),f.toColor(a,l,u);case 5:return a=parseInt(d.slice(1,2).repeat(2),16),l=parseInt(d.slice(2,3).repeat(2),16),u=parseInt(d.slice(3,4).repeat(2),16),n=parseInt(d.slice(4,5).repeat(2),16),f.toColor(a,l,u,n);case 7:return{css:d,rgba:(parseInt(d.slice(1),16)<<8|255)>>>0};case 9:return{css:d,rgba:parseInt(d.slice(1),16)>>>0}}let c=d.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(c)return a=parseInt(c[1]),l=parseInt(c[2]),u=parseInt(c[3]),n=Math.round(255*(c[5]===void 0?1:parseFloat(c[5]))),f.toColor(a,l,u,n);if(!h||!m||(h.fillStyle=m,h.fillStyle=d,typeof h.fillStyle!="string")||(h.fillRect(0,0,1,1),[a,l,u,n]=h.getImageData(0,0,1,1).data,n!==255))throw Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(a,l,u,n),css:d}}})(S||(t.css=S={})),(function(i){function h(m,d,c){let v=m/255,C=d/255,k=c/255;return .2126*(v<=.03928?v/12.92:((v+.055)/1.055)**2.4)+.7152*(C<=.03928?C/12.92:((C+.055)/1.055)**2.4)+.0722*(k<=.03928?k/12.92:((k+.055)/1.055)**2.4)}i.relativeLuminance=function(m){return h(m>>16&255,m>>8&255,255&m)},i.relativeLuminance2=h})(r||(t.rgb=r={})),(function(i){function h(d,c,v){let C=d>>24&255,k=d>>16&255,D=d>>8&255,x=c>>24&255,y=c>>16&255,L=c>>8&255,M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));for(;M<v&&(x>0||y>0||L>0);)x-=Math.max(0,Math.ceil(.1*x)),y-=Math.max(0,Math.ceil(.1*y)),L-=Math.max(0,Math.ceil(.1*L)),M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));return(x<<24|y<<16|L<<8|255)>>>0}function m(d,c,v){let C=d>>24&255,k=d>>16&255,D=d>>8&255,x=c>>24&255,y=c>>16&255,L=c>>8&255,M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));for(;M<v&&(x<255||y<255||L<255);)x=Math.min(255,x+Math.ceil(.1*(255-x))),y=Math.min(255,y+Math.ceil(.1*(255-y))),L=Math.min(255,L+Math.ceil(.1*(255-L))),M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));return(x<<24|y<<16|L<<8|255)>>>0}i.blend=function(d,c){if(n=(255&c)/255,n===1)return c;let v=c>>24&255,C=c>>16&255,k=c>>8&255,D=d>>24&255,x=d>>16&255,y=d>>8&255;return a=D+Math.round((v-D)*n),l=x+Math.round((C-x)*n),u=y+Math.round((k-y)*n),f.toRgba(a,l,u)},i.ensureContrastRatio=function(d,c,v){let C=r.relativeLuminance(d>>8),k=r.relativeLuminance(c>>8);if(s(C,k)<v){if(k<C){let y=h(d,c,v),L=s(C,r.relativeLuminance(y>>8));if(L<v){let M=m(d,c,v);return L>s(C,r.relativeLuminance(M>>8))?y:M}return y}let D=m(d,c,v),x=s(C,r.relativeLuminance(D>>8));if(x<v){let y=h(d,c,v);return x>s(C,r.relativeLuminance(y>>8))?D:y}return D}},i.reduceLuminance=h,i.increaseLuminance=m,i.toChannels=function(d){return[d>>24&255,d>>16&255,d>>8&255,255&d]}})(e||(t.rgba=e={})),t.toPaddedHex=o,t.contrastRatio=s},345:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let l=0;l<this._listeners.length;l++)if(this._listeners[l]===a)return void this._listeners.splice(l,1)}}})),this._event}fire(a,l){let u=[];for(let n=0;n<this._listeners.length;n++)u.push(this._listeners[n]);for(let n=0;n<u.length;n++)u[n].call(void 0,a,l)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(a,l){return a((u=>l.fire(u)))},t.runAndSubscribe=function(a,l){return l(void 0),a((u=>l(u)))}},859:(A,t)=>{function a(l){for(let u of l)u.dispose();l.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let l of this._disposables)l.dispose();this._disposables.length=0}register(l){return this._disposables.push(l),l}unregister(l){let u=this._disposables.indexOf(l);u!==-1&&this._disposables.splice(u,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(l){var u;this._isDisposed||l===this._value||((u=this._value)==null||u.dispose(),this._value=l)}clear(){this.value=void 0}dispose(){var l;this._isDisposed=!0,(l=this._value)==null||l.dispose(),this._value=void 0}},t.toDisposable=function(l){return{dispose:l}},t.disposeArray=a,t.getDisposeArrayDisposable=function(l){return{dispose:()=>a(l)}}},485:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(u,n,f){this._data[u]||(this._data[u]={}),this._data[u][n]=f}get(u,n){return this._data[u]?this._data[u][n]:void 0}clear(){this._data={}}}t.TwoKeyMap=a,t.FourKeyMap=class{constructor(){this._data=new a}set(l,u,n,f,p){this._data.get(l,u)||this._data.set(l,u,new a),this._data.get(l,u).set(n,f,p)}get(l,u,n,f){var p;return(p=this._data.get(l,u))==null?void 0:p.get(n,f)}clear(){this._data.clear()}}},399:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof process<"u"&&"title"in process;let a=t.isNode?"node":navigator.userAgent,l=t.isNode?"node":navigator.platform;t.isFirefox=a.includes("Firefox"),t.isLegacyEdge=a.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(a),t.getSafariVersion=function(){if(!t.isSafari)return 0;let u=a.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(l),t.isIpad=l==="iPad",t.isIphone=l==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(l),t.isLinux=l.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(a)},385:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;let l=a(399);class u{constructor(){this._tasks=[],this._i=0}enqueue(p){this._tasks.push(p),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._idleCallback=(this._cancelCallback(this._idleCallback),void 0)),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(p){this._idleCallback=void 0;let S=0,r=0,e=p.timeRemaining(),o=0;for(;this._i<this._tasks.length;){if(S=Date.now(),this._tasks[this._i]()||this._i++,S=Math.max(1,Date.now()-S),r=Math.max(S,r),o=p.timeRemaining(),1.5*r>o)return e-S<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-S))}ms`),void this._start();e=o}this.clear()}}class n extends u{_requestCallback(p){return setTimeout((()=>p(this._createDeadline(16))))}_cancelCallback(p){clearTimeout(p)}_createDeadline(p){let S=Date.now()+p;return{timeRemaining:()=>Math.max(0,S-Date.now())}}}t.PriorityTaskQueue=n,t.IdleTaskQueue=!l.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:n,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},147:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new l}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){let n=new a;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=a;class l{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}get underlineVariantOffset(){let n=(3758096384&this._ext)>>29;return n<0?4294967288^n:n}set underlineVariantOffset(n){this._ext&=536870911,this._ext|=n<<29&3758096384}constructor(n=0,f=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=f}clone(){return new l(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=l},782:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;let l=a(133),u=a(855),n=a(147);class f extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(S){let r=new f;return r.setFromCharData(S),r}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(S){this.fg=S[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let r=!1;if(S[u.CHAR_DATA_CHAR_INDEX].length>2)r=!0;else if(S[u.CHAR_DATA_CHAR_INDEX].length===2){let e=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let o=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=o&&o<=57343?this.content=1024*(e-55296)+o-56320+65536|S[u.CHAR_DATA_WIDTH_INDEX]<<22:r=!0}else r=!0}else this.content=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|S[u.CHAR_DATA_WIDTH_INDEX]<<22;r&&(this.combinedData=S[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|S[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=f},855:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},133:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},t.utf32ToString=function(a,l=0,u=a.length){let n="";for(let f=l;f<u;++f){let p=a[f];p>65535?(p-=65536,n+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):n+=String.fromCharCode(p)}return n},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,l){let u=a.length;if(!u)return 0;let n=0,f=0;if(this._interim){let p=a.charCodeAt(f++);56320<=p&&p<=57343?l[n++]=1024*(this._interim-55296)+p-56320+65536:(l[n++]=this._interim,l[n++]=p),this._interim=0}for(let p=f;p<u;++p){let S=a.charCodeAt(p);if(55296<=S&&S<=56319){if(++p>=u)return this._interim=S,n;let r=a.charCodeAt(p);56320<=r&&r<=57343?l[n++]=1024*(S-55296)+r-56320+65536:(l[n++]=S,l[n++]=r)}else S!==65279&&(l[n++]=S)}return n}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,l){let u=a.length;if(!u)return 0;let n,f,p,S,r=0,e=0,o=0;if(this.interim[0]){let h=!1,m=this.interim[0];m&=(224&m)==192?31:(240&m)==224?15:7;let d,c=0;for(;(d=63&this.interim[++c])&&c<4;)m<<=6,m|=d;let v=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=v-c;for(;o<C;){if(o>=u)return 0;if(d=a[o++],(192&d)!=128){o--,h=!0;break}this.interim[c++]=d,m<<=6,m|=63&d}h||(v===2?m<128?o--:l[r++]=m:v===3?m<2048||m>=55296&&m<=57343||m===65279||(l[r++]=m):m<65536||m>1114111||(l[r++]=m)),this.interim.fill(0)}let s=u-4,i=o;for(;i<u;){for(;!(!(i<s)||128&(n=a[i])||128&(f=a[i+1])||128&(p=a[i+2])||128&(S=a[i+3]));)l[r++]=n,l[r++]=f,l[r++]=p,l[r++]=S,i+=4;if(n=a[i++],n<128)l[r++]=n;else if((224&n)==192){if(i>=u)return this.interim[0]=n,r;if(f=a[i++],(192&f)!=128){i--;continue}if(e=(31&n)<<6|63&f,e<128){i--;continue}l[r++]=e}else if((240&n)==224){if(i>=u)return this.interim[0]=n,r;if(f=a[i++],(192&f)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=f,r;if(p=a[i++],(192&p)!=128){i--;continue}if(e=(15&n)<<12|(63&f)<<6|63&p,e<2048||e>=55296&&e<=57343||e===65279)continue;l[r++]=e}else if((248&n)==240){if(i>=u)return this.interim[0]=n,r;if(f=a[i++],(192&f)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=f,r;if(p=a[i++],(192&p)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=f,this.interim[2]=p,r;if(S=a[i++],(192&S)!=128){i--;continue}if(e=(7&n)<<18|(63&f)<<12|(63&p)<<6|63&S,e<65536||e>1114111)continue;l[r++]=e}}return r}}},776:function(A,t,a){var l=this&&this.__decorate||function(e,o,s,i){var h,m=arguments.length,d=m<3?o:i===null?i=Object.getOwnPropertyDescriptor(o,s):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,o,s,i);else for(var c=e.length-1;c>=0;c--)(h=e[c])&&(d=(m<3?h(d):m>3?h(o,s,d):h(o,s))||d);return m>3&&d&&Object.defineProperty(o,s,d),d},u=this&&this.__param||function(e,o){return function(s,i){o(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;let n=a(859),f=a(97),p={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF},S,r=t.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),S=this}_updateLogLevel(){this._logLevel=p[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let o=0;o<e.length;o++)typeof e[o]=="function"&&(e[o]=e[o]())}_log(e,o,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+o,...s)}trace(e,...o){var s;this._logLevel<=f.LogLevelEnum.TRACE&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.trace.bind(this._optionsService.options.logger))??console.log,e,o)}debug(e,...o){var s;this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.debug.bind(this._optionsService.options.logger))??console.log,e,o)}info(e,...o){var s;this._logLevel<=f.LogLevelEnum.INFO&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.info.bind(this._optionsService.options.logger))??console.info,e,o)}warn(e,...o){var s;this._logLevel<=f.LogLevelEnum.WARN&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.warn.bind(this._optionsService.options.logger))??console.warn,e,o)}error(e,...o){var s;this._logLevel<=f.LogLevelEnum.ERROR&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.error.bind(this._optionsService.options.logger))??console.error,e,o)}};t.LogService=r=l([u(0,f.IOptionsService)],r),t.setTraceLogger=function(e){S=e},t.traceCall=function(e,o,s){if(typeof s.value!="function")throw Error("not supported");let i=s.value;s.value=function(...h){if(S.logLevel!==f.LogLevelEnum.TRACE)return i.apply(this,h);S.trace(`GlyphRenderer#${i.name}(${h.map((d=>JSON.stringify(d))).join(", ")})`);let m=i.apply(this,h);return S.trace(`GlyphRenderer#${i.name} return`,m),m}}},726:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;let a="di$target",l="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(u){return u[l]||[]},t.createDecorator=function(u){if(t.serviceRegistry.has(u))return t.serviceRegistry.get(u);let n=function(f,p,S){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");(function(r,e,o){e[a]===e?e[l].push({id:r,index:o}):(e[l]=[{id:r,index:o}],e[a]=e)})(n,f,S)};return n.toString=()=>u,t.serviceRegistry.set(u,n),n}},97:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;let l=a(726);var u;t.IBufferService=(0,l.createDecorator)("BufferService"),t.ICoreMouseService=(0,l.createDecorator)("CoreMouseService"),t.ICoreService=(0,l.createDecorator)("CoreService"),t.ICharsetService=(0,l.createDecorator)("CharsetService"),t.IInstantiationService=(0,l.createDecorator)("InstantiationService"),(function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"})(u||(t.LogLevelEnum=u={})),t.ILogService=(0,l.createDecorator)("LogService"),t.IOptionsService=(0,l.createDecorator)("OptionsService"),t.IOscLinkService=(0,l.createDecorator)("OscLinkService"),t.IUnicodeService=(0,l.createDecorator)("UnicodeService"),t.IDecorationService=(0,l.createDecorator)("DecorationService")}},E={};function T(A){var t=E[A];if(t!==void 0)return t.exports;var a=E[A]={exports:{}};return b[A].call(a.exports,a,a.exports,T),a.exports}var N={};return(()=>{var A=N;Object.defineProperty(A,"__esModule",{value:!0}),A.CanvasAddon=void 0;let t=T(345),a=T(859),l=T(776),u=T(949);class n extends a.Disposable{constructor(){super(...arguments),this._onChangeTextureAtlas=this.register(new t.EventEmitter),this.onChangeTextureAtlas=this._onChangeTextureAtlas.event,this._onAddTextureAtlasCanvas=this.register(new t.EventEmitter),this.onAddTextureAtlasCanvas=this._onAddTextureAtlasCanvas.event}get textureAtlas(){var p;return(p=this._renderer)==null?void 0:p.textureAtlas}activate(p){let S=p._core;if(!p.element)return void this.register(S.onWillOpen((()=>this.activate(p))));this._terminal=p;let r=S.coreService,e=S.optionsService,o=S.screenElement,s=S.linkifier,i=S,h=i._bufferService,m=i._renderService,d=i._characterJoinerService,c=i._charSizeService,v=i._coreBrowserService,C=i._decorationService,k=i._logService,D=i._themeService;(0,l.setTraceLogger)(k),this._renderer=new u.CanvasRenderer(p,o,s,h,c,e,d,r,v,C,D),this.register((0,t.forwardEvent)(this._renderer.onChangeTextureAtlas,this._onChangeTextureAtlas)),this.register((0,t.forwardEvent)(this._renderer.onAddTextureAtlasCanvas,this._onAddTextureAtlasCanvas)),m.setRenderer(this._renderer),m.handleResize(h.cols,h.rows),this.register((0,a.toDisposable)((()=>{var x;m.setRenderer(this._terminal._core._createRenderer()),m.handleResize(p.cols,p.rows),(x=this._renderer)==null||x.dispose(),this._renderer=void 0})))}clearTextureAtlas(){var p;(p=this._renderer)==null||p.clearTextureAtlas()}}A.CanvasAddon=n})(),N})()))}))(),Ui=2,zi=1,ji=class{activate(g){this._terminal=g}dispose(){}fit(){let g=this.proposeDimensions();if(!g||!this._terminal||isNaN(g.cols)||isNaN(g.rows))return;let _=this._terminal._core;(this._terminal.rows!==g.rows||this._terminal.cols!==g.cols)&&(_._renderService.clear(),this._terminal.resize(g.cols,g.rows))}proposeDimensions(){var n;if(!this._terminal||!this._terminal.element||!this._terminal.element.parentElement)return;let g=this._terminal._core._renderService.dimensions;if(g.css.cell.width===0||g.css.cell.height===0)return;let _=this._terminal.options.scrollback===0?0:((n=this._terminal.options.overviewRuler)==null?void 0:n.width)||14,b=window.getComputedStyle(this._terminal.element.parentElement),E=parseInt(b.getPropertyValue("height")),T=Math.max(0,parseInt(b.getPropertyValue("width"))),N=window.getComputedStyle(this._terminal.element),A={top:parseInt(N.getPropertyValue("padding-top")),bottom:parseInt(N.getPropertyValue("padding-bottom")),right:parseInt(N.getPropertyValue("padding-right")),left:parseInt(N.getPropertyValue("padding-left"))},t=A.top+A.bottom,a=A.right+A.left,l=E-t,u=T-a-_;return{cols:Math.max(Ui,Math.floor(u/g.css.cell.width)),rows:Math.max(zi,Math.floor(l/g.css.cell.height))}}},qi=new class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(g){setTimeout(()=>{throw g.stack?Bt.isErrorNoTelemetry(g)?new Bt(g.message+`

`+g.stack):Error(g.message+`

`+g.stack):g},0)}}addListener(g){return this.listeners.push(g),()=>{this._removeListener(g)}}emit(g){this.listeners.forEach(_=>{_(g)})}_removeListener(g){this.listeners.splice(this.listeners.indexOf(g),1)}setUnexpectedErrorHandler(g){this.unexpectedErrorHandler=g}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(g){this.unexpectedErrorHandler(g),this.emit(g)}onUnexpectedExternalError(g){this.unexpectedErrorHandler(g)}};function tt(g){Gi(g)||qi.onUnexpectedError(g)}var it="Canceled";function Gi(g){return g instanceof Ki?!0:g instanceof Error&&g.name===it&&g.message===it}var Ki=class extends Error{constructor(){super(it),this.name=this.message}},Bt=class St extends Error{constructor(_){super(_),this.name="CodeExpectedError"}static fromError(_){if(_ instanceof St)return _;let b=new St;return b.message=_.message,b.stack=_.stack,b}static isErrorNoTelemetry(_){return _.name==="CodeExpectedError"}};function Vi(g,_,b=0,E=g.length){let T=b,N=E;for(;T<N;){let A=Math.floor((T+N)/2);_(g[A])?T=A+1:N=A}return T-1}var Xi=class ci{constructor(_){this._array=_,this._findLastMonotonousLastIdx=0}findLastMonotonous(_){if(ci.assertInvariants){if(this._prevFindLastPredicate){for(let E of this._array)if(this._prevFindLastPredicate(E)&&!_(E))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=_}let b=Vi(this._array,_,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=b+1,b===-1?void 0:this._array[b]}};Xi.assertInvariants=!1;var Ot;(g=>{function _(N){return N<0}g.isLessThan=_;function b(N){return N<=0}g.isLessThanOrEqual=b;function E(N){return N>0}g.isGreaterThan=E;function T(N){return N===0}g.isNeitherLessOrGreaterThan=T,g.greaterThan=1,g.lessThan=-1,g.neitherLessOrGreaterThan=0})(Ot||(Ot={}));function Ji(g,_){return(b,E)=>_(g(b),g(E))}var Yi=(g,_)=>g-_,Pt=class Ct{constructor(_){this.iterate=_}forEach(_){this.iterate(b=>(_(b),!0))}toArray(){let _=[];return this.iterate(b=>(_.push(b),!0)),_}filter(_){return new Ct(b=>this.iterate(E=>_(E)?b(E):!0))}map(_){return new Ct(b=>this.iterate(E=>b(_(E))))}some(_){let b=!1;return this.iterate(E=>(b=_(E),!b)),b}findFirst(_){let b;return this.iterate(E=>_(E)?(b=E,!1):!0),b}findLast(_){let b;return this.iterate(E=>(_(E)&&(b=E),!0)),b}findLastMaxBy(_){let b,E=!0;return this.iterate(T=>((E||Ot.isGreaterThan(_(T,b)))&&(E=!1,b=T),!0)),b}};Pt.empty=new Pt(g=>{});function Qi(g,_){let b=Object.create(null);for(let E of g){let T=_(E),N=b[T];N||(N=b[T]=[]),N.push(E)}return b}var Zi=class{constructor(){this.map=new Map}add(g,_){let b=this.map.get(g);b||(b=new Set,this.map.set(g,b)),b.add(_)}delete(g,_){let b=this.map.get(g);b&&(b.delete(_),b.size===0&&this.map.delete(g))}forEach(g,_){let b=this.map.get(g);b&&b.forEach(_)}get(g){return this.map.get(g)||new Set}};function es(g,_){let b=this,E=!1,T;return function(){if(E)return T;if(E=!0,_)try{T=g.apply(b,arguments)}finally{_()}else T=g.apply(b,arguments);return T}}var It;(g=>{function _(h){return h&&typeof h=="object"&&typeof h[Symbol.iterator]=="function"}g.is=_;let b=Object.freeze([]);function E(){return b}g.empty=E;function*T(h){yield h}g.single=T;function N(h){return _(h)?h:T(h)}g.wrap=N;function A(h){return h||b}g.from=A;function*t(h){for(let m=h.length-1;m>=0;m--)yield h[m]}g.reverse=t;function a(h){return!h||h[Symbol.iterator]().next().done===!0}g.isEmpty=a;function l(h){return h[Symbol.iterator]().next().value}g.first=l;function u(h,m){let d=0;for(let c of h)if(m(c,d++))return!0;return!1}g.some=u;function n(h,m){for(let d of h)if(m(d))return d}g.find=n;function*f(h,m){for(let d of h)m(d)&&(yield d)}g.filter=f;function*p(h,m){let d=0;for(let c of h)yield m(c,d++)}g.map=p;function*S(h,m){let d=0;for(let c of h)yield*m(c,d++)}g.flatMap=S;function*r(...h){for(let m of h)yield*m}g.concat=r;function e(h,m,d){let c=d;for(let v of h)c=m(c,v);return c}g.reduce=e;function*o(h,m,d=h.length){for(m<0&&(m+=h.length),d<0?d+=h.length:d>h.length&&(d=h.length);m<d;m++)yield h[m]}g.slice=o;function s(h,m=1/0){let d=[];if(m===0)return[d,h];let c=h[Symbol.iterator]();for(let v=0;v<m;v++){let C=c.next();if(C.done)return[d,g.empty()];d.push(C.value)}return[d,{[Symbol.iterator](){return c}}]}g.consume=s;async function i(h){let m=[];for await(let d of h)m.push(d);return Promise.resolve(m)}g.asyncToArray=i})(It||(It={}));var ts=!1,fe=null,is=class di{constructor(){this.livingDisposables=new Map}getDisposableData(_){let b=this.livingDisposables.get(_);return b||(b={parent:null,source:null,isSingleton:!1,value:_,idx:di.idx++},this.livingDisposables.set(_,b)),b}trackDisposable(_){let b=this.getDisposableData(_);b.source||(b.source=Error().stack)}setParent(_,b){let E=this.getDisposableData(_);E.parent=b}markAsDisposed(_){this.livingDisposables.delete(_)}markAsSingleton(_){this.getDisposableData(_).isSingleton=!0}getRootParent(_,b){let E=b.get(_);if(E)return E;let T=_.parent?this.getRootParent(this.getDisposableData(_.parent),b):_;return b.set(_,T),T}getTrackedDisposables(){let _=new Map;return[...this.livingDisposables.entries()].filter(([,b])=>b.source!==null&&!this.getRootParent(b,_).isSingleton).flatMap(([b])=>b)}computeLeakingDisposables(_=10,b){let E;if(b)E=b;else{let a=new Map,l=[...this.livingDisposables.values()].filter(n=>n.source!==null&&!this.getRootParent(n,a).isSingleton);if(l.length===0)return;let u=new Set(l.map(n=>n.value));if(E=l.filter(n=>!(n.parent&&u.has(n.parent))),E.length===0)throw Error("There are cyclic diposable chains!")}if(!E)return;function T(a){function l(n,f){for(;n.length>0&&f.some(p=>typeof p=="string"?p===n[0]:n[0].match(p));)n.shift()}let u=a.source.split(`
`).map(n=>n.trim().replace("at ","")).filter(n=>n!=="");return l(u,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),u.reverse()}let N=new Zi;for(let a of E){let l=T(a);for(let u=0;u<=l.length;u++)N.add(l.slice(0,u).join(`
`),a)}E.sort(Ji(a=>a.idx,Yi));let A="",t=0;for(let a of E.slice(0,_)){t++;let l=T(a),u=[];for(let n=0;n<l.length;n++){let f=l[n];f=`(shared with ${N.get(l.slice(0,n+1).join(`
`)).size}/${E.length} leaks) at ${f}`;let p=Qi([...N.get(l.slice(0,n).join(`
`))].map(S=>T(S)[n]),S=>S);delete p[l[n]];for(let[S,r]of Object.entries(p))u.unshift(`    - stacktraces of ${r.length} other leaks continue with ${S}`);u.unshift(f)}A+=`


==================== Leaking disposable ${t}/${E.length}: ${a.value.constructor.name} ====================
${u.join(`
`)}
============================================================

`}return E.length>_&&(A+=`


... and ${E.length-_} more leaking disposables

`),{leaks:E,details:A}}};is.idx=0;function ss(g){fe=g}if(ts){let g="__is_disposable_tracked__";ss(new class{trackDisposable(_){let b=Error("Potentially leaked disposable").stack;setTimeout(()=>{_[g]||console.log(b)},3e3)}setParent(_,b){if(_&&_!==be.None)try{_[g]=!0}catch{}}markAsDisposed(_){if(_&&_!==be.None)try{_[g]=!0}catch{}}markAsSingleton(_){}})}function Ne(g){return fe==null||fe.trackDisposable(g),g}function Ue(g){fe==null||fe.markAsDisposed(g)}function Pe(g,_){fe==null||fe.setParent(g,_)}function rs(g,_){if(fe)for(let b of g)fe.setParent(b,_)}function Ie(g){if(It.is(g)){let _=[];for(let b of g)if(b)try{b.dispose()}catch(E){_.push(E)}if(_.length===1)throw _[0];if(_.length>1)throw AggregateError(_,"Encountered errors while disposing of store");return Array.isArray(g)?[]:g}else if(g)return g.dispose(),g}function Ht(...g){let _=Me(()=>Ie(g));return rs(g,_),_}function Me(g){let _=Ne({dispose:es(()=>{Ue(_),g()})});return _}var Ft=class ui{constructor(){this._toDispose=new Set,this._isDisposed=!1,Ne(this)}dispose(){this._isDisposed||(Ue(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Ie(this._toDispose)}finally{this._toDispose.clear()}}add(_){if(!_)return _;if(_===this)throw Error("Cannot register a disposable on itself!");return Pe(_,this),this._isDisposed?ui.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(_),_}delete(_){if(_){if(_===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(_),_.dispose()}}deleteAndLeak(_){_&&this._toDispose.has(_)&&(this._toDispose.delete(_),Pe(_,null))}};Ft.DISABLE_DISPOSED_WARNING=!1;var st=Ft,be=class{constructor(){this._store=new st,Ne(this),Pe(this._store,this)}dispose(){Ue(this),this._store.dispose()}_register(g){if(g===this)throw Error("Cannot register a disposable on itself!");return this._store.add(g)}};be.None=Object.freeze({dispose(){}});var ze=class{constructor(){this._isDisposed=!1,Ne(this)}get value(){return this._isDisposed?void 0:this._value}set value(g){var _;this._isDisposed||g===this._value||((_=this._value)==null||_.dispose(),g&&Pe(g,this),this._value=g)}clear(){this.value=void 0}dispose(){var g;this._isDisposed=!0,Ue(this),(g=this._value)==null||g.dispose(),this._value=void 0}clearAndLeak(){let g=this._value;return this._value=void 0,g&&Pe(g,null),g}},Wt=class bt{constructor(_){this.element=_,this.next=bt.Undefined,this.prev=bt.Undefined}};Wt.Undefined=new Wt(void 0);var ns=globalThis.performance&&typeof globalThis.performance.now=="function",os=class _i{static create(_){return new _i(_)}constructor(_){this._now=ns&&_===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime===-1?this._now()-this._startTime:this._stopTime-this._startTime}},as=!1,$t=!1,hs=!1,rt;(g=>{g.None=()=>be.None;function _(y){if(hs){let{onDidAddListener:L}=y,M=ot.create(),B=0;y.onDidAddListener=()=>{++B===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),M.print()),L==null||L()}}}function b(y,L){return f(y,()=>{},0,void 0,!0,void 0,L)}g.defer=b;function E(y){return(L,M=null,B)=>{let P=!1,H;return H=y(w=>{if(!P)return H?H.dispose():P=!0,L.call(M,w)},null,B),P&&H.dispose(),H}}g.once=E;function T(y,L,M){return u((B,P=null,H)=>y(w=>B.call(P,L(w)),null,H),M)}g.map=T;function N(y,L,M){return u((B,P=null,H)=>y(w=>{L(w),B.call(P,w)},null,H),M)}g.forEach=N;function A(y,L,M){return u((B,P=null,H)=>y(w=>L(w)&&B.call(P,w),null,H),M)}g.filter=A;function t(y){return y}g.signal=t;function a(...y){return(L,M=null,B)=>n(Ht(...y.map(P=>P(H=>L.call(M,H)))),B)}g.any=a;function l(y,L,M,B){let P=M;return T(y,H=>(P=L(P,H),P),B)}g.reduce=l;function u(y,L){let M,B={onWillAddFirstListener(){M=y(P.fire,P)},onDidRemoveLastListener(){M==null||M.dispose()}};L||_(B);let P=new we(B);return L==null||L.add(P),P.event}function n(y,L){return L instanceof Array?L.push(y):L&&L.add(y),y}function f(y,L,M=100,B=!1,P=!1,H,w){let R,O,F,z=0,j,X={leakWarningThreshold:H,onWillAddFirstListener(){R=y(W=>{z++,O=L(O,W),B&&!F&&(K.fire(O),O=void 0),j=()=>{let $=O;O=void 0,F=void 0,(!B||z>1)&&K.fire($),z=0},typeof M=="number"?(clearTimeout(F),F=setTimeout(j,M)):F===void 0&&(F=0,queueMicrotask(j))})},onWillRemoveListener(){P&&z>0&&(j==null||j())},onDidRemoveLastListener(){j=void 0,R.dispose()}};w||_(X);let K=new we(X);return w==null||w.add(K),K.event}g.debounce=f;function p(y,L=0,M){return g.debounce(y,(B,P)=>B?(B.push(P),B):[P],L,void 0,!0,void 0,M)}g.accumulate=p;function S(y,L=(B,P)=>B===P,M){let B=!0,P;return A(y,H=>{let w=B||!L(H,P);return B=!1,P=H,w},M)}g.latch=S;function r(y,L,M){return[g.filter(y,L,M),g.filter(y,B=>!L(B),M)]}g.split=r;function e(y,L=!1,M=[],B){let P=M.slice(),H=y(O=>{P?P.push(O):R.fire(O)});B&&B.add(H);let w=()=>{P==null||P.forEach(O=>R.fire(O)),P=null},R=new we({onWillAddFirstListener(){H||(H=y(O=>R.fire(O)),B&&B.add(H))},onDidAddFirstListener(){P&&(L?setTimeout(w):w())},onDidRemoveLastListener(){H&&H.dispose(),H=null}});return B&&B.add(R),R.event}g.buffer=e;function o(y,L){return(M,B,P)=>{let H=L(new i);return y(function(w){let R=H.evaluate(w);R!==s&&M.call(B,R)},void 0,P)}}g.chain=o;let s=Symbol("HaltChainable");class i{constructor(){this.steps=[]}map(L){return this.steps.push(L),this}forEach(L){return this.steps.push(M=>(L(M),M)),this}filter(L){return this.steps.push(M=>L(M)?M:s),this}reduce(L,M){let B=M;return this.steps.push(P=>(B=L(B,P),B)),this}latch(L=(M,B)=>M===B){let M=!0,B;return this.steps.push(P=>{let H=M||!L(P,B);return M=!1,B=P,H?P:s}),this}evaluate(L){for(let M of this.steps)if(L=M(L),L===s)break;return L}}function h(y,L,M=B=>B){let B=(...H)=>P.fire(M(...H)),P=new we({onWillAddFirstListener:()=>y.on(L,B),onDidRemoveLastListener:()=>y.removeListener(L,B)});return P.event}g.fromNodeEventEmitter=h;function m(y,L,M=B=>B){let B=(...H)=>P.fire(M(...H)),P=new we({onWillAddFirstListener:()=>y.addEventListener(L,B),onDidRemoveLastListener:()=>y.removeEventListener(L,B)});return P.event}g.fromDOMEventEmitter=m;function d(y){return new Promise(L=>E(y)(L))}g.toPromise=d;function c(y){let L=new we;return y.then(M=>{L.fire(M)},()=>{L.fire(void 0)}).finally(()=>{L.dispose()}),L.event}g.fromPromise=c;function v(y,L){return y(M=>L.fire(M))}g.forward=v;function C(y,L,M){return L(M),y(B=>L(B))}g.runAndSubscribe=C;class k{constructor(L,M){this._observable=L,this._counter=0,this._hasChanged=!1;let B={onWillAddFirstListener:()=>{L.addObserver(this)},onDidRemoveLastListener:()=>{L.removeObserver(this)}};M||_(B),this.emitter=new we(B),M&&M.add(this.emitter)}beginUpdate(L){this._counter++}handlePossibleChange(L){}handleChange(L,M){this._hasChanged=!0}endUpdate(L){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function D(y,L){return new k(y,L).emitter.event}g.fromObservable=D;function x(y){return(L,M,B)=>{let P=0,H=!1,w={beginUpdate(){P++},endUpdate(){P--,P===0&&(y.reportChanges(),H&&(H=!1,L.call(M)))},handlePossibleChange(){},handleChange(){H=!0}};y.addObserver(w),y.reportChanges();let R={dispose(){y.removeObserver(w)}};return B instanceof st?B.add(R):Array.isArray(B)&&B.push(R),R}}g.fromObservableLight=x})(rt||(rt={}));var nt=class wt{constructor(_){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${_}_${wt._idPool++}`,wt.all.add(this)}start(_){this._stopWatch=new os,this.listenerCount=_}stop(){if(this._stopWatch){let _=this._stopWatch.elapsed();this.durations.push(_),this.elapsedOverall+=_,this.invocationCount+=1,this._stopWatch=void 0}}};nt.all=new Set,nt._idPool=0;var ls=nt,Nt=-1,Ut=class fi{constructor(_,b,E=(fi._idPool++).toString(16).padStart(3,"0")){this._errorHandler=_,this.threshold=b,this.name=E,this._warnCountdown=0}dispose(){var _;(_=this._stacks)==null||_.clear()}check(_,b){let E=this.threshold;if(E<=0||b<E)return;this._stacks||(this._stacks=new Map);let T=this._stacks.get(_.value)||0;if(this._stacks.set(_.value,T+1),--this._warnCountdown,this._warnCountdown<=0){this._warnCountdown=E*.5;let[N,A]=this.getMostFrequentStack(),t=`[${this.name}] potential listener LEAK detected, having ${b} listeners already. MOST frequent listener (${A}):`;console.warn(t),console.warn(N);let a=new ds(t,N);this._errorHandler(a)}return()=>{let N=this._stacks.get(_.value)||0;this._stacks.set(_.value,N-1)}}getMostFrequentStack(){if(!this._stacks)return;let _,b=0;for(let[E,T]of this._stacks)(!_||b<T)&&(_=[E,T],b=T);return _}};Ut._idPool=1;var cs=Ut,ot=class gi{constructor(_){this.value=_}static create(){return new gi(Error().stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},ds=class extends Error{constructor(g,_){super(g),this.name="ListenerLeakError",this.stack=_}},us=class extends Error{constructor(g,_){super(g),this.name="ListenerRefusalError",this.stack=_}},_s=0,je=class{constructor(g){this.value=g,this.id=_s++}},fs=2,gs=(g,_)=>{if(g instanceof je)_(g);else for(let b=0;b<g.length;b++){let E=g[b];E&&_(E)}},Ae;if(as){let g=[];setInterval(()=>{g.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(g.join(`
`)),g.length=0)},3e3),Ae=new FinalizationRegistry(_=>{typeof _=="string"&&g.push(_)})}var we=class{constructor(g){var _,b,E,T;this._size=0,this._options=g,this._leakageMon=Nt>0||(_=this._options)!=null&&_.leakWarningThreshold?new cs((g==null?void 0:g.onListenerError)??tt,((b=this._options)==null?void 0:b.leakWarningThreshold)??Nt):void 0,this._perfMon=(E=this._options)!=null&&E._profName?new ls(this._options._profName):void 0,this._deliveryQueue=(T=this._options)==null?void 0:T.deliveryQueue}dispose(){var g,_,b,E;if(!this._disposed){if(this._disposed=!0,((g=this._deliveryQueue)==null?void 0:g.current)===this&&this._deliveryQueue.reset(),this._listeners){if($t){let T=this._listeners;queueMicrotask(()=>{gs(T,N=>{var A;return(A=N.stack)==null?void 0:A.print()})})}this._listeners=void 0,this._size=0}(b=(_=this._options)==null?void 0:_.onDidRemoveLastListener)==null||b.call(_),(E=this._leakageMon)==null||E.dispose()}}get event(){return this._event??(this._event=(g,_,b)=>{var A,t,a,l,u;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let n=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(n);let f=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],p=new us(`${n}. HINT: Stack shows most frequent listener (${f[1]}-times)`,f[0]);return(((A=this._options)==null?void 0:A.onListenerError)||tt)(p),be.None}if(this._disposed)return be.None;_&&(g=g.bind(_));let E=new je(g),T;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(E.stack=ot.create(),T=this._leakageMon.check(E.stack,this._size+1)),$t&&(E.stack=ot.create()),this._listeners?this._listeners instanceof je?(this._deliveryQueue??(this._deliveryQueue=new vs),this._listeners=[this._listeners,E]):this._listeners.push(E):((a=(t=this._options)==null?void 0:t.onWillAddFirstListener)==null||a.call(t,this),this._listeners=E,(u=(l=this._options)==null?void 0:l.onDidAddFirstListener)==null||u.call(l,this)),this._size++;let N=Me(()=>{Ae==null||Ae.unregister(N),T==null||T(),this._removeListener(E)});if(b instanceof st?b.add(N):Array.isArray(b)&&b.push(N),Ae){let n=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),f=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(n);Ae.register(N,(f==null?void 0:f[2])??n,N)}return N}),this._event}_removeListener(g){var T,N,A,t;if((N=(T=this._options)==null?void 0:T.onWillRemoveListener)==null||N.call(T,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(t=(A=this._options)==null?void 0:A.onDidRemoveLastListener)==null||t.call(A,this),this._size=0;return}let _=this._listeners,b=_.indexOf(g);if(b===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,_[b]=void 0;let E=this._deliveryQueue.current===this;if(this._size*fs<=_.length){let a=0;for(let l=0;l<_.length;l++)_[l]?_[a++]=_[l]:E&&(this._deliveryQueue.end--,a<this._deliveryQueue.i&&this._deliveryQueue.i--);_.length=a}}_deliver(g,_){var E;if(!g)return;let b=((E=this._options)==null?void 0:E.onListenerError)||tt;if(!b){g.value(_);return}try{g.value(_)}catch(T){b(T)}}_deliverQueue(g){let _=g.current._listeners;for(;g.i<g.end;)this._deliver(_[g.i++],g.value);g.reset()}fire(g){var _,b,E,T;if((_=this._deliveryQueue)!=null&&_.current&&(this._deliverQueue(this._deliveryQueue),(b=this._perfMon)==null||b.stop()),(E=this._perfMon)==null||E.start(this._size),this._listeners)if(this._listeners instanceof je)this._deliver(this._listeners,g);else{let N=this._deliveryQueue;N.enqueue(this,g,this._listeners.length),this._deliverQueue(N)}(T=this._perfMon)==null||T.stop()}hasListeners(){return this._size>0}},vs=class{constructor(){this.i=-1,this.end=0}enqueue(g,_,b){this.i=0,this.end=b,this.current=g,this.value=_}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},zt=Object.freeze(function(g,_){let b=setTimeout(g.bind(_),0);return{dispose(){clearTimeout(b)}}}),ps;(g=>{function _(b){return b===g.None||b===g.Cancelled||b instanceof ms?!0:!b||typeof b!="object"?!1:typeof b.isCancellationRequested=="boolean"&&typeof b.onCancellationRequested=="function"}g.isCancellationToken=_,g.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:rt.None}),g.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:zt})})(ps||(ps={}));var ms=class{constructor(){this._isCancelled=!1,this._emitter=null}cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?zt:(this._emitter||(this._emitter=new we),this._emitter.event)}dispose(){this._emitter&&(this._emitter=(this._emitter.dispose(),null))}},qe="en",at=!1,jt=!1,Ge=qe,pe,xe=globalThis,de;typeof xe.vscode<"u"&&typeof xe.vscode.process<"u"?de=xe.vscode.process:typeof process<"u"&&typeof((oi=process==null?void 0:process.versions)==null?void 0:oi.node)=="string"&&(de=process);var Ss=typeof((ai=de==null?void 0:de.versions)==null?void 0:ai.electron)=="string"&&(de==null?void 0:de.type)==="renderer";if(typeof de=="object"){de.platform,de.platform,at=de.platform==="linux",at&&de.env.SNAP&&de.env.SNAP_REVISION,de.env.CI||de.env.BUILD_ARTIFACTSTAGINGDIRECTORY,Ge=qe;let g=de.env.VSCODE_NLS_CONFIG;if(g)try{let _=JSON.parse(g);_.userLocale,_.osLocale,Ge=_.resolvedLanguage||qe,(hi=_.languagePack)==null||hi.translationsConfigFile}catch{}}else typeof navigator=="object"&&!Ss?(pe=navigator.userAgent,pe.indexOf("Windows"),pe.indexOf("Macintosh"),(pe.indexOf("Macintosh")>=0||pe.indexOf("iPad")>=0||pe.indexOf("iPhone")>=0)&&navigator.maxTouchPoints&&navigator.maxTouchPoints,at=pe.indexOf("Linux")>=0,pe==null||pe.indexOf("Mobi"),jt=!0,Ge=globalThis._VSCODE_NLS_LANGUAGE||qe,navigator.language.toLowerCase()):console.error("Unable to resolve platform.");jt&&typeof xe.importScripts=="function"&&xe.origin;var ye=pe,ke=Ge,Cs;(g=>{function _(){return ke}g.value=_;function b(){return ke.length===2?ke==="en":ke.length>=3?ke[0]==="e"&&ke[1]==="n"&&ke[2]==="-":!1}g.isDefaultVariant=b;function E(){return ke==="en"}g.isDefault=E})(Cs||(Cs={}));var bs=typeof xe.postMessage=="function"&&!xe.importScripts;(()=>{if(bs){let g=[];xe.addEventListener("message",b=>{if(b.data&&b.data.vscodeScheduleAsyncWork)for(let E=0,T=g.length;E<T;E++){let N=g[E];if(N.id===b.data.vscodeScheduleAsyncWork){g.splice(E,1),N.callback();return}}});let _=0;return b=>{let E=++_;g.push({id:E,callback:b}),xe.postMessage({vscodeScheduleAsyncWork:E},"*")}}return g=>setTimeout(g)})();var ws=!!(ye&&ye.indexOf("Chrome")>=0);ye&&ye.indexOf("Firefox"),!ws&&ye&&ye.indexOf("Safari"),ye&&ye.indexOf("Edg/"),ye&&ye.indexOf("Android");function qt(g,_=0,b){let E=setTimeout(()=>{g(),b&&T.dispose()},_),T=Me(()=>{clearTimeout(E),b==null||b.deleteAndLeak(T)});return b==null||b.add(T),T}(function(){typeof globalThis.requestIdleCallback!="function"||globalThis.cancelIdleCallback})();var ys;(g=>{async function _(E){let T,N=await Promise.all(E.map(A=>A.then(t=>t,t=>{T||(T=t)})));if(typeof T<"u")throw T;return N}g.settled=_;function b(E){return new Promise(async(T,N)=>{try{await E(T,N)}catch(A){N(A)}})}g.withAsyncBody=b})(ys||(ys={}));var Gt=class ve{static fromArray(_){return new ve(b=>{b.emitMany(_)})}static fromPromise(_){return new ve(async b=>{b.emitMany(await _)})}static fromPromises(_){return new ve(async b=>{await Promise.all(_.map(async E=>b.emitOne(await E)))})}static merge(_){return new ve(async b=>{await Promise.all(_.map(async E=>{for await(let T of E)b.emitOne(T)}))})}constructor(_,b){this._state=0,this._results=[],this._error=null,this._onReturn=b,this._onStateChanged=new we,queueMicrotask(async()=>{let E={emitOne:T=>this.emitOne(T),emitMany:T=>this.emitMany(T),reject:T=>this.reject(T)};try{await Promise.resolve(_(E)),this.resolve()}catch(T){this.reject(T)}finally{E.emitOne=void 0,E.emitMany=void 0,E.reject=void 0}})}[Symbol.asyncIterator](){let _=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(_<this._results.length)return{done:!1,value:this._results[_++]};if(this._state===1)return{done:!0,value:void 0};await rt.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>{var b;return(b=this._onReturn)==null||b.call(this),{done:!0,value:void 0}}}}static map(_,b){return new ve(async E=>{for await(let T of _)E.emitOne(b(T))})}map(_){return ve.map(this,_)}static filter(_,b){return new ve(async E=>{for await(let T of _)b(T)&&E.emitOne(T)})}filter(_){return ve.filter(this,_)}static coalesce(_){return ve.filter(_,b=>!!b)}coalesce(){return ve.coalesce(this)}static async toPromise(_){let b=[];for await(let E of _)b.push(E);return b}toPromise(){return ve.toPromise(this)}emitOne(_){this._state===0&&(this._results.push(_),this._onStateChanged.fire())}emitMany(_){this._state===0&&(this._results=this._results.concat(_),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(_){this._state===0&&(this._state=2,this._error=_,this._onStateChanged.fire())}};Gt.EMPTY=Gt.fromArray([]);var Ls=class extends be{constructor(g){super(),this._terminal=g,this._linesCacheTimeout=this._register(new ze),this._linesCacheDisposables=this._register(new ze),this._register(Me(()=>this._destroyLinesCache()))}initLinesCache(){this._linesCache||(this._linesCache=Array(this._terminal.buffer.active.length),this._linesCacheDisposables.value=Ht(this._terminal.onLineFeed(()=>this._destroyLinesCache()),this._terminal.onCursorMove(()=>this._destroyLinesCache()),this._terminal.onResize(()=>this._destroyLinesCache()))),this._linesCacheTimeout.value=qt(()=>this._destroyLinesCache(),15e3)}_destroyLinesCache(){this._linesCache=void 0,this._linesCacheDisposables.clear(),this._linesCacheTimeout.clear()}getLineFromCache(g){var _;return(_=this._linesCache)==null?void 0:_[g]}setLineInCache(g,_){this._linesCache&&(this._linesCache[g]=_)}translateBufferLineToStringWithWrap(g,_){var N;let b=[],E=[0],T=this._terminal.buffer.active.getLine(g);for(;T;){let A=this._terminal.buffer.active.getLine(g+1),t=A?A.isWrapped:!1,a=T.translateToString(!t&&_);if(t&&A){let l=T.getCell(T.length-1);l&&l.getCode()===0&&l.getWidth()===1&&((N=A.getCell(0))==null?void 0:N.getWidth())===2&&(a=a.slice(0,-1))}if(b.push(a),t)E.push(E[E.length-1]+a.length);else break;g++,T=A}return[b.join(""),E]}},xs=class{get cachedSearchTerm(){return this._cachedSearchTerm}set cachedSearchTerm(g){this._cachedSearchTerm=g}get lastSearchOptions(){return this._lastSearchOptions}set lastSearchOptions(g){this._lastSearchOptions=g}isValidSearchTerm(g){return!!(g&&g.length>0)}didOptionsChange(g){return this._lastSearchOptions?g?this._lastSearchOptions.caseSensitive!==g.caseSensitive||this._lastSearchOptions.regex!==g.regex||this._lastSearchOptions.wholeWord!==g.wholeWord:!1:!0}shouldUpdateHighlighting(g,_){return _!=null&&_.decorations?this._cachedSearchTerm===void 0||g!==this._cachedSearchTerm||this.didOptionsChange(_):!1}clearCachedTerm(){this._cachedSearchTerm=void 0}reset(){this._cachedSearchTerm=void 0,this._lastSearchOptions=void 0}},Es=class{constructor(g,_){this._terminal=g,this._lineCache=_}find(g,_,b,E){if(!g||g.length===0){this._terminal.clearSelection();return}if(b>this._terminal.cols)throw Error(`Invalid col: ${b} to search in terminal of ${this._terminal.cols} cols`);this._lineCache.initLinesCache();let T={startRow:_,startCol:b},N=this._findInLine(g,T,E);if(!N)for(let A=_+1;A<this._terminal.buffer.active.baseY+this._terminal.rows&&(T.startRow=A,T.startCol=0,N=this._findInLine(g,T,E),!N);A++);return N}findNextWithSelection(g,_,b){if(!g||g.length===0){this._terminal.clearSelection();return}let E=this._terminal.getSelectionPosition();this._terminal.clearSelection();let T=0,N=0;E&&(b===g?(T=E.end.x,N=E.end.y):(T=E.start.x,N=E.start.y)),this._lineCache.initLinesCache();let A={startRow:N,startCol:T},t=this._findInLine(g,A,_);if(!t)for(let a=N+1;a<this._terminal.buffer.active.baseY+this._terminal.rows&&(A.startRow=a,A.startCol=0,t=this._findInLine(g,A,_),!t);a++);if(!t&&N!==0)for(let a=0;a<N&&(A.startRow=a,A.startCol=0,t=this._findInLine(g,A,_),!t);a++);return!t&&E&&(A.startRow=E.start.y,A.startCol=0,t=this._findInLine(g,A,_)),t}findPreviousWithSelection(g,_,b){if(!g||g.length===0){this._terminal.clearSelection();return}let E=this._terminal.getSelectionPosition();this._terminal.clearSelection();let T=this._terminal.buffer.active.baseY+this._terminal.rows-1,N=this._terminal.cols;this._lineCache.initLinesCache();let A={startRow:T,startCol:N},t;if(E&&(A.startRow=T=E.start.y,A.startCol=N=E.start.x,b!==g&&(t=this._findInLine(g,A,_,!1),t||(A.startRow=T=E.end.y,A.startCol=N=E.end.x))),t||(t=this._findInLine(g,A,_,!0)),!t){A.startCol=Math.max(A.startCol,this._terminal.cols);for(let a=T-1;a>=0&&(A.startRow=a,t=this._findInLine(g,A,_,!0),!t);a--);}if(!t&&T!==this._terminal.buffer.active.baseY+this._terminal.rows-1)for(let a=this._terminal.buffer.active.baseY+this._terminal.rows-1;a>=T&&(A.startRow=a,t=this._findInLine(g,A,_,!0),!t);a--);return t}_isWholeWord(g,_,b){return(g===0||" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?".includes(_[g-1]))&&(g+b.length===_.length||" ~!@#$%^&*()+`-=[]{}|\\;:\"',./<>?".includes(_[g+b.length]))}_findInLine(g,_,b={},E=!1){var p;let T=_.startRow,N=_.startCol;if((p=this._terminal.buffer.active.getLine(T))!=null&&p.isWrapped){if(E){_.startCol+=this._terminal.cols;return}return _.startRow--,_.startCol+=this._terminal.cols,this._findInLine(g,_,b)}let A=this._lineCache.getLineFromCache(T);A||(A=this._lineCache.translateBufferLineToStringWithWrap(T,!0),this._lineCache.setLineInCache(T,A));let[t,a]=A,l=this._bufferColsToStringOffset(T,N),u=g,n=t;b.regex||(u=b.caseSensitive?g:g.toLowerCase(),n=b.caseSensitive?t:t.toLowerCase());let f=-1;if(b.regex){let S=RegExp(u,b.caseSensitive?"g":"gi"),r;if(E)for(;r=S.exec(n.slice(0,l));)f=S.lastIndex-r[0].length,g=r[0],S.lastIndex-=g.length-1;else r=S.exec(n.slice(l)),r&&r[0].length>0&&(f=l+(S.lastIndex-r[0].length),g=r[0])}else E?l-u.length>=0&&(f=n.lastIndexOf(u,l-u.length)):f=n.indexOf(u,l);if(f>=0){if(b.wholeWord&&!this._isWholeWord(f,n,g))return;let S=0;for(;S<a.length-1&&f>=a[S+1];)S++;let r=S;for(;r<a.length-1&&f+g.length>=a[r+1];)r++;let e=f-a[S],o=f+g.length-a[r],s=this._stringLengthToBufferSize(T+S,e),i=this._stringLengthToBufferSize(T+r,o)-s+this._terminal.cols*(r-S);return{term:g,col:s,row:T+S,size:i}}}_stringLengthToBufferSize(g,_){let b=this._terminal.buffer.active.getLine(g);if(!b)return 0;for(let E=0;E<_;E++){let T=b.getCell(E);if(!T)break;let N=T.getChars();N.length>1&&(_-=N.length-1);let A=b.getCell(E+1);A&&A.getWidth()===0&&_++}return _}_bufferColsToStringOffset(g,_){let b=g,E=0,T=this._terminal.buffer.active.getLine(b);for(;_>0&&T;){for(let N=0;N<_&&N<this._terminal.cols;N++){let A=T.getCell(N);if(!A)break;A.getWidth()&&(E+=A.getCode()===0?1:A.getChars().length)}if(b++,T=this._terminal.buffer.active.getLine(b),T&&!T.isWrapped)break;_-=this._terminal.cols}return E}},ks=class extends be{constructor(g){super(),this._terminal=g,this._highlightDecorations=[],this._highlightedLines=new Set,this._register(Me(()=>this.clearHighlightDecorations()))}createHighlightDecorations(g,_){this.clearHighlightDecorations();for(let b of g){let E=this._createResultDecorations(b,_,!1);if(E)for(let T of E)this._storeDecoration(T,b)}}createActiveDecoration(g,_){let b=this._createResultDecorations(g,_,!0);if(b)return{decorations:b,match:g,dispose(){Ie(b)}}}clearHighlightDecorations(){Ie(this._highlightDecorations),this._highlightDecorations=[],this._highlightedLines.clear()}_storeDecoration(g,_){this._highlightedLines.add(g.marker.line),this._highlightDecorations.push({decoration:g,match:_,dispose(){g.dispose()}})}_applyStyles(g,_,b){g.classList.contains("xterm-find-result-decoration")||(g.classList.add("xterm-find-result-decoration"),_&&(g.style.outline=`1px solid ${_}`)),b&&g.classList.add("xterm-find-active-result-decoration")}_createResultDecorations(g,_,b){let E=[],T=g.col,N=g.size,A=-this._terminal.buffer.active.baseY-this._terminal.buffer.active.cursorY+g.row;for(;N>0;){let a=Math.min(this._terminal.cols-T,N);E.push([A,T,a]),T=0,N-=a,A++}let t=[];for(let a of E){let l=this._terminal.registerMarker(a[0]),u=this._terminal.registerDecoration({marker:l,x:a[1],width:a[2],backgroundColor:b?_.activeMatchBackground:_.matchBackground,overviewRulerOptions:this._highlightedLines.has(l.line)?void 0:{color:b?_.activeMatchColorOverviewRuler:_.matchOverviewRuler,position:"center"}});if(u){let n=[];n.push(l),n.push(u.onRender(f=>this._applyStyles(f,b?_.activeMatchBorder:_.matchBorder,!1))),n.push(u.onDispose(()=>Ie(n))),t.push(u)}}return t.length===0?void 0:t}},Ds=class extends be{constructor(){super(...arguments),this._searchResults=[],this._onDidChangeResults=this._register(new we)}get onDidChangeResults(){return this._onDidChangeResults.event}get searchResults(){return this._searchResults}get selectedDecoration(){return this._selectedDecoration}set selectedDecoration(g){this._selectedDecoration=g}updateResults(g,_){this._searchResults=g.slice(0,_)}clearResults(){this._searchResults=[]}clearSelectedDecoration(){this._selectedDecoration&&(this._selectedDecoration=(this._selectedDecoration.dispose(),void 0))}findResultIndex(g){for(let _=0;_<this._searchResults.length;_++){let b=this._searchResults[_];if(b.row===g.row&&b.col===g.col&&b.size===g.size)return _}return-1}fireResultsChanged(g){if(!g)return;let _=-1;this._selectedDecoration&&(_=this.findResultIndex(this._selectedDecoration.match)),this._onDidChangeResults.fire({resultIndex:_,resultCount:this._searchResults.length})}reset(){this.clearSelectedDecoration(),this.clearResults()}},Rs=class extends be{constructor(g){super(),this._highlightTimeout=this._register(new ze),this._lineCache=this._register(new ze),this._state=new xs,this._resultTracker=this._register(new Ds),this._highlightLimit=(g==null?void 0:g.highlightLimit)??1e3}get onDidChangeResults(){return this._resultTracker.onDidChangeResults}activate(g){this._terminal=g,this._lineCache.value=new Ls(g),this._engine=new Es(g,this._lineCache.value),this._decorationManager=new ks(g),this._register(this._terminal.onWriteParsed(()=>this._updateMatches())),this._register(this._terminal.onResize(()=>this._updateMatches())),this._register(Me(()=>this.clearDecorations()))}_updateMatches(){var g;this._highlightTimeout.clear(),this._state.cachedSearchTerm&&((g=this._state.lastSearchOptions)!=null&&g.decorations)&&(this._highlightTimeout.value=qt(()=>{let _=this._state.cachedSearchTerm;this._state.clearCachedTerm(),this.findPrevious(_,{...this._state.lastSearchOptions,incremental:!0},{noScroll:!0})},200))}clearDecorations(g){var _;this._resultTracker.clearSelectedDecoration(),(_=this._decorationManager)==null||_.clearHighlightDecorations(),this._resultTracker.clearResults(),g||this._state.clearCachedTerm()}clearActiveDecoration(){this._resultTracker.clearSelectedDecoration()}findNext(g,_,b){if(!this._terminal||!this._engine)throw Error("Cannot use addon until it has been loaded");this._state.lastSearchOptions=_,this._state.shouldUpdateHighlighting(g,_)&&this._highlightAllMatches(g,_);let E=this._findNextAndSelect(g,_,b);return this._fireResults(_),this._state.cachedSearchTerm=g,E}_highlightAllMatches(g,_){if(!this._terminal||!this._engine||!this._decorationManager)throw Error("Cannot use addon until it has been loaded");if(!this._state.isValidSearchTerm(g)){this.clearDecorations();return}this.clearDecorations(!0);let b=[],E,T=this._engine.find(g,0,0,_);for(;T&&((E==null?void 0:E.row)!==T.row||(E==null?void 0:E.col)!==T.col)&&!(b.length>=this._highlightLimit);)E=T,b.push(E),T=this._engine.find(g,E.col+E.term.length>=this._terminal.cols?E.row+1:E.row,E.col+E.term.length>=this._terminal.cols?0:E.col+1,_);this._resultTracker.updateResults(b,this._highlightLimit),_.decorations&&this._decorationManager.createHighlightDecorations(b,_.decorations)}_findNextAndSelect(g,_,b){if(!this._terminal||!this._engine)return!1;if(!this._state.isValidSearchTerm(g))return this._terminal.clearSelection(),this.clearDecorations(),!1;let E=this._engine.findNextWithSelection(g,_,this._state.cachedSearchTerm);return this._selectResult(E,_==null?void 0:_.decorations,b==null?void 0:b.noScroll)}findPrevious(g,_,b){if(!this._terminal||!this._engine)throw Error("Cannot use addon until it has been loaded");this._state.lastSearchOptions=_,this._state.shouldUpdateHighlighting(g,_)&&this._highlightAllMatches(g,_);let E=this._findPreviousAndSelect(g,_,b);return this._fireResults(_),this._state.cachedSearchTerm=g,E}_fireResults(g){this._resultTracker.fireResultsChanged(!!(g!=null&&g.decorations))}_findPreviousAndSelect(g,_,b){if(!this._terminal||!this._engine)return!1;if(!this._state.isValidSearchTerm(g))return this._terminal.clearSelection(),this.clearDecorations(),!1;let E=this._engine.findPreviousWithSelection(g,_,this._state.cachedSearchTerm);return this._selectResult(E,_==null?void 0:_.decorations,b==null?void 0:b.noScroll)}_selectResult(g,_,b){if(!this._terminal||!this._decorationManager)return!1;if(this._resultTracker.clearSelectedDecoration(),!g)return this._terminal.clearSelection(),!1;if(this._terminal.select(g.col,g.row,g.size),_){let E=this._decorationManager.createActiveDecoration(g,_);E&&(this._resultTracker.selectedDecoration=E)}if(!b&&(g.row>=this._terminal.buffer.active.viewportY+this._terminal.rows||g.row<this._terminal.buffer.active.viewportY)){let E=g.row-this._terminal.buffer.active.viewportY;E-=Math.floor(this._terminal.rows/2),this._terminal.scrollLines(E)}return!0}},ht=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],Ms=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],ce;function As(g,_){let b=0,E=_.length-1,T;if(g<_[0][0]||g>_[E][1])return!1;for(;E>=b;)if(T=b+E>>1,g>_[T][1])b=T+1;else if(g<_[T][0])E=T-1;else return!0;return!1}var Ts=class{constructor(){if(this.version="6",!ce){ce=new Uint8Array(65536),ce.fill(1),ce[0]=0,ce.fill(0,1,32),ce.fill(0,127,160),ce.fill(2,4352,4448),ce[9001]=2,ce[9002]=2,ce.fill(2,11904,42192),ce[12351]=1,ce.fill(2,44032,55204),ce.fill(2,63744,64256),ce.fill(2,65040,65050),ce.fill(2,65072,65136),ce.fill(2,65280,65377),ce.fill(2,65504,65511);for(let g=0;g<ht.length;++g)ce.fill(0,ht[g][0],ht[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?ce[g]:As(g,Ms)?0:g>=131072&&g<=196605||g>=196608&&g<=262141?2:1}charProperties(g,_){let b=this.wcwidth(g),E=b===0&&_!==0;if(E){let T=Ve.extractWidth(_);T===0?E=!1:T>b&&(b=T)}return Ve.createPropertyValue(0,b,E)}},Bs=new class{constructor(){this.listeners=[],this.unexpectedErrorHandler=function(g){setTimeout(()=>{throw g.stack?Kt.isErrorNoTelemetry(g)?new Kt(g.message+`

`+g.stack):Error(g.message+`

`+g.stack):g},0)}}addListener(g){return this.listeners.push(g),()=>{this._removeListener(g)}}emit(g){this.listeners.forEach(_=>{_(g)})}_removeListener(g){this.listeners.splice(this.listeners.indexOf(g),1)}setUnexpectedErrorHandler(g){this.unexpectedErrorHandler=g}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(g){this.unexpectedErrorHandler(g),this.emit(g)}onUnexpectedExternalError(g){this.unexpectedErrorHandler(g)}};function lt(g){Os(g)||Bs.onUnexpectedError(g)}var ct="Canceled";function Os(g){return g instanceof Ps?!0:g instanceof Error&&g.name===ct&&g.message===ct}var Ps=class extends Error{constructor(){super(ct),this.name=this.message}},Kt=class yt extends Error{constructor(_){super(_),this.name="CodeExpectedError"}static fromError(_){if(_ instanceof yt)return _;let b=new yt;return b.message=_.message,b.stack=_.stack,b}static isErrorNoTelemetry(_){return _.name==="CodeExpectedError"}};function Is(g,_){let b=this,E=!1,T;return function(){if(E)return T;if(E=!0,_)try{T=g.apply(b,arguments)}finally{_()}else T=g.apply(b,arguments);return T}}function Hs(g,_,b=0,E=g.length){let T=b,N=E;for(;T<N;){let A=Math.floor((T+N)/2);_(g[A])?T=A+1:N=A}return T-1}var Fs=class vi{constructor(_){this._array=_,this._findLastMonotonousLastIdx=0}findLastMonotonous(_){if(vi.assertInvariants){if(this._prevFindLastPredicate){for(let E of this._array)if(this._prevFindLastPredicate(E)&&!_(E))throw Error("MonotonousArray: current predicate must be weaker than (or equal to) the previous predicate.")}this._prevFindLastPredicate=_}let b=Hs(this._array,_,this._findLastMonotonousLastIdx);return this._findLastMonotonousLastIdx=b+1,b===-1?void 0:this._array[b]}};Fs.assertInvariants=!1;var Vt;(g=>{function _(N){return N<0}g.isLessThan=_;function b(N){return N<=0}g.isLessThanOrEqual=b;function E(N){return N>0}g.isGreaterThan=E;function T(N){return N===0}g.isNeitherLessOrGreaterThan=T,g.greaterThan=1,g.lessThan=-1,g.neitherLessOrGreaterThan=0})(Vt||(Vt={}));function Ws(g,_){return(b,E)=>_(g(b),g(E))}var $s=(g,_)=>g-_,Xt=class Lt{constructor(_){this.iterate=_}forEach(_){this.iterate(b=>(_(b),!0))}toArray(){let _=[];return this.iterate(b=>(_.push(b),!0)),_}filter(_){return new Lt(b=>this.iterate(E=>_(E)?b(E):!0))}map(_){return new Lt(b=>this.iterate(E=>b(_(E))))}some(_){let b=!1;return this.iterate(E=>(b=_(E),!b)),b}findFirst(_){let b;return this.iterate(E=>_(E)?(b=E,!1):!0),b}findLast(_){let b;return this.iterate(E=>(_(E)&&(b=E),!0)),b}findLastMaxBy(_){let b,E=!0;return this.iterate(T=>((E||Vt.isGreaterThan(_(T,b)))&&(E=!1,b=T),!0)),b}};Xt.empty=new Xt(g=>{});function Ns(g,_){let b=Object.create(null);for(let E of g){let T=_(E),N=b[T];N||(N=b[T]=[]),N.push(E)}return b}var Us=class{constructor(){this.map=new Map}add(g,_){let b=this.map.get(g);b||(b=new Set,this.map.set(g,b)),b.add(_)}delete(g,_){let b=this.map.get(g);b&&(b.delete(_),b.size===0&&this.map.delete(g))}forEach(g,_){let b=this.map.get(g);b&&b.forEach(_)}get(g){return this.map.get(g)||new Set}},Jt;(g=>{function _(h){return h&&typeof h=="object"&&typeof h[Symbol.iterator]=="function"}g.is=_;let b=Object.freeze([]);function E(){return b}g.empty=E;function*T(h){yield h}g.single=T;function N(h){return _(h)?h:T(h)}g.wrap=N;function A(h){return h||b}g.from=A;function*t(h){for(let m=h.length-1;m>=0;m--)yield h[m]}g.reverse=t;function a(h){return!h||h[Symbol.iterator]().next().done===!0}g.isEmpty=a;function l(h){return h[Symbol.iterator]().next().value}g.first=l;function u(h,m){let d=0;for(let c of h)if(m(c,d++))return!0;return!1}g.some=u;function n(h,m){for(let d of h)if(m(d))return d}g.find=n;function*f(h,m){for(let d of h)m(d)&&(yield d)}g.filter=f;function*p(h,m){let d=0;for(let c of h)yield m(c,d++)}g.map=p;function*S(h,m){let d=0;for(let c of h)yield*m(c,d++)}g.flatMap=S;function*r(...h){for(let m of h)yield*m}g.concat=r;function e(h,m,d){let c=d;for(let v of h)c=m(c,v);return c}g.reduce=e;function*o(h,m,d=h.length){for(m<0&&(m+=h.length),d<0?d+=h.length:d>h.length&&(d=h.length);m<d;m++)yield h[m]}g.slice=o;function s(h,m=1/0){let d=[];if(m===0)return[d,h];let c=h[Symbol.iterator]();for(let v=0;v<m;v++){let C=c.next();if(C.done)return[d,g.empty()];d.push(C.value)}return[d,{[Symbol.iterator](){return c}}]}g.consume=s;async function i(h){let m=[];for await(let d of h)m.push(d);return Promise.resolve(m)}g.asyncToArray=i})(Jt||(Jt={}));var zs=!1,ge=null,js=class pi{constructor(){this.livingDisposables=new Map}getDisposableData(_){let b=this.livingDisposables.get(_);return b||(b={parent:null,source:null,isSingleton:!1,value:_,idx:pi.idx++},this.livingDisposables.set(_,b)),b}trackDisposable(_){let b=this.getDisposableData(_);b.source||(b.source=Error().stack)}setParent(_,b){let E=this.getDisposableData(_);E.parent=b}markAsDisposed(_){this.livingDisposables.delete(_)}markAsSingleton(_){this.getDisposableData(_).isSingleton=!0}getRootParent(_,b){let E=b.get(_);if(E)return E;let T=_.parent?this.getRootParent(this.getDisposableData(_.parent),b):_;return b.set(_,T),T}getTrackedDisposables(){let _=new Map;return[...this.livingDisposables.entries()].filter(([,b])=>b.source!==null&&!this.getRootParent(b,_).isSingleton).flatMap(([b])=>b)}computeLeakingDisposables(_=10,b){let E;if(b)E=b;else{let a=new Map,l=[...this.livingDisposables.values()].filter(n=>n.source!==null&&!this.getRootParent(n,a).isSingleton);if(l.length===0)return;let u=new Set(l.map(n=>n.value));if(E=l.filter(n=>!(n.parent&&u.has(n.parent))),E.length===0)throw Error("There are cyclic diposable chains!")}if(!E)return;function T(a){function l(n,f){for(;n.length>0&&f.some(p=>typeof p=="string"?p===n[0]:n[0].match(p));)n.shift()}let u=a.source.split(`
`).map(n=>n.trim().replace("at ","")).filter(n=>n!=="");return l(u,["Error",/^trackDisposable \(.*\)$/,/^DisposableTracker.trackDisposable \(.*\)$/]),u.reverse()}let N=new Us;for(let a of E){let l=T(a);for(let u=0;u<=l.length;u++)N.add(l.slice(0,u).join(`
`),a)}E.sort(Ws(a=>a.idx,$s));let A="",t=0;for(let a of E.slice(0,_)){t++;let l=T(a),u=[];for(let n=0;n<l.length;n++){let f=l[n];f=`(shared with ${N.get(l.slice(0,n+1).join(`
`)).size}/${E.length} leaks) at ${f}`;let p=Ns([...N.get(l.slice(0,n).join(`
`))].map(S=>T(S)[n]),S=>S);delete p[l[n]];for(let[S,r]of Object.entries(p))u.unshift(`    - stacktraces of ${r.length} other leaks continue with ${S}`);u.unshift(f)}A+=`


==================== Leaking disposable ${t}/${E.length}: ${a.value.constructor.name} ====================
${u.join(`
`)}
============================================================

`}return E.length>_&&(A+=`


... and ${E.length-_} more leaking disposables

`),{leaks:E,details:A}}};js.idx=0;function qs(g){ge=g}if(zs){let g="__is_disposable_tracked__";qs(new class{trackDisposable(_){let b=Error("Potentially leaked disposable").stack;setTimeout(()=>{_[g]||console.log(b)},3e3)}setParent(_,b){if(_&&_!==Te.None)try{_[g]=!0}catch{}}markAsDisposed(_){if(_&&_!==Te.None)try{_[g]=!0}catch{}}markAsSingleton(_){}})}function dt(g){return ge==null||ge.trackDisposable(g),g}function ut(g){ge==null||ge.markAsDisposed(g)}function _t(g,_){ge==null||ge.setParent(g,_)}function Gs(g,_){if(ge)for(let b of g)ge.setParent(b,_)}function Yt(g){if(Jt.is(g)){let _=[];for(let b of g)if(b)try{b.dispose()}catch(E){_.push(E)}if(_.length===1)throw _[0];if(_.length>1)throw AggregateError(_,"Encountered errors while disposing of store");return Array.isArray(g)?[]:g}else if(g)return g.dispose(),g}function Ks(...g){let _=Qt(()=>Yt(g));return Gs(g,_),_}function Qt(g){let _=dt({dispose:Is(()=>{ut(_),g()})});return _}var Zt=class mi{constructor(){this._toDispose=new Set,this._isDisposed=!1,dt(this)}dispose(){this._isDisposed||(ut(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{Yt(this._toDispose)}finally{this._toDispose.clear()}}add(_){if(!_)return _;if(_===this)throw Error("Cannot register a disposable on itself!");return _t(_,this),this._isDisposed?mi.DISABLE_DISPOSED_WARNING||console.warn(Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(_),_}delete(_){if(_){if(_===this)throw Error("Cannot dispose a disposable on itself!");this._toDispose.delete(_),_.dispose()}}deleteAndLeak(_){_&&this._toDispose.has(_)&&(this._toDispose.delete(_),_t(_,null))}};Zt.DISABLE_DISPOSED_WARNING=!1;var ft=Zt,Te=class{constructor(){this._store=new ft,dt(this),_t(this._store,this)}dispose(){ut(this),this._store.dispose()}_register(g){if(g===this)throw Error("Cannot register a disposable on itself!");return this._store.add(g)}};Te.None=Object.freeze({dispose(){}});var ei=class xt{constructor(_){this.element=_,this.next=xt.Undefined,this.prev=xt.Undefined}};ei.Undefined=new ei(void 0);var Vs=globalThis.performance&&typeof globalThis.performance.now=="function",Xs=class Si{static create(_){return new Si(_)}constructor(_){this._now=Vs&&_===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime===-1?this._now()-this._startTime:this._stopTime-this._startTime}},Js=!1,ti=!1,Ys=!1,Qs;(g=>{g.None=()=>Te.None;function _(y){if(Ys){let{onDidAddListener:L}=y,M=vt.create(),B=0;y.onDidAddListener=()=>{++B===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),M.print()),L==null||L()}}}function b(y,L){return f(y,()=>{},0,void 0,!0,void 0,L)}g.defer=b;function E(y){return(L,M=null,B)=>{let P=!1,H;return H=y(w=>{if(!P)return H?H.dispose():P=!0,L.call(M,w)},null,B),P&&H.dispose(),H}}g.once=E;function T(y,L,M){return u((B,P=null,H)=>y(w=>B.call(P,L(w)),null,H),M)}g.map=T;function N(y,L,M){return u((B,P=null,H)=>y(w=>{L(w),B.call(P,w)},null,H),M)}g.forEach=N;function A(y,L,M){return u((B,P=null,H)=>y(w=>L(w)&&B.call(P,w),null,H),M)}g.filter=A;function t(y){return y}g.signal=t;function a(...y){return(L,M=null,B)=>n(Ks(...y.map(P=>P(H=>L.call(M,H)))),B)}g.any=a;function l(y,L,M,B){let P=M;return T(y,H=>(P=L(P,H),P),B)}g.reduce=l;function u(y,L){let M,B={onWillAddFirstListener(){M=y(P.fire,P)},onDidRemoveLastListener(){M==null||M.dispose()}};L||_(B);let P=new De(B);return L==null||L.add(P),P.event}function n(y,L){return L instanceof Array?L.push(y):L&&L.add(y),y}function f(y,L,M=100,B=!1,P=!1,H,w){let R,O,F,z=0,j,X={leakWarningThreshold:H,onWillAddFirstListener(){R=y(W=>{z++,O=L(O,W),B&&!F&&(K.fire(O),O=void 0),j=()=>{let $=O;O=void 0,F=void 0,(!B||z>1)&&K.fire($),z=0},typeof M=="number"?(clearTimeout(F),F=setTimeout(j,M)):F===void 0&&(F=0,queueMicrotask(j))})},onWillRemoveListener(){P&&z>0&&(j==null||j())},onDidRemoveLastListener(){j=void 0,R.dispose()}};w||_(X);let K=new De(X);return w==null||w.add(K),K.event}g.debounce=f;function p(y,L=0,M){return g.debounce(y,(B,P)=>B?(B.push(P),B):[P],L,void 0,!0,void 0,M)}g.accumulate=p;function S(y,L=(B,P)=>B===P,M){let B=!0,P;return A(y,H=>{let w=B||!L(H,P);return B=!1,P=H,w},M)}g.latch=S;function r(y,L,M){return[g.filter(y,L,M),g.filter(y,B=>!L(B),M)]}g.split=r;function e(y,L=!1,M=[],B){let P=M.slice(),H=y(O=>{P?P.push(O):R.fire(O)});B&&B.add(H);let w=()=>{P==null||P.forEach(O=>R.fire(O)),P=null},R=new De({onWillAddFirstListener(){H||(H=y(O=>R.fire(O)),B&&B.add(H))},onDidAddFirstListener(){P&&(L?setTimeout(w):w())},onDidRemoveLastListener(){H&&H.dispose(),H=null}});return B&&B.add(R),R.event}g.buffer=e;function o(y,L){return(M,B,P)=>{let H=L(new i);return y(function(w){let R=H.evaluate(w);R!==s&&M.call(B,R)},void 0,P)}}g.chain=o;let s=Symbol("HaltChainable");class i{constructor(){this.steps=[]}map(L){return this.steps.push(L),this}forEach(L){return this.steps.push(M=>(L(M),M)),this}filter(L){return this.steps.push(M=>L(M)?M:s),this}reduce(L,M){let B=M;return this.steps.push(P=>(B=L(B,P),B)),this}latch(L=(M,B)=>M===B){let M=!0,B;return this.steps.push(P=>{let H=M||!L(P,B);return M=!1,B=P,H?P:s}),this}evaluate(L){for(let M of this.steps)if(L=M(L),L===s)break;return L}}function h(y,L,M=B=>B){let B=(...H)=>P.fire(M(...H)),P=new De({onWillAddFirstListener:()=>y.on(L,B),onDidRemoveLastListener:()=>y.removeListener(L,B)});return P.event}g.fromNodeEventEmitter=h;function m(y,L,M=B=>B){let B=(...H)=>P.fire(M(...H)),P=new De({onWillAddFirstListener:()=>y.addEventListener(L,B),onDidRemoveLastListener:()=>y.removeEventListener(L,B)});return P.event}g.fromDOMEventEmitter=m;function d(y){return new Promise(L=>E(y)(L))}g.toPromise=d;function c(y){let L=new De;return y.then(M=>{L.fire(M)},()=>{L.fire(void 0)}).finally(()=>{L.dispose()}),L.event}g.fromPromise=c;function v(y,L){return y(M=>L.fire(M))}g.forward=v;function C(y,L,M){return L(M),y(B=>L(B))}g.runAndSubscribe=C;class k{constructor(L,M){this._observable=L,this._counter=0,this._hasChanged=!1;let B={onWillAddFirstListener:()=>{L.addObserver(this)},onDidRemoveLastListener:()=>{L.removeObserver(this)}};M||_(B),this.emitter=new De(B),M&&M.add(this.emitter)}beginUpdate(L){this._counter++}handlePossibleChange(L){}handleChange(L,M){this._hasChanged=!0}endUpdate(L){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function D(y,L){return new k(y,L).emitter.event}g.fromObservable=D;function x(y){return(L,M,B)=>{let P=0,H=!1,w={beginUpdate(){P++},endUpdate(){P--,P===0&&(y.reportChanges(),H&&(H=!1,L.call(M)))},handlePossibleChange(){},handleChange(){H=!0}};y.addObserver(w),y.reportChanges();let R={dispose(){y.removeObserver(w)}};return B instanceof ft?B.add(R):Array.isArray(B)&&B.push(R),R}}g.fromObservableLight=x})(Qs||(Qs={}));var gt=class Et{constructor(_){this.listenerCount=0,this.invocationCount=0,this.elapsedOverall=0,this.durations=[],this.name=`${_}_${Et._idPool++}`,Et.all.add(this)}start(_){this._stopWatch=new Xs,this.listenerCount=_}stop(){if(this._stopWatch){let _=this._stopWatch.elapsed();this.durations.push(_),this.elapsedOverall+=_,this.invocationCount+=1,this._stopWatch=void 0}}};gt.all=new Set,gt._idPool=0;var Zs=gt,ii=-1,si=class Ci{constructor(_,b,E=(Ci._idPool++).toString(16).padStart(3,"0")){this._errorHandler=_,this.threshold=b,this.name=E,this._warnCountdown=0}dispose(){var _;(_=this._stacks)==null||_.clear()}check(_,b){let E=this.threshold;if(E<=0||b<E)return;this._stacks||(this._stacks=new Map);let T=this._stacks.get(_.value)||0;if(this._stacks.set(_.value,T+1),--this._warnCountdown,this._warnCountdown<=0){this._warnCountdown=E*.5;let[N,A]=this.getMostFrequentStack(),t=`[${this.name}] potential listener LEAK detected, having ${b} listeners already. MOST frequent listener (${A}):`;console.warn(t),console.warn(N);let a=new tr(t,N);this._errorHandler(a)}return()=>{let N=this._stacks.get(_.value)||0;this._stacks.set(_.value,N-1)}}getMostFrequentStack(){if(!this._stacks)return;let _,b=0;for(let[E,T]of this._stacks)(!_||b<T)&&(_=[E,T],b=T);return _}};si._idPool=1;var er=si,vt=class bi{constructor(_){this.value=_}static create(){return new bi(Error().stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},tr=class extends Error{constructor(g,_){super(g),this.name="ListenerLeakError",this.stack=_}},ir=class extends Error{constructor(g,_){super(g),this.name="ListenerRefusalError",this.stack=_}},sr=0,Ke=class{constructor(g){this.value=g,this.id=sr++}},rr=2,nr=(g,_)=>{if(g instanceof Ke)_(g);else for(let b=0;b<g.length;b++){let E=g[b];E&&_(E)}},Be;if(Js){let g=[];setInterval(()=>{g.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(g.join(`
`)),g.length=0)},3e3),Be=new FinalizationRegistry(_=>{typeof _=="string"&&g.push(_)})}var De=class{constructor(g){var _,b,E,T;this._size=0,this._options=g,this._leakageMon=ii>0||(_=this._options)!=null&&_.leakWarningThreshold?new er((g==null?void 0:g.onListenerError)??lt,((b=this._options)==null?void 0:b.leakWarningThreshold)??ii):void 0,this._perfMon=(E=this._options)!=null&&E._profName?new Zs(this._options._profName):void 0,this._deliveryQueue=(T=this._options)==null?void 0:T.deliveryQueue}dispose(){var g,_,b,E;if(!this._disposed){if(this._disposed=!0,((g=this._deliveryQueue)==null?void 0:g.current)===this&&this._deliveryQueue.reset(),this._listeners){if(ti){let T=this._listeners;queueMicrotask(()=>{nr(T,N=>{var A;return(A=N.stack)==null?void 0:A.print()})})}this._listeners=void 0,this._size=0}(b=(_=this._options)==null?void 0:_.onDidRemoveLastListener)==null||b.call(_),(E=this._leakageMon)==null||E.dispose()}}get event(){return this._event??(this._event=(g,_,b)=>{var A,t,a,l,u;if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let n=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(n);let f=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],p=new ir(`${n}. HINT: Stack shows most frequent listener (${f[1]}-times)`,f[0]);return(((A=this._options)==null?void 0:A.onListenerError)||lt)(p),Te.None}if(this._disposed)return Te.None;_&&(g=g.bind(_));let E=new Ke(g),T;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(E.stack=vt.create(),T=this._leakageMon.check(E.stack,this._size+1)),ti&&(E.stack=vt.create()),this._listeners?this._listeners instanceof Ke?(this._deliveryQueue??(this._deliveryQueue=new or),this._listeners=[this._listeners,E]):this._listeners.push(E):((a=(t=this._options)==null?void 0:t.onWillAddFirstListener)==null||a.call(t,this),this._listeners=E,(u=(l=this._options)==null?void 0:l.onDidAddFirstListener)==null||u.call(l,this)),this._size++;let N=Qt(()=>{Be==null||Be.unregister(N),T==null||T(),this._removeListener(E)});if(b instanceof ft?b.add(N):Array.isArray(b)&&b.push(N),Be){let n=Error().stack.split(`
`).slice(2,3).join(`
`).trim(),f=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(n);Be.register(N,(f==null?void 0:f[2])??n,N)}return N}),this._event}_removeListener(g){var T,N,A,t;if((N=(T=this._options)==null?void 0:T.onWillRemoveListener)==null||N.call(T,this),!this._listeners)return;if(this._size===1){this._listeners=void 0,(t=(A=this._options)==null?void 0:A.onDidRemoveLastListener)==null||t.call(A,this),this._size=0;return}let _=this._listeners,b=_.indexOf(g);if(b===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),Error("Attempted to dispose unknown listener");this._size--,_[b]=void 0;let E=this._deliveryQueue.current===this;if(this._size*rr<=_.length){let a=0;for(let l=0;l<_.length;l++)_[l]?_[a++]=_[l]:E&&(this._deliveryQueue.end--,a<this._deliveryQueue.i&&this._deliveryQueue.i--);_.length=a}}_deliver(g,_){var E;if(!g)return;let b=((E=this._options)==null?void 0:E.onListenerError)||lt;if(!b){g.value(_);return}try{g.value(_)}catch(T){b(T)}}_deliverQueue(g){let _=g.current._listeners;for(;g.i<g.end;)this._deliver(_[g.i++],g.value);g.reset()}fire(g){var _,b,E,T;if((_=this._deliveryQueue)!=null&&_.current&&(this._deliverQueue(this._deliveryQueue),(b=this._perfMon)==null||b.stop()),(E=this._perfMon)==null||E.start(this._size),this._listeners)if(this._listeners instanceof Ke)this._deliver(this._listeners,g);else{let N=this._deliveryQueue;N.enqueue(this,g,this._listeners.length),this._deliverQueue(N)}(T=this._perfMon)==null||T.stop()}hasListeners(){return this._size>0}},or=class{constructor(){this.i=-1,this.end=0}enqueue(g,_,b){this.i=0,this.end=b,this.current=g,this.value=_}reset(){this.i=this.end,this.current=void 0,this.value=void 0}},Ve=class Je{constructor(){this._providers=Object.create(null),this._active="",this._onChange=new De,this.onChange=this._onChange.event;let _=new Ts;this.register(_),this._active=_.version,this._activeProvider=_}static extractShouldJoin(_){return(_&1)!=0}static extractWidth(_){return _>>1&3}static extractCharKind(_){return _>>3}static createPropertyValue(_,b,E=!1){return(_&16777215)<<3|(b&3)<<1|(E?1:0)}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(_){if(!this._providers[_])throw Error(`unknown Unicode version "${_}"`);this._active=_,this._activeProvider=this._providers[_],this._onChange.fire(_)}register(_){this._providers[_.version]=_}wcwidth(_){return this._activeProvider.wcwidth(_)}getStringCellWidth(_){let b=0,E=0,T=_.length;for(let N=0;N<T;++N){let A=_.charCodeAt(N);if(55296<=A&&A<=56319){if(++N>=T)return b+this.wcwidth(A);let l=_.charCodeAt(N);56320<=l&&l<=57343?A=(A-55296)*1024+l-56320+65536:b+=this.wcwidth(l)}let t=this.charProperties(A,E),a=Je.extractWidth(t);Je.extractShouldJoin(t)&&(a-=Je.extractWidth(E)),b+=a,E=t}return b}charProperties(_,b){return this._activeProvider.charProperties(_,b)}},pt=[[768,879],[1155,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1541],[1552,1562],[1564,1564],[1611,1631],[1648,1648],[1750,1757],[1759,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2045,2045],[2070,2073],[2075,2083],[2085,2087],[2089,2093],[2137,2139],[2259,2306],[2362,2362],[2364,2364],[2369,2376],[2381,2381],[2385,2391],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2558,2558],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2641,2641],[2672,2673],[2677,2677],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2810,2815],[2817,2817],[2876,2876],[2879,2879],[2881,2884],[2893,2893],[2902,2902],[2914,2915],[2946,2946],[3008,3008],[3021,3021],[3072,3072],[3076,3076],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3170,3171],[3201,3201],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3328,3329],[3387,3388],[3393,3396],[3405,3405],[3426,3427],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3981,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4151],[4153,4154],[4157,4158],[4184,4185],[4190,4192],[4209,4212],[4226,4226],[4229,4230],[4237,4237],[4253,4253],[4448,4607],[4957,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6158],[6277,6278],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6683,6683],[6742,6742],[6744,6750],[6752,6752],[6754,6754],[6757,6764],[6771,6780],[6783,6783],[6832,6846],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7040,7041],[7074,7077],[7080,7081],[7083,7085],[7142,7142],[7144,7145],[7149,7149],[7151,7153],[7212,7219],[7222,7223],[7376,7378],[7380,7392],[7394,7400],[7405,7405],[7412,7412],[7416,7417],[7616,7673],[7675,7679],[8203,8207],[8234,8238],[8288,8292],[8294,8303],[8400,8432],[11503,11505],[11647,11647],[11744,11775],[12330,12333],[12441,12442],[42607,42610],[42612,42621],[42654,42655],[42736,42737],[43010,43010],[43014,43014],[43019,43019],[43045,43046],[43204,43205],[43232,43249],[43263,43263],[43302,43309],[43335,43345],[43392,43394],[43443,43443],[43446,43449],[43452,43453],[43493,43493],[43561,43566],[43569,43570],[43573,43574],[43587,43587],[43596,43596],[43644,43644],[43696,43696],[43698,43700],[43703,43704],[43710,43711],[43713,43713],[43756,43757],[43766,43766],[44005,44005],[44008,44008],[44013,44013],[64286,64286],[65024,65039],[65056,65071],[65279,65279],[65529,65531]],ar=[[66045,66045],[66272,66272],[66422,66426],[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[68325,68326],[68900,68903],[69446,69456],[69633,69633],[69688,69702],[69759,69761],[69811,69814],[69817,69818],[69821,69821],[69837,69837],[69888,69890],[69927,69931],[69933,69940],[70003,70003],[70016,70017],[70070,70078],[70089,70092],[70191,70193],[70196,70196],[70198,70199],[70206,70206],[70367,70367],[70371,70378],[70400,70401],[70459,70460],[70464,70464],[70502,70508],[70512,70516],[70712,70719],[70722,70724],[70726,70726],[70750,70750],[70835,70840],[70842,70842],[70847,70848],[70850,70851],[71090,71093],[71100,71101],[71103,71104],[71132,71133],[71219,71226],[71229,71229],[71231,71232],[71339,71339],[71341,71341],[71344,71349],[71351,71351],[71453,71455],[71458,71461],[71463,71467],[71727,71735],[71737,71738],[72148,72151],[72154,72155],[72160,72160],[72193,72202],[72243,72248],[72251,72254],[72263,72263],[72273,72278],[72281,72283],[72330,72342],[72344,72345],[72752,72758],[72760,72765],[72767,72767],[72850,72871],[72874,72880],[72882,72883],[72885,72886],[73009,73014],[73018,73018],[73020,73021],[73023,73029],[73031,73031],[73104,73105],[73109,73109],[73111,73111],[73459,73460],[78896,78904],[92912,92916],[92976,92982],[94031,94031],[94095,94098],[113821,113822],[113824,113827],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[121344,121398],[121403,121452],[121461,121461],[121476,121476],[121499,121503],[121505,121519],[122880,122886],[122888,122904],[122907,122913],[122915,122916],[122918,122922],[123184,123190],[123628,123631],[125136,125142],[125252,125258],[917505,917505],[917536,917631],[917760,917999]],mt=[[4352,4447],[8986,8987],[9001,9002],[9193,9196],[9200,9200],[9203,9203],[9725,9726],[9748,9749],[9800,9811],[9855,9855],[9875,9875],[9889,9889],[9898,9899],[9917,9918],[9924,9925],[9934,9934],[9940,9940],[9962,9962],[9970,9971],[9973,9973],[9978,9978],[9981,9981],[9989,9989],[9994,9995],[10024,10024],[10060,10060],[10062,10062],[10067,10069],[10071,10071],[10133,10135],[10160,10160],[10175,10175],[11035,11036],[11088,11088],[11093,11093],[11904,11929],[11931,12019],[12032,12245],[12272,12283],[12288,12329],[12334,12350],[12353,12438],[12443,12543],[12549,12591],[12593,12686],[12688,12730],[12736,12771],[12784,12830],[12832,12871],[12880,19903],[19968,42124],[42128,42182],[43360,43388],[44032,55203],[63744,64255],[65040,65049],[65072,65106],[65108,65126],[65128,65131],[65281,65376],[65504,65510]],hr=[[94176,94179],[94208,100343],[100352,101106],[110592,110878],[110928,110930],[110948,110951],[110960,111355],[126980,126980],[127183,127183],[127374,127374],[127377,127386],[127488,127490],[127504,127547],[127552,127560],[127568,127569],[127584,127589],[127744,127776],[127789,127797],[127799,127868],[127870,127891],[127904,127946],[127951,127955],[127968,127984],[127988,127988],[127992,128062],[128064,128064],[128066,128252],[128255,128317],[128331,128334],[128336,128359],[128378,128378],[128405,128406],[128420,128420],[128507,128591],[128640,128709],[128716,128716],[128720,128722],[128725,128725],[128747,128748],[128756,128762],[128992,129003],[129293,129393],[129395,129398],[129402,129442],[129445,129450],[129454,129482],[129485,129535],[129648,129651],[129656,129658],[129664,129666],[129680,129685],[131072,196605],[196608,262141]],Ee;function ri(g,_){let b=0,E=_.length-1,T;if(g<_[0][0]||g>_[E][1])return!1;for(;E>=b;)if(T=b+E>>1,g>_[T][1])b=T+1;else if(g<_[T][0])E=T-1;else return!0;return!1}var lr=class{constructor(){if(this.version="11",!Ee){Ee=new Uint8Array(65536),Ee.fill(1),Ee[0]=0,Ee.fill(0,1,32),Ee.fill(0,127,160);for(let g=0;g<pt.length;++g)Ee.fill(0,pt[g][0],pt[g][1]+1);for(let g=0;g<mt.length;++g)Ee.fill(2,mt[g][0],mt[g][1]+1)}}wcwidth(g){return g<32?0:g<127?1:g<65536?Ee[g]:ri(g,ar)?0:ri(g,hr)?2:1}charProperties(g,_){let b=this.wcwidth(g),E=b===0&&_!==0;if(E){let T=Ve.extractWidth(_);T===0?E=!1:T>b&&(b=T)}return Ve.createPropertyValue(0,b,E)}},cr=class{activate(g){g.unicode.register(new lr)}dispose(){}},dr=class{constructor(g,_,b,E={}){this._terminal=g,this._regex=_,this._handler=b,this._options=E}provideLinks(g,_){let b=_r.computeLink(g,this._regex,this._terminal,this._handler);_(this._addCallbacks(b))}_addCallbacks(g){return g.map(_=>(_.leave=this._options.leave,_.hover=(b,E)=>{if(this._options.hover){let{range:T}=_;this._options.hover(b,E,T)}},_))}};function ur(g){try{let _=new URL(g),b=_.password&&_.username?`${_.protocol}//${_.username}:${_.password}@${_.host}`:_.username?`${_.protocol}//${_.username}@${_.host}`:`${_.protocol}//${_.host}`;return g.toLocaleLowerCase().startsWith(b.toLocaleLowerCase())}catch{return!1}}var _r=class Ye{static computeLink(_,b,E,T){let N=new RegExp(b.source,(b.flags||"")+"g"),[A,t]=Ye._getWindowedLineStrings(_-1,E),a=A.join(""),l,u=[];for(;l=N.exec(a);){let n=l[0];if(!ur(n))continue;let[f,p]=Ye._mapStrIdx(E,t,0,l.index),[S,r]=Ye._mapStrIdx(E,f,p,n.length);if(f===-1||p===-1||S===-1||r===-1)continue;let e={start:{x:p+1,y:f+1},end:{x:r,y:S+1}};u.push({range:e,text:n,activate:T})}return u}static _getWindowedLineStrings(_,b){let E,T=_,N=_,A=0,t="",a=[];if(E=b.buffer.active.getLine(_)){let l=E.translateToString(!0);if(E.isWrapped&&l[0]!==" "){for(A=0;(E=b.buffer.active.getLine(--T))&&A<2048&&(t=E.translateToString(!0),A+=t.length,a.push(t),!(!E.isWrapped||t.indexOf(" ")!==-1)););a.reverse()}for(a.push(l),A=0;(E=b.buffer.active.getLine(++N))&&E.isWrapped&&A<2048&&(t=E.translateToString(!0),A+=t.length,a.push(t),t.indexOf(" ")===-1););}return[a,T]}static _mapStrIdx(_,b,E,T){let N=_.buffer.active,A=N.getNullCell(),t=E;for(;T;){let a=N.getLine(b);if(!a)return[-1,-1];for(let l=t;l<a.length;++l){a.getCell(l,A);let u=A.getChars();if(A.getWidth()&&(T-=u.length||1,l===a.length-1&&u==="")){let n=N.getLine(b+1);n&&n.isWrapped&&(n.getCell(0,A),A.getWidth()===2&&(T+=1))}if(T<0)return[b,l]}b++,t=0}return[b,t]}},fr=/(https?|HTTPS?):[/]{2}[^\s"'!*(){}|\\\^<>`]*[^\s"':,.!?{}|\\\^~\[\]`()<>]/;function gr(g,_){let b=window.open();if(b){try{b.opener=null}catch{}b.location.href=_}else console.warn("Opening link blocked as opener could not be cleared")}var vr=class{constructor(g=gr,_={}){this._handler=g,this._options=_}activate(g){this._terminal=g;let _=this._options,b=_.urlRegex||fr;this._linkProvider=this._terminal.registerLinkProvider(new dr(this._terminal,b,this._handler,_))}dispose(){var g;(g=this._linkProvider)==null||g.dispose()}},pr=At(((g,_)=>{(function(b,E){if(typeof g=="object"&&typeof _=="object")_.exports=E();else if(typeof define=="function"&&define.amd)define([],E);else{var T=E();for(var N in T)(typeof g=="object"?g:b)[N]=T[N]}})(globalThis,(()=>(()=>{var b={4567:function(A,t,a){var l=this&&this.__decorate||function(s,i,h,m){var d,c=arguments.length,v=c<3?i:m===null?m=Object.getOwnPropertyDescriptor(i,h):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,i,h,m);else for(var C=s.length-1;C>=0;C--)(d=s[C])&&(v=(c<3?d(v):c>3?d(i,h,v):d(i,h))||v);return c>3&&v&&Object.defineProperty(i,h,v),v},u=this&&this.__param||function(s,i){return function(h,m){i(h,m,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.AccessibilityManager=void 0;let n=a(9042),f=a(9924),p=a(844),S=a(4725),r=a(2585),e=a(3656),o=t.AccessibilityManager=class extends p.Disposable{constructor(s,i,h,m){super(),this._terminal=s,this._coreBrowserService=h,this._renderService=m,this._rowColumns=new WeakMap,this._liveRegionLineCount=0,this._charsToConsume=[],this._charsToAnnounce="",this._accessibilityContainer=this._coreBrowserService.mainDocument.createElement("div"),this._accessibilityContainer.classList.add("xterm-accessibility"),this._rowContainer=this._coreBrowserService.mainDocument.createElement("div"),this._rowContainer.setAttribute("role","list"),this._rowContainer.classList.add("xterm-accessibility-tree"),this._rowElements=[];for(let d=0;d<this._terminal.rows;d++)this._rowElements[d]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[d]);if(this._topBoundaryFocusListener=d=>this._handleBoundaryFocus(d,0),this._bottomBoundaryFocusListener=d=>this._handleBoundaryFocus(d,1),this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions(),this._accessibilityContainer.appendChild(this._rowContainer),this._liveRegion=this._coreBrowserService.mainDocument.createElement("div"),this._liveRegion.classList.add("live-region"),this._liveRegion.setAttribute("aria-live","assertive"),this._accessibilityContainer.appendChild(this._liveRegion),this._liveRegionDebouncer=this.register(new f.TimeBasedDebouncer(this._renderRows.bind(this))),!this._terminal.element)throw Error("Cannot enable accessibility before Terminal.open");this._terminal.element.insertAdjacentElement("afterbegin",this._accessibilityContainer),this.register(this._terminal.onResize((d=>this._handleResize(d.rows)))),this.register(this._terminal.onRender((d=>this._refreshRows(d.start,d.end)))),this.register(this._terminal.onScroll((()=>this._refreshRows()))),this.register(this._terminal.onA11yChar((d=>this._handleChar(d)))),this.register(this._terminal.onLineFeed((()=>this._handleChar(`
`)))),this.register(this._terminal.onA11yTab((d=>this._handleTab(d)))),this.register(this._terminal.onKey((d=>this._handleKey(d.key)))),this.register(this._terminal.onBlur((()=>this._clearLiveRegion()))),this.register(this._renderService.onDimensionsChange((()=>this._refreshRowsDimensions()))),this.register((0,e.addDisposableDomListener)(document,"selectionchange",(()=>this._handleSelectionChange()))),this.register(this._coreBrowserService.onDprChange((()=>this._refreshRowsDimensions()))),this._refreshRows(),this.register((0,p.toDisposable)((()=>{this._accessibilityContainer.remove(),this._rowElements.length=0})))}_handleTab(s){for(let i=0;i<s;i++)this._handleChar(" ")}_handleChar(s){this._liveRegionLineCount<21&&(this._charsToConsume.length>0?this._charsToConsume.shift()!==s&&(this._charsToAnnounce+=s):this._charsToAnnounce+=s,s===`
`&&(this._liveRegionLineCount++,this._liveRegionLineCount===21&&(this._liveRegion.textContent+=n.tooMuchOutput)))}_clearLiveRegion(){this._liveRegion.textContent="",this._liveRegionLineCount=0}_handleKey(s){this._clearLiveRegion(),new RegExp("\\p{Control}","u").test(s)||this._charsToConsume.push(s)}_refreshRows(s,i){this._liveRegionDebouncer.refresh(s,i,this._terminal.rows)}_renderRows(s,i){let h=this._terminal.buffer,m=h.lines.length.toString();for(let d=s;d<=i;d++){let c=h.lines.get(h.ydisp+d),v=[],C=(c==null?void 0:c.translateToString(!0,void 0,void 0,v))||"",k=(h.ydisp+d+1).toString(),D=this._rowElements[d];D&&(C.length===0?(D.innerText="\xA0",this._rowColumns.set(D,[0,1])):(D.textContent=C,this._rowColumns.set(D,v)),D.setAttribute("aria-posinset",k),D.setAttribute("aria-setsize",m))}this._announceCharacters()}_announceCharacters(){this._charsToAnnounce.length!==0&&(this._liveRegion.textContent+=this._charsToAnnounce,this._charsToAnnounce="")}_handleBoundaryFocus(s,i){let h=s.target,m=this._rowElements[i===0?1:this._rowElements.length-2];if(h.getAttribute("aria-posinset")===(i===0?"1":`${this._terminal.buffer.lines.length}`)||s.relatedTarget!==m)return;let d,c;if(i===0?(d=h,c=this._rowElements.pop(),this._rowContainer.removeChild(c)):(d=this._rowElements.shift(),c=h,this._rowContainer.removeChild(d)),d.removeEventListener("focus",this._topBoundaryFocusListener),c.removeEventListener("focus",this._bottomBoundaryFocusListener),i===0){let v=this._createAccessibilityTreeNode();this._rowElements.unshift(v),this._rowContainer.insertAdjacentElement("afterbegin",v)}else{let v=this._createAccessibilityTreeNode();this._rowElements.push(v),this._rowContainer.appendChild(v)}this._rowElements[0].addEventListener("focus",this._topBoundaryFocusListener),this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._terminal.scrollLines(i===0?-1:1),this._rowElements[i===0?1:this._rowElements.length-2].focus(),s.preventDefault(),s.stopImmediatePropagation()}_handleSelectionChange(){var C;if(this._rowElements.length===0)return;let s=document.getSelection();if(!s)return;if(s.isCollapsed)return void(this._rowContainer.contains(s.anchorNode)&&this._terminal.clearSelection());if(!s.anchorNode||!s.focusNode)return void console.error("anchorNode and/or focusNode are null");let i={node:s.anchorNode,offset:s.anchorOffset},h={node:s.focusNode,offset:s.focusOffset};if((i.node.compareDocumentPosition(h.node)&Node.DOCUMENT_POSITION_PRECEDING||i.node===h.node&&i.offset>h.offset)&&([i,h]=[h,i]),i.node.compareDocumentPosition(this._rowElements[0])&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_FOLLOWING)&&(i={node:this._rowElements[0].childNodes[0],offset:0}),!this._rowContainer.contains(i.node))return;let m=this._rowElements.slice(-1)[0];if(h.node.compareDocumentPosition(m)&(Node.DOCUMENT_POSITION_CONTAINED_BY|Node.DOCUMENT_POSITION_PRECEDING)&&(h={node:m,offset:((C=m.textContent)==null?void 0:C.length)??0}),!this._rowContainer.contains(h.node))return;let d=({node:k,offset:D})=>{let x=k instanceof Text?k.parentNode:k,y=parseInt(x==null?void 0:x.getAttribute("aria-posinset"),10)-1;if(isNaN(y))return console.warn("row is invalid. Race condition?"),null;let L=this._rowColumns.get(x);if(!L)return console.warn("columns is null. Race condition?"),null;let M=D<L.length?L[D]:L.slice(-1)[0]+1;return M>=this._terminal.cols&&(++y,M=0),{row:y,column:M}},c=d(i),v=d(h);if(c&&v){if(c.row>v.row||c.row===v.row&&c.column>=v.column)throw Error("invalid range");this._terminal.select(c.column,c.row,(v.row-c.row)*this._terminal.cols-c.column+v.column)}}_handleResize(s){this._rowElements[this._rowElements.length-1].removeEventListener("focus",this._bottomBoundaryFocusListener);for(let i=this._rowContainer.children.length;i<this._terminal.rows;i++)this._rowElements[i]=this._createAccessibilityTreeNode(),this._rowContainer.appendChild(this._rowElements[i]);for(;this._rowElements.length>s;)this._rowContainer.removeChild(this._rowElements.pop());this._rowElements[this._rowElements.length-1].addEventListener("focus",this._bottomBoundaryFocusListener),this._refreshRowsDimensions()}_createAccessibilityTreeNode(){let s=this._coreBrowserService.mainDocument.createElement("div");return s.setAttribute("role","listitem"),s.tabIndex=-1,this._refreshRowDimensions(s),s}_refreshRowsDimensions(){if(this._renderService.dimensions.css.cell.height){this._accessibilityContainer.style.width=`${this._renderService.dimensions.css.canvas.width}px`,this._rowElements.length!==this._terminal.rows&&this._handleResize(this._terminal.rows);for(let s=0;s<this._terminal.rows;s++)this._refreshRowDimensions(this._rowElements[s])}}_refreshRowDimensions(s){s.style.height=`${this._renderService.dimensions.css.cell.height}px`}};t.AccessibilityManager=o=l([u(1,r.IInstantiationService),u(2,S.ICoreBrowserService),u(3,S.IRenderService)],o)},3614:(A,t)=>{function a(f){return f.replace(/\r?\n/g,"\r")}function l(f,p){return p?"\x1B[200~"+f+"\x1B[201~":f}function u(f,p,S,r){f=l(f=a(f),S.decPrivateModes.bracketedPasteMode&&r.rawOptions.ignoreBracketedPasteMode!==!0),S.triggerDataEvent(f,!0),p.value=""}function n(f,p,S){let r=S.getBoundingClientRect(),e=f.clientX-r.left-10,o=f.clientY-r.top-10;p.style.width="20px",p.style.height="20px",p.style.left=`${e}px`,p.style.top=`${o}px`,p.style.zIndex="1000",p.focus()}Object.defineProperty(t,"__esModule",{value:!0}),t.rightClickHandler=t.moveTextAreaUnderMouseCursor=t.paste=t.handlePasteEvent=t.copyHandler=t.bracketTextForPaste=t.prepareTextForTerminal=void 0,t.prepareTextForTerminal=a,t.bracketTextForPaste=l,t.copyHandler=function(f,p){f.clipboardData&&f.clipboardData.setData("text/plain",p.selectionText),f.preventDefault()},t.handlePasteEvent=function(f,p,S,r){f.stopPropagation(),f.clipboardData&&u(f.clipboardData.getData("text/plain"),p,S,r)},t.paste=u,t.moveTextAreaUnderMouseCursor=n,t.rightClickHandler=function(f,p,S,r,e){n(f,p,S),e&&r.rightClickSelect(f),p.value=r.selectionText,p.select()}},7239:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorContrastCache=void 0;let l=a(1505);t.ColorContrastCache=class{constructor(){this._color=new l.TwoKeyMap,this._css=new l.TwoKeyMap}setCss(u,n,f){this._css.set(u,n,f)}getCss(u,n){return this._css.get(u,n)}setColor(u,n,f){this._color.set(u,n,f)}getColor(u,n){return this._color.get(u,n)}clear(){this._color.clear(),this._css.clear()}}},3656:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addDisposableDomListener=void 0,t.addDisposableDomListener=function(a,l,u,n){a.addEventListener(l,u,n);let f=!1;return{dispose:()=>{f||(f=!0,a.removeEventListener(l,u,n))}}}},3551:function(A,t,a){var l=this&&this.__decorate||function(o,s,i,h){var m,d=arguments.length,c=d<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,i):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,s,i,h);else for(var v=o.length-1;v>=0;v--)(m=o[v])&&(c=(d<3?m(c):d>3?m(s,i,c):m(s,i))||c);return d>3&&c&&Object.defineProperty(s,i,c),c},u=this&&this.__param||function(o,s){return function(i,h){s(i,h,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Linkifier=void 0;let n=a(3656),f=a(8460),p=a(844),S=a(2585),r=a(4725),e=t.Linkifier=class extends p.Disposable{get currentLink(){return this._currentLink}constructor(o,s,i,h,m){super(),this._element=o,this._mouseService=s,this._renderService=i,this._bufferService=h,this._linkProviderService=m,this._linkCacheDisposables=[],this._isMouseOut=!0,this._wasResized=!1,this._activeLine=-1,this._onShowLinkUnderline=this.register(new f.EventEmitter),this.onShowLinkUnderline=this._onShowLinkUnderline.event,this._onHideLinkUnderline=this.register(new f.EventEmitter),this.onHideLinkUnderline=this._onHideLinkUnderline.event,this.register((0,p.getDisposeArrayDisposable)(this._linkCacheDisposables)),this.register((0,p.toDisposable)((()=>{var d;this._lastMouseEvent=void 0,(d=this._activeProviderReplies)==null||d.clear()}))),this.register(this._bufferService.onResize((()=>{this._clearCurrentLink(),this._wasResized=!0}))),this.register((0,n.addDisposableDomListener)(this._element,"mouseleave",(()=>{this._isMouseOut=!0,this._clearCurrentLink()}))),this.register((0,n.addDisposableDomListener)(this._element,"mousemove",this._handleMouseMove.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mousedown",this._handleMouseDown.bind(this))),this.register((0,n.addDisposableDomListener)(this._element,"mouseup",this._handleMouseUp.bind(this)))}_handleMouseMove(o){this._lastMouseEvent=o;let s=this._positionFromMouseEvent(o,this._element,this._mouseService);if(!s)return;this._isMouseOut=!1;let i=o.composedPath();for(let h=0;h<i.length;h++){let m=i[h];if(m.classList.contains("xterm"))break;if(m.classList.contains("xterm-hover"))return}this._lastBufferCell&&s.x===this._lastBufferCell.x&&s.y===this._lastBufferCell.y||(this._handleHover(s),this._lastBufferCell=s)}_handleHover(o){if(this._activeLine!==o.y||this._wasResized)return this._clearCurrentLink(),this._askForLink(o,!1),void(this._wasResized=!1);this._currentLink&&this._linkAtPosition(this._currentLink.link,o)||(this._clearCurrentLink(),this._askForLink(o,!0))}_askForLink(o,s){var h,m;this._activeProviderReplies&&s||((h=this._activeProviderReplies)==null||h.forEach((d=>{d==null||d.forEach((c=>{c.link.dispose&&c.link.dispose()}))})),this._activeProviderReplies=new Map,this._activeLine=o.y);let i=!1;for(let[d,c]of this._linkProviderService.linkProviders.entries())s?(m=this._activeProviderReplies)!=null&&m.get(d)&&(i=this._checkLinkProviderResult(d,o,i)):c.provideLinks(o.y,(v=>{var k,D;if(this._isMouseOut)return;let C=v==null?void 0:v.map((x=>({link:x})));(k=this._activeProviderReplies)==null||k.set(d,C),i=this._checkLinkProviderResult(d,o,i),((D=this._activeProviderReplies)==null?void 0:D.size)===this._linkProviderService.linkProviders.length&&this._removeIntersectingLinks(o.y,this._activeProviderReplies)}))}_removeIntersectingLinks(o,s){let i=new Set;for(let h=0;h<s.size;h++){let m=s.get(h);if(m)for(let d=0;d<m.length;d++){let c=m[d],v=c.link.range.start.y<o?0:c.link.range.start.x,C=c.link.range.end.y>o?this._bufferService.cols:c.link.range.end.x;for(let k=v;k<=C;k++){if(i.has(k)){m.splice(d--,1);break}i.add(k)}}}}_checkLinkProviderResult(o,s,i){var d;if(!this._activeProviderReplies)return i;let h=this._activeProviderReplies.get(o),m=!1;for(let c=0;c<o;c++)this._activeProviderReplies.has(c)&&!this._activeProviderReplies.get(c)||(m=!0);if(!m&&h){let c=h.find((v=>this._linkAtPosition(v.link,s)));c&&(i=!0,this._handleNewLink(c))}if(this._activeProviderReplies.size===this._linkProviderService.linkProviders.length&&!i)for(let c=0;c<this._activeProviderReplies.size;c++){let v=(d=this._activeProviderReplies.get(c))==null?void 0:d.find((C=>this._linkAtPosition(C.link,s)));if(v){i=!0,this._handleNewLink(v);break}}return i}_handleMouseDown(){this._mouseDownLink=this._currentLink}_handleMouseUp(o){if(!this._currentLink)return;let s=this._positionFromMouseEvent(o,this._element,this._mouseService);s&&this._mouseDownLink===this._currentLink&&this._linkAtPosition(this._currentLink.link,s)&&this._currentLink.link.activate(o,this._currentLink.link.text)}_clearCurrentLink(o,s){this._currentLink&&this._lastMouseEvent&&(!o||!s||this._currentLink.link.range.start.y>=o&&this._currentLink.link.range.end.y<=s)&&(this._linkLeave(this._element,this._currentLink.link,this._lastMouseEvent),this._currentLink=void 0,(0,p.disposeArray)(this._linkCacheDisposables))}_handleNewLink(o){if(!this._lastMouseEvent)return;let s=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);s&&this._linkAtPosition(o.link,s)&&(this._currentLink=o,this._currentLink.state={decorations:{underline:o.link.decorations===void 0||o.link.decorations.underline,pointerCursor:o.link.decorations===void 0||o.link.decorations.pointerCursor},isHovered:!0},this._linkHover(this._element,o.link,this._lastMouseEvent),o.link.decorations={},Object.defineProperties(o.link.decorations,{pointerCursor:{get:()=>{var i,h;return(h=(i=this._currentLink)==null?void 0:i.state)==null?void 0:h.decorations.pointerCursor},set:i=>{var h;(h=this._currentLink)!=null&&h.state&&this._currentLink.state.decorations.pointerCursor!==i&&(this._currentLink.state.decorations.pointerCursor=i,this._currentLink.state.isHovered&&this._element.classList.toggle("xterm-cursor-pointer",i))}},underline:{get:()=>{var i,h;return(h=(i=this._currentLink)==null?void 0:i.state)==null?void 0:h.decorations.underline},set:i=>{var h,m,d;(h=this._currentLink)!=null&&h.state&&((d=(m=this._currentLink)==null?void 0:m.state)==null?void 0:d.decorations.underline)!==i&&(this._currentLink.state.decorations.underline=i,this._currentLink.state.isHovered&&this._fireUnderlineEvent(o.link,i))}}}),this._linkCacheDisposables.push(this._renderService.onRenderedViewportChange((i=>{if(!this._currentLink)return;let h=i.start===0?0:i.start+1+this._bufferService.buffer.ydisp,m=this._bufferService.buffer.ydisp+1+i.end;if(this._currentLink.link.range.start.y>=h&&this._currentLink.link.range.end.y<=m&&(this._clearCurrentLink(h,m),this._lastMouseEvent)){let d=this._positionFromMouseEvent(this._lastMouseEvent,this._element,this._mouseService);d&&this._askForLink(d,!1)}}))))}_linkHover(o,s,i){var h;(h=this._currentLink)!=null&&h.state&&(this._currentLink.state.isHovered=!0,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!0),this._currentLink.state.decorations.pointerCursor&&o.classList.add("xterm-cursor-pointer")),s.hover&&s.hover(i,s.text)}_fireUnderlineEvent(o,s){let i=o.range,h=this._bufferService.buffer.ydisp,m=this._createLinkUnderlineEvent(i.start.x-1,i.start.y-h-1,i.end.x,i.end.y-h-1,void 0);(s?this._onShowLinkUnderline:this._onHideLinkUnderline).fire(m)}_linkLeave(o,s,i){var h;(h=this._currentLink)!=null&&h.state&&(this._currentLink.state.isHovered=!1,this._currentLink.state.decorations.underline&&this._fireUnderlineEvent(s,!1),this._currentLink.state.decorations.pointerCursor&&o.classList.remove("xterm-cursor-pointer")),s.leave&&s.leave(i,s.text)}_linkAtPosition(o,s){let i=o.range.start.y*this._bufferService.cols+o.range.start.x,h=o.range.end.y*this._bufferService.cols+o.range.end.x,m=s.y*this._bufferService.cols+s.x;return i<=m&&m<=h}_positionFromMouseEvent(o,s,i){let h=i.getCoords(o,s,this._bufferService.cols,this._bufferService.rows);if(h)return{x:h[0],y:h[1]+this._bufferService.buffer.ydisp}}_createLinkUnderlineEvent(o,s,i,h,m){return{x1:o,y1:s,x2:i,y2:h,cols:this._bufferService.cols,fg:m}}};t.Linkifier=e=l([u(1,r.IMouseService),u(2,r.IRenderService),u(3,S.IBufferService),u(4,r.ILinkProviderService)],e)},9042:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.tooMuchOutput=t.promptLabel=void 0,t.promptLabel="Terminal input",t.tooMuchOutput="Too much output to announce, navigate to rows manually to read"},3730:function(A,t,a){var l=this&&this.__decorate||function(r,e,o,s){var i,h=arguments.length,m=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,o):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,e,o,s);else for(var d=r.length-1;d>=0;d--)(i=r[d])&&(m=(h<3?i(m):h>3?i(e,o,m):i(e,o))||m);return h>3&&m&&Object.defineProperty(e,o,m),m},u=this&&this.__param||function(r,e){return function(o,s){e(o,s,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkProvider=void 0;let n=a(511),f=a(2585),p=t.OscLinkProvider=class{constructor(r,e,o){this._bufferService=r,this._optionsService=e,this._oscLinkService=o}provideLinks(r,e){var C;let o=this._bufferService.buffer.lines.get(r-1);if(!o)return void e(void 0);let s=[],i=this._optionsService.rawOptions.linkHandler,h=new n.CellData,m=o.getTrimmedLength(),d=-1,c=-1,v=!1;for(let k=0;k<m;k++)if(c!==-1||o.hasContent(k)){if(o.loadCell(k,h),h.hasExtendedAttrs()&&h.extended.urlId){if(c===-1){c=k,d=h.extended.urlId;continue}v=h.extended.urlId!==d}else c!==-1&&(v=!0);if(v||c!==-1&&k===m-1){let D=(C=this._oscLinkService.getLinkData(d))==null?void 0:C.uri;if(D){let x={start:{x:c+1,y:r},end:{x:k+(v||k!==m-1?0:1),y:r}},y=!1;if(!(i!=null&&i.allowNonHttpProtocols))try{let L=new URL(D);["http:","https:"].includes(L.protocol)||(y=!0)}catch{y=!0}y||s.push({text:D,range:x,activate:(L,M)=>i?i.activate(L,M,x):S(0,M),hover:(L,M)=>{var B;return(B=i==null?void 0:i.hover)==null?void 0:B.call(i,L,M,x)},leave:(L,M)=>{var B;return(B=i==null?void 0:i.leave)==null?void 0:B.call(i,L,M,x)}})}v=!1,h.hasExtendedAttrs()&&h.extended.urlId?(c=k,d=h.extended.urlId):(c=-1,d=-1)}}e(s)}};function S(r,e){if(confirm(`Do you want to navigate to ${e}?

WARNING: This link could potentially be dangerous`)){let o=window.open();if(o){try{o.opener=null}catch{}o.location.href=e}else console.warn("Opening link blocked as opener could not be cleared")}}t.OscLinkProvider=p=l([u(0,f.IBufferService),u(1,f.IOptionsService),u(2,f.IOscLinkService)],p)},6193:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.RenderDebouncer=void 0,t.RenderDebouncer=class{constructor(a,l){this._renderCallback=a,this._coreBrowserService=l,this._refreshCallbacks=[]}dispose(){this._animationFrame&&(this._animationFrame=(this._coreBrowserService.window.cancelAnimationFrame(this._animationFrame),void 0))}addRefreshCallback(a){return this._refreshCallbacks.push(a),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh()))),this._animationFrame}refresh(a,l,u){this._rowCount=u,a=a===void 0?0:a,l=l===void 0?this._rowCount-1:l,this._rowStart=this._rowStart===void 0?a:Math.min(this._rowStart,a),this._rowEnd=this._rowEnd===void 0?l:Math.max(this._rowEnd,l),this._animationFrame||(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._animationFrame=void 0,this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return void this._runRefreshCallbacks();let a=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,l),this._runRefreshCallbacks()}_runRefreshCallbacks(){for(let a of this._refreshCallbacks)a(0);this._refreshCallbacks=[]}}},3236:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Terminal=void 0;let l=a(3614),u=a(3656),n=a(3551),f=a(9042),p=a(3730),S=a(1680),r=a(3107),e=a(5744),o=a(2950),s=a(1296),i=a(428),h=a(4269),m=a(5114),d=a(8934),c=a(3230),v=a(9312),C=a(4725),k=a(6731),D=a(8055),x=a(8969),y=a(8460),L=a(844),M=a(6114),B=a(8437),P=a(2584),H=a(7399),w=a(5941),R=a(9074),O=a(2585),F=a(5435),z=a(4567),j=a(779);class X extends x.CoreTerminal{get onFocus(){return this._onFocus.event}get onBlur(){return this._onBlur.event}get onA11yChar(){return this._onA11yCharEmitter.event}get onA11yTab(){return this._onA11yTabEmitter.event}get onWillOpen(){return this._onWillOpen.event}constructor(W={}){super(W),this.browser=M,this._keyDownHandled=!1,this._keyDownSeen=!1,this._keyPressHandled=!1,this._unprocessedDeadKey=!1,this._accessibilityManager=this.register(new L.MutableDisposable),this._onCursorMove=this.register(new y.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onKey=this.register(new y.EventEmitter),this.onKey=this._onKey.event,this._onRender=this.register(new y.EventEmitter),this.onRender=this._onRender.event,this._onSelectionChange=this.register(new y.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onTitleChange=this.register(new y.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onBell=this.register(new y.EventEmitter),this.onBell=this._onBell.event,this._onFocus=this.register(new y.EventEmitter),this._onBlur=this.register(new y.EventEmitter),this._onA11yCharEmitter=this.register(new y.EventEmitter),this._onA11yTabEmitter=this.register(new y.EventEmitter),this._onWillOpen=this.register(new y.EventEmitter),this._setup(),this._decorationService=this._instantiationService.createInstance(R.DecorationService),this._instantiationService.setService(O.IDecorationService,this._decorationService),this._linkProviderService=this._instantiationService.createInstance(j.LinkProviderService),this._instantiationService.setService(C.ILinkProviderService,this._linkProviderService),this._linkProviderService.registerLinkProvider(this._instantiationService.createInstance(p.OscLinkProvider)),this.register(this._inputHandler.onRequestBell((()=>this._onBell.fire()))),this.register(this._inputHandler.onRequestRefreshRows((($,I)=>this.refresh($,I)))),this.register(this._inputHandler.onRequestSendFocus((()=>this._reportFocus()))),this.register(this._inputHandler.onRequestReset((()=>this.reset()))),this.register(this._inputHandler.onRequestWindowsOptionsReport(($=>this._reportWindowsOptions($)))),this.register(this._inputHandler.onColor(($=>this._handleColorEvent($)))),this.register((0,y.forwardEvent)(this._inputHandler.onCursorMove,this._onCursorMove)),this.register((0,y.forwardEvent)(this._inputHandler.onTitleChange,this._onTitleChange)),this.register((0,y.forwardEvent)(this._inputHandler.onA11yChar,this._onA11yCharEmitter)),this.register((0,y.forwardEvent)(this._inputHandler.onA11yTab,this._onA11yTabEmitter)),this.register(this._bufferService.onResize(($=>this._afterResize($.cols,$.rows)))),this.register((0,L.toDisposable)((()=>{var $,I;this._customKeyEventHandler=void 0,(I=($=this.element)==null?void 0:$.parentNode)==null||I.removeChild(this.element)})))}_handleColorEvent(W){if(this._themeService)for(let $ of W){let I,U="";switch($.index){case 256:I="foreground",U="10";break;case 257:I="background",U="11";break;case 258:I="cursor",U="12";break;default:I="ansi",U="4;"+$.index}switch($.type){case 0:let q=D.color.toColorRGB(I==="ansi"?this._themeService.colors.ansi[$.index]:this._themeService.colors[I]);this.coreService.triggerDataEvent(`${P.C0.ESC}]${U};${(0,w.toRgbString)(q)}${P.C1_ESCAPED.ST}`);break;case 1:if(I==="ansi")this._themeService.modifyColors((G=>G.ansi[$.index]=D.channels.toColor(...$.color)));else{let G=I;this._themeService.modifyColors((Q=>Q[G]=D.channels.toColor(...$.color)))}break;case 2:this._themeService.restoreColor($.index)}}}_setup(){super._setup(),this._customKeyEventHandler=void 0}get buffer(){return this.buffers.active}focus(){this.textarea&&this.textarea.focus({preventScroll:!0})}_handleScreenReaderModeOptionChange(W){W?!this._accessibilityManager.value&&this._renderService&&(this._accessibilityManager.value=this._instantiationService.createInstance(z.AccessibilityManager,this)):this._accessibilityManager.clear()}_handleTextAreaFocus(W){this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(P.C0.ESC+"[I"),this.element.classList.add("focus"),this._showCursor(),this._onFocus.fire()}blur(){var W;return(W=this.textarea)==null?void 0:W.blur()}_handleTextAreaBlur(){this.textarea.value="",this.refresh(this.buffer.y,this.buffer.y),this.coreService.decPrivateModes.sendFocus&&this.coreService.triggerDataEvent(P.C0.ESC+"[O"),this.element.classList.remove("focus"),this._onBlur.fire()}_syncTextArea(){if(!this.textarea||!this.buffer.isCursorInViewport||this._compositionHelper.isComposing||!this._renderService)return;let W=this.buffer.ybase+this.buffer.y,$=this.buffer.lines.get(W);if(!$)return;let I=Math.min(this.buffer.x,this.cols-1),U=this._renderService.dimensions.css.cell.height,q=$.getWidth(I),G=this._renderService.dimensions.css.cell.width*q,Q=this.buffer.y*this._renderService.dimensions.css.cell.height,Y=I*this._renderService.dimensions.css.cell.width;this.textarea.style.left=Y+"px",this.textarea.style.top=Q+"px",this.textarea.style.width=G+"px",this.textarea.style.height=U+"px",this.textarea.style.lineHeight=U+"px",this.textarea.style.zIndex="-5"}_initGlobal(){this._bindKeys(),this.register((0,u.addDisposableDomListener)(this.element,"copy",($=>{this.hasSelection()&&(0,l.copyHandler)($,this._selectionService)})));let W=$=>(0,l.handlePasteEvent)($,this.textarea,this.coreService,this.optionsService);this.register((0,u.addDisposableDomListener)(this.textarea,"paste",W)),this.register((0,u.addDisposableDomListener)(this.element,"paste",W)),M.isFirefox?this.register((0,u.addDisposableDomListener)(this.element,"mousedown",($=>{$.button===2&&(0,l.rightClickHandler)($,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))):this.register((0,u.addDisposableDomListener)(this.element,"contextmenu",($=>{(0,l.rightClickHandler)($,this.textarea,this.screenElement,this._selectionService,this.options.rightClickSelectsWord)}))),M.isLinux&&this.register((0,u.addDisposableDomListener)(this.element,"auxclick",($=>{$.button===1&&(0,l.moveTextAreaUnderMouseCursor)($,this.textarea,this.screenElement)})))}_bindKeys(){this.register((0,u.addDisposableDomListener)(this.textarea,"keyup",(W=>this._keyUp(W)),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keydown",(W=>this._keyDown(W)),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"keypress",(W=>this._keyPress(W)),!0)),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionstart",(()=>this._compositionHelper.compositionstart()))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionupdate",(W=>this._compositionHelper.compositionupdate(W)))),this.register((0,u.addDisposableDomListener)(this.textarea,"compositionend",(()=>this._compositionHelper.compositionend()))),this.register((0,u.addDisposableDomListener)(this.textarea,"input",(W=>this._inputEvent(W)),!0)),this.register(this.onRender((()=>this._compositionHelper.updateCompositionElements())))}open(W){var I;if(!W)throw Error("Terminal requires a parent element.");if(W.isConnected||this._logService.debug("Terminal.open was called on an element that was not attached to the DOM"),((I=this.element)==null?void 0:I.ownerDocument.defaultView)&&this._coreBrowserService)return void(this.element.ownerDocument.defaultView!==this._coreBrowserService.window&&(this._coreBrowserService.window=this.element.ownerDocument.defaultView));this._document=W.ownerDocument,this.options.documentOverride&&this.options.documentOverride instanceof Document&&(this._document=this.optionsService.rawOptions.documentOverride),this.element=this._document.createElement("div"),this.element.dir="ltr",this.element.classList.add("terminal"),this.element.classList.add("xterm"),W.appendChild(this.element);let $=this._document.createDocumentFragment();this._viewportElement=this._document.createElement("div"),this._viewportElement.classList.add("xterm-viewport"),$.appendChild(this._viewportElement),this._viewportScrollArea=this._document.createElement("div"),this._viewportScrollArea.classList.add("xterm-scroll-area"),this._viewportElement.appendChild(this._viewportScrollArea),this.screenElement=this._document.createElement("div"),this.screenElement.classList.add("xterm-screen"),this.register((0,u.addDisposableDomListener)(this.screenElement,"mousemove",(U=>this.updateCursorStyle(U)))),this._helperContainer=this._document.createElement("div"),this._helperContainer.classList.add("xterm-helpers"),this.screenElement.appendChild(this._helperContainer),$.appendChild(this.screenElement),this.textarea=this._document.createElement("textarea"),this.textarea.classList.add("xterm-helper-textarea"),this.textarea.setAttribute("aria-label",f.promptLabel),M.isChromeOS||this.textarea.setAttribute("aria-multiline","false"),this.textarea.setAttribute("autocorrect","off"),this.textarea.setAttribute("autocapitalize","off"),this.textarea.setAttribute("spellcheck","false"),this.textarea.tabIndex=0,this._coreBrowserService=this.register(this._instantiationService.createInstance(m.CoreBrowserService,this.textarea,W.ownerDocument.defaultView??window,this._document??typeof window<"u"?window.document:null)),this._instantiationService.setService(C.ICoreBrowserService,this._coreBrowserService),this.register((0,u.addDisposableDomListener)(this.textarea,"focus",(U=>this._handleTextAreaFocus(U)))),this.register((0,u.addDisposableDomListener)(this.textarea,"blur",(()=>this._handleTextAreaBlur()))),this._helperContainer.appendChild(this.textarea),this._charSizeService=this._instantiationService.createInstance(i.CharSizeService,this._document,this._helperContainer),this._instantiationService.setService(C.ICharSizeService,this._charSizeService),this._themeService=this._instantiationService.createInstance(k.ThemeService),this._instantiationService.setService(C.IThemeService,this._themeService),this._characterJoinerService=this._instantiationService.createInstance(h.CharacterJoinerService),this._instantiationService.setService(C.ICharacterJoinerService,this._characterJoinerService),this._renderService=this.register(this._instantiationService.createInstance(c.RenderService,this.rows,this.screenElement)),this._instantiationService.setService(C.IRenderService,this._renderService),this.register(this._renderService.onRenderedViewportChange((U=>this._onRender.fire(U)))),this.onResize((U=>this._renderService.resize(U.cols,U.rows))),this._compositionView=this._document.createElement("div"),this._compositionView.classList.add("composition-view"),this._compositionHelper=this._instantiationService.createInstance(o.CompositionHelper,this.textarea,this._compositionView),this._helperContainer.appendChild(this._compositionView),this._mouseService=this._instantiationService.createInstance(d.MouseService),this._instantiationService.setService(C.IMouseService,this._mouseService),this.linkifier=this.register(this._instantiationService.createInstance(n.Linkifier,this.screenElement)),this.element.appendChild($);try{this._onWillOpen.fire(this.element)}catch{}this._renderService.hasRenderer()||this._renderService.setRenderer(this._createRenderer()),this.viewport=this._instantiationService.createInstance(S.Viewport,this._viewportElement,this._viewportScrollArea),this.viewport.onRequestScrollLines((U=>this.scrollLines(U.amount,U.suppressScrollEvent,1))),this.register(this._inputHandler.onRequestSyncScrollBar((()=>this.viewport.syncScrollArea()))),this.register(this.viewport),this.register(this.onCursorMove((()=>{this._renderService.handleCursorMove(),this._syncTextArea()}))),this.register(this.onResize((()=>this._renderService.handleResize(this.cols,this.rows)))),this.register(this.onBlur((()=>this._renderService.handleBlur()))),this.register(this.onFocus((()=>this._renderService.handleFocus()))),this.register(this._renderService.onDimensionsChange((()=>this.viewport.syncScrollArea()))),this._selectionService=this.register(this._instantiationService.createInstance(v.SelectionService,this.element,this.screenElement,this.linkifier)),this._instantiationService.setService(C.ISelectionService,this._selectionService),this.register(this._selectionService.onRequestScrollLines((U=>this.scrollLines(U.amount,U.suppressScrollEvent)))),this.register(this._selectionService.onSelectionChange((()=>this._onSelectionChange.fire()))),this.register(this._selectionService.onRequestRedraw((U=>this._renderService.handleSelectionChanged(U.start,U.end,U.columnSelectMode)))),this.register(this._selectionService.onLinuxMouseSelection((U=>{this.textarea.value=U,this.textarea.focus(),this.textarea.select()}))),this.register(this._onScroll.event((U=>{this.viewport.syncScrollArea(),this._selectionService.refresh()}))),this.register((0,u.addDisposableDomListener)(this._viewportElement,"scroll",(()=>this._selectionService.refresh()))),this.register(this._instantiationService.createInstance(r.BufferDecorationRenderer,this.screenElement)),this.register((0,u.addDisposableDomListener)(this.element,"mousedown",(U=>this._selectionService.handleMouseDown(U)))),this.coreMouseService.areMouseEventsActive?(this._selectionService.disable(),this.element.classList.add("enable-mouse-events")):this._selectionService.enable(),this.options.screenReaderMode&&(this._accessibilityManager.value=this._instantiationService.createInstance(z.AccessibilityManager,this)),this.register(this.optionsService.onSpecificOptionChange("screenReaderMode",(U=>this._handleScreenReaderModeOptionChange(U)))),this.options.overviewRulerWidth&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement))),this.optionsService.onSpecificOptionChange("overviewRulerWidth",(U=>{!this._overviewRulerRenderer&&U&&this._viewportElement&&this.screenElement&&(this._overviewRulerRenderer=this.register(this._instantiationService.createInstance(e.OverviewRulerRenderer,this._viewportElement,this.screenElement)))})),this._charSizeService.measure(),this.refresh(0,this.rows-1),this._initGlobal(),this.bindMouse()}_createRenderer(){return this._instantiationService.createInstance(s.DomRenderer,this,this._document,this.element,this.screenElement,this._viewportElement,this._helperContainer,this.linkifier)}bindMouse(){let W=this,$=this.element;function I(G){let Q=W._mouseService.getMouseReportCoords(G,W.screenElement);if(!Q)return!1;let Y,re;switch(G.overrideType||G.type){case"mousemove":re=32,G.buttons===void 0?(Y=3,G.button!==void 0&&(Y=G.button<3?G.button:3)):Y=1&G.buttons?0:4&G.buttons?1:2&G.buttons?2:3;break;case"mouseup":re=0,Y=G.button<3?G.button:3;break;case"mousedown":re=1,Y=G.button<3?G.button:3;break;case"wheel":if(W._customWheelEventHandler&&W._customWheelEventHandler(G)===!1||W.viewport.getLinesScrolled(G)===0)return!1;re=G.deltaY<0?0:1,Y=4;break;default:return!1}return!(re===void 0||Y===void 0||Y>4)&&W.coreMouseService.triggerMouseEvent({col:Q.col,row:Q.row,x:Q.x,y:Q.y,button:Y,action:re,ctrl:G.ctrlKey,alt:G.altKey,shift:G.shiftKey})}let U={mouseup:null,wheel:null,mousedrag:null,mousemove:null},q={mouseup:G=>(I(G),G.buttons||(this._document.removeEventListener("mouseup",U.mouseup),U.mousedrag&&this._document.removeEventListener("mousemove",U.mousedrag)),this.cancel(G)),wheel:G=>(I(G),this.cancel(G,!0)),mousedrag:G=>{G.buttons&&I(G)},mousemove:G=>{G.buttons||I(G)}};this.register(this.coreMouseService.onProtocolChange((G=>{G?(this.optionsService.rawOptions.logLevel==="debug"&&this._logService.debug("Binding to mouse events:",this.coreMouseService.explainEvents(G)),this.element.classList.add("enable-mouse-events"),this._selectionService.disable()):(this._logService.debug("Unbinding from mouse events."),this.element.classList.remove("enable-mouse-events"),this._selectionService.enable()),8&G?U.mousemove||(U.mousemove=($.addEventListener("mousemove",q.mousemove),q.mousemove)):($.removeEventListener("mousemove",U.mousemove),U.mousemove=null),16&G?U.wheel||(U.wheel=($.addEventListener("wheel",q.wheel,{passive:!1}),q.wheel)):($.removeEventListener("wheel",U.wheel),U.wheel=null),2&G?U.mouseup||(U.mouseup=q.mouseup):(this._document.removeEventListener("mouseup",U.mouseup),U.mouseup=null),4&G?U.mousedrag||(U.mousedrag=q.mousedrag):(this._document.removeEventListener("mousemove",U.mousedrag),U.mousedrag=null)}))),this.coreMouseService.activeProtocol=this.coreMouseService.activeProtocol,this.register((0,u.addDisposableDomListener)($,"mousedown",(G=>{if(G.preventDefault(),this.focus(),this.coreMouseService.areMouseEventsActive&&!this._selectionService.shouldForceSelection(G))return I(G),U.mouseup&&this._document.addEventListener("mouseup",U.mouseup),U.mousedrag&&this._document.addEventListener("mousemove",U.mousedrag),this.cancel(G)}))),this.register((0,u.addDisposableDomListener)($,"wheel",(G=>{if(!U.wheel){if(this._customWheelEventHandler&&this._customWheelEventHandler(G)===!1)return!1;if(!this.buffer.hasScrollback){let Q=this.viewport.getLinesScrolled(G);if(Q===0)return;let Y=P.C0.ESC+(this.coreService.decPrivateModes.applicationCursorKeys?"O":"[")+(G.deltaY<0?"A":"B"),re="";for(let he=0;he<Math.abs(Q);he++)re+=Y;return this.coreService.triggerDataEvent(re,!0),this.cancel(G,!0)}return this.viewport.handleWheel(G)?this.cancel(G):void 0}}),{passive:!1})),this.register((0,u.addDisposableDomListener)($,"touchstart",(G=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchStart(G),this.cancel(G)}),{passive:!0})),this.register((0,u.addDisposableDomListener)($,"touchmove",(G=>{if(!this.coreMouseService.areMouseEventsActive)return this.viewport.handleTouchMove(G)?void 0:this.cancel(G)}),{passive:!1}))}refresh(W,$){var I;(I=this._renderService)==null||I.refreshRows(W,$)}updateCursorStyle(W){var $;($=this._selectionService)!=null&&$.shouldColumnSelect(W)?this.element.classList.add("column-select"):this.element.classList.remove("column-select")}_showCursor(){this.coreService.isCursorInitialized||(this.coreService.isCursorInitialized=!0,this.refresh(this.buffer.y,this.buffer.y))}scrollLines(W,$,I=0){var U;I===1?(super.scrollLines(W,$,I),this.refresh(0,this.rows-1)):(U=this.viewport)==null||U.scrollLines(W)}paste(W){(0,l.paste)(W,this.textarea,this.coreService,this.optionsService)}attachCustomKeyEventHandler(W){this._customKeyEventHandler=W}attachCustomWheelEventHandler(W){this._customWheelEventHandler=W}registerLinkProvider(W){return this._linkProviderService.registerLinkProvider(W)}registerCharacterJoiner(W){if(!this._characterJoinerService)throw Error("Terminal must be opened first");let $=this._characterJoinerService.register(W);return this.refresh(0,this.rows-1),$}deregisterCharacterJoiner(W){if(!this._characterJoinerService)throw Error("Terminal must be opened first");this._characterJoinerService.deregister(W)&&this.refresh(0,this.rows-1)}get markers(){return this.buffer.markers}registerMarker(W){return this.buffer.addMarker(this.buffer.ybase+this.buffer.y+W)}registerDecoration(W){return this._decorationService.registerDecoration(W)}hasSelection(){return!!this._selectionService&&this._selectionService.hasSelection}select(W,$,I){this._selectionService.setSelection(W,$,I)}getSelection(){return this._selectionService?this._selectionService.selectionText:""}getSelectionPosition(){if(this._selectionService&&this._selectionService.hasSelection)return{start:{x:this._selectionService.selectionStart[0],y:this._selectionService.selectionStart[1]},end:{x:this._selectionService.selectionEnd[0],y:this._selectionService.selectionEnd[1]}}}clearSelection(){var W;(W=this._selectionService)==null||W.clearSelection()}selectAll(){var W;(W=this._selectionService)==null||W.selectAll()}selectLines(W,$){var I;(I=this._selectionService)==null||I.selectLines(W,$)}_keyDown(W){if(this._keyDownHandled=!1,this._keyDownSeen=!0,this._customKeyEventHandler&&this._customKeyEventHandler(W)===!1)return!1;let $=this.browser.isMac&&this.options.macOptionIsMeta&&W.altKey;if(!$&&!this._compositionHelper.keydown(W))return this.options.scrollOnUserInput&&this.buffer.ybase!==this.buffer.ydisp&&this.scrollToBottom(),!1;$||W.key!=="Dead"&&W.key!=="AltGraph"||(this._unprocessedDeadKey=!0);let I=(0,H.evaluateKeyboardEvent)(W,this.coreService.decPrivateModes.applicationCursorKeys,this.browser.isMac,this.options.macOptionIsMeta);if(this.updateCursorStyle(W),I.type===3||I.type===2){let U=this.rows-1;return this.scrollLines(I.type===2?-U:U),this.cancel(W,!0)}return I.type===1&&this.selectAll(),!!this._isThirdLevelShift(this.browser,W)||(I.cancel&&this.cancel(W,!0),!I.key||!!(W.key&&!W.ctrlKey&&!W.altKey&&!W.metaKey&&W.key.length===1&&W.key.charCodeAt(0)>=65&&W.key.charCodeAt(0)<=90)||(this._unprocessedDeadKey?(this._unprocessedDeadKey=!1,!0):(I.key!==P.C0.ETX&&I.key!==P.C0.CR||(this.textarea.value=""),this._onKey.fire({key:I.key,domEvent:W}),this._showCursor(),this.coreService.triggerDataEvent(I.key,!0),!this.optionsService.rawOptions.screenReaderMode||W.altKey||W.ctrlKey?this.cancel(W,!0):void(this._keyDownHandled=!0))))}_isThirdLevelShift(W,$){let I=W.isMac&&!this.options.macOptionIsMeta&&$.altKey&&!$.ctrlKey&&!$.metaKey||W.isWindows&&$.altKey&&$.ctrlKey&&!$.metaKey||W.isWindows&&$.getModifierState("AltGraph");return $.type==="keypress"?I:I&&(!$.keyCode||$.keyCode>47)}_keyUp(W){this._keyDownSeen=!1,this._customKeyEventHandler&&this._customKeyEventHandler(W)===!1||((function($){return $.keyCode===16||$.keyCode===17||$.keyCode===18})(W)||this.focus(),this.updateCursorStyle(W),this._keyPressHandled=!1)}_keyPress(W){let $;if(this._keyPressHandled=!1,this._keyDownHandled||this._customKeyEventHandler&&this._customKeyEventHandler(W)===!1)return!1;if(this.cancel(W),W.charCode)$=W.charCode;else if(W.which===null||W.which===void 0)$=W.keyCode;else{if(W.which===0||W.charCode===0)return!1;$=W.which}return!(!$||(W.altKey||W.ctrlKey||W.metaKey)&&!this._isThirdLevelShift(this.browser,W)||($=String.fromCharCode($),this._onKey.fire({key:$,domEvent:W}),this._showCursor(),this.coreService.triggerDataEvent($,!0),this._keyPressHandled=!0,this._unprocessedDeadKey=!1,0))}_inputEvent(W){if(W.data&&W.inputType==="insertText"&&(!W.composed||!this._keyDownSeen)&&!this.optionsService.rawOptions.screenReaderMode){if(this._keyPressHandled)return!1;this._unprocessedDeadKey=!1;let $=W.data;return this.coreService.triggerDataEvent($,!0),this.cancel(W),!0}return!1}resize(W,$){W!==this.cols||$!==this.rows?super.resize(W,$):this._charSizeService&&!this._charSizeService.hasValidSize&&this._charSizeService.measure()}_afterResize(W,$){var I,U;(I=this._charSizeService)==null||I.measure(),(U=this.viewport)==null||U.syncScrollArea(!0)}clear(){var W;if(this.buffer.ybase!==0||this.buffer.y!==0){this.buffer.clearAllMarkers(),this.buffer.lines.set(0,this.buffer.lines.get(this.buffer.ybase+this.buffer.y)),this.buffer.lines.length=1,this.buffer.ydisp=0,this.buffer.ybase=0,this.buffer.y=0;for(let $=1;$<this.rows;$++)this.buffer.lines.push(this.buffer.getBlankLine(B.DEFAULT_ATTR_DATA));this._onScroll.fire({position:this.buffer.ydisp,source:0}),(W=this.viewport)==null||W.reset(),this.refresh(0,this.rows-1)}}reset(){var $,I;this.options.rows=this.rows,this.options.cols=this.cols;let W=this._customKeyEventHandler;this._setup(),super.reset(),($=this._selectionService)==null||$.reset(),this._decorationService.reset(),(I=this.viewport)==null||I.reset(),this._customKeyEventHandler=W,this.refresh(0,this.rows-1)}clearTextureAtlas(){var W;(W=this._renderService)==null||W.clearTextureAtlas()}_reportFocus(){var W;(W=this.element)!=null&&W.classList.contains("focus")?this.coreService.triggerDataEvent(P.C0.ESC+"[I"):this.coreService.triggerDataEvent(P.C0.ESC+"[O")}_reportWindowsOptions(W){if(this._renderService)switch(W){case F.WindowsOptionsReportType.GET_WIN_SIZE_PIXELS:let $=this._renderService.dimensions.css.canvas.width.toFixed(0),I=this._renderService.dimensions.css.canvas.height.toFixed(0);this.coreService.triggerDataEvent(`${P.C0.ESC}[4;${I};${$}t`);break;case F.WindowsOptionsReportType.GET_CELL_SIZE_PIXELS:let U=this._renderService.dimensions.css.cell.width.toFixed(0),q=this._renderService.dimensions.css.cell.height.toFixed(0);this.coreService.triggerDataEvent(`${P.C0.ESC}[6;${q};${U}t`)}}cancel(W,$){if(this.options.cancelEvents||$)return W.preventDefault(),W.stopPropagation(),!1}}t.Terminal=X},9924:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TimeBasedDebouncer=void 0,t.TimeBasedDebouncer=class{constructor(a,l=1e3){this._renderCallback=a,this._debounceThresholdMS=l,this._lastRefreshMs=0,this._additionalRefreshRequested=!1}dispose(){this._refreshTimeoutID&&clearTimeout(this._refreshTimeoutID)}refresh(a,l,u){this._rowCount=u,a=a===void 0?0:a,l=l===void 0?this._rowCount-1:l,this._rowStart=this._rowStart===void 0?a:Math.min(this._rowStart,a),this._rowEnd=this._rowEnd===void 0?l:Math.max(this._rowEnd,l);let n=Date.now();if(n-this._lastRefreshMs>=this._debounceThresholdMS)this._lastRefreshMs=n,this._innerRefresh();else if(!this._additionalRefreshRequested){let f=n-this._lastRefreshMs,p=this._debounceThresholdMS-f;this._additionalRefreshRequested=!0,this._refreshTimeoutID=window.setTimeout((()=>{this._lastRefreshMs=Date.now(),this._innerRefresh(),this._additionalRefreshRequested=!1,this._refreshTimeoutID=void 0}),p)}}_innerRefresh(){if(this._rowStart===void 0||this._rowEnd===void 0||this._rowCount===void 0)return;let a=Math.max(this._rowStart,0),l=Math.min(this._rowEnd,this._rowCount-1);this._rowStart=void 0,this._rowEnd=void 0,this._renderCallback(a,l)}}},1680:function(A,t,a){var l=this&&this.__decorate||function(o,s,i,h){var m,d=arguments.length,c=d<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,i):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,s,i,h);else for(var v=o.length-1;v>=0;v--)(m=o[v])&&(c=(d<3?m(c):d>3?m(s,i,c):m(s,i))||c);return d>3&&c&&Object.defineProperty(s,i,c),c},u=this&&this.__param||function(o,s){return function(i,h){s(i,h,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.Viewport=void 0;let n=a(3656),f=a(4725),p=a(8460),S=a(844),r=a(2585),e=t.Viewport=class extends S.Disposable{constructor(o,s,i,h,m,d,c,v){super(),this._viewportElement=o,this._scrollArea=s,this._bufferService=i,this._optionsService=h,this._charSizeService=m,this._renderService=d,this._coreBrowserService=c,this.scrollBarWidth=0,this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._wheelPartialScroll=0,this._refreshAnimationFrame=null,this._ignoreNextScrollEvent=!1,this._smoothScrollState={startTime:0,origin:-1,target:-1},this._onRequestScrollLines=this.register(new p.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this.scrollBarWidth=this._viewportElement.offsetWidth-this._scrollArea.offsetWidth||15,this.register((0,n.addDisposableDomListener)(this._viewportElement,"scroll",this._handleScroll.bind(this))),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((C=>this._activeBuffer=C.activeBuffer))),this._renderDimensions=this._renderService.dimensions,this.register(this._renderService.onDimensionsChange((C=>this._renderDimensions=C))),this._handleThemeChange(v.colors),this.register(v.onChangeColors((C=>this._handleThemeChange(C)))),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.syncScrollArea()))),setTimeout((()=>this.syncScrollArea()))}_handleThemeChange(o){this._viewportElement.style.backgroundColor=o.background.css}reset(){this._currentRowHeight=0,this._currentDeviceCellHeight=0,this._lastRecordedBufferLength=0,this._lastRecordedViewportHeight=0,this._lastRecordedBufferHeight=0,this._lastTouchY=0,this._lastScrollTop=0,this._coreBrowserService.window.requestAnimationFrame((()=>this.syncScrollArea()))}_refresh(o){if(o)return this._innerRefresh(),void(this._refreshAnimationFrame!==null&&this._coreBrowserService.window.cancelAnimationFrame(this._refreshAnimationFrame));this._refreshAnimationFrame===null&&(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._innerRefresh())))}_innerRefresh(){if(this._charSizeService.height>0){this._currentRowHeight=this._renderDimensions.device.cell.height/this._coreBrowserService.dpr,this._currentDeviceCellHeight=this._renderDimensions.device.cell.height,this._lastRecordedViewportHeight=this._viewportElement.offsetHeight;let s=Math.round(this._currentRowHeight*this._lastRecordedBufferLength)+(this._lastRecordedViewportHeight-this._renderDimensions.css.canvas.height);this._lastRecordedBufferHeight!==s&&(this._lastRecordedBufferHeight=s,this._scrollArea.style.height=this._lastRecordedBufferHeight+"px")}let o=this._bufferService.buffer.ydisp*this._currentRowHeight;this._viewportElement.scrollTop!==o&&(this._ignoreNextScrollEvent=!0,this._viewportElement.scrollTop=o),this._refreshAnimationFrame=null}syncScrollArea(o=!1){if(this._lastRecordedBufferLength!==this._bufferService.buffer.lines.length)return this._lastRecordedBufferLength=this._bufferService.buffer.lines.length,void this._refresh(o);this._lastRecordedViewportHeight===this._renderService.dimensions.css.canvas.height&&this._lastScrollTop===this._activeBuffer.ydisp*this._currentRowHeight&&this._renderDimensions.device.cell.height===this._currentDeviceCellHeight||this._refresh(o)}_handleScroll(o){if(this._lastScrollTop=this._viewportElement.scrollTop,!this._viewportElement.offsetParent)return;if(this._ignoreNextScrollEvent)return this._ignoreNextScrollEvent=!1,void this._onRequestScrollLines.fire({amount:0,suppressScrollEvent:!0});let s=Math.round(this._lastScrollTop/this._currentRowHeight)-this._bufferService.buffer.ydisp;this._onRequestScrollLines.fire({amount:s,suppressScrollEvent:!0})}_smoothScroll(){if(this._isDisposed||this._smoothScrollState.origin===-1||this._smoothScrollState.target===-1)return;let o=this._smoothScrollPercent();this._viewportElement.scrollTop=this._smoothScrollState.origin+Math.round(o*(this._smoothScrollState.target-this._smoothScrollState.origin)),o<1?this._coreBrowserService.window.requestAnimationFrame((()=>this._smoothScroll())):this._clearSmoothScrollState()}_smoothScrollPercent(){return this._optionsService.rawOptions.smoothScrollDuration&&this._smoothScrollState.startTime?Math.max(Math.min((Date.now()-this._smoothScrollState.startTime)/this._optionsService.rawOptions.smoothScrollDuration,1),0):1}_clearSmoothScrollState(){this._smoothScrollState.startTime=0,this._smoothScrollState.origin=-1,this._smoothScrollState.target=-1}_bubbleScroll(o,s){let i=this._viewportElement.scrollTop+this._lastRecordedViewportHeight;return!(s<0&&this._viewportElement.scrollTop!==0||s>0&&i<this._lastRecordedBufferHeight)||(o.cancelable&&o.preventDefault(),!1)}handleWheel(o){let s=this._getPixelsScrolled(o);return s!==0&&(this._optionsService.rawOptions.smoothScrollDuration?(this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target===-1?this._smoothScrollState.target=this._viewportElement.scrollTop+s:this._smoothScrollState.target+=s,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()):this._viewportElement.scrollTop+=s,this._bubbleScroll(o,s))}scrollLines(o){if(o!==0)if(this._optionsService.rawOptions.smoothScrollDuration){let s=o*this._currentRowHeight;this._smoothScrollState.startTime=Date.now(),this._smoothScrollPercent()<1?(this._smoothScrollState.origin=this._viewportElement.scrollTop,this._smoothScrollState.target=this._smoothScrollState.origin+s,this._smoothScrollState.target=Math.max(Math.min(this._smoothScrollState.target,this._viewportElement.scrollHeight),0),this._smoothScroll()):this._clearSmoothScrollState()}else this._onRequestScrollLines.fire({amount:o,suppressScrollEvent:!1})}_getPixelsScrolled(o){if(o.deltaY===0||o.shiftKey)return 0;let s=this._applyScrollModifier(o.deltaY,o);return o.deltaMode===WheelEvent.DOM_DELTA_LINE?s*=this._currentRowHeight:o.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._currentRowHeight*this._bufferService.rows),s}getBufferElements(o,s){var v;let i,h="",m=[],d=s??this._bufferService.buffer.lines.length,c=this._bufferService.buffer.lines;for(let C=o;C<d;C++){let k=c.get(C);if(!k)continue;let D=(v=c.get(C+1))==null?void 0:v.isWrapped;if(h+=k.translateToString(!D),!D||C===c.length-1){let x=document.createElement("div");x.textContent=h,m.push(x),h.length>0&&(i=x),h=""}}return{bufferElements:m,cursorElement:i}}getLinesScrolled(o){if(o.deltaY===0||o.shiftKey)return 0;let s=this._applyScrollModifier(o.deltaY,o);return o.deltaMode===WheelEvent.DOM_DELTA_PIXEL?(s/=this._currentRowHeight+0,this._wheelPartialScroll+=s,s=Math.floor(Math.abs(this._wheelPartialScroll))*(this._wheelPartialScroll>0?1:-1),this._wheelPartialScroll%=1):o.deltaMode===WheelEvent.DOM_DELTA_PAGE&&(s*=this._bufferService.rows),s}_applyScrollModifier(o,s){let i=this._optionsService.rawOptions.fastScrollModifier;return i==="alt"&&s.altKey||i==="ctrl"&&s.ctrlKey||i==="shift"&&s.shiftKey?o*this._optionsService.rawOptions.fastScrollSensitivity*this._optionsService.rawOptions.scrollSensitivity:o*this._optionsService.rawOptions.scrollSensitivity}handleTouchStart(o){this._lastTouchY=o.touches[0].pageY}handleTouchMove(o){let s=this._lastTouchY-o.touches[0].pageY;return this._lastTouchY=o.touches[0].pageY,s!==0&&(this._viewportElement.scrollTop+=s,this._bubbleScroll(o,s))}};t.Viewport=e=l([u(2,r.IBufferService),u(3,r.IOptionsService),u(4,f.ICharSizeService),u(5,f.IRenderService),u(6,f.ICoreBrowserService),u(7,f.IThemeService)],e)},3107:function(A,t,a){var l=this&&this.__decorate||function(r,e,o,s){var i,h=arguments.length,m=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,o):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,e,o,s);else for(var d=r.length-1;d>=0;d--)(i=r[d])&&(m=(h<3?i(m):h>3?i(e,o,m):i(e,o))||m);return h>3&&m&&Object.defineProperty(e,o,m),m},u=this&&this.__param||function(r,e){return function(o,s){e(o,s,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferDecorationRenderer=void 0;let n=a(4725),f=a(844),p=a(2585),S=t.BufferDecorationRenderer=class extends f.Disposable{constructor(r,e,o,s,i){super(),this._screenElement=r,this._bufferService=e,this._coreBrowserService=o,this._decorationService=s,this._renderService=i,this._decorationElements=new Map,this._altBufferIsActive=!1,this._dimensionsChanged=!1,this._container=document.createElement("div"),this._container.classList.add("xterm-decoration-container"),this._screenElement.appendChild(this._container),this.register(this._renderService.onRenderedViewportChange((()=>this._doRefreshDecorations()))),this.register(this._renderService.onDimensionsChange((()=>{this._dimensionsChanged=!0,this._queueRefresh()}))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._altBufferIsActive=this._bufferService.buffer===this._bufferService.buffers.alt}))),this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh()))),this.register(this._decorationService.onDecorationRemoved((h=>this._removeDecoration(h)))),this.register((0,f.toDisposable)((()=>{this._container.remove(),this._decorationElements.clear()})))}_queueRefresh(){this._animationFrame===void 0&&(this._animationFrame=this._renderService.addRefreshCallback((()=>{this._doRefreshDecorations(),this._animationFrame=void 0})))}_doRefreshDecorations(){for(let r of this._decorationService.decorations)this._renderDecoration(r);this._dimensionsChanged=!1}_renderDecoration(r){this._refreshStyle(r),this._dimensionsChanged&&this._refreshXPosition(r)}_createElement(r){var s;let e=this._coreBrowserService.mainDocument.createElement("div");e.classList.add("xterm-decoration"),e.classList.toggle("xterm-decoration-top-layer",((s=r==null?void 0:r.options)==null?void 0:s.layer)==="top"),e.style.width=`${Math.round((r.options.width||1)*this._renderService.dimensions.css.cell.width)}px`,e.style.height=(r.options.height||1)*this._renderService.dimensions.css.cell.height+"px",e.style.top=(r.marker.line-this._bufferService.buffers.active.ydisp)*this._renderService.dimensions.css.cell.height+"px",e.style.lineHeight=`${this._renderService.dimensions.css.cell.height}px`;let o=r.options.x??0;return o&&o>this._bufferService.cols&&(e.style.display="none"),this._refreshXPosition(r,e),e}_refreshStyle(r){let e=r.marker.line-this._bufferService.buffers.active.ydisp;if(e<0||e>=this._bufferService.rows)r.element&&(r.element.style.display="none",r.onRenderEmitter.fire(r.element));else{let o=this._decorationElements.get(r);o||(o=this._createElement(r),r.element=o,this._decorationElements.set(r,o),this._container.appendChild(o),r.onDispose((()=>{this._decorationElements.delete(r),o.remove()}))),o.style.top=e*this._renderService.dimensions.css.cell.height+"px",o.style.display=this._altBufferIsActive?"none":"block",r.onRenderEmitter.fire(o)}}_refreshXPosition(r,e=r.element){if(!e)return;let o=r.options.x??0;(r.options.anchor||"left")==="right"?e.style.right=o?o*this._renderService.dimensions.css.cell.width+"px":"":e.style.left=o?o*this._renderService.dimensions.css.cell.width+"px":""}_removeDecoration(r){var e;(e=this._decorationElements.get(r))==null||e.remove(),this._decorationElements.delete(r),r.dispose()}};t.BufferDecorationRenderer=S=l([u(1,p.IBufferService),u(2,n.ICoreBrowserService),u(3,p.IDecorationService),u(4,n.IRenderService)],S)},5871:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ColorZoneStore=void 0,t.ColorZoneStore=class{constructor(){this._zones=[],this._zonePool=[],this._zonePoolIndex=0,this._linePadding={full:0,left:0,center:0,right:0}}get zones(){return this._zonePool.length=Math.min(this._zonePool.length,this._zones.length),this._zones}clear(){this._zones.length=0,this._zonePoolIndex=0}addDecoration(a){if(a.options.overviewRulerOptions){for(let l of this._zones)if(l.color===a.options.overviewRulerOptions.color&&l.position===a.options.overviewRulerOptions.position){if(this._lineIntersectsZone(l,a.marker.line))return;if(this._lineAdjacentToZone(l,a.marker.line,a.options.overviewRulerOptions.position))return void this._addLineToZone(l,a.marker.line)}if(this._zonePoolIndex<this._zonePool.length)return this._zonePool[this._zonePoolIndex].color=a.options.overviewRulerOptions.color,this._zonePool[this._zonePoolIndex].position=a.options.overviewRulerOptions.position,this._zonePool[this._zonePoolIndex].startBufferLine=a.marker.line,this._zonePool[this._zonePoolIndex].endBufferLine=a.marker.line,void this._zones.push(this._zonePool[this._zonePoolIndex++]);this._zones.push({color:a.options.overviewRulerOptions.color,position:a.options.overviewRulerOptions.position,startBufferLine:a.marker.line,endBufferLine:a.marker.line}),this._zonePool.push(this._zones[this._zones.length-1]),this._zonePoolIndex++}}setPadding(a){this._linePadding=a}_lineIntersectsZone(a,l){return l>=a.startBufferLine&&l<=a.endBufferLine}_lineAdjacentToZone(a,l,u){return l>=a.startBufferLine-this._linePadding[u||"full"]&&l<=a.endBufferLine+this._linePadding[u||"full"]}_addLineToZone(a,l){a.startBufferLine=Math.min(a.startBufferLine,l),a.endBufferLine=Math.max(a.endBufferLine,l)}}},5744:function(A,t,a){var l=this&&this.__decorate||function(i,h,m,d){var c,v=arguments.length,C=v<3?h:d===null?d=Object.getOwnPropertyDescriptor(h,m):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(i,h,m,d);else for(var k=i.length-1;k>=0;k--)(c=i[k])&&(C=(v<3?c(C):v>3?c(h,m,C):c(h,m))||C);return v>3&&C&&Object.defineProperty(h,m,C),C},u=this&&this.__param||function(i,h){return function(m,d){h(m,d,i)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OverviewRulerRenderer=void 0;let n=a(5871),f=a(4725),p=a(844),S=a(2585),r={full:0,left:0,center:0,right:0},e={full:0,left:0,center:0,right:0},o={full:0,left:0,center:0,right:0},s=t.OverviewRulerRenderer=class extends p.Disposable{get _width(){return this._optionsService.options.overviewRulerWidth||0}constructor(i,h,m,d,c,v,C){var D;super(),this._viewportElement=i,this._screenElement=h,this._bufferService=m,this._decorationService=d,this._renderService=c,this._optionsService=v,this._coreBrowserService=C,this._colorZoneStore=new n.ColorZoneStore,this._shouldUpdateDimensions=!0,this._shouldUpdateAnchor=!0,this._lastKnownBufferLength=0,this._canvas=this._coreBrowserService.mainDocument.createElement("canvas"),this._canvas.classList.add("xterm-decoration-overview-ruler"),this._refreshCanvasDimensions(),(D=this._viewportElement.parentElement)==null||D.insertBefore(this._canvas,this._viewportElement);let k=this._canvas.getContext("2d");if(!k)throw Error("Ctx cannot be null");this._ctx=k,this._registerDecorationListeners(),this._registerBufferChangeListeners(),this._registerDimensionChangeListeners(),this.register((0,p.toDisposable)((()=>{var x;(x=this._canvas)==null||x.remove()})))}_registerDecorationListeners(){this.register(this._decorationService.onDecorationRegistered((()=>this._queueRefresh(void 0,!0)))),this.register(this._decorationService.onDecorationRemoved((()=>this._queueRefresh(void 0,!0))))}_registerBufferChangeListeners(){this.register(this._renderService.onRenderedViewportChange((()=>this._queueRefresh()))),this.register(this._bufferService.buffers.onBufferActivate((()=>{this._canvas.style.display=this._bufferService.buffer===this._bufferService.buffers.alt?"none":"block"}))),this.register(this._bufferService.onScroll((()=>{this._lastKnownBufferLength!==this._bufferService.buffers.normal.lines.length&&(this._refreshDrawHeightConstants(),this._refreshColorZonePadding())})))}_registerDimensionChangeListeners(){this.register(this._renderService.onRender((()=>{this._containerHeight&&this._containerHeight===this._screenElement.clientHeight||(this._queueRefresh(!0),this._containerHeight=this._screenElement.clientHeight)}))),this.register(this._optionsService.onSpecificOptionChange("overviewRulerWidth",(()=>this._queueRefresh(!0)))),this.register(this._coreBrowserService.onDprChange((()=>this._queueRefresh(!0)))),this._queueRefresh(!0)}_refreshDrawConstants(){let i=Math.floor(this._canvas.width/3),h=Math.ceil(this._canvas.width/3);e.full=this._canvas.width,e.left=i,e.center=h,e.right=i,this._refreshDrawHeightConstants(),o.full=0,o.left=0,o.center=e.left,o.right=e.left+e.center}_refreshDrawHeightConstants(){r.full=Math.round(2*this._coreBrowserService.dpr);let i=this._canvas.height/this._bufferService.buffer.lines.length,h=Math.round(Math.max(Math.min(i,12),6)*this._coreBrowserService.dpr);r.left=h,r.center=h,r.right=h}_refreshColorZonePadding(){this._colorZoneStore.setPadding({full:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*r.full),left:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*r.left),center:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*r.center),right:Math.floor(this._bufferService.buffers.active.lines.length/(this._canvas.height-1)*r.right)}),this._lastKnownBufferLength=this._bufferService.buffers.normal.lines.length}_refreshCanvasDimensions(){this._canvas.style.width=`${this._width}px`,this._canvas.width=Math.round(this._width*this._coreBrowserService.dpr),this._canvas.style.height=`${this._screenElement.clientHeight}px`,this._canvas.height=Math.round(this._screenElement.clientHeight*this._coreBrowserService.dpr),this._refreshDrawConstants(),this._refreshColorZonePadding()}_refreshDecorations(){this._shouldUpdateDimensions&&this._refreshCanvasDimensions(),this._ctx.clearRect(0,0,this._canvas.width,this._canvas.height),this._colorZoneStore.clear();for(let h of this._decorationService.decorations)this._colorZoneStore.addDecoration(h);this._ctx.lineWidth=1;let i=this._colorZoneStore.zones;for(let h of i)h.position!=="full"&&this._renderColorZone(h);for(let h of i)h.position==="full"&&this._renderColorZone(h);this._shouldUpdateDimensions=!1,this._shouldUpdateAnchor=!1}_renderColorZone(i){this._ctx.fillStyle=i.color,this._ctx.fillRect(o[i.position||"full"],Math.round((this._canvas.height-1)*(i.startBufferLine/this._bufferService.buffers.active.lines.length)-r[i.position||"full"]/2),e[i.position||"full"],Math.round((this._canvas.height-1)*((i.endBufferLine-i.startBufferLine)/this._bufferService.buffers.active.lines.length)+r[i.position||"full"]))}_queueRefresh(i,h){this._shouldUpdateDimensions=i||this._shouldUpdateDimensions,this._shouldUpdateAnchor=h||this._shouldUpdateAnchor,this._animationFrame===void 0&&(this._animationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>{this._refreshDecorations(),this._animationFrame=void 0})))}};t.OverviewRulerRenderer=s=l([u(2,S.IBufferService),u(3,S.IDecorationService),u(4,f.IRenderService),u(5,S.IOptionsService),u(6,f.ICoreBrowserService)],s)},2950:function(A,t,a){var l=this&&this.__decorate||function(r,e,o,s){var i,h=arguments.length,m=h<3?e:s===null?s=Object.getOwnPropertyDescriptor(e,o):s;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")m=Reflect.decorate(r,e,o,s);else for(var d=r.length-1;d>=0;d--)(i=r[d])&&(m=(h<3?i(m):h>3?i(e,o,m):i(e,o))||m);return h>3&&m&&Object.defineProperty(e,o,m),m},u=this&&this.__param||function(r,e){return function(o,s){e(o,s,r)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CompositionHelper=void 0;let n=a(4725),f=a(2585),p=a(2584),S=t.CompositionHelper=class{get isComposing(){return this._isComposing}constructor(r,e,o,s,i,h){this._textarea=r,this._compositionView=e,this._bufferService=o,this._optionsService=s,this._coreService=i,this._renderService=h,this._isComposing=!1,this._isSendingComposition=!1,this._compositionPosition={start:0,end:0},this._dataAlreadySent=""}compositionstart(){this._isComposing=!0,this._compositionPosition.start=this._textarea.value.length,this._compositionView.textContent="",this._dataAlreadySent="",this._compositionView.classList.add("active")}compositionupdate(r){this._compositionView.textContent=r.data,this.updateCompositionElements(),setTimeout((()=>{this._compositionPosition.end=this._textarea.value.length}),0)}compositionend(){this._finalizeComposition(!0)}keydown(r){if(this._isComposing||this._isSendingComposition){if(r.keyCode===229||r.keyCode===16||r.keyCode===17||r.keyCode===18)return!1;this._finalizeComposition(!1)}return r.keyCode!==229||(this._handleAnyTextareaChanges(),!1)}_finalizeComposition(r){if(this._compositionView.classList.remove("active"),this._isComposing=!1,r){let e={start:this._compositionPosition.start,end:this._compositionPosition.end};this._isSendingComposition=!0,setTimeout((()=>{if(this._isSendingComposition){let o;this._isSendingComposition=!1,e.start+=this._dataAlreadySent.length,o=this._isComposing?this._textarea.value.substring(e.start,e.end):this._textarea.value.substring(e.start),o.length>0&&this._coreService.triggerDataEvent(o,!0)}}),0)}else{this._isSendingComposition=!1;let e=this._textarea.value.substring(this._compositionPosition.start,this._compositionPosition.end);this._coreService.triggerDataEvent(e,!0)}}_handleAnyTextareaChanges(){let r=this._textarea.value;setTimeout((()=>{if(!this._isComposing){let e=this._textarea.value,o=e.replace(r,"");this._dataAlreadySent=o,e.length>r.length?this._coreService.triggerDataEvent(o,!0):e.length<r.length?this._coreService.triggerDataEvent(`${p.C0.DEL}`,!0):e.length===r.length&&e!==r&&this._coreService.triggerDataEvent(e,!0)}}),0)}updateCompositionElements(r){if(this._isComposing){if(this._bufferService.buffer.isCursorInViewport){let e=Math.min(this._bufferService.buffer.x,this._bufferService.cols-1),o=this._renderService.dimensions.css.cell.height,s=this._bufferService.buffer.y*this._renderService.dimensions.css.cell.height,i=e*this._renderService.dimensions.css.cell.width;this._compositionView.style.left=i+"px",this._compositionView.style.top=s+"px",this._compositionView.style.height=o+"px",this._compositionView.style.lineHeight=o+"px",this._compositionView.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._compositionView.style.fontSize=this._optionsService.rawOptions.fontSize+"px";let h=this._compositionView.getBoundingClientRect();this._textarea.style.left=i+"px",this._textarea.style.top=s+"px",this._textarea.style.width=Math.max(h.width,1)+"px",this._textarea.style.height=Math.max(h.height,1)+"px",this._textarea.style.lineHeight=h.height+"px"}r||setTimeout((()=>this.updateCompositionElements(!0)),0)}}};t.CompositionHelper=S=l([u(2,f.IBufferService),u(3,f.IOptionsService),u(4,f.ICoreService),u(5,n.IRenderService)],S)},9806:(A,t)=>{function a(l,u,n){let f=n.getBoundingClientRect(),p=l.getComputedStyle(n),S=parseInt(p.getPropertyValue("padding-left")),r=parseInt(p.getPropertyValue("padding-top"));return[u.clientX-f.left-S,u.clientY-f.top-r]}Object.defineProperty(t,"__esModule",{value:!0}),t.getCoords=t.getCoordsRelativeToElement=void 0,t.getCoordsRelativeToElement=a,t.getCoords=function(l,u,n,f,p,S,r,e,o){if(!S)return;let s=a(l,u,n);return s?(s[0]=Math.ceil((s[0]+(o?r/2:0))/r),s[1]=Math.ceil(s[1]/e),s[0]=Math.min(Math.max(s[0],1),f+(o?1:0)),s[1]=Math.min(Math.max(s[1],1),p),s):void 0}},9504:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.moveToCellSequence=void 0;let l=a(2584);function u(e,o,s,i){let h=e-n(e,s),m=o-n(o,s);return r(Math.abs(h-m)-(function(d,c,v){var x;let C=0,k=d-n(d,v),D=c-n(c,v);for(let y=0;y<Math.abs(k-D);y++){let L=f(d,c)==="A"?-1:1;(x=v.buffer.lines.get(k+L*y))!=null&&x.isWrapped&&C++}return C})(e,o,s),S(f(e,o),i))}function n(e,o){let s=0,i=o.buffer.lines.get(e),h=i==null?void 0:i.isWrapped;for(;h&&e>=0&&e<o.rows;)s++,i=o.buffer.lines.get(--e),h=i==null?void 0:i.isWrapped;return s}function f(e,o){return e>o?"A":"B"}function p(e,o,s,i,h,m){let d=e,c=o,v="";for(;d!==s||c!==i;)d+=h?1:-1,h&&d>m.cols-1?(v+=m.buffer.translateBufferLineToString(c,!1,e,d),d=0,e=0,c++):!h&&d<0&&(v+=m.buffer.translateBufferLineToString(c,!1,0,e+1),d=m.cols-1,e=d,c--);return v+m.buffer.translateBufferLineToString(c,!1,e,d)}function S(e,o){let s=o?"O":"[";return l.C0.ESC+s+e}function r(e,o){e=Math.floor(e);let s="";for(let i=0;i<e;i++)s+=o;return s}t.moveToCellSequence=function(e,o,s,i){let h=s.buffer.x,m=s.buffer.y;if(!s.buffer.hasScrollback)return(function(v,C,k,D,x,y){return u(C,D,x,y).length===0?"":r(p(v,C,v,C-n(C,x),!1,x).length,S("D",y))})(h,m,0,o,s,i)+u(m,o,s,i)+(function(v,C,k,D,x,y){let L;L=u(C,D,x,y).length>0?D-n(D,x):C;let M=D,B=(function(P,H,w,R,O,F){let z;return z=u(w,R,O,F).length>0?R-n(R,O):H,P<w&&z<=R||P>=w&&z<R?"C":"D"})(v,C,k,D,x,y);return r(p(v,L,k,M,B==="C",x).length,S(B,y))})(h,m,e,o,s,i);let d;if(m===o)return d=h>e?"D":"C",r(Math.abs(h-e),S(d,i));d=m>o?"D":"C";let c=Math.abs(m-o);return r((function(v,C){return C.cols-v})(m>o?e:h,s)+(c-1)*s.cols+1+((m>o?h:e)-1),S(d,i))}},1296:function(A,t,a){var l=this&&this.__decorate||function(y,L,M,B){var P,H=arguments.length,w=H<3?L:B===null?B=Object.getOwnPropertyDescriptor(L,M):B;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")w=Reflect.decorate(y,L,M,B);else for(var R=y.length-1;R>=0;R--)(P=y[R])&&(w=(H<3?P(w):H>3?P(L,M,w):P(L,M))||w);return H>3&&w&&Object.defineProperty(L,M,w),w},u=this&&this.__param||function(y,L){return function(M,B){L(M,B,y)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRenderer=void 0;let n=a(3787),f=a(2550),p=a(2223),S=a(6171),r=a(6052),e=a(4725),o=a(8055),s=a(8460),i=a(844),h=a(2585),m="xterm-dom-renderer-owner-",d="xterm-rows",c="xterm-fg-",v="xterm-bg-",C="xterm-focus",k="xterm-selection",D=1,x=t.DomRenderer=class extends i.Disposable{constructor(y,L,M,B,P,H,w,R,O,F,z,j,X){super(),this._terminal=y,this._document=L,this._element=M,this._screenElement=B,this._viewportElement=P,this._helperContainer=H,this._linkifier2=w,this._charSizeService=O,this._optionsService=F,this._bufferService=z,this._coreBrowserService=j,this._themeService=X,this._terminalClass=D++,this._rowElements=[],this._selectionRenderModel=(0,r.createSelectionRenderModel)(),this.onRequestRedraw=this.register(new s.EventEmitter).event,this._rowContainer=this._document.createElement("div"),this._rowContainer.classList.add(d),this._rowContainer.style.lineHeight="normal",this._rowContainer.setAttribute("aria-hidden","true"),this._refreshRowElements(this._bufferService.cols,this._bufferService.rows),this._selectionContainer=this._document.createElement("div"),this._selectionContainer.classList.add(k),this._selectionContainer.setAttribute("aria-hidden","true"),this.dimensions=(0,S.createRenderDimensions)(),this._updateDimensions(),this.register(this._optionsService.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._themeService.onChangeColors((K=>this._injectCss(K)))),this._injectCss(this._themeService.colors),this._rowFactory=R.createInstance(n.DomRendererRowFactory,document),this._element.classList.add(m+this._terminalClass),this._screenElement.appendChild(this._rowContainer),this._screenElement.appendChild(this._selectionContainer),this.register(this._linkifier2.onShowLinkUnderline((K=>this._handleLinkHover(K)))),this.register(this._linkifier2.onHideLinkUnderline((K=>this._handleLinkLeave(K)))),this.register((0,i.toDisposable)((()=>{this._element.classList.remove(m+this._terminalClass),this._rowContainer.remove(),this._selectionContainer.remove(),this._widthCache.dispose(),this._themeStyleElement.remove(),this._dimensionsStyleElement.remove()}))),this._widthCache=new f.WidthCache(this._document,this._helperContainer),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}_updateDimensions(){let y=this._coreBrowserService.dpr;this.dimensions.device.char.width=this._charSizeService.width*y,this.dimensions.device.char.height=Math.ceil(this._charSizeService.height*y),this.dimensions.device.cell.width=this.dimensions.device.char.width+Math.round(this._optionsService.rawOptions.letterSpacing),this.dimensions.device.cell.height=Math.floor(this.dimensions.device.char.height*this._optionsService.rawOptions.lineHeight),this.dimensions.device.char.left=0,this.dimensions.device.char.top=0,this.dimensions.device.canvas.width=this.dimensions.device.cell.width*this._bufferService.cols,this.dimensions.device.canvas.height=this.dimensions.device.cell.height*this._bufferService.rows,this.dimensions.css.canvas.width=Math.round(this.dimensions.device.canvas.width/y),this.dimensions.css.canvas.height=Math.round(this.dimensions.device.canvas.height/y),this.dimensions.css.cell.width=this.dimensions.css.canvas.width/this._bufferService.cols,this.dimensions.css.cell.height=this.dimensions.css.canvas.height/this._bufferService.rows;for(let M of this._rowElements)M.style.width=`${this.dimensions.css.canvas.width}px`,M.style.height=`${this.dimensions.css.cell.height}px`,M.style.lineHeight=`${this.dimensions.css.cell.height}px`,M.style.overflow="hidden";this._dimensionsStyleElement||(this._dimensionsStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._dimensionsStyleElement));let L=`${this._terminalSelector} .${d} span { display: inline-block; height: 100%; vertical-align: top;}`;this._dimensionsStyleElement.textContent=L,this._selectionContainer.style.height=this._viewportElement.style.height,this._screenElement.style.width=`${this.dimensions.css.canvas.width}px`,this._screenElement.style.height=`${this.dimensions.css.canvas.height}px`}_injectCss(y){this._themeStyleElement||(this._themeStyleElement=this._document.createElement("style"),this._screenElement.appendChild(this._themeStyleElement));let L=`${this._terminalSelector} .${d} { color: ${y.foreground.css}; font-family: ${this._optionsService.rawOptions.fontFamily}; font-size: ${this._optionsService.rawOptions.fontSize}px; font-kerning: none; white-space: pre}`;L+=`${this._terminalSelector} .${d} .xterm-dim { color: ${o.color.multiplyOpacity(y.foreground,.5).css};}`,L+=`${this._terminalSelector} span:not(.xterm-bold) { font-weight: ${this._optionsService.rawOptions.fontWeight};}${this._terminalSelector} span.xterm-bold { font-weight: ${this._optionsService.rawOptions.fontWeightBold};}${this._terminalSelector} span.xterm-italic { font-style: italic;}`;let M=`blink_underline_${this._terminalClass}`,B=`blink_bar_${this._terminalClass}`,P=`blink_block_${this._terminalClass}`;L+=`@keyframes ${M} { 50% {  border-bottom-style: hidden; }}`,L+=`@keyframes ${B} { 50% {  box-shadow: none; }}`,L+=`@keyframes ${P} { 0% {  background-color: ${y.cursor.css};  color: ${y.cursorAccent.css}; } 50% {  background-color: inherit;  color: ${y.cursor.css}; }}`,L+=`${this._terminalSelector} .${d}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-underline { animation: ${M} 1s step-end infinite;}${this._terminalSelector} .${d}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-bar { animation: ${B} 1s step-end infinite;}${this._terminalSelector} .${d}.${C} .xterm-cursor.xterm-cursor-blink.xterm-cursor-block { animation: ${P} 1s step-end infinite;}${this._terminalSelector} .${d} .xterm-cursor.xterm-cursor-block { background-color: ${y.cursor.css}; color: ${y.cursorAccent.css};}${this._terminalSelector} .${d} .xterm-cursor.xterm-cursor-block:not(.xterm-cursor-blink) { background-color: ${y.cursor.css} !important; color: ${y.cursorAccent.css} !important;}${this._terminalSelector} .${d} .xterm-cursor.xterm-cursor-outline { outline: 1px solid ${y.cursor.css}; outline-offset: -1px;}${this._terminalSelector} .${d} .xterm-cursor.xterm-cursor-bar { box-shadow: ${this._optionsService.rawOptions.cursorWidth}px 0 0 ${y.cursor.css} inset;}${this._terminalSelector} .${d} .xterm-cursor.xterm-cursor-underline { border-bottom: 1px ${y.cursor.css}; border-bottom-style: solid; height: calc(100% - 1px);}`,L+=`${this._terminalSelector} .${k} { position: absolute; top: 0; left: 0; z-index: 1; pointer-events: none;}${this._terminalSelector}.focus .${k} div { position: absolute; background-color: ${y.selectionBackgroundOpaque.css};}${this._terminalSelector} .${k} div { position: absolute; background-color: ${y.selectionInactiveBackgroundOpaque.css};}`;for(let[H,w]of y.ansi.entries())L+=`${this._terminalSelector} .${c}${H} { color: ${w.css}; }${this._terminalSelector} .${c}${H}.xterm-dim { color: ${o.color.multiplyOpacity(w,.5).css}; }${this._terminalSelector} .${v}${H} { background-color: ${w.css}; }`;L+=`${this._terminalSelector} .${c}${p.INVERTED_DEFAULT_COLOR} { color: ${o.color.opaque(y.background).css}; }${this._terminalSelector} .${c}${p.INVERTED_DEFAULT_COLOR}.xterm-dim { color: ${o.color.multiplyOpacity(o.color.opaque(y.background),.5).css}; }${this._terminalSelector} .${v}${p.INVERTED_DEFAULT_COLOR} { background-color: ${y.foreground.css}; }`,this._themeStyleElement.textContent=L}_setDefaultSpacing(){let y=this.dimensions.css.cell.width-this._widthCache.get("W",!1,!1);this._rowContainer.style.letterSpacing=`${y}px`,this._rowFactory.defaultSpacing=y}handleDevicePixelRatioChange(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}_refreshRowElements(y,L){for(let M=this._rowElements.length;M<=L;M++){let B=this._document.createElement("div");this._rowContainer.appendChild(B),this._rowElements.push(B)}for(;this._rowElements.length>L;)this._rowContainer.removeChild(this._rowElements.pop())}handleResize(y,L){this._refreshRowElements(y,L),this._updateDimensions(),this.handleSelectionChanged(this._selectionRenderModel.selectionStart,this._selectionRenderModel.selectionEnd,this._selectionRenderModel.columnSelectMode)}handleCharSizeChanged(){this._updateDimensions(),this._widthCache.clear(),this._setDefaultSpacing()}handleBlur(){this._rowContainer.classList.remove(C),this.renderRows(0,this._bufferService.rows-1)}handleFocus(){this._rowContainer.classList.add(C),this.renderRows(this._bufferService.buffer.y,this._bufferService.buffer.y)}handleSelectionChanged(y,L,M){if(this._selectionContainer.replaceChildren(),this._rowFactory.handleSelectionChanged(y,L,M),this.renderRows(0,this._bufferService.rows-1),!y||!L)return;this._selectionRenderModel.update(this._terminal,y,L,M);let B=this._selectionRenderModel.viewportStartRow,P=this._selectionRenderModel.viewportEndRow,H=this._selectionRenderModel.viewportCappedStartRow,w=this._selectionRenderModel.viewportCappedEndRow;if(H>=this._bufferService.rows||w<0)return;let R=this._document.createDocumentFragment();if(M){let O=y[0]>L[0];R.appendChild(this._createSelectionElement(H,O?L[0]:y[0],O?y[0]:L[0],w-H+1))}else{let O=B===H?y[0]:0,F=H===P?L[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(H,O,F));let z=w-H-1;if(R.appendChild(this._createSelectionElement(H+1,0,this._bufferService.cols,z)),H!==w){let j=P===w?L[0]:this._bufferService.cols;R.appendChild(this._createSelectionElement(w,0,j))}}this._selectionContainer.appendChild(R)}_createSelectionElement(y,L,M,B=1){let P=this._document.createElement("div"),H=L*this.dimensions.css.cell.width,w=this.dimensions.css.cell.width*(M-L);return H+w>this.dimensions.css.canvas.width&&(w=this.dimensions.css.canvas.width-H),P.style.height=B*this.dimensions.css.cell.height+"px",P.style.top=y*this.dimensions.css.cell.height+"px",P.style.left=`${H}px`,P.style.width=`${w}px`,P}handleCursorMove(){}_handleOptionsChanged(){this._updateDimensions(),this._injectCss(this._themeService.colors),this._widthCache.setFont(this._optionsService.rawOptions.fontFamily,this._optionsService.rawOptions.fontSize,this._optionsService.rawOptions.fontWeight,this._optionsService.rawOptions.fontWeightBold),this._setDefaultSpacing()}clear(){for(let y of this._rowElements)y.replaceChildren()}renderRows(y,L){let M=this._bufferService.buffer,B=M.ybase+M.y,P=Math.min(M.x,this._bufferService.cols-1),H=this._optionsService.rawOptions.cursorBlink,w=this._optionsService.rawOptions.cursorStyle,R=this._optionsService.rawOptions.cursorInactiveStyle;for(let O=y;O<=L;O++){let F=O+M.ydisp,z=this._rowElements[O],j=M.lines.get(F);if(!z||!j)break;z.replaceChildren(...this._rowFactory.createRow(j,F,F===B,w,R,P,H,this.dimensions.css.cell.width,this._widthCache,-1,-1))}}get _terminalSelector(){return`.${m}${this._terminalClass}`}_handleLinkHover(y){this._setCellUnderline(y.x1,y.x2,y.y1,y.y2,y.cols,!0)}_handleLinkLeave(y){this._setCellUnderline(y.x1,y.x2,y.y1,y.y2,y.cols,!1)}_setCellUnderline(y,L,M,B,P,H){M<0&&(y=0),B<0&&(L=0);let w=this._bufferService.rows-1;M=Math.max(Math.min(M,w),0),B=Math.max(Math.min(B,w),0),P=Math.min(P,this._bufferService.cols);let R=this._bufferService.buffer,O=R.ybase+R.y,F=Math.min(R.x,P-1),z=this._optionsService.rawOptions.cursorBlink,j=this._optionsService.rawOptions.cursorStyle,X=this._optionsService.rawOptions.cursorInactiveStyle;for(let K=M;K<=B;++K){let W=K+R.ydisp,$=this._rowElements[K],I=R.lines.get(W);if(!$||!I)break;$.replaceChildren(...this._rowFactory.createRow(I,W,W===O,j,X,F,z,this.dimensions.css.cell.width,this._widthCache,H?K===M?y:0:-1,H?(K===B?L:P)-1:-1))}}};t.DomRenderer=x=l([u(7,h.IInstantiationService),u(8,e.ICharSizeService),u(9,h.IOptionsService),u(10,h.IBufferService),u(11,e.ICoreBrowserService),u(12,e.IThemeService)],x)},3787:function(A,t,a){var l=this&&this.__decorate||function(d,c,v,C){var k,D=arguments.length,x=D<3?c:C===null?C=Object.getOwnPropertyDescriptor(c,v):C;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")x=Reflect.decorate(d,c,v,C);else for(var y=d.length-1;y>=0;y--)(k=d[y])&&(x=(D<3?k(x):D>3?k(c,v,x):k(c,v))||x);return D>3&&x&&Object.defineProperty(c,v,x),x},u=this&&this.__param||function(d,c){return function(v,C){c(v,C,d)}};Object.defineProperty(t,"__esModule",{value:!0}),t.DomRendererRowFactory=void 0;let n=a(2223),f=a(643),p=a(511),S=a(2585),r=a(8055),e=a(4725),o=a(4269),s=a(6171),i=a(3734),h=t.DomRendererRowFactory=class{constructor(d,c,v,C,k,D,x){this._document=d,this._characterJoinerService=c,this._optionsService=v,this._coreBrowserService=C,this._coreService=k,this._decorationService=D,this._themeService=x,this._workCell=new p.CellData,this._columnSelectMode=!1,this.defaultSpacing=0}handleSelectionChanged(d,c,v){this._selectionStart=d,this._selectionEnd=c,this._columnSelectMode=v}createRow(d,c,v,C,k,D,x,y,L,M,B){let P=[],H=this._characterJoinerService.getJoinedCharacters(c),w=this._themeService.colors,R,O=d.getNoBgTrimmedLength();v&&O<D+1&&(O=D+1);let F=0,z="",j=0,X=0,K=0,W=!1,$=0,I=!1,U=0,q=[],G=M!==-1&&B!==-1;for(let Q=0;Q<O;Q++){d.loadCell(Q,this._workCell);let Y=this._workCell.getWidth();if(Y===0)continue;let re=!1,he=Q,J=this._workCell;if(H.length>0&&Q===H[0][0]){re=!0;let Z=H.shift();J=new o.JoinedCellData(this._workCell,d.translateToString(!0,Z[0],Z[1]),Z[1]-Z[0]),he=Z[1]-1,Y=J.getWidth()}let Ce=this._isCellInSelection(Q,c),Re=v&&Q===D,se=G&&Q>=M&&Q<=B,ee=!1;this._decorationService.forEachDecorationAtCell(Q,c,void 0,(Z=>{ee=!0}));let te=J.getChars()||f.WHITESPACE_CELL_CHAR;if(te===" "&&(J.isUnderline()||J.isOverline())&&(te="\xA0"),U=Y*y-L.get(te,J.isBold(),J.isItalic()),R){if(F&&(Ce&&I||!Ce&&!I&&J.bg===j)&&(Ce&&I&&w.selectionForeground||J.fg===X)&&J.extended.ext===K&&se===W&&U===$&&!Re&&!re&&!ee){J.isInvisible()?z+=f.WHITESPACE_CELL_CHAR:z+=te,F++;continue}F&&(R.textContent=z),R=this._document.createElement("span"),F=0,z=""}else R=this._document.createElement("span");if(j=J.bg,X=J.fg,K=J.extended.ext,W=se,$=U,I=Ce,re&&D>=Q&&D<=he&&(D=Q),!this._coreService.isCursorHidden&&Re&&this._coreService.isCursorInitialized){if(q.push("xterm-cursor"),this._coreBrowserService.isFocused)x&&q.push("xterm-cursor-blink"),q.push(C==="bar"?"xterm-cursor-bar":C==="underline"?"xterm-cursor-underline":"xterm-cursor-block");else if(k)switch(k){case"outline":q.push("xterm-cursor-outline");break;case"block":q.push("xterm-cursor-block");break;case"bar":q.push("xterm-cursor-bar");break;case"underline":q.push("xterm-cursor-underline")}}if(J.isBold()&&q.push("xterm-bold"),J.isItalic()&&q.push("xterm-italic"),J.isDim()&&q.push("xterm-dim"),z=J.isInvisible()?f.WHITESPACE_CELL_CHAR:J.getChars()||f.WHITESPACE_CELL_CHAR,J.isUnderline()&&(q.push(`xterm-underline-${J.extended.underlineStyle}`),z===" "&&(z="\xA0"),!J.isUnderlineColorDefault()))if(J.isUnderlineColorRGB())R.style.textDecorationColor=`rgb(${i.AttributeData.toColorRGB(J.getUnderlineColor()).join(",")})`;else{let Z=J.getUnderlineColor();this._optionsService.rawOptions.drawBoldTextInBrightColors&&J.isBold()&&Z<8&&(Z+=8),R.style.textDecorationColor=w.ansi[Z].css}J.isOverline()&&(q.push("xterm-overline"),z===" "&&(z="\xA0")),J.isStrikethrough()&&q.push("xterm-strikethrough"),se&&(R.style.textDecoration="underline");let V=J.getFgColor(),ie=J.getFgColorMode(),ae=J.getBgColor(),oe=J.getBgColorMode(),Le=!!J.isInverse();if(Le){let Z=V;V=ae,ae=Z;let Oe=ie;ie=oe,oe=Oe}let ue,_e,le,ne=!1;switch(this._decorationService.forEachDecorationAtCell(Q,c,void 0,(Z=>{Z.options.layer!=="top"&&ne||(Z.backgroundColorRGB&&(oe=50331648,ae=Z.backgroundColorRGB.rgba>>8&16777215,ue=Z.backgroundColorRGB),Z.foregroundColorRGB&&(ie=50331648,V=Z.foregroundColorRGB.rgba>>8&16777215,_e=Z.foregroundColorRGB),ne=Z.options.layer==="top")})),!ne&&Ce&&(ue=this._coreBrowserService.isFocused?w.selectionBackgroundOpaque:w.selectionInactiveBackgroundOpaque,ae=ue.rgba>>8&16777215,oe=50331648,ne=!0,w.selectionForeground&&(ie=50331648,V=w.selectionForeground.rgba>>8&16777215,_e=w.selectionForeground)),ne&&q.push("xterm-decoration-top"),oe){case 16777216:case 33554432:le=w.ansi[ae],q.push(`xterm-bg-${ae}`);break;case 50331648:le=r.channels.toColor(ae>>16,ae>>8&255,255&ae),this._addStyle(R,`background-color:#${m((ae>>>0).toString(16),"0",6)}`);break;default:Le?(le=w.foreground,q.push(`xterm-bg-${n.INVERTED_DEFAULT_COLOR}`)):le=w.background}switch(ue||J.isDim()&&(ue=r.color.multiplyOpacity(le,.5)),ie){case 16777216:case 33554432:J.isBold()&&V<8&&this._optionsService.rawOptions.drawBoldTextInBrightColors&&(V+=8),this._applyMinimumContrast(R,le,w.ansi[V],J,ue,void 0)||q.push(`xterm-fg-${V}`);break;case 50331648:let Z=r.channels.toColor(V>>16&255,V>>8&255,255&V);this._applyMinimumContrast(R,le,Z,J,ue,_e)||this._addStyle(R,`color:#${m(V.toString(16),"0",6)}`);break;default:this._applyMinimumContrast(R,le,w.foreground,J,ue,_e)||Le&&q.push(`xterm-fg-${n.INVERTED_DEFAULT_COLOR}`)}q.length&&(q.length=(R.className=q.join(" "),0)),Re||re||ee?R.textContent=z:F++,U!==this.defaultSpacing&&(R.style.letterSpacing=`${U}px`),P.push(R),Q=he}return R&&F&&(R.textContent=z),P}_applyMinimumContrast(d,c,v,C,k,D){if(this._optionsService.rawOptions.minimumContrastRatio===1||(0,s.treatGlyphAsBackgroundColor)(C.getCode()))return!1;let x=this._getContrastCache(C),y;if(k||D||(y=x.getColor(c.rgba,v.rgba)),y===void 0){let L=this._optionsService.rawOptions.minimumContrastRatio/(C.isDim()?2:1);y=r.color.ensureContrastRatio(k||c,D||v,L),x.setColor((k||c).rgba,(D||v).rgba,y??null)}return!!y&&(this._addStyle(d,`color:${y.css}`),!0)}_getContrastCache(d){return d.isDim()?this._themeService.colors.halfContrastCache:this._themeService.colors.contrastCache}_addStyle(d,c){d.setAttribute("style",`${d.getAttribute("style")||""}${c};`)}_isCellInSelection(d,c){let v=this._selectionStart,C=this._selectionEnd;return!(!v||!C)&&(this._columnSelectMode?v[0]<=C[0]?d>=v[0]&&c>=v[1]&&d<C[0]&&c<=C[1]:d<v[0]&&c>=v[1]&&d>=C[0]&&c<=C[1]:c>v[1]&&c<C[1]||v[1]===C[1]&&c===v[1]&&d>=v[0]&&d<C[0]||v[1]<C[1]&&c===C[1]&&d<C[0]||v[1]<C[1]&&c===v[1]&&d>=v[0])}};function m(d,c,v){for(;d.length<v;)d=c+d;return d}t.DomRendererRowFactory=h=l([u(1,e.ICharacterJoinerService),u(2,S.IOptionsService),u(3,e.ICoreBrowserService),u(4,S.ICoreService),u(5,S.IDecorationService),u(6,e.IThemeService)],h)},2550:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WidthCache=void 0,t.WidthCache=class{constructor(a,l){this._flat=new Float32Array(256),this._font="",this._fontSize=0,this._weight="normal",this._weightBold="bold",this._measureElements=[],this._container=a.createElement("div"),this._container.classList.add("xterm-width-cache-measure-container"),this._container.setAttribute("aria-hidden","true"),this._container.style.whiteSpace="pre",this._container.style.fontKerning="none";let u=a.createElement("span");u.classList.add("xterm-char-measure-element");let n=a.createElement("span");n.classList.add("xterm-char-measure-element"),n.style.fontWeight="bold";let f=a.createElement("span");f.classList.add("xterm-char-measure-element"),f.style.fontStyle="italic";let p=a.createElement("span");p.classList.add("xterm-char-measure-element"),p.style.fontWeight="bold",p.style.fontStyle="italic",this._measureElements=[u,n,f,p],this._container.appendChild(u),this._container.appendChild(n),this._container.appendChild(f),this._container.appendChild(p),l.appendChild(this._container),this.clear()}dispose(){this._container.remove(),this._measureElements.length=0,this._holey=void 0}clear(){this._flat.fill(-9999),this._holey=new Map}setFont(a,l,u,n){a===this._font&&l===this._fontSize&&u===this._weight&&n===this._weightBold||(this._font=a,this._fontSize=l,this._weight=u,this._weightBold=n,this._container.style.fontFamily=this._font,this._container.style.fontSize=`${this._fontSize}px`,this._measureElements[0].style.fontWeight=`${u}`,this._measureElements[1].style.fontWeight=`${n}`,this._measureElements[2].style.fontWeight=`${u}`,this._measureElements[3].style.fontWeight=`${n}`,this.clear())}get(a,l,u){let n=0;if(!l&&!u&&a.length===1&&(n=a.charCodeAt(0))<256){if(this._flat[n]!==-9999)return this._flat[n];let S=this._measure(a,0);return S>0&&(this._flat[n]=S),S}let f=a;l&&(f+="B"),u&&(f+="I");let p=this._holey.get(f);if(p===void 0){let S=0;l&&(S|=1),u&&(S|=2),p=this._measure(a,S),p>0&&this._holey.set(f,p)}return p}_measure(a,l){let u=this._measureElements[l];return u.textContent=a.repeat(32),u.offsetWidth/32}}},2223:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.TEXT_BASELINE=t.DIM_OPACITY=t.INVERTED_DEFAULT_COLOR=void 0;let l=a(6114);t.INVERTED_DEFAULT_COLOR=257,t.DIM_OPACITY=.5,t.TEXT_BASELINE=l.isFirefox||l.isLegacyEdge?"bottom":"ideographic"},6171:(A,t)=>{function a(u){return 57508<=u&&u<=57558}function l(u){return u>=128512&&u<=128591||u>=127744&&u<=128511||u>=128640&&u<=128767||u>=9728&&u<=9983||u>=9984&&u<=10175||u>=65024&&u<=65039||u>=129280&&u<=129535||u>=127462&&u<=127487}Object.defineProperty(t,"__esModule",{value:!0}),t.computeNextVariantOffset=t.createRenderDimensions=t.treatGlyphAsBackgroundColor=t.allowRescaling=t.isEmoji=t.isRestrictedPowerlineGlyph=t.isPowerlineGlyph=t.throwIfFalsy=void 0,t.throwIfFalsy=function(u){if(!u)throw Error("value must not be falsy");return u},t.isPowerlineGlyph=a,t.isRestrictedPowerlineGlyph=function(u){return 57520<=u&&u<=57527},t.isEmoji=l,t.allowRescaling=function(u,n,f,p){return n===1&&f>Math.ceil(1.5*p)&&u!==void 0&&u>255&&!l(u)&&!a(u)&&!(function(S){return 57344<=S&&S<=63743})(u)},t.treatGlyphAsBackgroundColor=function(u){return a(u)||(function(n){return 9472<=n&&n<=9631})(u)},t.createRenderDimensions=function(){return{css:{canvas:{width:0,height:0},cell:{width:0,height:0}},device:{canvas:{width:0,height:0},cell:{width:0,height:0},char:{width:0,height:0,left:0,top:0}}}},t.computeNextVariantOffset=function(u,n,f=0){return(u-(2*Math.round(n)-f))%(2*Math.round(n))}},6052:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createSelectionRenderModel=void 0;class a{constructor(){this.clear()}clear(){this.hasSelection=!1,this.columnSelectMode=!1,this.viewportStartRow=0,this.viewportEndRow=0,this.viewportCappedStartRow=0,this.viewportCappedEndRow=0,this.startCol=0,this.endCol=0,this.selectionStart=void 0,this.selectionEnd=void 0}update(u,n,f,p=!1){if(this.selectionStart=n,this.selectionEnd=f,!n||!f||n[0]===f[0]&&n[1]===f[1])return void this.clear();let S=u.buffers.active.ydisp,r=n[1]-S,e=f[1]-S,o=Math.max(r,0),s=Math.min(e,u.rows-1);o>=u.rows||s<0?this.clear():(this.hasSelection=!0,this.columnSelectMode=p,this.viewportStartRow=r,this.viewportEndRow=e,this.viewportCappedStartRow=o,this.viewportCappedEndRow=s,this.startCol=n[0],this.endCol=f[0])}isCellSelected(u,n,f){return!!this.hasSelection&&(f-=u.buffer.active.viewportY,this.columnSelectMode?this.startCol<=this.endCol?n>=this.startCol&&f>=this.viewportCappedStartRow&&n<this.endCol&&f<=this.viewportCappedEndRow:n<this.startCol&&f>=this.viewportCappedStartRow&&n>=this.endCol&&f<=this.viewportCappedEndRow:f>this.viewportStartRow&&f<this.viewportEndRow||this.viewportStartRow===this.viewportEndRow&&f===this.viewportStartRow&&n>=this.startCol&&n<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportEndRow&&n<this.endCol||this.viewportStartRow<this.viewportEndRow&&f===this.viewportStartRow&&n>=this.startCol)}}t.createSelectionRenderModel=function(){return new a}},456:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionModel=void 0,t.SelectionModel=class{constructor(a){this._bufferService=a,this.isSelectAllActive=!1,this.selectionStartLength=0}clearSelection(){this.selectionStart=void 0,this.selectionEnd=void 0,this.isSelectAllActive=!1,this.selectionStartLength=0}get finalSelectionStart(){return this.isSelectAllActive?[0,0]:this.selectionEnd&&this.selectionStart&&this.areSelectionValuesReversed()?this.selectionEnd:this.selectionStart}get finalSelectionEnd(){if(this.isSelectAllActive)return[this._bufferService.cols,this._bufferService.buffer.ybase+this._bufferService.rows-1];if(this.selectionStart){if(!this.selectionEnd||this.areSelectionValuesReversed()){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?a%this._bufferService.cols==0?[this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)-1]:[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[a,this.selectionStart[1]]}if(this.selectionStartLength&&this.selectionEnd[1]===this.selectionStart[1]){let a=this.selectionStart[0]+this.selectionStartLength;return a>this._bufferService.cols?[a%this._bufferService.cols,this.selectionStart[1]+Math.floor(a/this._bufferService.cols)]:[Math.max(a,this.selectionEnd[0]),this.selectionEnd[1]]}return this.selectionEnd}}areSelectionValuesReversed(){let a=this.selectionStart,l=this.selectionEnd;return!(!a||!l)&&(a[1]>l[1]||a[1]===l[1]&&a[0]>l[0])}handleTrim(a){return this.selectionStart&&(this.selectionStart[1]-=a),this.selectionEnd&&(this.selectionEnd[1]-=a),this.selectionEnd&&this.selectionEnd[1]<0?(this.clearSelection(),!0):(this.selectionStart&&this.selectionStart[1]<0&&(this.selectionStart[1]=0),!1)}}},428:function(A,t,a){var l=this&&this.__decorate||function(s,i,h,m){var d,c=arguments.length,v=c<3?i:m===null?m=Object.getOwnPropertyDescriptor(i,h):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,i,h,m);else for(var C=s.length-1;C>=0;C--)(d=s[C])&&(v=(c<3?d(v):c>3?d(i,h,v):d(i,h))||v);return c>3&&v&&Object.defineProperty(i,h,v),v},u=this&&this.__param||function(s,i){return function(h,m){i(h,m,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharSizeService=void 0;let n=a(2585),f=a(8460),p=a(844),S=t.CharSizeService=class extends p.Disposable{get hasValidSize(){return this.width>0&&this.height>0}constructor(s,i,h){super(),this._optionsService=h,this.width=0,this.height=0,this._onCharSizeChange=this.register(new f.EventEmitter),this.onCharSizeChange=this._onCharSizeChange.event;try{this._measureStrategy=this.register(new o(this._optionsService))}catch{this._measureStrategy=this.register(new e(s,i,this._optionsService))}this.register(this._optionsService.onMultipleOptionChange(["fontFamily","fontSize"],(()=>this.measure())))}measure(){let s=this._measureStrategy.measure();s.width===this.width&&s.height===this.height||(this.width=s.width,this.height=s.height,this._onCharSizeChange.fire())}};t.CharSizeService=S=l([u(2,n.IOptionsService)],S);class r extends p.Disposable{constructor(){super(...arguments),this._result={width:0,height:0}}_validateAndSet(i,h){i!==void 0&&i>0&&h!==void 0&&h>0&&(this._result.width=i,this._result.height=h)}}class e extends r{constructor(i,h,m){super(),this._document=i,this._parentElement=h,this._optionsService=m,this._measureElement=this._document.createElement("span"),this._measureElement.classList.add("xterm-char-measure-element"),this._measureElement.textContent="W".repeat(32),this._measureElement.setAttribute("aria-hidden","true"),this._measureElement.style.whiteSpace="pre",this._measureElement.style.fontKerning="none",this._parentElement.appendChild(this._measureElement)}measure(){return this._measureElement.style.fontFamily=this._optionsService.rawOptions.fontFamily,this._measureElement.style.fontSize=`${this._optionsService.rawOptions.fontSize}px`,this._validateAndSet(Number(this._measureElement.offsetWidth)/32,Number(this._measureElement.offsetHeight)),this._result}}class o extends r{constructor(i){super(),this._optionsService=i,this._canvas=new OffscreenCanvas(100,100),this._ctx=this._canvas.getContext("2d");let h=this._ctx.measureText("W");if(!("width"in h&&"fontBoundingBoxAscent"in h&&"fontBoundingBoxDescent"in h))throw Error("Required font metrics not supported")}measure(){this._ctx.font=`${this._optionsService.rawOptions.fontSize}px ${this._optionsService.rawOptions.fontFamily}`;let i=this._ctx.measureText("W");return this._validateAndSet(i.width,i.fontBoundingBoxAscent+i.fontBoundingBoxDescent),this._result}}},4269:function(A,t,a){var l=this&&this.__decorate||function(o,s,i,h){var m,d=arguments.length,c=d<3?s:h===null?h=Object.getOwnPropertyDescriptor(s,i):h;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")c=Reflect.decorate(o,s,i,h);else for(var v=o.length-1;v>=0;v--)(m=o[v])&&(c=(d<3?m(c):d>3?m(s,i,c):m(s,i))||c);return d>3&&c&&Object.defineProperty(s,i,c),c},u=this&&this.__param||function(o,s){return function(i,h){s(i,h,o)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterJoinerService=t.JoinedCellData=void 0;let n=a(3734),f=a(643),p=a(511),S=a(2585);class r extends n.AttributeData{constructor(s,i,h){super(),this.content=0,this.combinedData="",this.fg=s.fg,this.bg=s.bg,this.combinedData=i,this._width=h}isCombined(){return 2097152}getWidth(){return this._width}getChars(){return this.combinedData}getCode(){return 2097151}setFromCharData(s){throw Error("not implemented")}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.JoinedCellData=r;let e=t.CharacterJoinerService=class wi{constructor(s){this._bufferService=s,this._characterJoiners=[],this._nextCharacterJoinerId=0,this._workCell=new p.CellData}register(s){let i={id:this._nextCharacterJoinerId++,handler:s};return this._characterJoiners.push(i),i.id}deregister(s){for(let i=0;i<this._characterJoiners.length;i++)if(this._characterJoiners[i].id===s)return this._characterJoiners.splice(i,1),!0;return!1}getJoinedCharacters(s){if(this._characterJoiners.length===0)return[];let i=this._bufferService.buffer.lines.get(s);if(!i||i.length===0)return[];let h=[],m=i.translateToString(!0),d=0,c=0,v=0,C=i.getFg(0),k=i.getBg(0);for(let D=0;D<i.getTrimmedLength();D++)if(i.loadCell(D,this._workCell),this._workCell.getWidth()!==0){if(this._workCell.fg!==C||this._workCell.bg!==k){if(D-d>1){let x=this._getJoinedRanges(m,v,c,i,d);for(let y=0;y<x.length;y++)h.push(x[y])}d=D,v=c,C=this._workCell.fg,k=this._workCell.bg}c+=this._workCell.getChars().length||f.WHITESPACE_CELL_CHAR.length}if(this._bufferService.cols-d>1){let D=this._getJoinedRanges(m,v,c,i,d);for(let x=0;x<D.length;x++)h.push(D[x])}return h}_getJoinedRanges(s,i,h,m,d){let c=s.substring(i,h),v=[];try{v=this._characterJoiners[0].handler(c)}catch(C){console.error(C)}for(let C=1;C<this._characterJoiners.length;C++)try{let k=this._characterJoiners[C].handler(c);for(let D=0;D<k.length;D++)wi._mergeRanges(v,k[D])}catch(k){console.error(k)}return this._stringRangesToCellRanges(v,m,d),v}_stringRangesToCellRanges(s,i,h){let m=0,d=!1,c=0,v=s[m];if(v){for(let C=h;C<this._bufferService.cols;C++){let k=i.getWidth(C),D=i.getString(C).length||f.WHITESPACE_CELL_CHAR.length;if(k!==0){if(!d&&v[0]<=c&&(v[0]=C,d=!0),v[1]<=c){if(v[1]=C,v=s[++m],!v)break;v[0]<=c?(v[0]=C,d=!0):d=!1}c+=D}}v&&(v[1]=this._bufferService.cols)}}static _mergeRanges(s,i){let h=!1;for(let m=0;m<s.length;m++){let d=s[m];if(h){if(i[1]<=d[0])return s[m-1][1]=i[1],s;if(i[1]<=d[1])return s[m-1][1]=Math.max(i[1],d[1]),s.splice(m,1),s;s.splice(m,1),m--}else{if(i[1]<=d[0])return s.splice(m,0,i),s;if(i[1]<=d[1])return d[0]=Math.min(i[0],d[0]),s;i[0]<d[1]&&(d[0]=Math.min(i[0],d[0]),h=!0)}}return h?s[s.length-1][1]=i[1]:s.push(i),s}};t.CharacterJoinerService=e=l([u(0,S.IBufferService)],e)},5114:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreBrowserService=void 0;let l=a(844),u=a(8460),n=a(3656);class f extends l.Disposable{constructor(r,e,o){super(),this._textarea=r,this._window=e,this.mainDocument=o,this._isFocused=!1,this._cachedIsFocused=void 0,this._screenDprMonitor=new p(this._window),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._onWindowChange=this.register(new u.EventEmitter),this.onWindowChange=this._onWindowChange.event,this.register(this.onWindowChange((s=>this._screenDprMonitor.setWindow(s)))),this.register((0,u.forwardEvent)(this._screenDprMonitor.onDprChange,this._onDprChange)),this._textarea.addEventListener("focus",(()=>this._isFocused=!0)),this._textarea.addEventListener("blur",(()=>this._isFocused=!1))}get window(){return this._window}set window(r){this._window!==r&&(this._window=r,this._onWindowChange.fire(this._window))}get dpr(){return this.window.devicePixelRatio}get isFocused(){return this._cachedIsFocused===void 0&&(this._cachedIsFocused=this._isFocused&&this._textarea.ownerDocument.hasFocus(),queueMicrotask((()=>this._cachedIsFocused=void 0))),this._cachedIsFocused}}t.CoreBrowserService=f;class p extends l.Disposable{constructor(r){super(),this._parentWindow=r,this._windowResizeListener=this.register(new l.MutableDisposable),this._onDprChange=this.register(new u.EventEmitter),this.onDprChange=this._onDprChange.event,this._outerListener=()=>this._setDprAndFireIfDiffers(),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._updateDpr(),this._setWindowResizeListener(),this.register((0,l.toDisposable)((()=>this.clearListener())))}setWindow(r){this._parentWindow=r,this._setWindowResizeListener(),this._setDprAndFireIfDiffers()}_setWindowResizeListener(){this._windowResizeListener.value=(0,n.addDisposableDomListener)(this._parentWindow,"resize",(()=>this._setDprAndFireIfDiffers()))}_setDprAndFireIfDiffers(){this._parentWindow.devicePixelRatio!==this._currentDevicePixelRatio&&this._onDprChange.fire(this._parentWindow.devicePixelRatio),this._updateDpr()}_updateDpr(){var r;this._outerListener&&((r=this._resolutionMediaMatchList)==null||r.removeListener(this._outerListener),this._currentDevicePixelRatio=this._parentWindow.devicePixelRatio,this._resolutionMediaMatchList=this._parentWindow.matchMedia(`screen and (resolution: ${this._parentWindow.devicePixelRatio}dppx)`),this._resolutionMediaMatchList.addListener(this._outerListener))}clearListener(){this._resolutionMediaMatchList&&this._outerListener&&(this._resolutionMediaMatchList.removeListener(this._outerListener),this._resolutionMediaMatchList=void 0,this._outerListener=void 0)}}},779:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.LinkProviderService=void 0;let l=a(844);class u extends l.Disposable{constructor(){super(),this.linkProviders=[],this.register((0,l.toDisposable)((()=>this.linkProviders.length=0)))}registerLinkProvider(f){return this.linkProviders.push(f),{dispose:()=>{let p=this.linkProviders.indexOf(f);p!==-1&&this.linkProviders.splice(p,1)}}}}t.LinkProviderService=u},8934:function(A,t,a){var l=this&&this.__decorate||function(S,r,e,o){var s,i=arguments.length,h=i<3?r:o===null?o=Object.getOwnPropertyDescriptor(r,e):o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")h=Reflect.decorate(S,r,e,o);else for(var m=S.length-1;m>=0;m--)(s=S[m])&&(h=(i<3?s(h):i>3?s(r,e,h):s(r,e))||h);return i>3&&h&&Object.defineProperty(r,e,h),h},u=this&&this.__param||function(S,r){return function(e,o){r(e,o,S)}};Object.defineProperty(t,"__esModule",{value:!0}),t.MouseService=void 0;let n=a(4725),f=a(9806),p=t.MouseService=class{constructor(S,r){this._renderService=S,this._charSizeService=r}getCoords(S,r,e,o,s){return(0,f.getCoords)(window,S,r,e,o,this._charSizeService.hasValidSize,this._renderService.dimensions.css.cell.width,this._renderService.dimensions.css.cell.height,s)}getMouseReportCoords(S,r){let e=(0,f.getCoordsRelativeToElement)(window,S,r);if(this._charSizeService.hasValidSize)return e[0]=Math.min(Math.max(e[0],0),this._renderService.dimensions.css.canvas.width-1),e[1]=Math.min(Math.max(e[1],0),this._renderService.dimensions.css.canvas.height-1),{col:Math.floor(e[0]/this._renderService.dimensions.css.cell.width),row:Math.floor(e[1]/this._renderService.dimensions.css.cell.height),x:Math.floor(e[0]),y:Math.floor(e[1])}}};t.MouseService=p=l([u(0,n.IRenderService),u(1,n.ICharSizeService)],p)},3230:function(A,t,a){var l=this&&this.__decorate||function(s,i,h,m){var d,c=arguments.length,v=c<3?i:m===null?m=Object.getOwnPropertyDescriptor(i,h):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,i,h,m);else for(var C=s.length-1;C>=0;C--)(d=s[C])&&(v=(c<3?d(v):c>3?d(i,h,v):d(i,h))||v);return c>3&&v&&Object.defineProperty(i,h,v),v},u=this&&this.__param||function(s,i){return function(h,m){i(h,m,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.RenderService=void 0;let n=a(6193),f=a(4725),p=a(8460),S=a(844),r=a(7226),e=a(2585),o=t.RenderService=class extends S.Disposable{get dimensions(){return this._renderer.value.dimensions}constructor(s,i,h,m,d,c,v,C){super(),this._rowCount=s,this._charSizeService=m,this._renderer=this.register(new S.MutableDisposable),this._pausedResizeTask=new r.DebouncedIdleTask,this._observerDisposable=this.register(new S.MutableDisposable),this._isPaused=!1,this._needsFullRefresh=!1,this._isNextRenderRedrawOnly=!0,this._needsSelectionRefresh=!1,this._canvasWidth=0,this._canvasHeight=0,this._selectionState={start:void 0,end:void 0,columnSelectMode:!1},this._onDimensionsChange=this.register(new p.EventEmitter),this.onDimensionsChange=this._onDimensionsChange.event,this._onRenderedViewportChange=this.register(new p.EventEmitter),this.onRenderedViewportChange=this._onRenderedViewportChange.event,this._onRender=this.register(new p.EventEmitter),this.onRender=this._onRender.event,this._onRefreshRequest=this.register(new p.EventEmitter),this.onRefreshRequest=this._onRefreshRequest.event,this._renderDebouncer=new n.RenderDebouncer(((k,D)=>this._renderRows(k,D)),v),this.register(this._renderDebouncer),this.register(v.onDprChange((()=>this.handleDevicePixelRatioChange()))),this.register(c.onResize((()=>this._fullRefresh()))),this.register(c.buffers.onBufferActivate((()=>{var k;return(k=this._renderer.value)==null?void 0:k.clear()}))),this.register(h.onOptionChange((()=>this._handleOptionsChanged()))),this.register(this._charSizeService.onCharSizeChange((()=>this.handleCharSizeChanged()))),this.register(d.onDecorationRegistered((()=>this._fullRefresh()))),this.register(d.onDecorationRemoved((()=>this._fullRefresh()))),this.register(h.onMultipleOptionChange(["customGlyphs","drawBoldTextInBrightColors","letterSpacing","lineHeight","fontFamily","fontSize","fontWeight","fontWeightBold","minimumContrastRatio","rescaleOverlappingGlyphs"],(()=>{this.clear(),this.handleResize(c.cols,c.rows),this._fullRefresh()}))),this.register(h.onMultipleOptionChange(["cursorBlink","cursorStyle"],(()=>this.refreshRows(c.buffer.y,c.buffer.y,!0)))),this.register(C.onChangeColors((()=>this._fullRefresh()))),this._registerIntersectionObserver(v.window,i),this.register(v.onWindowChange((k=>this._registerIntersectionObserver(k,i))))}_registerIntersectionObserver(s,i){if("IntersectionObserver"in s){let h=new s.IntersectionObserver((m=>this._handleIntersectionChange(m[m.length-1])),{threshold:0});h.observe(i),this._observerDisposable.value=(0,S.toDisposable)((()=>h.disconnect()))}}_handleIntersectionChange(s){this._isPaused=s.isIntersecting===void 0?s.intersectionRatio===0:!s.isIntersecting,this._isPaused||this._charSizeService.hasValidSize||this._charSizeService.measure(),!this._isPaused&&this._needsFullRefresh&&(this._pausedResizeTask.flush(),this.refreshRows(0,this._rowCount-1),this._needsFullRefresh=!1)}refreshRows(s,i,h=!1){this._isPaused?this._needsFullRefresh=!0:(h||(this._isNextRenderRedrawOnly=!1),this._renderDebouncer.refresh(s,i,this._rowCount))}_renderRows(s,i){this._renderer.value&&(s=Math.min(s,this._rowCount-1),i=Math.min(i,this._rowCount-1),this._renderer.value.renderRows(s,i),this._needsSelectionRefresh&&(this._needsSelectionRefresh=(this._renderer.value.handleSelectionChanged(this._selectionState.start,this._selectionState.end,this._selectionState.columnSelectMode),!1)),this._isNextRenderRedrawOnly||this._onRenderedViewportChange.fire({start:s,end:i}),this._onRender.fire({start:s,end:i}),this._isNextRenderRedrawOnly=!0)}resize(s,i){this._rowCount=i,this._fireOnCanvasResize()}_handleOptionsChanged(){this._renderer.value&&(this.refreshRows(0,this._rowCount-1),this._fireOnCanvasResize())}_fireOnCanvasResize(){this._renderer.value&&(this._renderer.value.dimensions.css.canvas.width===this._canvasWidth&&this._renderer.value.dimensions.css.canvas.height===this._canvasHeight||this._onDimensionsChange.fire(this._renderer.value.dimensions))}hasRenderer(){return!!this._renderer.value}setRenderer(s){this._renderer.value=s,this._renderer.value&&(this._renderer.value.onRequestRedraw((i=>this.refreshRows(i.start,i.end,!0))),this._needsSelectionRefresh=!0,this._fullRefresh())}addRefreshCallback(s){return this._renderDebouncer.addRefreshCallback(s)}_fullRefresh(){this._isPaused?this._needsFullRefresh=!0:this.refreshRows(0,this._rowCount-1)}clearTextureAtlas(){var s,i;this._renderer.value&&((i=(s=this._renderer.value).clearTextureAtlas)==null||i.call(s),this._fullRefresh())}handleDevicePixelRatioChange(){this._charSizeService.measure(),this._renderer.value&&(this._renderer.value.handleDevicePixelRatioChange(),this.refreshRows(0,this._rowCount-1))}handleResize(s,i){this._renderer.value&&(this._isPaused?this._pausedResizeTask.set((()=>{var h;return(h=this._renderer.value)==null?void 0:h.handleResize(s,i)})):this._renderer.value.handleResize(s,i),this._fullRefresh())}handleCharSizeChanged(){var s;(s=this._renderer.value)==null||s.handleCharSizeChanged()}handleBlur(){var s;(s=this._renderer.value)==null||s.handleBlur()}handleFocus(){var s;(s=this._renderer.value)==null||s.handleFocus()}handleSelectionChanged(s,i,h){var m;this._selectionState.start=s,this._selectionState.end=i,this._selectionState.columnSelectMode=h,(m=this._renderer.value)==null||m.handleSelectionChanged(s,i,h)}handleCursorMove(){var s;(s=this._renderer.value)==null||s.handleCursorMove()}clear(){var s;(s=this._renderer.value)==null||s.clear()}};t.RenderService=o=l([u(2,e.IOptionsService),u(3,f.ICharSizeService),u(4,e.IDecorationService),u(5,e.IBufferService),u(6,f.ICoreBrowserService),u(7,f.IThemeService)],o)},9312:function(A,t,a){var l=this&&this.__decorate||function(c,v,C,k){var D,x=arguments.length,y=x<3?v:k===null?k=Object.getOwnPropertyDescriptor(v,C):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(c,v,C,k);else for(var L=c.length-1;L>=0;L--)(D=c[L])&&(y=(x<3?D(y):x>3?D(v,C,y):D(v,C))||y);return x>3&&y&&Object.defineProperty(v,C,y),y},u=this&&this.__param||function(c,v){return function(C,k){v(C,k,c)}};Object.defineProperty(t,"__esModule",{value:!0}),t.SelectionService=void 0;let n=a(9806),f=a(9504),p=a(456),S=a(4725),r=a(8460),e=a(844),o=a(6114),s=a(4841),i=a(511),h=a(2585),m=RegExp("\xA0","g"),d=t.SelectionService=class extends e.Disposable{constructor(c,v,C,k,D,x,y,L,M){super(),this._element=c,this._screenElement=v,this._linkifier=C,this._bufferService=k,this._coreService=D,this._mouseService=x,this._optionsService=y,this._renderService=L,this._coreBrowserService=M,this._dragScrollAmount=0,this._enabled=!0,this._workCell=new i.CellData,this._mouseDownTimeStamp=0,this._oldHasSelection=!1,this._oldSelectionStart=void 0,this._oldSelectionEnd=void 0,this._onLinuxMouseSelection=this.register(new r.EventEmitter),this.onLinuxMouseSelection=this._onLinuxMouseSelection.event,this._onRedrawRequest=this.register(new r.EventEmitter),this.onRequestRedraw=this._onRedrawRequest.event,this._onSelectionChange=this.register(new r.EventEmitter),this.onSelectionChange=this._onSelectionChange.event,this._onRequestScrollLines=this.register(new r.EventEmitter),this.onRequestScrollLines=this._onRequestScrollLines.event,this._mouseMoveListener=B=>this._handleMouseMove(B),this._mouseUpListener=B=>this._handleMouseUp(B),this._coreService.onUserInput((()=>{this.hasSelection&&this.clearSelection()})),this._trimListener=this._bufferService.buffer.lines.onTrim((B=>this._handleTrim(B))),this.register(this._bufferService.buffers.onBufferActivate((B=>this._handleBufferActivate(B)))),this.enable(),this._model=new p.SelectionModel(this._bufferService),this._activeSelectionMode=0,this.register((0,e.toDisposable)((()=>{this._removeMouseDownListeners()})))}reset(){this.clearSelection()}disable(){this.clearSelection(),this._enabled=!1}enable(){this._enabled=!0}get selectionStart(){return this._model.finalSelectionStart}get selectionEnd(){return this._model.finalSelectionEnd}get hasSelection(){let c=this._model.finalSelectionStart,v=this._model.finalSelectionEnd;return!(!c||!v||c[0]===v[0]&&c[1]===v[1])}get selectionText(){let c=this._model.finalSelectionStart,v=this._model.finalSelectionEnd;if(!c||!v)return"";let C=this._bufferService.buffer,k=[];if(this._activeSelectionMode===3){if(c[0]===v[0])return"";let D=c[0]<v[0]?c[0]:v[0],x=c[0]<v[0]?v[0]:c[0];for(let y=c[1];y<=v[1];y++){let L=C.translateBufferLineToString(y,!0,D,x);k.push(L)}}else{let D=c[1]===v[1]?v[0]:void 0;k.push(C.translateBufferLineToString(c[1],!0,c[0],D));for(let x=c[1]+1;x<=v[1]-1;x++){let y=C.lines.get(x),L=C.translateBufferLineToString(x,!0);y!=null&&y.isWrapped?k[k.length-1]+=L:k.push(L)}if(c[1]!==v[1]){let x=C.lines.get(v[1]),y=C.translateBufferLineToString(v[1],!0,0,v[0]);x&&x.isWrapped?k[k.length-1]+=y:k.push(y)}}return k.map((D=>D.replace(m," "))).join(o.isWindows?`\r
`:`
`)}clearSelection(){this._model.clearSelection(),this._removeMouseDownListeners(),this.refresh(),this._onSelectionChange.fire()}refresh(c){this._refreshAnimationFrame||(this._refreshAnimationFrame=this._coreBrowserService.window.requestAnimationFrame((()=>this._refresh()))),o.isLinux&&c&&this.selectionText.length&&this._onLinuxMouseSelection.fire(this.selectionText)}_refresh(){this._refreshAnimationFrame=void 0,this._onRedrawRequest.fire({start:this._model.finalSelectionStart,end:this._model.finalSelectionEnd,columnSelectMode:this._activeSelectionMode===3})}_isClickInSelection(c){let v=this._getMouseBufferCoords(c),C=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!!(C&&k&&v)&&this._areCoordsInSelection(v,C,k)}isCellInSelection(c,v){let C=this._model.finalSelectionStart,k=this._model.finalSelectionEnd;return!(!C||!k)&&this._areCoordsInSelection([c,v],C,k)}_areCoordsInSelection(c,v,C){return c[1]>v[1]&&c[1]<C[1]||v[1]===C[1]&&c[1]===v[1]&&c[0]>=v[0]&&c[0]<C[0]||v[1]<C[1]&&c[1]===C[1]&&c[0]<C[0]||v[1]<C[1]&&c[1]===v[1]&&c[0]>=v[0]}_selectWordAtCursor(c,v){var D,x;let C=(x=(D=this._linkifier.currentLink)==null?void 0:D.link)==null?void 0:x.range;if(C)return this._model.selectionStart=[C.start.x-1,C.start.y-1],this._model.selectionStartLength=(0,s.getRangeLength)(C,this._bufferService.cols),this._model.selectionEnd=void 0,!0;let k=this._getMouseBufferCoords(c);return!!k&&(this._selectWordAt(k,v),this._model.selectionEnd=void 0,!0)}selectAll(){this._model.isSelectAllActive=!0,this.refresh(),this._onSelectionChange.fire()}selectLines(c,v){this._model.clearSelection(),c=Math.max(c,0),v=Math.min(v,this._bufferService.buffer.lines.length-1),this._model.selectionStart=[0,c],this._model.selectionEnd=[this._bufferService.cols,v],this.refresh(),this._onSelectionChange.fire()}_handleTrim(c){this._model.handleTrim(c)&&this.refresh()}_getMouseBufferCoords(c){let v=this._mouseService.getCoords(c,this._screenElement,this._bufferService.cols,this._bufferService.rows,!0);if(v)return v[0]--,v[1]--,v[1]+=this._bufferService.buffer.ydisp,v}_getMouseEventScrollAmount(c){let v=(0,n.getCoordsRelativeToElement)(this._coreBrowserService.window,c,this._screenElement)[1],C=this._renderService.dimensions.css.canvas.height;return v>=0&&v<=C?0:(v>C&&(v-=C),v=Math.min(Math.max(v,-50),50),v/=50,v/Math.abs(v)+Math.round(14*v))}shouldForceSelection(c){return o.isMac?c.altKey&&this._optionsService.rawOptions.macOptionClickForcesSelection:c.shiftKey}handleMouseDown(c){if(this._mouseDownTimeStamp=c.timeStamp,(c.button!==2||!this.hasSelection)&&c.button===0){if(!this._enabled){if(!this.shouldForceSelection(c))return;c.stopPropagation()}c.preventDefault(),this._dragScrollAmount=0,this._enabled&&c.shiftKey?this._handleIncrementalClick(c):c.detail===1?this._handleSingleClick(c):c.detail===2?this._handleDoubleClick(c):c.detail===3&&this._handleTripleClick(c),this._addMouseDownListeners(),this.refresh(!0)}}_addMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.addEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.addEventListener("mouseup",this._mouseUpListener)),this._dragScrollIntervalTimer=this._coreBrowserService.window.setInterval((()=>this._dragScroll()),50)}_removeMouseDownListeners(){this._screenElement.ownerDocument&&(this._screenElement.ownerDocument.removeEventListener("mousemove",this._mouseMoveListener),this._screenElement.ownerDocument.removeEventListener("mouseup",this._mouseUpListener)),this._coreBrowserService.window.clearInterval(this._dragScrollIntervalTimer),this._dragScrollIntervalTimer=void 0}_handleIncrementalClick(c){this._model.selectionStart&&(this._model.selectionEnd=this._getMouseBufferCoords(c))}_handleSingleClick(c){if(this._model.selectionStartLength=0,this._model.isSelectAllActive=!1,this._activeSelectionMode=this.shouldColumnSelect(c)?3:0,this._model.selectionStart=this._getMouseBufferCoords(c),!this._model.selectionStart)return;this._model.selectionEnd=void 0;let v=this._bufferService.buffer.lines.get(this._model.selectionStart[1]);v&&v.length!==this._model.selectionStart[0]&&v.hasWidth(this._model.selectionStart[0])===0&&this._model.selectionStart[0]++}_handleDoubleClick(c){this._selectWordAtCursor(c,!0)&&(this._activeSelectionMode=1)}_handleTripleClick(c){let v=this._getMouseBufferCoords(c);v&&(this._activeSelectionMode=2,this._selectLineAt(v[1]))}shouldColumnSelect(c){return c.altKey&&!(o.isMac&&this._optionsService.rawOptions.macOptionClickForcesSelection)}_handleMouseMove(c){if(c.stopImmediatePropagation(),!this._model.selectionStart)return;let v=this._model.selectionEnd?[this._model.selectionEnd[0],this._model.selectionEnd[1]]:null;if(this._model.selectionEnd=this._getMouseBufferCoords(c),!this._model.selectionEnd)return void this.refresh(!0);this._activeSelectionMode===2?this._model.selectionEnd[1]<this._model.selectionStart[1]?this._model.selectionEnd[0]=0:this._model.selectionEnd[0]=this._bufferService.cols:this._activeSelectionMode===1&&this._selectToWordAt(this._model.selectionEnd),this._dragScrollAmount=this._getMouseEventScrollAmount(c),this._activeSelectionMode!==3&&(this._dragScrollAmount>0?this._model.selectionEnd[0]=this._bufferService.cols:this._dragScrollAmount<0&&(this._model.selectionEnd[0]=0));let C=this._bufferService.buffer;if(this._model.selectionEnd[1]<C.lines.length){let k=C.lines.get(this._model.selectionEnd[1]);k&&k.hasWidth(this._model.selectionEnd[0])===0&&this._model.selectionEnd[0]<this._bufferService.cols&&this._model.selectionEnd[0]++}v&&v[0]===this._model.selectionEnd[0]&&v[1]===this._model.selectionEnd[1]||this.refresh(!0)}_dragScroll(){if(this._model.selectionEnd&&this._model.selectionStart&&this._dragScrollAmount){this._onRequestScrollLines.fire({amount:this._dragScrollAmount,suppressScrollEvent:!1});let c=this._bufferService.buffer;this._dragScrollAmount>0?(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=this._bufferService.cols),this._model.selectionEnd[1]=Math.min(c.ydisp+this._bufferService.rows,c.lines.length-1)):(this._activeSelectionMode!==3&&(this._model.selectionEnd[0]=0),this._model.selectionEnd[1]=c.ydisp),this.refresh()}}_handleMouseUp(c){let v=c.timeStamp-this._mouseDownTimeStamp;if(this._removeMouseDownListeners(),this.selectionText.length<=1&&v<500&&c.altKey&&this._optionsService.rawOptions.altClickMovesCursor){if(this._bufferService.buffer.ybase===this._bufferService.buffer.ydisp){let C=this._mouseService.getCoords(c,this._element,this._bufferService.cols,this._bufferService.rows,!1);if(C&&C[0]!==void 0&&C[1]!==void 0){let k=(0,f.moveToCellSequence)(C[0]-1,C[1]-1,this._bufferService,this._coreService.decPrivateModes.applicationCursorKeys);this._coreService.triggerDataEvent(k,!0)}}}else this._fireEventIfSelectionChanged()}_fireEventIfSelectionChanged(){let c=this._model.finalSelectionStart,v=this._model.finalSelectionEnd,C=!(!c||!v||c[0]===v[0]&&c[1]===v[1]);C?c&&v&&(this._oldSelectionStart&&this._oldSelectionEnd&&c[0]===this._oldSelectionStart[0]&&c[1]===this._oldSelectionStart[1]&&v[0]===this._oldSelectionEnd[0]&&v[1]===this._oldSelectionEnd[1]||this._fireOnSelectionChange(c,v,C)):this._oldHasSelection&&this._fireOnSelectionChange(c,v,C)}_fireOnSelectionChange(c,v,C){this._oldSelectionStart=c,this._oldSelectionEnd=v,this._oldHasSelection=C,this._onSelectionChange.fire()}_handleBufferActivate(c){this.clearSelection(),this._trimListener.dispose(),this._trimListener=c.activeBuffer.lines.onTrim((v=>this._handleTrim(v)))}_convertViewportColToCharacterIndex(c,v){let C=v;for(let k=0;v>=k;k++){let D=c.loadCell(k,this._workCell).getChars().length;this._workCell.getWidth()===0?C--:D>1&&v!==k&&(C+=D-1)}return C}setSelection(c,v,C){this._model.clearSelection(),this._removeMouseDownListeners(),this._model.selectionStart=[c,v],this._model.selectionStartLength=C,this.refresh(),this._fireEventIfSelectionChanged()}rightClickSelect(c){this._isClickInSelection(c)||(this._selectWordAtCursor(c,!1)&&this.refresh(!0),this._fireEventIfSelectionChanged())}_getWordAt(c,v,C=!0,k=!0){if(c[0]>=this._bufferService.cols)return;let D=this._bufferService.buffer,x=D.lines.get(c[1]);if(!x)return;let y=D.translateBufferLineToString(c[1],!1),L=this._convertViewportColToCharacterIndex(x,c[0]),M=L,B=c[0]-L,P=0,H=0,w=0,R=0;if(y.charAt(L)===" "){for(;L>0&&y.charAt(L-1)===" ";)L--;for(;M<y.length&&y.charAt(M+1)===" ";)M++}else{let z=c[0],j=c[0];x.getWidth(z)===0&&(P++,z--),x.getWidth(j)===2&&(H++,j++);let X=x.getString(j).length;for(X>1&&(R+=X-1,M+=X-1);z>0&&L>0&&!this._isCharWordSeparator(x.loadCell(z-1,this._workCell));){x.loadCell(z-1,this._workCell);let K=this._workCell.getChars().length;this._workCell.getWidth()===0?(P++,z--):K>1&&(w+=K-1,L-=K-1),L--,z--}for(;j<x.length&&M+1<y.length&&!this._isCharWordSeparator(x.loadCell(j+1,this._workCell));){x.loadCell(j+1,this._workCell);let K=this._workCell.getChars().length;this._workCell.getWidth()===2?(H++,j++):K>1&&(R+=K-1,M+=K-1),M++,j++}}M++;let O=L+B-P+w,F=Math.min(this._bufferService.cols,M-L+P+H-w-R);if(v||y.slice(L,M).trim()!==""){if(C&&O===0&&x.getCodePoint(0)!==32){let z=D.lines.get(c[1]-1);if(z&&x.isWrapped&&z.getCodePoint(this._bufferService.cols-1)!==32){let j=this._getWordAt([this._bufferService.cols-1,c[1]-1],!1,!0,!1);if(j){let X=this._bufferService.cols-j.start;O-=X,F+=X}}}if(k&&O+F===this._bufferService.cols&&x.getCodePoint(this._bufferService.cols-1)!==32){let z=D.lines.get(c[1]+1);if(z!=null&&z.isWrapped&&z.getCodePoint(0)!==32){let j=this._getWordAt([0,c[1]+1],!1,!1,!0);j&&(F+=j.length)}}return{start:O,length:F}}}_selectWordAt(c,v){let C=this._getWordAt(c,v);if(C){for(;C.start<0;)C.start+=this._bufferService.cols,c[1]--;this._model.selectionStart=[C.start,c[1]],this._model.selectionStartLength=C.length}}_selectToWordAt(c){let v=this._getWordAt(c,!0);if(v){let C=c[1];for(;v.start<0;)v.start+=this._bufferService.cols,C--;if(!this._model.areSelectionValuesReversed())for(;v.start+v.length>this._bufferService.cols;)v.length-=this._bufferService.cols,C++;this._model.selectionEnd=[this._model.areSelectionValuesReversed()?v.start:v.start+v.length,C]}}_isCharWordSeparator(c){return c.getWidth()!==0&&this._optionsService.rawOptions.wordSeparator.indexOf(c.getChars())>=0}_selectLineAt(c){let v=this._bufferService.buffer.getWrappedRangeForLine(c),C={start:{x:0,y:v.first},end:{x:this._bufferService.cols-1,y:v.last}};this._model.selectionStart=[0,v.first],this._model.selectionEnd=void 0,this._model.selectionStartLength=(0,s.getRangeLength)(C,this._bufferService.cols)}};t.SelectionService=d=l([u(3,h.IBufferService),u(4,h.ICoreService),u(5,S.IMouseService),u(6,h.IOptionsService),u(7,S.IRenderService),u(8,S.ICoreBrowserService)],d)},4725:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ILinkProviderService=t.IThemeService=t.ICharacterJoinerService=t.ISelectionService=t.IRenderService=t.IMouseService=t.ICoreBrowserService=t.ICharSizeService=void 0;let l=a(8343);t.ICharSizeService=(0,l.createDecorator)("CharSizeService"),t.ICoreBrowserService=(0,l.createDecorator)("CoreBrowserService"),t.IMouseService=(0,l.createDecorator)("MouseService"),t.IRenderService=(0,l.createDecorator)("RenderService"),t.ISelectionService=(0,l.createDecorator)("SelectionService"),t.ICharacterJoinerService=(0,l.createDecorator)("CharacterJoinerService"),t.IThemeService=(0,l.createDecorator)("ThemeService"),t.ILinkProviderService=(0,l.createDecorator)("LinkProviderService")},6731:function(A,t,a){var l=this&&this.__decorate||function(c,v,C,k){var D,x=arguments.length,y=x<3?v:k===null?k=Object.getOwnPropertyDescriptor(v,C):k;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")y=Reflect.decorate(c,v,C,k);else for(var L=c.length-1;L>=0;L--)(D=c[L])&&(y=(x<3?D(y):x>3?D(v,C,y):D(v,C))||y);return x>3&&y&&Object.defineProperty(v,C,y),y},u=this&&this.__param||function(c,v){return function(C,k){v(C,k,c)}};Object.defineProperty(t,"__esModule",{value:!0}),t.ThemeService=t.DEFAULT_ANSI_COLORS=void 0;let n=a(7239),f=a(8055),p=a(8460),S=a(844),r=a(2585),e=f.css.toColor("#ffffff"),o=f.css.toColor("#000000"),s=f.css.toColor("#ffffff"),i=f.css.toColor("#000000"),h={css:"rgba(255, 255, 255, 0.3)",rgba:4294967117};t.DEFAULT_ANSI_COLORS=Object.freeze((()=>{let c=[f.css.toColor("#2e3436"),f.css.toColor("#cc0000"),f.css.toColor("#4e9a06"),f.css.toColor("#c4a000"),f.css.toColor("#3465a4"),f.css.toColor("#75507b"),f.css.toColor("#06989a"),f.css.toColor("#d3d7cf"),f.css.toColor("#555753"),f.css.toColor("#ef2929"),f.css.toColor("#8ae234"),f.css.toColor("#fce94f"),f.css.toColor("#729fcf"),f.css.toColor("#ad7fa8"),f.css.toColor("#34e2e2"),f.css.toColor("#eeeeec")],v=[0,95,135,175,215,255];for(let C=0;C<216;C++){let k=v[C/36%6|0],D=v[C/6%6|0],x=v[C%6];c.push({css:f.channels.toCss(k,D,x),rgba:f.channels.toRgba(k,D,x)})}for(let C=0;C<24;C++){let k=8+10*C;c.push({css:f.channels.toCss(k,k,k),rgba:f.channels.toRgba(k,k,k)})}return c})());let m=t.ThemeService=class extends S.Disposable{get colors(){return this._colors}constructor(c){super(),this._optionsService=c,this._contrastCache=new n.ColorContrastCache,this._halfContrastCache=new n.ColorContrastCache,this._onChangeColors=this.register(new p.EventEmitter),this.onChangeColors=this._onChangeColors.event,this._colors={foreground:e,background:o,cursor:s,cursorAccent:i,selectionForeground:void 0,selectionBackgroundTransparent:h,selectionBackgroundOpaque:f.color.blend(o,h),selectionInactiveBackgroundTransparent:h,selectionInactiveBackgroundOpaque:f.color.blend(o,h),ansi:t.DEFAULT_ANSI_COLORS.slice(),contrastCache:this._contrastCache,halfContrastCache:this._halfContrastCache},this._updateRestoreColors(),this._setTheme(this._optionsService.rawOptions.theme),this.register(this._optionsService.onSpecificOptionChange("minimumContrastRatio",(()=>this._contrastCache.clear()))),this.register(this._optionsService.onSpecificOptionChange("theme",(()=>this._setTheme(this._optionsService.rawOptions.theme))))}_setTheme(c={}){let v=this._colors;if(v.foreground=d(c.foreground,e),v.background=d(c.background,o),v.cursor=d(c.cursor,s),v.cursorAccent=d(c.cursorAccent,i),v.selectionBackgroundTransparent=d(c.selectionBackground,h),v.selectionBackgroundOpaque=f.color.blend(v.background,v.selectionBackgroundTransparent),v.selectionInactiveBackgroundTransparent=d(c.selectionInactiveBackground,v.selectionBackgroundTransparent),v.selectionInactiveBackgroundOpaque=f.color.blend(v.background,v.selectionInactiveBackgroundTransparent),v.selectionForeground=c.selectionForeground?d(c.selectionForeground,f.NULL_COLOR):void 0,v.selectionForeground===f.NULL_COLOR&&(v.selectionForeground=void 0),f.color.isOpaque(v.selectionBackgroundTransparent)&&(v.selectionBackgroundTransparent=f.color.opacity(v.selectionBackgroundTransparent,.3)),f.color.isOpaque(v.selectionInactiveBackgroundTransparent)&&(v.selectionInactiveBackgroundTransparent=f.color.opacity(v.selectionInactiveBackgroundTransparent,.3)),v.ansi=t.DEFAULT_ANSI_COLORS.slice(),v.ansi[0]=d(c.black,t.DEFAULT_ANSI_COLORS[0]),v.ansi[1]=d(c.red,t.DEFAULT_ANSI_COLORS[1]),v.ansi[2]=d(c.green,t.DEFAULT_ANSI_COLORS[2]),v.ansi[3]=d(c.yellow,t.DEFAULT_ANSI_COLORS[3]),v.ansi[4]=d(c.blue,t.DEFAULT_ANSI_COLORS[4]),v.ansi[5]=d(c.magenta,t.DEFAULT_ANSI_COLORS[5]),v.ansi[6]=d(c.cyan,t.DEFAULT_ANSI_COLORS[6]),v.ansi[7]=d(c.white,t.DEFAULT_ANSI_COLORS[7]),v.ansi[8]=d(c.brightBlack,t.DEFAULT_ANSI_COLORS[8]),v.ansi[9]=d(c.brightRed,t.DEFAULT_ANSI_COLORS[9]),v.ansi[10]=d(c.brightGreen,t.DEFAULT_ANSI_COLORS[10]),v.ansi[11]=d(c.brightYellow,t.DEFAULT_ANSI_COLORS[11]),v.ansi[12]=d(c.brightBlue,t.DEFAULT_ANSI_COLORS[12]),v.ansi[13]=d(c.brightMagenta,t.DEFAULT_ANSI_COLORS[13]),v.ansi[14]=d(c.brightCyan,t.DEFAULT_ANSI_COLORS[14]),v.ansi[15]=d(c.brightWhite,t.DEFAULT_ANSI_COLORS[15]),c.extendedAnsi){let C=Math.min(v.ansi.length-16,c.extendedAnsi.length);for(let k=0;k<C;k++)v.ansi[k+16]=d(c.extendedAnsi[k],t.DEFAULT_ANSI_COLORS[k+16])}this._contrastCache.clear(),this._halfContrastCache.clear(),this._updateRestoreColors(),this._onChangeColors.fire(this.colors)}restoreColor(c){this._restoreColor(c),this._onChangeColors.fire(this.colors)}_restoreColor(c){if(c!==void 0)switch(c){case 256:this._colors.foreground=this._restoreColors.foreground;break;case 257:this._colors.background=this._restoreColors.background;break;case 258:this._colors.cursor=this._restoreColors.cursor;break;default:this._colors.ansi[c]=this._restoreColors.ansi[c]}else for(let v=0;v<this._restoreColors.ansi.length;++v)this._colors.ansi[v]=this._restoreColors.ansi[v]}modifyColors(c){c(this._colors),this._onChangeColors.fire(this.colors)}_updateRestoreColors(){this._restoreColors={foreground:this._colors.foreground,background:this._colors.background,cursor:this._colors.cursor,ansi:this._colors.ansi.slice()}}};function d(c,v){if(c!==void 0)try{return f.css.toColor(c)}catch{}return v}t.ThemeService=m=l([u(0,r.IOptionsService)],m)},6349:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CircularList=void 0;let l=a(8460),u=a(844);class n extends u.Disposable{constructor(p){super(),this._maxLength=p,this.onDeleteEmitter=this.register(new l.EventEmitter),this.onDelete=this.onDeleteEmitter.event,this.onInsertEmitter=this.register(new l.EventEmitter),this.onInsert=this.onInsertEmitter.event,this.onTrimEmitter=this.register(new l.EventEmitter),this.onTrim=this.onTrimEmitter.event,this._array=Array(this._maxLength),this._startIndex=0,this._length=0}get maxLength(){return this._maxLength}set maxLength(p){if(this._maxLength===p)return;let S=Array(p);for(let r=0;r<Math.min(p,this.length);r++)S[r]=this._array[this._getCyclicIndex(r)];this._array=S,this._maxLength=p,this._startIndex=0}get length(){return this._length}set length(p){if(p>this._length)for(let S=this._length;S<p;S++)this._array[S]=void 0;this._length=p}get(p){return this._array[this._getCyclicIndex(p)]}set(p,S){this._array[this._getCyclicIndex(p)]=S}push(p){this._array[this._getCyclicIndex(this._length)]=p,this._length===this._maxLength?(this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1)):this._length++}recycle(){if(this._length!==this._maxLength)throw Error("Can only recycle when the buffer is full");return this._startIndex=++this._startIndex%this._maxLength,this.onTrimEmitter.fire(1),this._array[this._getCyclicIndex(this._length-1)]}get isFull(){return this._length===this._maxLength}pop(){return this._array[this._getCyclicIndex(this._length---1)]}splice(p,S,...r){if(S){for(let e=p;e<this._length-S;e++)this._array[this._getCyclicIndex(e)]=this._array[this._getCyclicIndex(e+S)];this._length-=S,this.onDeleteEmitter.fire({index:p,amount:S})}for(let e=this._length-1;e>=p;e--)this._array[this._getCyclicIndex(e+r.length)]=this._array[this._getCyclicIndex(e)];for(let e=0;e<r.length;e++)this._array[this._getCyclicIndex(p+e)]=r[e];if(r.length&&this.onInsertEmitter.fire({index:p,amount:r.length}),this._length+r.length>this._maxLength){let e=this._length+r.length-this._maxLength;this._startIndex+=e,this._length=this._maxLength,this.onTrimEmitter.fire(e)}else this._length+=r.length}trimStart(p){p>this._length&&(p=this._length),this._startIndex+=p,this._length-=p,this.onTrimEmitter.fire(p)}shiftElements(p,S,r){if(!(S<=0)){if(p<0||p>=this._length)throw Error("start argument out of range");if(p+r<0)throw Error("Cannot shift elements in list beyond index 0");if(r>0){for(let o=S-1;o>=0;o--)this.set(p+o+r,this.get(p+o));let e=p+S+r-this._length;if(e>0)for(this._length+=e;this._length>this._maxLength;)this._length--,this._startIndex++,this.onTrimEmitter.fire(1)}else for(let e=0;e<S;e++)this.set(p+e+r,this.get(p+e))}}_getCyclicIndex(p){return(this._startIndex+p)%this._maxLength}}t.CircularList=n},1439:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.clone=void 0,t.clone=function a(l,u=5){if(typeof l!="object")return l;let n=Array.isArray(l)?[]:{};for(let f in l)n[f]=u<=1?l[f]:l[f]&&a(l[f],u-1);return n}},8055:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.contrastRatio=t.toPaddedHex=t.rgba=t.rgb=t.css=t.color=t.channels=t.NULL_COLOR=void 0;let a=0,l=0,u=0,n=0;var f,p,S,r,e;function o(i){let h=i.toString(16);return h.length<2?"0"+h:h}function s(i,h){return i<h?(h+.05)/(i+.05):(i+.05)/(h+.05)}t.NULL_COLOR={css:"#00000000",rgba:0},(function(i){i.toCss=function(h,m,d,c){return c===void 0?`#${o(h)}${o(m)}${o(d)}`:`#${o(h)}${o(m)}${o(d)}${o(c)}`},i.toRgba=function(h,m,d,c=255){return(h<<24|m<<16|d<<8|c)>>>0},i.toColor=function(h,m,d,c){return{css:i.toCss(h,m,d,c),rgba:i.toRgba(h,m,d,c)}}})(f||(t.channels=f={})),(function(i){function h(m,d){return n=Math.round(255*d),[a,l,u]=e.toChannels(m.rgba),{css:f.toCss(a,l,u,n),rgba:f.toRgba(a,l,u,n)}}i.blend=function(m,d){if(n=(255&d.rgba)/255,n===1)return{css:d.css,rgba:d.rgba};let c=d.rgba>>24&255,v=d.rgba>>16&255,C=d.rgba>>8&255,k=m.rgba>>24&255,D=m.rgba>>16&255,x=m.rgba>>8&255;return a=k+Math.round((c-k)*n),l=D+Math.round((v-D)*n),u=x+Math.round((C-x)*n),{css:f.toCss(a,l,u),rgba:f.toRgba(a,l,u)}},i.isOpaque=function(m){return(255&m.rgba)==255},i.ensureContrastRatio=function(m,d,c){let v=e.ensureContrastRatio(m.rgba,d.rgba,c);if(v)return f.toColor(v>>24&255,v>>16&255,v>>8&255)},i.opaque=function(m){let d=(255|m.rgba)>>>0;return[a,l,u]=e.toChannels(d),{css:f.toCss(a,l,u),rgba:d}},i.opacity=h,i.multiplyOpacity=function(m,d){return n=255&m.rgba,h(m,n*d/255)},i.toColorRGB=function(m){return[m.rgba>>24&255,m.rgba>>16&255,m.rgba>>8&255]}})(p||(t.color=p={})),(function(i){let h,m;try{let d=document.createElement("canvas");d.width=1,d.height=1;let c=d.getContext("2d",{willReadFrequently:!0});c&&(h=c,h.globalCompositeOperation="copy",m=h.createLinearGradient(0,0,1,1))}catch{}i.toColor=function(d){if(d.match(/#[\da-f]{3,8}/i))switch(d.length){case 4:return a=parseInt(d.slice(1,2).repeat(2),16),l=parseInt(d.slice(2,3).repeat(2),16),u=parseInt(d.slice(3,4).repeat(2),16),f.toColor(a,l,u);case 5:return a=parseInt(d.slice(1,2).repeat(2),16),l=parseInt(d.slice(2,3).repeat(2),16),u=parseInt(d.slice(3,4).repeat(2),16),n=parseInt(d.slice(4,5).repeat(2),16),f.toColor(a,l,u,n);case 7:return{css:d,rgba:(parseInt(d.slice(1),16)<<8|255)>>>0};case 9:return{css:d,rgba:parseInt(d.slice(1),16)>>>0}}let c=d.match(/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(,\s*(0|1|\d?\.(\d+))\s*)?\)/);if(c)return a=parseInt(c[1]),l=parseInt(c[2]),u=parseInt(c[3]),n=Math.round(255*(c[5]===void 0?1:parseFloat(c[5]))),f.toColor(a,l,u,n);if(!h||!m||(h.fillStyle=m,h.fillStyle=d,typeof h.fillStyle!="string")||(h.fillRect(0,0,1,1),[a,l,u,n]=h.getImageData(0,0,1,1).data,n!==255))throw Error("css.toColor: Unsupported css format");return{rgba:f.toRgba(a,l,u,n),css:d}}})(S||(t.css=S={})),(function(i){function h(m,d,c){let v=m/255,C=d/255,k=c/255;return .2126*(v<=.03928?v/12.92:((v+.055)/1.055)**2.4)+.7152*(C<=.03928?C/12.92:((C+.055)/1.055)**2.4)+.0722*(k<=.03928?k/12.92:((k+.055)/1.055)**2.4)}i.relativeLuminance=function(m){return h(m>>16&255,m>>8&255,255&m)},i.relativeLuminance2=h})(r||(t.rgb=r={})),(function(i){function h(d,c,v){let C=d>>24&255,k=d>>16&255,D=d>>8&255,x=c>>24&255,y=c>>16&255,L=c>>8&255,M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));for(;M<v&&(x>0||y>0||L>0);)x-=Math.max(0,Math.ceil(.1*x)),y-=Math.max(0,Math.ceil(.1*y)),L-=Math.max(0,Math.ceil(.1*L)),M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));return(x<<24|y<<16|L<<8|255)>>>0}function m(d,c,v){let C=d>>24&255,k=d>>16&255,D=d>>8&255,x=c>>24&255,y=c>>16&255,L=c>>8&255,M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));for(;M<v&&(x<255||y<255||L<255);)x=Math.min(255,x+Math.ceil(.1*(255-x))),y=Math.min(255,y+Math.ceil(.1*(255-y))),L=Math.min(255,L+Math.ceil(.1*(255-L))),M=s(r.relativeLuminance2(x,y,L),r.relativeLuminance2(C,k,D));return(x<<24|y<<16|L<<8|255)>>>0}i.blend=function(d,c){if(n=(255&c)/255,n===1)return c;let v=c>>24&255,C=c>>16&255,k=c>>8&255,D=d>>24&255,x=d>>16&255,y=d>>8&255;return a=D+Math.round((v-D)*n),l=x+Math.round((C-x)*n),u=y+Math.round((k-y)*n),f.toRgba(a,l,u)},i.ensureContrastRatio=function(d,c,v){let C=r.relativeLuminance(d>>8),k=r.relativeLuminance(c>>8);if(s(C,k)<v){if(k<C){let y=h(d,c,v),L=s(C,r.relativeLuminance(y>>8));if(L<v){let M=m(d,c,v);return L>s(C,r.relativeLuminance(M>>8))?y:M}return y}let D=m(d,c,v),x=s(C,r.relativeLuminance(D>>8));if(x<v){let y=h(d,c,v);return x>s(C,r.relativeLuminance(y>>8))?D:y}return D}},i.reduceLuminance=h,i.increaseLuminance=m,i.toChannels=function(d){return[d>>24&255,d>>16&255,d>>8&255,255&d]}})(e||(t.rgba=e={})),t.toPaddedHex=o,t.contrastRatio=s},8969:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CoreTerminal=void 0;let l=a(844),u=a(2585),n=a(4348),f=a(7866),p=a(744),S=a(7302),r=a(6975),e=a(8460),o=a(1753),s=a(1480),i=a(7994),h=a(9282),m=a(5435),d=a(5981),c=a(2660),v=!1;class C extends l.Disposable{get onScroll(){return this._onScrollApi||(this._onScrollApi=this.register(new e.EventEmitter),this._onScroll.event((D=>{var x;(x=this._onScrollApi)==null||x.fire(D.position)}))),this._onScrollApi.event}get cols(){return this._bufferService.cols}get rows(){return this._bufferService.rows}get buffers(){return this._bufferService.buffers}get options(){return this.optionsService.options}set options(D){for(let x in D)this.optionsService.options[x]=D[x]}constructor(D){super(),this._windowsWrappingHeuristics=this.register(new l.MutableDisposable),this._onBinary=this.register(new e.EventEmitter),this.onBinary=this._onBinary.event,this._onData=this.register(new e.EventEmitter),this.onData=this._onData.event,this._onLineFeed=this.register(new e.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onResize=this.register(new e.EventEmitter),this.onResize=this._onResize.event,this._onWriteParsed=this.register(new e.EventEmitter),this.onWriteParsed=this._onWriteParsed.event,this._onScroll=this.register(new e.EventEmitter),this._instantiationService=new n.InstantiationService,this.optionsService=this.register(new S.OptionsService(D)),this._instantiationService.setService(u.IOptionsService,this.optionsService),this._bufferService=this.register(this._instantiationService.createInstance(p.BufferService)),this._instantiationService.setService(u.IBufferService,this._bufferService),this._logService=this.register(this._instantiationService.createInstance(f.LogService)),this._instantiationService.setService(u.ILogService,this._logService),this.coreService=this.register(this._instantiationService.createInstance(r.CoreService)),this._instantiationService.setService(u.ICoreService,this.coreService),this.coreMouseService=this.register(this._instantiationService.createInstance(o.CoreMouseService)),this._instantiationService.setService(u.ICoreMouseService,this.coreMouseService),this.unicodeService=this.register(this._instantiationService.createInstance(s.UnicodeService)),this._instantiationService.setService(u.IUnicodeService,this.unicodeService),this._charsetService=this._instantiationService.createInstance(i.CharsetService),this._instantiationService.setService(u.ICharsetService,this._charsetService),this._oscLinkService=this._instantiationService.createInstance(c.OscLinkService),this._instantiationService.setService(u.IOscLinkService,this._oscLinkService),this._inputHandler=this.register(new m.InputHandler(this._bufferService,this._charsetService,this.coreService,this._logService,this.optionsService,this._oscLinkService,this.coreMouseService,this.unicodeService)),this.register((0,e.forwardEvent)(this._inputHandler.onLineFeed,this._onLineFeed)),this.register(this._inputHandler),this.register((0,e.forwardEvent)(this._bufferService.onResize,this._onResize)),this.register((0,e.forwardEvent)(this.coreService.onData,this._onData)),this.register((0,e.forwardEvent)(this.coreService.onBinary,this._onBinary)),this.register(this.coreService.onRequestScrollToBottom((()=>this.scrollToBottom()))),this.register(this.coreService.onUserInput((()=>this._writeBuffer.handleUserInput()))),this.register(this.optionsService.onMultipleOptionChange(["windowsMode","windowsPty"],(()=>this._handleWindowsPtyOptionChange()))),this.register(this._bufferService.onScroll((x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this.register(this._inputHandler.onScroll((x=>{this._onScroll.fire({position:this._bufferService.buffer.ydisp,source:0}),this._inputHandler.markRangeDirty(this._bufferService.buffer.scrollTop,this._bufferService.buffer.scrollBottom)}))),this._writeBuffer=this.register(new d.WriteBuffer(((x,y)=>this._inputHandler.parse(x,y)))),this.register((0,e.forwardEvent)(this._writeBuffer.onWriteParsed,this._onWriteParsed))}write(D,x){this._writeBuffer.write(D,x)}writeSync(D,x){this._logService.logLevel<=u.LogLevelEnum.WARN&&!v&&(this._logService.warn("writeSync is unreliable and will be removed soon."),v=!0),this._writeBuffer.writeSync(D,x)}input(D,x=!0){this.coreService.triggerDataEvent(D,x)}resize(D,x){isNaN(D)||isNaN(x)||(D=Math.max(D,p.MINIMUM_COLS),x=Math.max(x,p.MINIMUM_ROWS),this._bufferService.resize(D,x))}scroll(D,x=!1){this._bufferService.scroll(D,x)}scrollLines(D,x,y){this._bufferService.scrollLines(D,x,y)}scrollPages(D){this.scrollLines(D*(this.rows-1))}scrollToTop(){this.scrollLines(-this._bufferService.buffer.ydisp)}scrollToBottom(){this.scrollLines(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp)}scrollToLine(D){let x=D-this._bufferService.buffer.ydisp;x!==0&&this.scrollLines(x)}registerEscHandler(D,x){return this._inputHandler.registerEscHandler(D,x)}registerDcsHandler(D,x){return this._inputHandler.registerDcsHandler(D,x)}registerCsiHandler(D,x){return this._inputHandler.registerCsiHandler(D,x)}registerOscHandler(D,x){return this._inputHandler.registerOscHandler(D,x)}_setup(){this._handleWindowsPtyOptionChange()}reset(){this._inputHandler.reset(),this._bufferService.reset(),this._charsetService.reset(),this.coreService.reset(),this.coreMouseService.reset()}_handleWindowsPtyOptionChange(){let D=!1,x=this.optionsService.rawOptions.windowsPty;x&&x.buildNumber!==void 0&&x.buildNumber!==void 0?D=x.backend==="conpty"&&x.buildNumber<21376:this.optionsService.rawOptions.windowsMode&&(D=!0),D?this._enableWindowsWrappingHeuristics():this._windowsWrappingHeuristics.clear()}_enableWindowsWrappingHeuristics(){if(!this._windowsWrappingHeuristics.value){let D=[];D.push(this.onLineFeed(h.updateWindowsModeWrappedState.bind(null,this._bufferService))),D.push(this.registerCsiHandler({final:"H"},(()=>((0,h.updateWindowsModeWrappedState)(this._bufferService),!1)))),this._windowsWrappingHeuristics.value=(0,l.toDisposable)((()=>{for(let x of D)x.dispose()}))}}}t.CoreTerminal=C},8460:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.runAndSubscribe=t.forwardEvent=t.EventEmitter=void 0,t.EventEmitter=class{constructor(){this._listeners=[],this._disposed=!1}get event(){return this._event||(this._event=a=>(this._listeners.push(a),{dispose:()=>{if(!this._disposed){for(let l=0;l<this._listeners.length;l++)if(this._listeners[l]===a)return void this._listeners.splice(l,1)}}})),this._event}fire(a,l){let u=[];for(let n=0;n<this._listeners.length;n++)u.push(this._listeners[n]);for(let n=0;n<u.length;n++)u[n].call(void 0,a,l)}dispose(){this.clearListeners(),this._disposed=!0}clearListeners(){this._listeners&&(this._listeners.length=0)}},t.forwardEvent=function(a,l){return a((u=>l.fire(u)))},t.runAndSubscribe=function(a,l){return l(void 0),a((u=>l(u)))}},5435:function(A,t,a){var l=this&&this.__decorate||function(H,w,R,O){var F,z=arguments.length,j=z<3?w:O===null?O=Object.getOwnPropertyDescriptor(w,R):O;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")j=Reflect.decorate(H,w,R,O);else for(var X=H.length-1;X>=0;X--)(F=H[X])&&(j=(z<3?F(j):z>3?F(w,R,j):F(w,R))||j);return z>3&&j&&Object.defineProperty(w,R,j),j},u=this&&this.__param||function(H,w){return function(R,O){w(R,O,H)}};Object.defineProperty(t,"__esModule",{value:!0}),t.InputHandler=t.WindowsOptionsReportType=void 0;let n=a(2584),f=a(7116),p=a(2015),S=a(844),r=a(482),e=a(8437),o=a(8460),s=a(643),i=a(511),h=a(3734),m=a(2585),d=a(1480),c=a(6242),v=a(6351),C=a(5941),k={"(":0,")":1,"*":2,"+":3,"-":1,".":2},D=131072;function x(H,w){if(H>24)return w.setWinLines||!1;switch(H){case 1:return!!w.restoreWin;case 2:return!!w.minimizeWin;case 3:return!!w.setWinPosition;case 4:return!!w.setWinSizePixels;case 5:return!!w.raiseWin;case 6:return!!w.lowerWin;case 7:return!!w.refreshWin;case 8:return!!w.setWinSizeChars;case 9:return!!w.maximizeWin;case 10:return!!w.fullscreenWin;case 11:return!!w.getWinState;case 13:return!!w.getWinPosition;case 14:return!!w.getWinSizePixels;case 15:return!!w.getScreenSizePixels;case 16:return!!w.getCellSizePixels;case 18:return!!w.getWinSizeChars;case 19:return!!w.getScreenSizeChars;case 20:return!!w.getIconTitle;case 21:return!!w.getWinTitle;case 22:return!!w.pushTitle;case 23:return!!w.popTitle;case 24:return!!w.setWinLines}return!1}var y;(function(H){H[H.GET_WIN_SIZE_PIXELS=0]="GET_WIN_SIZE_PIXELS",H[H.GET_CELL_SIZE_PIXELS=1]="GET_CELL_SIZE_PIXELS"})(y||(t.WindowsOptionsReportType=y={}));let L=0;class M extends S.Disposable{getAttrData(){return this._curAttrData}constructor(w,R,O,F,z,j,X,K,W=new p.EscapeSequenceParser){for(let $ in super(),this._bufferService=w,this._charsetService=R,this._coreService=O,this._logService=F,this._optionsService=z,this._oscLinkService=j,this._coreMouseService=X,this._unicodeService=K,this._parser=W,this._parseBuffer=new Uint32Array(4096),this._stringDecoder=new r.StringToUtf32,this._utf8Decoder=new r.Utf8ToUtf32,this._workCell=new i.CellData,this._windowTitle="",this._iconName="",this._windowTitleStack=[],this._iconNameStack=[],this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone(),this._onRequestBell=this.register(new o.EventEmitter),this.onRequestBell=this._onRequestBell.event,this._onRequestRefreshRows=this.register(new o.EventEmitter),this.onRequestRefreshRows=this._onRequestRefreshRows.event,this._onRequestReset=this.register(new o.EventEmitter),this.onRequestReset=this._onRequestReset.event,this._onRequestSendFocus=this.register(new o.EventEmitter),this.onRequestSendFocus=this._onRequestSendFocus.event,this._onRequestSyncScrollBar=this.register(new o.EventEmitter),this.onRequestSyncScrollBar=this._onRequestSyncScrollBar.event,this._onRequestWindowsOptionsReport=this.register(new o.EventEmitter),this.onRequestWindowsOptionsReport=this._onRequestWindowsOptionsReport.event,this._onA11yChar=this.register(new o.EventEmitter),this.onA11yChar=this._onA11yChar.event,this._onA11yTab=this.register(new o.EventEmitter),this.onA11yTab=this._onA11yTab.event,this._onCursorMove=this.register(new o.EventEmitter),this.onCursorMove=this._onCursorMove.event,this._onLineFeed=this.register(new o.EventEmitter),this.onLineFeed=this._onLineFeed.event,this._onScroll=this.register(new o.EventEmitter),this.onScroll=this._onScroll.event,this._onTitleChange=this.register(new o.EventEmitter),this.onTitleChange=this._onTitleChange.event,this._onColor=this.register(new o.EventEmitter),this.onColor=this._onColor.event,this._parseStack={paused:!1,cursorStartX:0,cursorStartY:0,decodedLength:0,position:0},this._specialColors=[256,257,258],this.register(this._parser),this._dirtyRowTracker=new B(this._bufferService),this._activeBuffer=this._bufferService.buffer,this.register(this._bufferService.buffers.onBufferActivate((I=>this._activeBuffer=I.activeBuffer))),this._parser.setCsiHandlerFallback(((I,U)=>{this._logService.debug("Unknown CSI code: ",{identifier:this._parser.identToString(I),params:U.toArray()})})),this._parser.setEscHandlerFallback((I=>{this._logService.debug("Unknown ESC code: ",{identifier:this._parser.identToString(I)})})),this._parser.setExecuteHandlerFallback((I=>{this._logService.debug("Unknown EXECUTE code: ",{code:I})})),this._parser.setOscHandlerFallback(((I,U,q)=>{this._logService.debug("Unknown OSC code: ",{identifier:I,action:U,data:q})})),this._parser.setDcsHandlerFallback(((I,U,q)=>{U==="HOOK"&&(q=q.toArray()),this._logService.debug("Unknown DCS code: ",{identifier:this._parser.identToString(I),action:U,payload:q})})),this._parser.setPrintHandler(((I,U,q)=>this.print(I,U,q))),this._parser.registerCsiHandler({final:"@"},(I=>this.insertChars(I))),this._parser.registerCsiHandler({intermediates:" ",final:"@"},(I=>this.scrollLeft(I))),this._parser.registerCsiHandler({final:"A"},(I=>this.cursorUp(I))),this._parser.registerCsiHandler({intermediates:" ",final:"A"},(I=>this.scrollRight(I))),this._parser.registerCsiHandler({final:"B"},(I=>this.cursorDown(I))),this._parser.registerCsiHandler({final:"C"},(I=>this.cursorForward(I))),this._parser.registerCsiHandler({final:"D"},(I=>this.cursorBackward(I))),this._parser.registerCsiHandler({final:"E"},(I=>this.cursorNextLine(I))),this._parser.registerCsiHandler({final:"F"},(I=>this.cursorPrecedingLine(I))),this._parser.registerCsiHandler({final:"G"},(I=>this.cursorCharAbsolute(I))),this._parser.registerCsiHandler({final:"H"},(I=>this.cursorPosition(I))),this._parser.registerCsiHandler({final:"I"},(I=>this.cursorForwardTab(I))),this._parser.registerCsiHandler({final:"J"},(I=>this.eraseInDisplay(I,!1))),this._parser.registerCsiHandler({prefix:"?",final:"J"},(I=>this.eraseInDisplay(I,!0))),this._parser.registerCsiHandler({final:"K"},(I=>this.eraseInLine(I,!1))),this._parser.registerCsiHandler({prefix:"?",final:"K"},(I=>this.eraseInLine(I,!0))),this._parser.registerCsiHandler({final:"L"},(I=>this.insertLines(I))),this._parser.registerCsiHandler({final:"M"},(I=>this.deleteLines(I))),this._parser.registerCsiHandler({final:"P"},(I=>this.deleteChars(I))),this._parser.registerCsiHandler({final:"S"},(I=>this.scrollUp(I))),this._parser.registerCsiHandler({final:"T"},(I=>this.scrollDown(I))),this._parser.registerCsiHandler({final:"X"},(I=>this.eraseChars(I))),this._parser.registerCsiHandler({final:"Z"},(I=>this.cursorBackwardTab(I))),this._parser.registerCsiHandler({final:"`"},(I=>this.charPosAbsolute(I))),this._parser.registerCsiHandler({final:"a"},(I=>this.hPositionRelative(I))),this._parser.registerCsiHandler({final:"b"},(I=>this.repeatPrecedingCharacter(I))),this._parser.registerCsiHandler({final:"c"},(I=>this.sendDeviceAttributesPrimary(I))),this._parser.registerCsiHandler({prefix:">",final:"c"},(I=>this.sendDeviceAttributesSecondary(I))),this._parser.registerCsiHandler({final:"d"},(I=>this.linePosAbsolute(I))),this._parser.registerCsiHandler({final:"e"},(I=>this.vPositionRelative(I))),this._parser.registerCsiHandler({final:"f"},(I=>this.hVPosition(I))),this._parser.registerCsiHandler({final:"g"},(I=>this.tabClear(I))),this._parser.registerCsiHandler({final:"h"},(I=>this.setMode(I))),this._parser.registerCsiHandler({prefix:"?",final:"h"},(I=>this.setModePrivate(I))),this._parser.registerCsiHandler({final:"l"},(I=>this.resetMode(I))),this._parser.registerCsiHandler({prefix:"?",final:"l"},(I=>this.resetModePrivate(I))),this._parser.registerCsiHandler({final:"m"},(I=>this.charAttributes(I))),this._parser.registerCsiHandler({final:"n"},(I=>this.deviceStatus(I))),this._parser.registerCsiHandler({prefix:"?",final:"n"},(I=>this.deviceStatusPrivate(I))),this._parser.registerCsiHandler({intermediates:"!",final:"p"},(I=>this.softReset(I))),this._parser.registerCsiHandler({intermediates:" ",final:"q"},(I=>this.setCursorStyle(I))),this._parser.registerCsiHandler({final:"r"},(I=>this.setScrollRegion(I))),this._parser.registerCsiHandler({final:"s"},(I=>this.saveCursor(I))),this._parser.registerCsiHandler({final:"t"},(I=>this.windowOptions(I))),this._parser.registerCsiHandler({final:"u"},(I=>this.restoreCursor(I))),this._parser.registerCsiHandler({intermediates:"'",final:"}"},(I=>this.insertColumns(I))),this._parser.registerCsiHandler({intermediates:"'",final:"~"},(I=>this.deleteColumns(I))),this._parser.registerCsiHandler({intermediates:'"',final:"q"},(I=>this.selectProtected(I))),this._parser.registerCsiHandler({intermediates:"$",final:"p"},(I=>this.requestMode(I,!0))),this._parser.registerCsiHandler({prefix:"?",intermediates:"$",final:"p"},(I=>this.requestMode(I,!1))),this._parser.setExecuteHandler(n.C0.BEL,(()=>this.bell())),this._parser.setExecuteHandler(n.C0.LF,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.VT,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.FF,(()=>this.lineFeed())),this._parser.setExecuteHandler(n.C0.CR,(()=>this.carriageReturn())),this._parser.setExecuteHandler(n.C0.BS,(()=>this.backspace())),this._parser.setExecuteHandler(n.C0.HT,(()=>this.tab())),this._parser.setExecuteHandler(n.C0.SO,(()=>this.shiftOut())),this._parser.setExecuteHandler(n.C0.SI,(()=>this.shiftIn())),this._parser.setExecuteHandler(n.C1.IND,(()=>this.index())),this._parser.setExecuteHandler(n.C1.NEL,(()=>this.nextLine())),this._parser.setExecuteHandler(n.C1.HTS,(()=>this.tabSet())),this._parser.registerOscHandler(0,new c.OscHandler((I=>(this.setTitle(I),this.setIconName(I),!0)))),this._parser.registerOscHandler(1,new c.OscHandler((I=>this.setIconName(I)))),this._parser.registerOscHandler(2,new c.OscHandler((I=>this.setTitle(I)))),this._parser.registerOscHandler(4,new c.OscHandler((I=>this.setOrReportIndexedColor(I)))),this._parser.registerOscHandler(8,new c.OscHandler((I=>this.setHyperlink(I)))),this._parser.registerOscHandler(10,new c.OscHandler((I=>this.setOrReportFgColor(I)))),this._parser.registerOscHandler(11,new c.OscHandler((I=>this.setOrReportBgColor(I)))),this._parser.registerOscHandler(12,new c.OscHandler((I=>this.setOrReportCursorColor(I)))),this._parser.registerOscHandler(104,new c.OscHandler((I=>this.restoreIndexedColor(I)))),this._parser.registerOscHandler(110,new c.OscHandler((I=>this.restoreFgColor(I)))),this._parser.registerOscHandler(111,new c.OscHandler((I=>this.restoreBgColor(I)))),this._parser.registerOscHandler(112,new c.OscHandler((I=>this.restoreCursorColor(I)))),this._parser.registerEscHandler({final:"7"},(()=>this.saveCursor())),this._parser.registerEscHandler({final:"8"},(()=>this.restoreCursor())),this._parser.registerEscHandler({final:"D"},(()=>this.index())),this._parser.registerEscHandler({final:"E"},(()=>this.nextLine())),this._parser.registerEscHandler({final:"H"},(()=>this.tabSet())),this._parser.registerEscHandler({final:"M"},(()=>this.reverseIndex())),this._parser.registerEscHandler({final:"="},(()=>this.keypadApplicationMode())),this._parser.registerEscHandler({final:">"},(()=>this.keypadNumericMode())),this._parser.registerEscHandler({final:"c"},(()=>this.fullReset())),this._parser.registerEscHandler({final:"n"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"o"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"|"},(()=>this.setgLevel(3))),this._parser.registerEscHandler({final:"}"},(()=>this.setgLevel(2))),this._parser.registerEscHandler({final:"~"},(()=>this.setgLevel(1))),this._parser.registerEscHandler({intermediates:"%",final:"@"},(()=>this.selectDefaultCharset())),this._parser.registerEscHandler({intermediates:"%",final:"G"},(()=>this.selectDefaultCharset())),f.CHARSETS)this._parser.registerEscHandler({intermediates:"(",final:$},(()=>this.selectCharset("("+$))),this._parser.registerEscHandler({intermediates:")",final:$},(()=>this.selectCharset(")"+$))),this._parser.registerEscHandler({intermediates:"*",final:$},(()=>this.selectCharset("*"+$))),this._parser.registerEscHandler({intermediates:"+",final:$},(()=>this.selectCharset("+"+$))),this._parser.registerEscHandler({intermediates:"-",final:$},(()=>this.selectCharset("-"+$))),this._parser.registerEscHandler({intermediates:".",final:$},(()=>this.selectCharset("."+$))),this._parser.registerEscHandler({intermediates:"/",final:$},(()=>this.selectCharset("/"+$)));this._parser.registerEscHandler({intermediates:"#",final:"8"},(()=>this.screenAlignmentPattern())),this._parser.setErrorHandler(($=>(this._logService.error("Parsing error: ",$),$))),this._parser.registerDcsHandler({intermediates:"$",final:"q"},new v.DcsHandler((($,I)=>this.requestStatusString($,I))))}_preserveStack(w,R,O,F){this._parseStack.paused=!0,this._parseStack.cursorStartX=w,this._parseStack.cursorStartY=R,this._parseStack.decodedLength=O,this._parseStack.position=F}_logSlowResolvingAsync(w){this._logService.logLevel<=m.LogLevelEnum.WARN&&Promise.race([w,new Promise(((R,O)=>setTimeout((()=>O("#SLOW_TIMEOUT")),5e3)))]).catch((R=>{if(R!=="#SLOW_TIMEOUT")throw R;console.warn("async parser handler taking longer than 5000 ms")}))}_getCurrentLinkId(){return this._curAttrData.extended.urlId}parse(w,R){let O,F=this._activeBuffer.x,z=this._activeBuffer.y,j=0,X=this._parseStack.paused;if(X){if(O=this._parser.parse(this._parseBuffer,this._parseStack.decodedLength,R))return this._logSlowResolvingAsync(O),O;F=this._parseStack.cursorStartX,z=this._parseStack.cursorStartY,this._parseStack.paused=!1,w.length>D&&(j=this._parseStack.position+D)}if(this._logService.logLevel<=m.LogLevelEnum.DEBUG&&this._logService.debug("parsing data"+(typeof w=="string"?` "${w}"`:` "${Array.prototype.map.call(w,($=>String.fromCharCode($))).join("")}"`),typeof w=="string"?w.split("").map(($=>$.charCodeAt(0))):w),this._parseBuffer.length<w.length&&this._parseBuffer.length<D&&(this._parseBuffer=new Uint32Array(Math.min(w.length,D))),X||this._dirtyRowTracker.clearRange(),w.length>D)for(let $=j;$<w.length;$+=D){let I=$+D<w.length?$+D:w.length,U=typeof w=="string"?this._stringDecoder.decode(w.substring($,I),this._parseBuffer):this._utf8Decoder.decode(w.subarray($,I),this._parseBuffer);if(O=this._parser.parse(this._parseBuffer,U))return this._preserveStack(F,z,U,$),this._logSlowResolvingAsync(O),O}else if(!X){let $=typeof w=="string"?this._stringDecoder.decode(w,this._parseBuffer):this._utf8Decoder.decode(w,this._parseBuffer);if(O=this._parser.parse(this._parseBuffer,$))return this._preserveStack(F,z,$,0),this._logSlowResolvingAsync(O),O}this._activeBuffer.x===F&&this._activeBuffer.y===z||this._onCursorMove.fire();let K=this._dirtyRowTracker.end+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp),W=this._dirtyRowTracker.start+(this._bufferService.buffer.ybase-this._bufferService.buffer.ydisp);W<this._bufferService.rows&&this._onRequestRefreshRows.fire(Math.min(W,this._bufferService.rows-1),Math.min(K,this._bufferService.rows-1))}print(w,R,O){let F,z,j=this._charsetService.charset,X=this._optionsService.rawOptions.screenReaderMode,K=this._bufferService.cols,W=this._coreService.decPrivateModes.wraparound,$=this._coreService.modes.insertMode,I=this._curAttrData,U=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._activeBuffer.x&&O-R>0&&U.getWidth(this._activeBuffer.x-1)===2&&U.setCellFromCodepoint(this._activeBuffer.x-1,0,1,I);let q=this._parser.precedingJoinState;for(let G=R;G<O;++G){if(F=w[G],F<127&&j){let he=j[String.fromCharCode(F)];he&&(F=he.charCodeAt(0))}let Q=this._unicodeService.charProperties(F,q);z=d.UnicodeService.extractWidth(Q);let Y=d.UnicodeService.extractShouldJoin(Q),re=Y?d.UnicodeService.extractWidth(q):0;if(q=Q,X&&this._onA11yChar.fire((0,r.stringFromCodePoint)(F)),this._getCurrentLinkId()&&this._oscLinkService.addLineToLink(this._getCurrentLinkId(),this._activeBuffer.ybase+this._activeBuffer.y),this._activeBuffer.x+z-re>K){if(W){let he=U,J=this._activeBuffer.x-re;for(this._activeBuffer.x=re,this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData(),!0)):(this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!0),U=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y),re>0&&U instanceof e.BufferLine&&U.copyCellsFrom(he,J,0,re,!1);J<K;)he.setCellFromCodepoint(J++,0,1,I)}else if(this._activeBuffer.x=K-1,z===2)continue}if(Y&&this._activeBuffer.x){let he=U.getWidth(this._activeBuffer.x-1)?1:2;U.addCodepointToCell(this._activeBuffer.x-he,F,z);for(let J=z-re;--J>=0;)U.setCellFromCodepoint(this._activeBuffer.x++,0,0,I)}else if($&&(U.insertCells(this._activeBuffer.x,z-re,this._activeBuffer.getNullCell(I)),U.getWidth(K-1)===2&&U.setCellFromCodepoint(K-1,s.NULL_CELL_CODE,s.NULL_CELL_WIDTH,I)),U.setCellFromCodepoint(this._activeBuffer.x++,F,z,I),z>0)for(;--z;)U.setCellFromCodepoint(this._activeBuffer.x++,0,0,I)}this._parser.precedingJoinState=q,this._activeBuffer.x<K&&O-R>0&&U.getWidth(this._activeBuffer.x)===0&&!U.hasContent(this._activeBuffer.x)&&U.setCellFromCodepoint(this._activeBuffer.x,0,1,I),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}registerCsiHandler(w,R){return w.final!=="t"||w.prefix||w.intermediates?this._parser.registerCsiHandler(w,R):this._parser.registerCsiHandler(w,(O=>!x(O.params[0],this._optionsService.rawOptions.windowOptions)||R(O)))}registerDcsHandler(w,R){return this._parser.registerDcsHandler(w,new v.DcsHandler(R))}registerEscHandler(w,R){return this._parser.registerEscHandler(w,R)}registerOscHandler(w,R){return this._parser.registerOscHandler(w,new c.OscHandler(R))}bell(){return this._onRequestBell.fire(),!0}lineFeed(){return this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._optionsService.rawOptions.convertEol&&(this._activeBuffer.x=0),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows?this._activeBuffer.y=this._bufferService.rows-1:this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.x>=this._bufferService.cols&&this._activeBuffer.x--,this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._onLineFeed.fire(),!0}carriageReturn(){return this._activeBuffer.x=0,!0}backspace(){var w;if(!this._coreService.decPrivateModes.reverseWraparound)return this._restrictCursor(),this._activeBuffer.x>0&&this._activeBuffer.x--,!0;if(this._restrictCursor(this._bufferService.cols),this._activeBuffer.x>0)this._activeBuffer.x--;else if(this._activeBuffer.x===0&&this._activeBuffer.y>this._activeBuffer.scrollTop&&this._activeBuffer.y<=this._activeBuffer.scrollBottom&&((w=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y))!=null&&w.isWrapped)){this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).isWrapped=!1,this._activeBuffer.y--,this._activeBuffer.x=this._bufferService.cols-1;let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);R.hasWidth(this._activeBuffer.x)&&!R.hasContent(this._activeBuffer.x)&&this._activeBuffer.x--}return this._restrictCursor(),!0}tab(){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let w=this._activeBuffer.x;return this._activeBuffer.x=this._activeBuffer.nextStop(),this._optionsService.rawOptions.screenReaderMode&&this._onA11yTab.fire(this._activeBuffer.x-w),!0}shiftOut(){return this._charsetService.setgLevel(1),!0}shiftIn(){return this._charsetService.setgLevel(0),!0}_restrictCursor(w=this._bufferService.cols-1){this._activeBuffer.x=Math.min(w,Math.max(0,this._activeBuffer.x)),this._activeBuffer.y=this._coreService.decPrivateModes.origin?Math.min(this._activeBuffer.scrollBottom,Math.max(this._activeBuffer.scrollTop,this._activeBuffer.y)):Math.min(this._bufferService.rows-1,Math.max(0,this._activeBuffer.y)),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_setCursor(w,R){this._dirtyRowTracker.markDirty(this._activeBuffer.y),this._coreService.decPrivateModes.origin?(this._activeBuffer.x=w,this._activeBuffer.y=this._activeBuffer.scrollTop+R):(this._activeBuffer.x=w,this._activeBuffer.y=R),this._restrictCursor(),this._dirtyRowTracker.markDirty(this._activeBuffer.y)}_moveCursor(w,R){this._restrictCursor(),this._setCursor(this._activeBuffer.x+w,this._activeBuffer.y+R)}cursorUp(w){let R=this._activeBuffer.y-this._activeBuffer.scrollTop;return R>=0?this._moveCursor(0,-Math.min(R,w.params[0]||1)):this._moveCursor(0,-(w.params[0]||1)),!0}cursorDown(w){let R=this._activeBuffer.scrollBottom-this._activeBuffer.y;return R>=0?this._moveCursor(0,Math.min(R,w.params[0]||1)):this._moveCursor(0,w.params[0]||1),!0}cursorForward(w){return this._moveCursor(w.params[0]||1,0),!0}cursorBackward(w){return this._moveCursor(-(w.params[0]||1),0),!0}cursorNextLine(w){return this.cursorDown(w),this._activeBuffer.x=0,!0}cursorPrecedingLine(w){return this.cursorUp(w),this._activeBuffer.x=0,!0}cursorCharAbsolute(w){return this._setCursor((w.params[0]||1)-1,this._activeBuffer.y),!0}cursorPosition(w){return this._setCursor(w.length>=2?(w.params[1]||1)-1:0,(w.params[0]||1)-1),!0}charPosAbsolute(w){return this._setCursor((w.params[0]||1)-1,this._activeBuffer.y),!0}hPositionRelative(w){return this._moveCursor(w.params[0]||1,0),!0}linePosAbsolute(w){return this._setCursor(this._activeBuffer.x,(w.params[0]||1)-1),!0}vPositionRelative(w){return this._moveCursor(0,w.params[0]||1),!0}hVPosition(w){return this.cursorPosition(w),!0}tabClear(w){let R=w.params[0];return R===0?delete this._activeBuffer.tabs[this._activeBuffer.x]:R===3&&(this._activeBuffer.tabs={}),!0}cursorForwardTab(w){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=w.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.nextStop();return!0}cursorBackwardTab(w){if(this._activeBuffer.x>=this._bufferService.cols)return!0;let R=w.params[0]||1;for(;R--;)this._activeBuffer.x=this._activeBuffer.prevStop();return!0}selectProtected(w){let R=w.params[0];return R===1&&(this._curAttrData.bg|=536870912),R!==2&&R!==0||(this._curAttrData.bg&=-536870913),!0}_eraseInBufferLine(w,R,O,F=!1,z=!1){let j=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);j.replaceCells(R,O,this._activeBuffer.getNullCell(this._eraseAttrData()),z),F&&(j.isWrapped=!1)}_resetBufferLine(w,R=!1){let O=this._activeBuffer.lines.get(this._activeBuffer.ybase+w);O&&(O.fill(this._activeBuffer.getNullCell(this._eraseAttrData()),R),this._bufferService.buffer.clearMarkers(this._activeBuffer.ybase+w),O.isWrapped=!1)}eraseInDisplay(w,R=!1){let O;switch(this._restrictCursor(this._bufferService.cols),w.params[0]){case 0:for(O=this._activeBuffer.y,this._dirtyRowTracker.markDirty(O),this._eraseInBufferLine(O++,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);O<this._bufferService.rows;O++)this._resetBufferLine(O,R);this._dirtyRowTracker.markDirty(O);break;case 1:for(O=this._activeBuffer.y,this._dirtyRowTracker.markDirty(O),this._eraseInBufferLine(O,0,this._activeBuffer.x+1,!0,R),this._activeBuffer.x+1>=this._bufferService.cols&&(this._activeBuffer.lines.get(O+1).isWrapped=!1);O--;)this._resetBufferLine(O,R);this._dirtyRowTracker.markDirty(0);break;case 2:for(O=this._bufferService.rows,this._dirtyRowTracker.markDirty(O-1);O--;)this._resetBufferLine(O,R);this._dirtyRowTracker.markDirty(0);break;case 3:let F=this._activeBuffer.lines.length-this._bufferService.rows;F>0&&(this._activeBuffer.lines.trimStart(F),this._activeBuffer.ybase=Math.max(this._activeBuffer.ybase-F,0),this._activeBuffer.ydisp=Math.max(this._activeBuffer.ydisp-F,0),this._onScroll.fire(0))}return!0}eraseInLine(w,R=!1){switch(this._restrictCursor(this._bufferService.cols),w.params[0]){case 0:this._eraseInBufferLine(this._activeBuffer.y,this._activeBuffer.x,this._bufferService.cols,this._activeBuffer.x===0,R);break;case 1:this._eraseInBufferLine(this._activeBuffer.y,0,this._activeBuffer.x+1,!1,R);break;case 2:this._eraseInBufferLine(this._activeBuffer.y,0,this._bufferService.cols,!0,R)}return this._dirtyRowTracker.markDirty(this._activeBuffer.y),!0}insertLines(w){this._restrictCursor();let R=w.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let O=this._activeBuffer.ybase+this._activeBuffer.y,F=this._bufferService.rows-1-this._activeBuffer.scrollBottom,z=this._bufferService.rows-1+this._activeBuffer.ybase-F+1;for(;R--;)this._activeBuffer.lines.splice(z-1,1),this._activeBuffer.lines.splice(O,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}deleteLines(w){this._restrictCursor();let R=w.params[0]||1;if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let O=this._activeBuffer.ybase+this._activeBuffer.y,F;for(F=this._bufferService.rows-1-this._activeBuffer.scrollBottom,F=this._bufferService.rows-1+this._activeBuffer.ybase-F;R--;)this._activeBuffer.lines.splice(O,1),this._activeBuffer.lines.splice(F,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.y,this._activeBuffer.scrollBottom),this._activeBuffer.x=0,!0}insertChars(w){this._restrictCursor();let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.insertCells(this._activeBuffer.x,w.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}deleteChars(w){this._restrictCursor();let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.deleteCells(this._activeBuffer.x,w.params[0]||1,this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}scrollUp(w){let R=w.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,0,this._activeBuffer.getBlankLine(this._eraseAttrData()));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollDown(w){let R=w.params[0]||1;for(;R--;)this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollBottom,1),this._activeBuffer.lines.splice(this._activeBuffer.ybase+this._activeBuffer.scrollTop,0,this._activeBuffer.getBlankLine(e.DEFAULT_ATTR_DATA));return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollLeft(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=w.params[0]||1;for(let O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);F.deleteCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}scrollRight(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=w.params[0]||1;for(let O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);F.insertCells(0,R,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}insertColumns(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=w.params[0]||1;for(let O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);F.insertCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}deleteColumns(w){if(this._activeBuffer.y>this._activeBuffer.scrollBottom||this._activeBuffer.y<this._activeBuffer.scrollTop)return!0;let R=w.params[0]||1;for(let O=this._activeBuffer.scrollTop;O<=this._activeBuffer.scrollBottom;++O){let F=this._activeBuffer.lines.get(this._activeBuffer.ybase+O);F.deleteCells(this._activeBuffer.x,R,this._activeBuffer.getNullCell(this._eraseAttrData())),F.isWrapped=!1}return this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom),!0}eraseChars(w){this._restrictCursor();let R=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y);return R&&(R.replaceCells(this._activeBuffer.x,this._activeBuffer.x+(w.params[0]||1),this._activeBuffer.getNullCell(this._eraseAttrData())),this._dirtyRowTracker.markDirty(this._activeBuffer.y)),!0}repeatPrecedingCharacter(w){let R=this._parser.precedingJoinState;if(!R)return!0;let O=w.params[0]||1,F=d.UnicodeService.extractWidth(R),z=this._activeBuffer.x-F,j=this._activeBuffer.lines.get(this._activeBuffer.ybase+this._activeBuffer.y).getString(z),X=new Uint32Array(j.length*O),K=0;for(let $=0;$<j.length;){let I=j.codePointAt($)||0;X[K++]=I,$+=I>65535?2:1}let W=K;for(let $=1;$<O;++$)X.copyWithin(W,0,K),W+=K;return this.print(X,0,W),!0}sendDeviceAttributesPrimary(w){return w.params[0]>0||(this._is("xterm")||this._is("rxvt-unicode")||this._is("screen")?this._coreService.triggerDataEvent(n.C0.ESC+"[?1;2c"):this._is("linux")&&this._coreService.triggerDataEvent(n.C0.ESC+"[?6c")),!0}sendDeviceAttributesSecondary(w){return w.params[0]>0||(this._is("xterm")?this._coreService.triggerDataEvent(n.C0.ESC+"[>0;276;0c"):this._is("rxvt-unicode")?this._coreService.triggerDataEvent(n.C0.ESC+"[>85;95;0c"):this._is("linux")?this._coreService.triggerDataEvent(w.params[0]+"c"):this._is("screen")&&this._coreService.triggerDataEvent(n.C0.ESC+"[>83;40003;0c")),!0}_is(w){return(this._optionsService.rawOptions.termName+"").indexOf(w)===0}setMode(w){for(let R=0;R<w.length;R++)switch(w.params[R]){case 4:this._coreService.modes.insertMode=!0;break;case 20:this._optionsService.options.convertEol=!0}return!0}setModePrivate(w){for(let R=0;R<w.length;R++)switch(w.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!0;break;case 2:this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),this._charsetService.setgCharset(1,f.DEFAULT_CHARSET),this._charsetService.setgCharset(2,f.DEFAULT_CHARSET),this._charsetService.setgCharset(3,f.DEFAULT_CHARSET);break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(132,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!0,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!0;break;case 12:this._optionsService.options.cursorBlink=!0;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!0;break;case 66:this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire();break;case 9:this._coreMouseService.activeProtocol="X10";break;case 1e3:this._coreMouseService.activeProtocol="VT200";break;case 1002:this._coreMouseService.activeProtocol="DRAG";break;case 1003:this._coreMouseService.activeProtocol="ANY";break;case 1004:this._coreService.decPrivateModes.sendFocus=!0,this._onRequestSendFocus.fire();break;case 1005:this._logService.debug("DECSET 1005 not supported (see #2507)");break;case 1006:this._coreMouseService.activeEncoding="SGR";break;case 1015:this._logService.debug("DECSET 1015 not supported (see #2507)");break;case 1016:this._coreMouseService.activeEncoding="SGR_PIXELS";break;case 25:this._coreService.isCursorHidden=!1;break;case 1048:this.saveCursor();break;case 1049:this.saveCursor();case 47:case 1047:this._bufferService.buffers.activateAltBuffer(this._eraseAttrData()),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!0}return!0}resetMode(w){for(let R=0;R<w.length;R++)switch(w.params[R]){case 4:this._coreService.modes.insertMode=!1;break;case 20:this._optionsService.options.convertEol=!1}return!0}resetModePrivate(w){for(let R=0;R<w.length;R++)switch(w.params[R]){case 1:this._coreService.decPrivateModes.applicationCursorKeys=!1;break;case 3:this._optionsService.rawOptions.windowOptions.setWinLines&&(this._bufferService.resize(80,this._bufferService.rows),this._onRequestReset.fire());break;case 6:this._coreService.decPrivateModes.origin=!1,this._setCursor(0,0);break;case 7:this._coreService.decPrivateModes.wraparound=!1;break;case 12:this._optionsService.options.cursorBlink=!1;break;case 45:this._coreService.decPrivateModes.reverseWraparound=!1;break;case 66:this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire();break;case 9:case 1e3:case 1002:case 1003:this._coreMouseService.activeProtocol="NONE";break;case 1004:this._coreService.decPrivateModes.sendFocus=!1;break;case 1005:this._logService.debug("DECRST 1005 not supported (see #2507)");break;case 1006:case 1016:this._coreMouseService.activeEncoding="DEFAULT";break;case 1015:this._logService.debug("DECRST 1015 not supported (see #2507)");break;case 25:this._coreService.isCursorHidden=!0;break;case 1048:this.restoreCursor();break;case 1049:case 47:case 1047:this._bufferService.buffers.activateNormalBuffer(),w.params[R]===1049&&this.restoreCursor(),this._coreService.isCursorInitialized=!0,this._onRequestRefreshRows.fire(0,this._bufferService.rows-1),this._onRequestSyncScrollBar.fire();break;case 2004:this._coreService.decPrivateModes.bracketedPasteMode=!1}return!0}requestMode(w,R){let O=this._coreService.decPrivateModes,{activeProtocol:F,activeEncoding:z}=this._coreMouseService,j=this._coreService,{buffers:X,cols:K}=this._bufferService,{active:W,alt:$}=X,I=this._optionsService.rawOptions,U=Y=>Y?1:2,q=w.params[0];return G=q,Q=R?q===2?4:q===4?U(j.modes.insertMode):q===12?3:q===20?U(I.convertEol):0:q===1?U(O.applicationCursorKeys):q===3?I.windowOptions.setWinLines?K===80?2:K===132?1:0:0:q===6?U(O.origin):q===7?U(O.wraparound):q===8?3:q===9?U(F==="X10"):q===12?U(I.cursorBlink):q===25?U(!j.isCursorHidden):q===45?U(O.reverseWraparound):q===66?U(O.applicationKeypad):q===67?4:q===1e3?U(F==="VT200"):q===1002?U(F==="DRAG"):q===1003?U(F==="ANY"):q===1004?U(O.sendFocus):q===1005?4:q===1006?U(z==="SGR"):q===1015?4:q===1016?U(z==="SGR_PIXELS"):q===1048?1:q===47||q===1047||q===1049?U(W===$):q===2004?U(O.bracketedPasteMode):0,j.triggerDataEvent(`${n.C0.ESC}[${R?"":"?"}${G};${Q}$y`),!0;var G,Q}_updateAttrColor(w,R,O,F,z){return R===2?(w|=50331648,w&=-16777216,w|=h.AttributeData.fromColorRGB([O,F,z])):R===5&&(w&=-50331904,w|=33554432|255&O),w}_extractColor(w,R,O){let F=[0,0,-1,0,0,0],z=0,j=0;do{if(F[j+z]=w.params[R+j],w.hasSubParams(R+j)){let X=w.getSubParams(R+j),K=0;do F[1]===5&&(z=1),F[j+K+1+z]=X[K];while(++K<X.length&&K+j+1+z<F.length);break}if(F[1]===5&&j+z>=2||F[1]===2&&j+z>=5)break;F[1]&&(z=1)}while(++j+R<w.length&&j+z<F.length);for(let X=2;X<F.length;++X)F[X]===-1&&(F[X]=0);switch(F[0]){case 38:O.fg=this._updateAttrColor(O.fg,F[1],F[3],F[4],F[5]);break;case 48:O.bg=this._updateAttrColor(O.bg,F[1],F[3],F[4],F[5]);break;case 58:O.extended=O.extended.clone(),O.extended.underlineColor=this._updateAttrColor(O.extended.underlineColor,F[1],F[3],F[4],F[5])}return j}_processUnderline(w,R){R.extended=R.extended.clone(),(!~w||w>5)&&(w=1),R.extended.underlineStyle=w,R.fg|=268435456,w===0&&(R.fg&=-268435457),R.updateExtended()}_processSGR0(w){w.fg=e.DEFAULT_ATTR_DATA.fg,w.bg=e.DEFAULT_ATTR_DATA.bg,w.extended=w.extended.clone(),w.extended.underlineStyle=0,w.extended.underlineColor&=-67108864,w.updateExtended()}charAttributes(w){if(w.length===1&&w.params[0]===0)return this._processSGR0(this._curAttrData),!0;let R=w.length,O,F=this._curAttrData;for(let z=0;z<R;z++)O=w.params[z],O>=30&&O<=37?(F.fg&=-50331904,F.fg|=16777216|O-30):O>=40&&O<=47?(F.bg&=-50331904,F.bg|=16777216|O-40):O>=90&&O<=97?(F.fg&=-50331904,F.fg|=16777224|O-90):O>=100&&O<=107?(F.bg&=-50331904,F.bg|=16777224|O-100):O===0?this._processSGR0(F):O===1?F.fg|=134217728:O===3?F.bg|=67108864:O===4?(F.fg|=268435456,this._processUnderline(w.hasSubParams(z)?w.getSubParams(z)[0]:1,F)):O===5?F.fg|=536870912:O===7?F.fg|=67108864:O===8?F.fg|=1073741824:O===9?F.fg|=2147483648:O===2?F.bg|=134217728:O===21?this._processUnderline(2,F):O===22?(F.fg&=-134217729,F.bg&=-134217729):O===23?F.bg&=-67108865:O===24?(F.fg&=-268435457,this._processUnderline(0,F)):O===25?F.fg&=-536870913:O===27?F.fg&=-67108865:O===28?F.fg&=-1073741825:O===29?F.fg&=2147483647:O===39?(F.fg&=-67108864,F.fg|=16777215&e.DEFAULT_ATTR_DATA.fg):O===49?(F.bg&=-67108864,F.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):O===38||O===48||O===58?z+=this._extractColor(w,z,F):O===53?F.bg|=1073741824:O===55?F.bg&=-1073741825:O===59?(F.extended=F.extended.clone(),F.extended.underlineColor=-1,F.updateExtended()):O===100?(F.fg&=-67108864,F.fg|=16777215&e.DEFAULT_ATTR_DATA.fg,F.bg&=-67108864,F.bg|=16777215&e.DEFAULT_ATTR_DATA.bg):this._logService.debug("Unknown SGR attribute: %d.",O);return!0}deviceStatus(w){switch(w.params[0]){case 5:this._coreService.triggerDataEvent(`${n.C0.ESC}[0n`);break;case 6:let R=this._activeBuffer.y+1,O=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[${R};${O}R`)}return!0}deviceStatusPrivate(w){if(w.params[0]===6){let R=this._activeBuffer.y+1,O=this._activeBuffer.x+1;this._coreService.triggerDataEvent(`${n.C0.ESC}[?${R};${O}R`)}return!0}softReset(w){return this._coreService.isCursorHidden=!1,this._onRequestSyncScrollBar.fire(),this._activeBuffer.scrollTop=0,this._activeBuffer.scrollBottom=this._bufferService.rows-1,this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._coreService.reset(),this._charsetService.reset(),this._activeBuffer.savedX=0,this._activeBuffer.savedY=this._activeBuffer.ybase,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,this._coreService.decPrivateModes.origin=!1,!0}setCursorStyle(w){let R=w.params[0]||1;switch(R){case 1:case 2:this._optionsService.options.cursorStyle="block";break;case 3:case 4:this._optionsService.options.cursorStyle="underline";break;case 5:case 6:this._optionsService.options.cursorStyle="bar"}let O=R%2==1;return this._optionsService.options.cursorBlink=O,!0}setScrollRegion(w){let R=w.params[0]||1,O;return(w.length<2||(O=w.params[1])>this._bufferService.rows||O===0)&&(O=this._bufferService.rows),O>R&&(this._activeBuffer.scrollTop=R-1,this._activeBuffer.scrollBottom=O-1,this._setCursor(0,0)),!0}windowOptions(w){if(!x(w.params[0],this._optionsService.rawOptions.windowOptions))return!0;let R=w.length>1?w.params[1]:0;switch(w.params[0]){case 14:R!==2&&this._onRequestWindowsOptionsReport.fire(y.GET_WIN_SIZE_PIXELS);break;case 16:this._onRequestWindowsOptionsReport.fire(y.GET_CELL_SIZE_PIXELS);break;case 18:this._bufferService&&this._coreService.triggerDataEvent(`${n.C0.ESC}[8;${this._bufferService.rows};${this._bufferService.cols}t`);break;case 22:R!==0&&R!==2||(this._windowTitleStack.push(this._windowTitle),this._windowTitleStack.length>10&&this._windowTitleStack.shift()),R!==0&&R!==1||(this._iconNameStack.push(this._iconName),this._iconNameStack.length>10&&this._iconNameStack.shift());break;case 23:R!==0&&R!==2||this._windowTitleStack.length&&this.setTitle(this._windowTitleStack.pop()),R!==0&&R!==1||this._iconNameStack.length&&this.setIconName(this._iconNameStack.pop())}return!0}saveCursor(w){return this._activeBuffer.savedX=this._activeBuffer.x,this._activeBuffer.savedY=this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.savedCurAttrData.fg=this._curAttrData.fg,this._activeBuffer.savedCurAttrData.bg=this._curAttrData.bg,this._activeBuffer.savedCharset=this._charsetService.charset,!0}restoreCursor(w){return this._activeBuffer.x=this._activeBuffer.savedX||0,this._activeBuffer.y=Math.max(this._activeBuffer.savedY-this._activeBuffer.ybase,0),this._curAttrData.fg=this._activeBuffer.savedCurAttrData.fg,this._curAttrData.bg=this._activeBuffer.savedCurAttrData.bg,this._charsetService.charset=this._savedCharset,this._activeBuffer.savedCharset&&(this._charsetService.charset=this._activeBuffer.savedCharset),this._restrictCursor(),!0}setTitle(w){return this._windowTitle=w,this._onTitleChange.fire(w),!0}setIconName(w){return this._iconName=w,!0}setOrReportIndexedColor(w){let R=[],O=w.split(";");for(;O.length>1;){let F=O.shift(),z=O.shift();if(/^\d+$/.exec(F)){let j=parseInt(F);if(P(j))if(z==="?")R.push({type:0,index:j});else{let X=(0,C.parseColor)(z);X&&R.push({type:1,index:j,color:X})}}}return R.length&&this._onColor.fire(R),!0}setHyperlink(w){let R=w.split(";");return!(R.length<2)&&(R[1]?this._createHyperlink(R[0],R[1]):!R[0]&&this._finishHyperlink())}_createHyperlink(w,R){this._getCurrentLinkId()&&this._finishHyperlink();let O=w.split(":"),F,z=O.findIndex((j=>j.startsWith("id=")));return z!==-1&&(F=O[z].slice(3)||void 0),this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=this._oscLinkService.registerLink({id:F,uri:R}),this._curAttrData.updateExtended(),!0}_finishHyperlink(){return this._curAttrData.extended=this._curAttrData.extended.clone(),this._curAttrData.extended.urlId=0,this._curAttrData.updateExtended(),!0}_setOrReportSpecialColor(w,R){let O=w.split(";");for(let F=0;F<O.length&&!(R>=this._specialColors.length);++F,++R)if(O[F]==="?")this._onColor.fire([{type:0,index:this._specialColors[R]}]);else{let z=(0,C.parseColor)(O[F]);z&&this._onColor.fire([{type:1,index:this._specialColors[R],color:z}])}return!0}setOrReportFgColor(w){return this._setOrReportSpecialColor(w,0)}setOrReportBgColor(w){return this._setOrReportSpecialColor(w,1)}setOrReportCursorColor(w){return this._setOrReportSpecialColor(w,2)}restoreIndexedColor(w){if(!w)return this._onColor.fire([{type:2}]),!0;let R=[],O=w.split(";");for(let F=0;F<O.length;++F)if(/^\d+$/.exec(O[F])){let z=parseInt(O[F]);P(z)&&R.push({type:2,index:z})}return R.length&&this._onColor.fire(R),!0}restoreFgColor(w){return this._onColor.fire([{type:2,index:256}]),!0}restoreBgColor(w){return this._onColor.fire([{type:2,index:257}]),!0}restoreCursorColor(w){return this._onColor.fire([{type:2,index:258}]),!0}nextLine(){return this._activeBuffer.x=0,this.index(),!0}keypadApplicationMode(){return this._logService.debug("Serial port requested application keypad."),this._coreService.decPrivateModes.applicationKeypad=!0,this._onRequestSyncScrollBar.fire(),!0}keypadNumericMode(){return this._logService.debug("Switching back to normal keypad."),this._coreService.decPrivateModes.applicationKeypad=!1,this._onRequestSyncScrollBar.fire(),!0}selectDefaultCharset(){return this._charsetService.setgLevel(0),this._charsetService.setgCharset(0,f.DEFAULT_CHARSET),!0}selectCharset(w){return w.length===2?(w[0]==="/"||this._charsetService.setgCharset(k[w[0]],f.CHARSETS[w[1]]||f.DEFAULT_CHARSET),!0):(this.selectDefaultCharset(),!0)}index(){return this._restrictCursor(),this._activeBuffer.y++,this._activeBuffer.y===this._activeBuffer.scrollBottom+1?(this._activeBuffer.y--,this._bufferService.scroll(this._eraseAttrData())):this._activeBuffer.y>=this._bufferService.rows&&(this._activeBuffer.y=this._bufferService.rows-1),this._restrictCursor(),!0}tabSet(){return this._activeBuffer.tabs[this._activeBuffer.x]=!0,!0}reverseIndex(){if(this._restrictCursor(),this._activeBuffer.y===this._activeBuffer.scrollTop){let w=this._activeBuffer.scrollBottom-this._activeBuffer.scrollTop;this._activeBuffer.lines.shiftElements(this._activeBuffer.ybase+this._activeBuffer.y,w,1),this._activeBuffer.lines.set(this._activeBuffer.ybase+this._activeBuffer.y,this._activeBuffer.getBlankLine(this._eraseAttrData())),this._dirtyRowTracker.markRangeDirty(this._activeBuffer.scrollTop,this._activeBuffer.scrollBottom)}else this._activeBuffer.y--,this._restrictCursor();return!0}fullReset(){return this._parser.reset(),this._onRequestReset.fire(),!0}reset(){this._curAttrData=e.DEFAULT_ATTR_DATA.clone(),this._eraseAttrDataInternal=e.DEFAULT_ATTR_DATA.clone()}_eraseAttrData(){return this._eraseAttrDataInternal.bg&=-67108864,this._eraseAttrDataInternal.bg|=67108863&this._curAttrData.bg,this._eraseAttrDataInternal}setgLevel(w){return this._charsetService.setgLevel(w),!0}screenAlignmentPattern(){let w=new i.CellData;w.content=4194373,w.fg=this._curAttrData.fg,w.bg=this._curAttrData.bg,this._setCursor(0,0);for(let R=0;R<this._bufferService.rows;++R){let O=this._activeBuffer.ybase+this._activeBuffer.y+R,F=this._activeBuffer.lines.get(O);F&&(F.fill(w),F.isWrapped=!1)}return this._dirtyRowTracker.markAllDirty(),this._setCursor(0,0),!0}requestStatusString(w,R){let O=this._bufferService.buffer,F=this._optionsService.rawOptions;return(z=>(this._coreService.triggerDataEvent(`${n.C0.ESC}${z}${n.C0.ESC}\\`),!0))(w==='"q'?`P1$r${this._curAttrData.isProtected()?1:0}"q`:w==='"p'?'P1$r61;1"p':w==="r"?`P1$r${O.scrollTop+1};${O.scrollBottom+1}r`:w==="m"?"P1$r0m":w===" q"?`P1$r${{block:2,underline:4,bar:6}[F.cursorStyle]-(F.cursorBlink?1:0)} q`:"P0$r")}markRangeDirty(w,R){this._dirtyRowTracker.markRangeDirty(w,R)}}t.InputHandler=M;let B=class{constructor(H){this._bufferService=H,this.clearRange()}clearRange(){this.start=this._bufferService.buffer.y,this.end=this._bufferService.buffer.y}markDirty(H){H<this.start?this.start=H:H>this.end&&(this.end=H)}markRangeDirty(H,w){H>w&&(L=H,H=w,w=L),H<this.start&&(this.start=H),w>this.end&&(this.end=w)}markAllDirty(){this.markRangeDirty(0,this._bufferService.rows-1)}};function P(H){return 0<=H&&H<256}B=l([u(0,m.IBufferService)],B)},844:(A,t)=>{function a(l){for(let u of l)u.dispose();l.length=0}Object.defineProperty(t,"__esModule",{value:!0}),t.getDisposeArrayDisposable=t.disposeArray=t.toDisposable=t.MutableDisposable=t.Disposable=void 0,t.Disposable=class{constructor(){this._disposables=[],this._isDisposed=!1}dispose(){this._isDisposed=!0;for(let l of this._disposables)l.dispose();this._disposables.length=0}register(l){return this._disposables.push(l),l}unregister(l){let u=this._disposables.indexOf(l);u!==-1&&this._disposables.splice(u,1)}},t.MutableDisposable=class{constructor(){this._isDisposed=!1}get value(){return this._isDisposed?void 0:this._value}set value(l){var u;this._isDisposed||l===this._value||((u=this._value)==null||u.dispose(),this._value=l)}clear(){this.value=void 0}dispose(){var l;this._isDisposed=!0,(l=this._value)==null||l.dispose(),this._value=void 0}},t.toDisposable=function(l){return{dispose:l}},t.disposeArray=a,t.getDisposeArrayDisposable=function(l){return{dispose:()=>a(l)}}},1505:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.FourKeyMap=t.TwoKeyMap=void 0;class a{constructor(){this._data={}}set(u,n,f){this._data[u]||(this._data[u]={}),this._data[u][n]=f}get(u,n){return this._data[u]?this._data[u][n]:void 0}clear(){this._data={}}}t.TwoKeyMap=a,t.FourKeyMap=class{constructor(){this._data=new a}set(l,u,n,f,p){this._data.get(l,u)||this._data.set(l,u,new a),this._data.get(l,u).set(n,f,p)}get(l,u,n,f){var p;return(p=this._data.get(l,u))==null?void 0:p.get(n,f)}clear(){this._data.clear()}}},6114:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.isChromeOS=t.isLinux=t.isWindows=t.isIphone=t.isIpad=t.isMac=t.getSafariVersion=t.isSafari=t.isLegacyEdge=t.isFirefox=t.isNode=void 0,t.isNode=typeof process<"u"&&"title"in process;let a=t.isNode?"node":navigator.userAgent,l=t.isNode?"node":navigator.platform;t.isFirefox=a.includes("Firefox"),t.isLegacyEdge=a.includes("Edge"),t.isSafari=/^((?!chrome|android).)*safari/i.test(a),t.getSafariVersion=function(){if(!t.isSafari)return 0;let u=a.match(/Version\/(\d+)/);return u===null||u.length<2?0:parseInt(u[1])},t.isMac=["Macintosh","MacIntel","MacPPC","Mac68K"].includes(l),t.isIpad=l==="iPad",t.isIphone=l==="iPhone",t.isWindows=["Windows","Win16","Win32","WinCE"].includes(l),t.isLinux=l.indexOf("Linux")>=0,t.isChromeOS=/\bCrOS\b/.test(a)},6106:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SortedList=void 0;let a=0;t.SortedList=class{constructor(l){this._getKey=l,this._array=[]}clear(){this._array.length=0}insert(l){this._array.length===0?this._array.push(l):(a=this._search(this._getKey(l)),this._array.splice(a,0,l))}delete(l){if(this._array.length===0)return!1;let u=this._getKey(l);if(u===void 0||(a=this._search(u),a===-1)||this._getKey(this._array[a])!==u)return!1;do if(this._array[a]===l)return this._array.splice(a,1),!0;while(++a<this._array.length&&this._getKey(this._array[a])===u);return!1}*getKeyIterator(l){if(this._array.length!==0&&(a=this._search(l),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===l))do yield this._array[a];while(++a<this._array.length&&this._getKey(this._array[a])===l)}forEachByKey(l,u){if(this._array.length!==0&&(a=this._search(l),!(a<0||a>=this._array.length)&&this._getKey(this._array[a])===l))do u(this._array[a]);while(++a<this._array.length&&this._getKey(this._array[a])===l)}values(){return[...this._array].values()}_search(l){let u=0,n=this._array.length-1;for(;n>=u;){let f=u+n>>1,p=this._getKey(this._array[f]);if(p>l)n=f-1;else{if(!(p<l)){for(;f>0&&this._getKey(this._array[f-1])===l;)f--;return f}u=f+1}}return u}}},7226:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DebouncedIdleTask=t.IdleTaskQueue=t.PriorityTaskQueue=void 0;let l=a(6114);class u{constructor(){this._tasks=[],this._i=0}enqueue(p){this._tasks.push(p),this._start()}flush(){for(;this._i<this._tasks.length;)this._tasks[this._i]()||this._i++;this.clear()}clear(){this._idleCallback&&(this._idleCallback=(this._cancelCallback(this._idleCallback),void 0)),this._i=0,this._tasks.length=0}_start(){this._idleCallback||(this._idleCallback=this._requestCallback(this._process.bind(this)))}_process(p){this._idleCallback=void 0;let S=0,r=0,e=p.timeRemaining(),o=0;for(;this._i<this._tasks.length;){if(S=Date.now(),this._tasks[this._i]()||this._i++,S=Math.max(1,Date.now()-S),r=Math.max(S,r),o=p.timeRemaining(),1.5*r>o)return e-S<-20&&console.warn(`task queue exceeded allotted deadline by ${Math.abs(Math.round(e-S))}ms`),void this._start();e=o}this.clear()}}class n extends u{_requestCallback(p){return setTimeout((()=>p(this._createDeadline(16))))}_cancelCallback(p){clearTimeout(p)}_createDeadline(p){let S=Date.now()+p;return{timeRemaining:()=>Math.max(0,S-Date.now())}}}t.PriorityTaskQueue=n,t.IdleTaskQueue=!l.isNode&&"requestIdleCallback"in window?class extends u{_requestCallback(f){return requestIdleCallback(f)}_cancelCallback(f){cancelIdleCallback(f)}}:n,t.DebouncedIdleTask=class{constructor(){this._queue=new t.IdleTaskQueue}set(f){this._queue.clear(),this._queue.enqueue(f)}flush(){this._queue.flush()}}},9282:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.updateWindowsModeWrappedState=void 0;let l=a(643);t.updateWindowsModeWrappedState=function(u){var p;let n=(p=u.buffer.lines.get(u.buffer.ybase+u.buffer.y-1))==null?void 0:p.get(u.cols-1),f=u.buffer.lines.get(u.buffer.ybase+u.buffer.y);f&&n&&(f.isWrapped=n[l.CHAR_DATA_CODE_INDEX]!==l.NULL_CELL_CODE&&n[l.CHAR_DATA_CODE_INDEX]!==l.WHITESPACE_CELL_CODE)}},3734:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedAttrs=t.AttributeData=void 0;class a{constructor(){this.fg=0,this.bg=0,this.extended=new l}static toColorRGB(n){return[n>>>16&255,n>>>8&255,255&n]}static fromColorRGB(n){return(255&n[0])<<16|(255&n[1])<<8|255&n[2]}clone(){let n=new a;return n.fg=this.fg,n.bg=this.bg,n.extended=this.extended.clone(),n}isInverse(){return 67108864&this.fg}isBold(){return 134217728&this.fg}isUnderline(){return this.hasExtendedAttrs()&&this.extended.underlineStyle!==0?1:268435456&this.fg}isBlink(){return 536870912&this.fg}isInvisible(){return 1073741824&this.fg}isItalic(){return 67108864&this.bg}isDim(){return 134217728&this.bg}isStrikethrough(){return 2147483648&this.fg}isProtected(){return 536870912&this.bg}isOverline(){return 1073741824&this.bg}getFgColorMode(){return 50331648&this.fg}getBgColorMode(){return 50331648&this.bg}isFgRGB(){return(50331648&this.fg)==50331648}isBgRGB(){return(50331648&this.bg)==50331648}isFgPalette(){return(50331648&this.fg)==16777216||(50331648&this.fg)==33554432}isBgPalette(){return(50331648&this.bg)==16777216||(50331648&this.bg)==33554432}isFgDefault(){return(50331648&this.fg)==0}isBgDefault(){return(50331648&this.bg)==0}isAttributeDefault(){return this.fg===0&&this.bg===0}getFgColor(){switch(50331648&this.fg){case 16777216:case 33554432:return 255&this.fg;case 50331648:return 16777215&this.fg;default:return-1}}getBgColor(){switch(50331648&this.bg){case 16777216:case 33554432:return 255&this.bg;case 50331648:return 16777215&this.bg;default:return-1}}hasExtendedAttrs(){return 268435456&this.bg}updateExtended(){this.extended.isEmpty()?this.bg&=-268435457:this.bg|=268435456}getUnderlineColor(){if(268435456&this.bg&&~this.extended.underlineColor)switch(50331648&this.extended.underlineColor){case 16777216:case 33554432:return 255&this.extended.underlineColor;case 50331648:return 16777215&this.extended.underlineColor;default:return this.getFgColor()}return this.getFgColor()}getUnderlineColorMode(){return 268435456&this.bg&&~this.extended.underlineColor?50331648&this.extended.underlineColor:this.getFgColorMode()}isUnderlineColorRGB(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==50331648:this.isFgRGB()}isUnderlineColorPalette(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==16777216||(50331648&this.extended.underlineColor)==33554432:this.isFgPalette()}isUnderlineColorDefault(){return 268435456&this.bg&&~this.extended.underlineColor?(50331648&this.extended.underlineColor)==0:this.isFgDefault()}getUnderlineStyle(){return 268435456&this.fg?268435456&this.bg?this.extended.underlineStyle:1:0}getUnderlineVariantOffset(){return this.extended.underlineVariantOffset}}t.AttributeData=a;class l{get ext(){return this._urlId?-469762049&this._ext|this.underlineStyle<<26:this._ext}set ext(n){this._ext=n}get underlineStyle(){return this._urlId?5:(469762048&this._ext)>>26}set underlineStyle(n){this._ext&=-469762049,this._ext|=n<<26&469762048}get underlineColor(){return 67108863&this._ext}set underlineColor(n){this._ext&=-67108864,this._ext|=67108863&n}get urlId(){return this._urlId}set urlId(n){this._urlId=n}get underlineVariantOffset(){let n=(3758096384&this._ext)>>29;return n<0?4294967288^n:n}set underlineVariantOffset(n){this._ext&=536870911,this._ext|=n<<29&3758096384}constructor(n=0,f=0){this._ext=0,this._urlId=0,this._ext=n,this._urlId=f}clone(){return new l(this._ext,this._urlId)}isEmpty(){return this.underlineStyle===0&&this._urlId===0}}t.ExtendedAttrs=l},9092:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Buffer=t.MAX_BUFFER_SIZE=void 0;let l=a(6349),u=a(7226),n=a(3734),f=a(8437),p=a(4634),S=a(511),r=a(643),e=a(4863),o=a(7116);t.MAX_BUFFER_SIZE=4294967295,t.Buffer=class{constructor(s,i,h){this._hasScrollback=s,this._optionsService=i,this._bufferService=h,this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.tabs={},this.savedY=0,this.savedX=0,this.savedCurAttrData=f.DEFAULT_ATTR_DATA.clone(),this.savedCharset=o.DEFAULT_CHARSET,this.markers=[],this._nullCell=S.CellData.fromCharData([0,r.NULL_CELL_CHAR,r.NULL_CELL_WIDTH,r.NULL_CELL_CODE]),this._whitespaceCell=S.CellData.fromCharData([0,r.WHITESPACE_CELL_CHAR,r.WHITESPACE_CELL_WIDTH,r.WHITESPACE_CELL_CODE]),this._isClearing=!1,this._memoryCleanupQueue=new u.IdleTaskQueue,this._memoryCleanupPosition=0,this._cols=this._bufferService.cols,this._rows=this._bufferService.rows,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}getNullCell(s){return s?(this._nullCell.fg=s.fg,this._nullCell.bg=s.bg,this._nullCell.extended=s.extended):(this._nullCell.fg=0,this._nullCell.bg=0,this._nullCell.extended=new n.ExtendedAttrs),this._nullCell}getWhitespaceCell(s){return s?(this._whitespaceCell.fg=s.fg,this._whitespaceCell.bg=s.bg,this._whitespaceCell.extended=s.extended):(this._whitespaceCell.fg=0,this._whitespaceCell.bg=0,this._whitespaceCell.extended=new n.ExtendedAttrs),this._whitespaceCell}getBlankLine(s,i){return new f.BufferLine(this._bufferService.cols,this.getNullCell(s),i)}get hasScrollback(){return this._hasScrollback&&this.lines.maxLength>this._rows}get isCursorInViewport(){let s=this.ybase+this.y-this.ydisp;return s>=0&&s<this._rows}_getCorrectBufferLength(s){if(!this._hasScrollback)return s;let i=s+this._optionsService.rawOptions.scrollback;return i>t.MAX_BUFFER_SIZE?t.MAX_BUFFER_SIZE:i}fillViewportRows(s){if(this.lines.length===0){s===void 0&&(s=f.DEFAULT_ATTR_DATA);let i=this._rows;for(;i--;)this.lines.push(this.getBlankLine(s))}}clear(){this.ydisp=0,this.ybase=0,this.y=0,this.x=0,this.lines=new l.CircularList(this._getCorrectBufferLength(this._rows)),this.scrollTop=0,this.scrollBottom=this._rows-1,this.setupTabStops()}resize(s,i){let h=this.getNullCell(f.DEFAULT_ATTR_DATA),m=0,d=this._getCorrectBufferLength(i);if(d>this.lines.maxLength&&(this.lines.maxLength=d),this.lines.length>0){if(this._cols<s)for(let v=0;v<this.lines.length;v++)m+=+this.lines.get(v).resize(s,h);let c=0;if(this._rows<i)for(let v=this._rows;v<i;v++)this.lines.length<i+this.ybase&&(this._optionsService.rawOptions.windowsMode||this._optionsService.rawOptions.windowsPty.backend!==void 0||this._optionsService.rawOptions.windowsPty.buildNumber!==void 0?this.lines.push(new f.BufferLine(s,h)):this.ybase>0&&this.lines.length<=this.ybase+this.y+c+1?(this.ybase--,c++,this.ydisp>0&&this.ydisp--):this.lines.push(new f.BufferLine(s,h)));else for(let v=this._rows;v>i;v--)this.lines.length>i+this.ybase&&(this.lines.length>this.ybase+this.y+1?this.lines.pop():(this.ybase++,this.ydisp++));if(d<this.lines.maxLength){let v=this.lines.length-d;v>0&&(this.lines.trimStart(v),this.ybase=Math.max(this.ybase-v,0),this.ydisp=Math.max(this.ydisp-v,0),this.savedY=Math.max(this.savedY-v,0)),this.lines.maxLength=d}this.x=Math.min(this.x,s-1),this.y=Math.min(this.y,i-1),c&&(this.y+=c),this.savedX=Math.min(this.savedX,s-1),this.scrollTop=0}if(this.scrollBottom=i-1,this._isReflowEnabled&&(this._reflow(s,i),this._cols>s))for(let c=0;c<this.lines.length;c++)m+=+this.lines.get(c).resize(s,h);this._cols=s,this._rows=i,this._memoryCleanupQueue.clear(),m>.1*this.lines.length&&(this._memoryCleanupPosition=0,this._memoryCleanupQueue.enqueue((()=>this._batchedMemoryCleanup())))}_batchedMemoryCleanup(){let s=!0;this._memoryCleanupPosition>=this.lines.length&&(this._memoryCleanupPosition=0,s=!1);let i=0;for(;this._memoryCleanupPosition<this.lines.length;)if(i+=this.lines.get(this._memoryCleanupPosition++).cleanupMemory(),i>100)return!0;return s}get _isReflowEnabled(){let s=this._optionsService.rawOptions.windowsPty;return s&&s.buildNumber?this._hasScrollback&&s.backend==="conpty"&&s.buildNumber>=21376:this._hasScrollback&&!this._optionsService.rawOptions.windowsMode}_reflow(s,i){this._cols!==s&&(s>this._cols?this._reflowLarger(s,i):this._reflowSmaller(s,i))}_reflowLarger(s,i){let h=(0,p.reflowLargerGetLinesToRemove)(this.lines,this._cols,s,this.ybase+this.y,this.getNullCell(f.DEFAULT_ATTR_DATA));if(h.length>0){let m=(0,p.reflowLargerCreateNewLayout)(this.lines,h);(0,p.reflowLargerApplyNewLayout)(this.lines,m.layout),this._reflowLargerAdjustViewport(s,i,m.countRemoved)}}_reflowLargerAdjustViewport(s,i,h){let m=this.getNullCell(f.DEFAULT_ATTR_DATA),d=h;for(;d-- >0;)this.ybase===0?(this.y>0&&this.y--,this.lines.length<i&&this.lines.push(new f.BufferLine(s,m))):(this.ydisp===this.ybase&&this.ydisp--,this.ybase--);this.savedY=Math.max(this.savedY-h,0)}_reflowSmaller(s,i){let h=this.getNullCell(f.DEFAULT_ATTR_DATA),m=[],d=0;for(let c=this.lines.length-1;c>=0;c--){let v=this.lines.get(c);if(!v||!v.isWrapped&&v.getTrimmedLength()<=s)continue;let C=[v];for(;v.isWrapped&&c>0;)v=this.lines.get(--c),C.unshift(v);let k=this.ybase+this.y;if(k>=c&&k<c+C.length)continue;let D=C[C.length-1].getTrimmedLength(),x=(0,p.reflowSmallerGetNewLineLengths)(C,this._cols,s),y=x.length-C.length,L;L=this.ybase===0&&this.y!==this.lines.length-1?Math.max(0,this.y-this.lines.maxLength+y):Math.max(0,this.lines.length-this.lines.maxLength+y);let M=[];for(let O=0;O<y;O++){let F=this.getBlankLine(f.DEFAULT_ATTR_DATA,!0);M.push(F)}M.length>0&&(m.push({start:c+C.length+d,newLines:M}),d+=M.length),C.push(...M);let B=x.length-1,P=x[B];P===0&&(B--,P=x[B]);let H=C.length-y-1,w=D;for(;H>=0;){let O=Math.min(w,P);if(C[B]===void 0)break;if(C[B].copyCellsFrom(C[H],w-O,P-O,O,!0),P-=O,P===0&&(B--,P=x[B]),w-=O,w===0){H--;let F=Math.max(H,0);w=(0,p.getWrappedLineTrimmedLength)(C,F,this._cols)}}for(let O=0;O<C.length;O++)x[O]<s&&C[O].setCell(x[O],h);let R=y-L;for(;R-- >0;)this.ybase===0?this.y<i-1?(this.y++,this.lines.pop()):(this.ybase++,this.ydisp++):this.ybase<Math.min(this.lines.maxLength,this.lines.length+d)-i&&(this.ybase===this.ydisp&&this.ydisp++,this.ybase++);this.savedY=Math.min(this.savedY+y,this.ybase+i-1)}if(m.length>0){let c=[],v=[];for(let B=0;B<this.lines.length;B++)v.push(this.lines.get(B));let C=this.lines.length,k=C-1,D=0,x=m[D];this.lines.length=Math.min(this.lines.maxLength,this.lines.length+d);let y=0;for(let B=Math.min(this.lines.maxLength-1,C+d-1);B>=0;B--)if(x&&x.start>k+y){for(let P=x.newLines.length-1;P>=0;P--)this.lines.set(B--,x.newLines[P]);B++,c.push({index:k+1,amount:x.newLines.length}),y+=x.newLines.length,x=m[++D]}else this.lines.set(B,v[k--]);let L=0;for(let B=c.length-1;B>=0;B--)c[B].index+=L,this.lines.onInsertEmitter.fire(c[B]),L+=c[B].amount;let M=Math.max(0,C+d-this.lines.maxLength);M>0&&this.lines.onTrimEmitter.fire(M)}}translateBufferLineToString(s,i,h=0,m){let d=this.lines.get(s);return d?d.translateToString(i,h,m):""}getWrappedRangeForLine(s){let i=s,h=s;for(;i>0&&this.lines.get(i).isWrapped;)i--;for(;h+1<this.lines.length&&this.lines.get(h+1).isWrapped;)h++;return{first:i,last:h}}setupTabStops(s){for(s==null?(this.tabs={},s=0):this.tabs[s]||(s=this.prevStop(s));s<this._cols;s+=this._optionsService.rawOptions.tabStopWidth)this.tabs[s]=!0}prevStop(s){for(s??(s=this.x);!this.tabs[--s]&&s>0;);return s>=this._cols?this._cols-1:s<0?0:s}nextStop(s){for(s??(s=this.x);!this.tabs[++s]&&s<this._cols;);return s>=this._cols?this._cols-1:s<0?0:s}clearMarkers(s){this._isClearing=!0;for(let i=0;i<this.markers.length;i++)this.markers[i].line===s&&(this.markers[i].dispose(),this.markers.splice(i--,1));this._isClearing=!1}clearAllMarkers(){this._isClearing=!0;for(let s=0;s<this.markers.length;s++)this.markers[s].dispose(),this.markers.splice(s--,1);this._isClearing=!1}addMarker(s){let i=new e.Marker(s);return this.markers.push(i),i.register(this.lines.onTrim((h=>{i.line-=h,i.line<0&&i.dispose()}))),i.register(this.lines.onInsert((h=>{i.line>=h.index&&(i.line+=h.amount)}))),i.register(this.lines.onDelete((h=>{i.line>=h.index&&i.line<h.index+h.amount&&i.dispose(),i.line>h.index&&(i.line-=h.amount)}))),i.register(i.onDispose((()=>this._removeMarker(i)))),i}_removeMarker(s){this._isClearing||this.markers.splice(this.markers.indexOf(s),1)}}},8437:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLine=t.DEFAULT_ATTR_DATA=void 0;let l=a(3734),u=a(511),n=a(643),f=a(482);t.DEFAULT_ATTR_DATA=Object.freeze(new l.AttributeData);let p=0;class S{constructor(e,o,s=!1){this.isWrapped=s,this._combined={},this._extendedAttrs={},this._data=new Uint32Array(3*e);let i=o||u.CellData.fromCharData([0,n.NULL_CELL_CHAR,n.NULL_CELL_WIDTH,n.NULL_CELL_CODE]);for(let h=0;h<e;++h)this.setCell(h,i);this.length=e}get(e){let o=this._data[3*e+0],s=2097151&o;return[this._data[3*e+1],2097152&o?this._combined[e]:s?(0,f.stringFromCodePoint)(s):"",o>>22,2097152&o?this._combined[e].charCodeAt(this._combined[e].length-1):s]}set(e,o){this._data[3*e+1]=o[n.CHAR_DATA_ATTR_INDEX],o[n.CHAR_DATA_CHAR_INDEX].length>1?(this._combined[e]=o[1],this._data[3*e+0]=2097152|e|o[n.CHAR_DATA_WIDTH_INDEX]<<22):this._data[3*e+0]=o[n.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|o[n.CHAR_DATA_WIDTH_INDEX]<<22}getWidth(e){return this._data[3*e+0]>>22}hasWidth(e){return 12582912&this._data[3*e+0]}getFg(e){return this._data[3*e+1]}getBg(e){return this._data[3*e+2]}hasContent(e){return 4194303&this._data[3*e+0]}getCodePoint(e){let o=this._data[3*e+0];return 2097152&o?this._combined[e].charCodeAt(this._combined[e].length-1):2097151&o}isCombined(e){return 2097152&this._data[3*e+0]}getString(e){let o=this._data[3*e+0];return 2097152&o?this._combined[e]:2097151&o?(0,f.stringFromCodePoint)(2097151&o):""}isProtected(e){return 536870912&this._data[3*e+2]}loadCell(e,o){return p=3*e,o.content=this._data[p+0],o.fg=this._data[p+1],o.bg=this._data[p+2],2097152&o.content&&(o.combinedData=this._combined[e]),268435456&o.bg&&(o.extended=this._extendedAttrs[e]),o}setCell(e,o){2097152&o.content&&(this._combined[e]=o.combinedData),268435456&o.bg&&(this._extendedAttrs[e]=o.extended),this._data[3*e+0]=o.content,this._data[3*e+1]=o.fg,this._data[3*e+2]=o.bg}setCellFromCodepoint(e,o,s,i){268435456&i.bg&&(this._extendedAttrs[e]=i.extended),this._data[3*e+0]=o|s<<22,this._data[3*e+1]=i.fg,this._data[3*e+2]=i.bg}addCodepointToCell(e,o,s){let i=this._data[3*e+0];2097152&i?this._combined[e]+=(0,f.stringFromCodePoint)(o):2097151&i?(this._combined[e]=(0,f.stringFromCodePoint)(2097151&i)+(0,f.stringFromCodePoint)(o),i&=-2097152,i|=2097152):i=o|4194304,s&&(i&=-12582913,i|=s<<22),this._data[3*e+0]=i}insertCells(e,o,s){if((e%=this.length)&&this.getWidth(e-1)===2&&this.setCellFromCodepoint(e-1,0,1,s),o<this.length-e){let i=new u.CellData;for(let h=this.length-e-o-1;h>=0;--h)this.setCell(e+o+h,this.loadCell(e+h,i));for(let h=0;h<o;++h)this.setCell(e+h,s)}else for(let i=e;i<this.length;++i)this.setCell(i,s);this.getWidth(this.length-1)===2&&this.setCellFromCodepoint(this.length-1,0,1,s)}deleteCells(e,o,s){if(e%=this.length,o<this.length-e){let i=new u.CellData;for(let h=0;h<this.length-e-o;++h)this.setCell(e+h,this.loadCell(e+o+h,i));for(let h=this.length-o;h<this.length;++h)this.setCell(h,s)}else for(let i=e;i<this.length;++i)this.setCell(i,s);e&&this.getWidth(e-1)===2&&this.setCellFromCodepoint(e-1,0,1,s),this.getWidth(e)!==0||this.hasContent(e)||this.setCellFromCodepoint(e,0,1,s)}replaceCells(e,o,s,i=!1){if(i)for(e&&this.getWidth(e-1)===2&&!this.isProtected(e-1)&&this.setCellFromCodepoint(e-1,0,1,s),o<this.length&&this.getWidth(o-1)===2&&!this.isProtected(o)&&this.setCellFromCodepoint(o,0,1,s);e<o&&e<this.length;)this.isProtected(e)||this.setCell(e,s),e++;else for(e&&this.getWidth(e-1)===2&&this.setCellFromCodepoint(e-1,0,1,s),o<this.length&&this.getWidth(o-1)===2&&this.setCellFromCodepoint(o,0,1,s);e<o&&e<this.length;)this.setCell(e++,s)}resize(e,o){if(e===this.length)return 4*this._data.length*2<this._data.buffer.byteLength;let s=3*e;if(e>this.length){if(this._data.buffer.byteLength>=4*s)this._data=new Uint32Array(this._data.buffer,0,s);else{let i=new Uint32Array(s);i.set(this._data),this._data=i}for(let i=this.length;i<e;++i)this.setCell(i,o)}else{this._data=this._data.subarray(0,s);let i=Object.keys(this._combined);for(let m=0;m<i.length;m++){let d=parseInt(i[m],10);d>=e&&delete this._combined[d]}let h=Object.keys(this._extendedAttrs);for(let m=0;m<h.length;m++){let d=parseInt(h[m],10);d>=e&&delete this._extendedAttrs[d]}}return this.length=e,4*s*2<this._data.buffer.byteLength}cleanupMemory(){if(4*this._data.length*2<this._data.buffer.byteLength){let e=new Uint32Array(this._data.length);return e.set(this._data),this._data=e,1}return 0}fill(e,o=!1){if(o)for(let s=0;s<this.length;++s)this.isProtected(s)||this.setCell(s,e);else{this._combined={},this._extendedAttrs={};for(let s=0;s<this.length;++s)this.setCell(s,e)}}copyFrom(e){for(let o in this.length===e.length?this._data.set(e._data):this._data=new Uint32Array(e._data),this.length=e.length,this._combined={},e._combined)this._combined[o]=e._combined[o];for(let o in this._extendedAttrs={},e._extendedAttrs)this._extendedAttrs[o]=e._extendedAttrs[o];this.isWrapped=e.isWrapped}clone(){let e=new S(0);for(let o in e._data=new Uint32Array(this._data),e.length=this.length,this._combined)e._combined[o]=this._combined[o];for(let o in this._extendedAttrs)e._extendedAttrs[o]=this._extendedAttrs[o];return e.isWrapped=this.isWrapped,e}getTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0])return e+(this._data[3*e+0]>>22);return 0}getNoBgTrimmedLength(){for(let e=this.length-1;e>=0;--e)if(4194303&this._data[3*e+0]||50331648&this._data[3*e+2])return e+(this._data[3*e+0]>>22);return 0}copyCellsFrom(e,o,s,i,h){let m=e._data;if(h)for(let c=i-1;c>=0;c--){for(let v=0;v<3;v++)this._data[3*(s+c)+v]=m[3*(o+c)+v];268435456&m[3*(o+c)+2]&&(this._extendedAttrs[s+c]=e._extendedAttrs[o+c])}else for(let c=0;c<i;c++){for(let v=0;v<3;v++)this._data[3*(s+c)+v]=m[3*(o+c)+v];268435456&m[3*(o+c)+2]&&(this._extendedAttrs[s+c]=e._extendedAttrs[o+c])}let d=Object.keys(e._combined);for(let c=0;c<d.length;c++){let v=parseInt(d[c],10);v>=o&&(this._combined[v-o+s]=e._combined[v])}}translateToString(e,o,s,i){o??(o=0),s??(s=this.length),e&&(s=Math.min(s,this.getTrimmedLength())),i&&(i.length=0);let h="";for(;o<s;){let m=this._data[3*o+0],d=2097151&m,c=2097152&m?this._combined[o]:d?(0,f.stringFromCodePoint)(d):n.WHITESPACE_CELL_CHAR;if(h+=c,i)for(let v=0;v<c.length;++v)i.push(o);o+=m>>22||1}return i&&i.push(o),h}}t.BufferLine=S},4841:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRangeLength=void 0,t.getRangeLength=function(a,l){if(a.start.y>a.end.y)throw Error(`Buffer range end (${a.end.x}, ${a.end.y}) cannot be before start (${a.start.x}, ${a.start.y})`);return l*(a.end.y-a.start.y)+(a.end.x-a.start.x+1)}},4634:(A,t)=>{function a(l,u,n){if(u===l.length-1)return l[u].getTrimmedLength();let f=!l[u].hasContent(n-1)&&l[u].getWidth(n-1)===1,p=l[u+1].getWidth(0)===2;return f&&p?n-1:n}Object.defineProperty(t,"__esModule",{value:!0}),t.getWrappedLineTrimmedLength=t.reflowSmallerGetNewLineLengths=t.reflowLargerApplyNewLayout=t.reflowLargerCreateNewLayout=t.reflowLargerGetLinesToRemove=void 0,t.reflowLargerGetLinesToRemove=function(l,u,n,f,p){let S=[];for(let r=0;r<l.length-1;r++){let e=r,o=l.get(++e);if(!o.isWrapped)continue;let s=[l.get(r)];for(;e<l.length&&o.isWrapped;)s.push(o),o=l.get(++e);if(f>=r&&f<e){r+=s.length-1;continue}let i=0,h=a(s,i,u),m=1,d=0;for(;m<s.length;){let v=a(s,m,u),C=v-d,k=n-h,D=Math.min(C,k);s[i].copyCellsFrom(s[m],d,h,D,!1),h+=D,h===n&&(i++,h=0),d+=D,d===v&&(m++,d=0),h===0&&i!==0&&s[i-1].getWidth(n-1)===2&&(s[i].copyCellsFrom(s[i-1],n-1,h++,1,!1),s[i-1].setCell(n-1,p))}s[i].replaceCells(h,n,p);let c=0;for(let v=s.length-1;v>0&&(v>i||s[v].getTrimmedLength()===0);v--)c++;c>0&&(S.push(r+s.length-c),S.push(c)),r+=s.length-1}return S},t.reflowLargerCreateNewLayout=function(l,u){let n=[],f=0,p=u[f],S=0;for(let r=0;r<l.length;r++)if(p===r){let e=u[++f];l.onDeleteEmitter.fire({index:r-S,amount:e}),r+=e-1,S+=e,p=u[++f]}else n.push(r);return{layout:n,countRemoved:S}},t.reflowLargerApplyNewLayout=function(l,u){let n=[];for(let f=0;f<u.length;f++)n.push(l.get(u[f]));for(let f=0;f<n.length;f++)l.set(f,n[f]);l.length=u.length},t.reflowSmallerGetNewLineLengths=function(l,u,n){let f=[],p=l.map(((o,s)=>a(l,s,u))).reduce(((o,s)=>o+s)),S=0,r=0,e=0;for(;e<p;){if(p-e<n){f.push(p-e);break}S+=n;let o=a(l,r,u);S>o&&(S-=o,r++);let s=l[r].getWidth(S-1)===2;s&&S--;let i=s?n-1:n;f.push(i),e+=i}return f},t.getWrappedLineTrimmedLength=a},5295:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferSet=void 0;let l=a(8460),u=a(844),n=a(9092);class f extends u.Disposable{constructor(S,r){super(),this._optionsService=S,this._bufferService=r,this._onBufferActivate=this.register(new l.EventEmitter),this.onBufferActivate=this._onBufferActivate.event,this.reset(),this.register(this._optionsService.onSpecificOptionChange("scrollback",(()=>this.resize(this._bufferService.cols,this._bufferService.rows)))),this.register(this._optionsService.onSpecificOptionChange("tabStopWidth",(()=>this.setupTabStops())))}reset(){this._normal=new n.Buffer(!0,this._optionsService,this._bufferService),this._normal.fillViewportRows(),this._alt=new n.Buffer(!1,this._optionsService,this._bufferService),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}),this.setupTabStops()}get alt(){return this._alt}get active(){return this._activeBuffer}get normal(){return this._normal}activateNormalBuffer(){this._activeBuffer!==this._normal&&(this._normal.x=this._alt.x,this._normal.y=this._alt.y,this._alt.clearAllMarkers(),this._alt.clear(),this._activeBuffer=this._normal,this._onBufferActivate.fire({activeBuffer:this._normal,inactiveBuffer:this._alt}))}activateAltBuffer(S){this._activeBuffer!==this._alt&&(this._alt.fillViewportRows(S),this._alt.x=this._normal.x,this._alt.y=this._normal.y,this._activeBuffer=this._alt,this._onBufferActivate.fire({activeBuffer:this._alt,inactiveBuffer:this._normal}))}resize(S,r){this._normal.resize(S,r),this._alt.resize(S,r),this.setupTabStops(S)}setupTabStops(S){this._normal.setupTabStops(S),this._alt.setupTabStops(S)}}t.BufferSet=f},511:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CellData=void 0;let l=a(482),u=a(643),n=a(3734);class f extends n.AttributeData{constructor(){super(...arguments),this.content=0,this.fg=0,this.bg=0,this.extended=new n.ExtendedAttrs,this.combinedData=""}static fromCharData(S){let r=new f;return r.setFromCharData(S),r}isCombined(){return 2097152&this.content}getWidth(){return this.content>>22}getChars(){return 2097152&this.content?this.combinedData:2097151&this.content?(0,l.stringFromCodePoint)(2097151&this.content):""}getCode(){return this.isCombined()?this.combinedData.charCodeAt(this.combinedData.length-1):2097151&this.content}setFromCharData(S){this.fg=S[u.CHAR_DATA_ATTR_INDEX],this.bg=0;let r=!1;if(S[u.CHAR_DATA_CHAR_INDEX].length>2)r=!0;else if(S[u.CHAR_DATA_CHAR_INDEX].length===2){let e=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0);if(55296<=e&&e<=56319){let o=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(1);56320<=o&&o<=57343?this.content=1024*(e-55296)+o-56320+65536|S[u.CHAR_DATA_WIDTH_INDEX]<<22:r=!0}else r=!0}else this.content=S[u.CHAR_DATA_CHAR_INDEX].charCodeAt(0)|S[u.CHAR_DATA_WIDTH_INDEX]<<22;r&&(this.combinedData=S[u.CHAR_DATA_CHAR_INDEX],this.content=2097152|S[u.CHAR_DATA_WIDTH_INDEX]<<22)}getAsCharData(){return[this.fg,this.getChars(),this.getWidth(),this.getCode()]}}t.CellData=f},643:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WHITESPACE_CELL_CODE=t.WHITESPACE_CELL_WIDTH=t.WHITESPACE_CELL_CHAR=t.NULL_CELL_CODE=t.NULL_CELL_WIDTH=t.NULL_CELL_CHAR=t.CHAR_DATA_CODE_INDEX=t.CHAR_DATA_WIDTH_INDEX=t.CHAR_DATA_CHAR_INDEX=t.CHAR_DATA_ATTR_INDEX=t.DEFAULT_EXT=t.DEFAULT_ATTR=t.DEFAULT_COLOR=void 0,t.DEFAULT_COLOR=0,t.DEFAULT_ATTR=256|t.DEFAULT_COLOR<<9,t.DEFAULT_EXT=0,t.CHAR_DATA_ATTR_INDEX=0,t.CHAR_DATA_CHAR_INDEX=1,t.CHAR_DATA_WIDTH_INDEX=2,t.CHAR_DATA_CODE_INDEX=3,t.NULL_CELL_CHAR="",t.NULL_CELL_WIDTH=1,t.NULL_CELL_CODE=0,t.WHITESPACE_CELL_CHAR=" ",t.WHITESPACE_CELL_WIDTH=1,t.WHITESPACE_CELL_CODE=32},4863:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Marker=void 0;let l=a(8460),u=a(844);class n{get id(){return this._id}constructor(p){this.line=p,this.isDisposed=!1,this._disposables=[],this._id=n._nextId++,this._onDispose=this.register(new l.EventEmitter),this.onDispose=this._onDispose.event}dispose(){this.isDisposed||(this.isDisposed=!0,this.line=-1,this._onDispose.fire(),(0,u.disposeArray)(this._disposables),this._disposables.length=0)}register(p){return this._disposables.push(p),p}}t.Marker=n,n._nextId=1},7116:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DEFAULT_CHARSET=t.CHARSETS=void 0,t.CHARSETS={},t.DEFAULT_CHARSET=t.CHARSETS.B,t.CHARSETS[0]={"`":"\u25C6",a:"\u2592",b:"\u2409",c:"\u240C",d:"\u240D",e:"\u240A",f:"\xB0",g:"\xB1",h:"\u2424",i:"\u240B",j:"\u2518",k:"\u2510",l:"\u250C",m:"\u2514",n:"\u253C",o:"\u23BA",p:"\u23BB",q:"\u2500",r:"\u23BC",s:"\u23BD",t:"\u251C",u:"\u2524",v:"\u2534",w:"\u252C",x:"\u2502",y:"\u2264",z:"\u2265","{":"\u03C0","|":"\u2260","}":"\xA3","~":"\xB7"},t.CHARSETS.A={"#":"\xA3"},t.CHARSETS.B=void 0,t.CHARSETS[4]={"#":"\xA3","@":"\xBE","[":"ij","\\":"\xBD","]":"|","{":"\xA8","|":"f","}":"\xBC","~":"\xB4"},t.CHARSETS.C=t.CHARSETS[5]={"[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},t.CHARSETS.R={"#":"\xA3","@":"\xE0","[":"\xB0","\\":"\xE7","]":"\xA7","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xA8"},t.CHARSETS.Q={"@":"\xE0","[":"\xE2","\\":"\xE7","]":"\xEA","^":"\xEE","`":"\xF4","{":"\xE9","|":"\xF9","}":"\xE8","~":"\xFB"},t.CHARSETS.K={"@":"\xA7","[":"\xC4","\\":"\xD6","]":"\xDC","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xDF"},t.CHARSETS.Y={"#":"\xA3","@":"\xA7","[":"\xB0","\\":"\xE7","]":"\xE9","`":"\xF9","{":"\xE0","|":"\xF2","}":"\xE8","~":"\xEC"},t.CHARSETS.E=t.CHARSETS[6]={"@":"\xC4","[":"\xC6","\\":"\xD8","]":"\xC5","^":"\xDC","`":"\xE4","{":"\xE6","|":"\xF8","}":"\xE5","~":"\xFC"},t.CHARSETS.Z={"#":"\xA3","@":"\xA7","[":"\xA1","\\":"\xD1","]":"\xBF","{":"\xB0","|":"\xF1","}":"\xE7"},t.CHARSETS.H=t.CHARSETS[7]={"@":"\xC9","[":"\xC4","\\":"\xD6","]":"\xC5","^":"\xDC","`":"\xE9","{":"\xE4","|":"\xF6","}":"\xE5","~":"\xFC"},t.CHARSETS["="]={"#":"\xF9","@":"\xE0","[":"\xE9","\\":"\xE7","]":"\xEA","^":"\xEE",_:"\xE8","`":"\xF4","{":"\xE4","|":"\xF6","}":"\xFC","~":"\xFB"}},2584:(A,t)=>{var a,l,u;Object.defineProperty(t,"__esModule",{value:!0}),t.C1_ESCAPED=t.C1=t.C0=void 0,(function(n){n.NUL="\0",n.SOH="",n.STX="",n.ETX="",n.EOT="",n.ENQ="",n.ACK="",n.BEL="\x07",n.BS="\b",n.HT="	",n.LF=`
`,n.VT="\v",n.FF="\f",n.CR="\r",n.SO="",n.SI="",n.DLE="",n.DC1="",n.DC2="",n.DC3="",n.DC4="",n.NAK="",n.SYN="",n.ETB="",n.CAN="",n.EM="",n.SUB="",n.ESC="\x1B",n.FS="",n.GS="",n.RS="",n.US="",n.SP=" ",n.DEL="\x7F"})(a||(t.C0=a={})),(function(n){n.PAD="\x80",n.HOP="\x81",n.BPH="\x82",n.NBH="\x83",n.IND="\x84",n.NEL="\x85",n.SSA="\x86",n.ESA="\x87",n.HTS="\x88",n.HTJ="\x89",n.VTS="\x8A",n.PLD="\x8B",n.PLU="\x8C",n.RI="\x8D",n.SS2="\x8E",n.SS3="\x8F",n.DCS="\x90",n.PU1="\x91",n.PU2="\x92",n.STS="\x93",n.CCH="\x94",n.MW="\x95",n.SPA="\x96",n.EPA="\x97",n.SOS="\x98",n.SGCI="\x99",n.SCI="\x9A",n.CSI="\x9B",n.ST="\x9C",n.OSC="\x9D",n.PM="\x9E",n.APC="\x9F"})(l||(t.C1=l={})),(function(n){n.ST=`${a.ESC}\\`})(u||(t.C1_ESCAPED=u={}))},7399:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.evaluateKeyboardEvent=void 0;let l=a(2584),u={48:["0",")"],49:["1","!"],50:["2","@"],51:["3","#"],52:["4","$"],53:["5","%"],54:["6","^"],55:["7","&"],56:["8","*"],57:["9","("],186:[";",":"],187:["=","+"],188:[",","<"],189:["-","_"],190:[".",">"],191:["/","?"],192:["`","~"],219:["[","{"],220:["\\","|"],221:["]","}"],222:["'",'"']};t.evaluateKeyboardEvent=function(n,f,p,S){var o;let r={type:0,cancel:!1,key:void 0},e=(n.shiftKey?1:0)|(n.altKey?2:0)|(n.ctrlKey?4:0)|(n.metaKey?8:0);switch(n.keyCode){case 0:n.key==="UIKeyInputUpArrow"?r.key=f?l.C0.ESC+"OA":l.C0.ESC+"[A":n.key==="UIKeyInputLeftArrow"?r.key=f?l.C0.ESC+"OD":l.C0.ESC+"[D":n.key==="UIKeyInputRightArrow"?r.key=f?l.C0.ESC+"OC":l.C0.ESC+"[C":n.key==="UIKeyInputDownArrow"&&(r.key=f?l.C0.ESC+"OB":l.C0.ESC+"[B");break;case 8:r.key=n.ctrlKey?"\b":l.C0.DEL,n.altKey&&(r.key=l.C0.ESC+r.key);break;case 9:if(n.shiftKey){r.key=l.C0.ESC+"[Z";break}r.key=l.C0.HT,r.cancel=!0;break;case 13:r.key=n.altKey?l.C0.ESC+l.C0.CR:l.C0.CR,r.cancel=!0;break;case 27:r.key=l.C0.ESC,n.altKey&&(r.key=l.C0.ESC+l.C0.ESC),r.cancel=!0;break;case 37:if(n.metaKey)break;e?(r.key=l.C0.ESC+"[1;"+(e+1)+"D",r.key===l.C0.ESC+"[1;3D"&&(r.key=l.C0.ESC+(p?"b":"[1;5D"))):r.key=f?l.C0.ESC+"OD":l.C0.ESC+"[D";break;case 39:if(n.metaKey)break;e?(r.key=l.C0.ESC+"[1;"+(e+1)+"C",r.key===l.C0.ESC+"[1;3C"&&(r.key=l.C0.ESC+(p?"f":"[1;5C"))):r.key=f?l.C0.ESC+"OC":l.C0.ESC+"[C";break;case 38:if(n.metaKey)break;e?(r.key=l.C0.ESC+"[1;"+(e+1)+"A",p||r.key!==l.C0.ESC+"[1;3A"||(r.key=l.C0.ESC+"[1;5A")):r.key=f?l.C0.ESC+"OA":l.C0.ESC+"[A";break;case 40:if(n.metaKey)break;e?(r.key=l.C0.ESC+"[1;"+(e+1)+"B",p||r.key!==l.C0.ESC+"[1;3B"||(r.key=l.C0.ESC+"[1;5B")):r.key=f?l.C0.ESC+"OB":l.C0.ESC+"[B";break;case 45:n.shiftKey||n.ctrlKey||(r.key=l.C0.ESC+"[2~");break;case 46:r.key=e?l.C0.ESC+"[3;"+(e+1)+"~":l.C0.ESC+"[3~";break;case 36:r.key=e?l.C0.ESC+"[1;"+(e+1)+"H":f?l.C0.ESC+"OH":l.C0.ESC+"[H";break;case 35:r.key=e?l.C0.ESC+"[1;"+(e+1)+"F":f?l.C0.ESC+"OF":l.C0.ESC+"[F";break;case 33:n.shiftKey?r.type=2:n.ctrlKey?r.key=l.C0.ESC+"[5;"+(e+1)+"~":r.key=l.C0.ESC+"[5~";break;case 34:n.shiftKey?r.type=3:n.ctrlKey?r.key=l.C0.ESC+"[6;"+(e+1)+"~":r.key=l.C0.ESC+"[6~";break;case 112:r.key=e?l.C0.ESC+"[1;"+(e+1)+"P":l.C0.ESC+"OP";break;case 113:r.key=e?l.C0.ESC+"[1;"+(e+1)+"Q":l.C0.ESC+"OQ";break;case 114:r.key=e?l.C0.ESC+"[1;"+(e+1)+"R":l.C0.ESC+"OR";break;case 115:r.key=e?l.C0.ESC+"[1;"+(e+1)+"S":l.C0.ESC+"OS";break;case 116:r.key=e?l.C0.ESC+"[15;"+(e+1)+"~":l.C0.ESC+"[15~";break;case 117:r.key=e?l.C0.ESC+"[17;"+(e+1)+"~":l.C0.ESC+"[17~";break;case 118:r.key=e?l.C0.ESC+"[18;"+(e+1)+"~":l.C0.ESC+"[18~";break;case 119:r.key=e?l.C0.ESC+"[19;"+(e+1)+"~":l.C0.ESC+"[19~";break;case 120:r.key=e?l.C0.ESC+"[20;"+(e+1)+"~":l.C0.ESC+"[20~";break;case 121:r.key=e?l.C0.ESC+"[21;"+(e+1)+"~":l.C0.ESC+"[21~";break;case 122:r.key=e?l.C0.ESC+"[23;"+(e+1)+"~":l.C0.ESC+"[23~";break;case 123:r.key=e?l.C0.ESC+"[24;"+(e+1)+"~":l.C0.ESC+"[24~";break;default:if(!n.ctrlKey||n.shiftKey||n.altKey||n.metaKey)if(p&&!S||!n.altKey||n.metaKey)!p||n.altKey||n.ctrlKey||n.shiftKey||!n.metaKey?n.key&&!n.ctrlKey&&!n.altKey&&!n.metaKey&&n.keyCode>=48&&n.key.length===1?r.key=n.key:n.key&&n.ctrlKey&&(n.key==="_"&&(r.key=l.C0.US),n.key==="@"&&(r.key=l.C0.NUL)):n.keyCode===65&&(r.type=1);else{let s=(o=u[n.keyCode])==null?void 0:o[n.shiftKey?1:0];if(s)r.key=l.C0.ESC+s;else if(n.keyCode>=65&&n.keyCode<=90){let i=n.ctrlKey?n.keyCode-64:n.keyCode+32,h=String.fromCharCode(i);n.shiftKey&&(h=h.toUpperCase()),r.key=l.C0.ESC+h}else if(n.keyCode===32)r.key=l.C0.ESC+(n.ctrlKey?l.C0.NUL:" ");else if(n.key==="Dead"&&n.code.startsWith("Key")){let i=n.code.slice(3,4);n.shiftKey||(i=i.toLowerCase()),r.key=l.C0.ESC+i,r.cancel=!0}}else n.keyCode>=65&&n.keyCode<=90?r.key=String.fromCharCode(n.keyCode-64):n.keyCode===32?r.key=l.C0.NUL:n.keyCode>=51&&n.keyCode<=55?r.key=String.fromCharCode(n.keyCode-51+27):n.keyCode===56?r.key=l.C0.DEL:n.keyCode===219?r.key=l.C0.ESC:n.keyCode===220?r.key=l.C0.FS:n.keyCode===221&&(r.key=l.C0.GS)}return r}},482:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Utf8ToUtf32=t.StringToUtf32=t.utf32ToString=t.stringFromCodePoint=void 0,t.stringFromCodePoint=function(a){return a>65535?(a-=65536,String.fromCharCode(55296+(a>>10))+String.fromCharCode(a%1024+56320)):String.fromCharCode(a)},t.utf32ToString=function(a,l=0,u=a.length){let n="";for(let f=l;f<u;++f){let p=a[f];p>65535?(p-=65536,n+=String.fromCharCode(55296+(p>>10))+String.fromCharCode(p%1024+56320)):n+=String.fromCharCode(p)}return n},t.StringToUtf32=class{constructor(){this._interim=0}clear(){this._interim=0}decode(a,l){let u=a.length;if(!u)return 0;let n=0,f=0;if(this._interim){let p=a.charCodeAt(f++);56320<=p&&p<=57343?l[n++]=1024*(this._interim-55296)+p-56320+65536:(l[n++]=this._interim,l[n++]=p),this._interim=0}for(let p=f;p<u;++p){let S=a.charCodeAt(p);if(55296<=S&&S<=56319){if(++p>=u)return this._interim=S,n;let r=a.charCodeAt(p);56320<=r&&r<=57343?l[n++]=1024*(S-55296)+r-56320+65536:(l[n++]=S,l[n++]=r)}else S!==65279&&(l[n++]=S)}return n}},t.Utf8ToUtf32=class{constructor(){this.interim=new Uint8Array(3)}clear(){this.interim.fill(0)}decode(a,l){let u=a.length;if(!u)return 0;let n,f,p,S,r=0,e=0,o=0;if(this.interim[0]){let h=!1,m=this.interim[0];m&=(224&m)==192?31:(240&m)==224?15:7;let d,c=0;for(;(d=63&this.interim[++c])&&c<4;)m<<=6,m|=d;let v=(224&this.interim[0])==192?2:(240&this.interim[0])==224?3:4,C=v-c;for(;o<C;){if(o>=u)return 0;if(d=a[o++],(192&d)!=128){o--,h=!0;break}this.interim[c++]=d,m<<=6,m|=63&d}h||(v===2?m<128?o--:l[r++]=m:v===3?m<2048||m>=55296&&m<=57343||m===65279||(l[r++]=m):m<65536||m>1114111||(l[r++]=m)),this.interim.fill(0)}let s=u-4,i=o;for(;i<u;){for(;!(!(i<s)||128&(n=a[i])||128&(f=a[i+1])||128&(p=a[i+2])||128&(S=a[i+3]));)l[r++]=n,l[r++]=f,l[r++]=p,l[r++]=S,i+=4;if(n=a[i++],n<128)l[r++]=n;else if((224&n)==192){if(i>=u)return this.interim[0]=n,r;if(f=a[i++],(192&f)!=128){i--;continue}if(e=(31&n)<<6|63&f,e<128){i--;continue}l[r++]=e}else if((240&n)==224){if(i>=u)return this.interim[0]=n,r;if(f=a[i++],(192&f)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=f,r;if(p=a[i++],(192&p)!=128){i--;continue}if(e=(15&n)<<12|(63&f)<<6|63&p,e<2048||e>=55296&&e<=57343||e===65279)continue;l[r++]=e}else if((248&n)==240){if(i>=u)return this.interim[0]=n,r;if(f=a[i++],(192&f)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=f,r;if(p=a[i++],(192&p)!=128){i--;continue}if(i>=u)return this.interim[0]=n,this.interim[1]=f,this.interim[2]=p,r;if(S=a[i++],(192&S)!=128){i--;continue}if(e=(7&n)<<18|(63&f)<<12|(63&p)<<6|63&S,e<65536||e>1114111)continue;l[r++]=e}}return r}}},225:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeV6=void 0;let l=a(1480),u=[[768,879],[1155,1158],[1160,1161],[1425,1469],[1471,1471],[1473,1474],[1476,1477],[1479,1479],[1536,1539],[1552,1557],[1611,1630],[1648,1648],[1750,1764],[1767,1768],[1770,1773],[1807,1807],[1809,1809],[1840,1866],[1958,1968],[2027,2035],[2305,2306],[2364,2364],[2369,2376],[2381,2381],[2385,2388],[2402,2403],[2433,2433],[2492,2492],[2497,2500],[2509,2509],[2530,2531],[2561,2562],[2620,2620],[2625,2626],[2631,2632],[2635,2637],[2672,2673],[2689,2690],[2748,2748],[2753,2757],[2759,2760],[2765,2765],[2786,2787],[2817,2817],[2876,2876],[2879,2879],[2881,2883],[2893,2893],[2902,2902],[2946,2946],[3008,3008],[3021,3021],[3134,3136],[3142,3144],[3146,3149],[3157,3158],[3260,3260],[3263,3263],[3270,3270],[3276,3277],[3298,3299],[3393,3395],[3405,3405],[3530,3530],[3538,3540],[3542,3542],[3633,3633],[3636,3642],[3655,3662],[3761,3761],[3764,3769],[3771,3772],[3784,3789],[3864,3865],[3893,3893],[3895,3895],[3897,3897],[3953,3966],[3968,3972],[3974,3975],[3984,3991],[3993,4028],[4038,4038],[4141,4144],[4146,4146],[4150,4151],[4153,4153],[4184,4185],[4448,4607],[4959,4959],[5906,5908],[5938,5940],[5970,5971],[6002,6003],[6068,6069],[6071,6077],[6086,6086],[6089,6099],[6109,6109],[6155,6157],[6313,6313],[6432,6434],[6439,6440],[6450,6450],[6457,6459],[6679,6680],[6912,6915],[6964,6964],[6966,6970],[6972,6972],[6978,6978],[7019,7027],[7616,7626],[7678,7679],[8203,8207],[8234,8238],[8288,8291],[8298,8303],[8400,8431],[12330,12335],[12441,12442],[43014,43014],[43019,43019],[43045,43046],[64286,64286],[65024,65039],[65056,65059],[65279,65279],[65529,65531]],n=[[68097,68099],[68101,68102],[68108,68111],[68152,68154],[68159,68159],[119143,119145],[119155,119170],[119173,119179],[119210,119213],[119362,119364],[917505,917505],[917536,917631],[917760,917999]],f;t.UnicodeV6=class{constructor(){if(this.version="6",!f){f=new Uint8Array(65536),f.fill(1),f[0]=0,f.fill(0,1,32),f.fill(0,127,160),f.fill(2,4352,4448),f[9001]=2,f[9002]=2,f.fill(2,11904,42192),f[12351]=1,f.fill(2,44032,55204),f.fill(2,63744,64256),f.fill(2,65040,65050),f.fill(2,65072,65136),f.fill(2,65280,65377),f.fill(2,65504,65511);for(let p=0;p<u.length;++p)f.fill(0,u[p][0],u[p][1]+1)}}wcwidth(p){return p<32?0:p<127?1:p<65536?f[p]:(function(S,r){let e,o=0,s=r.length-1;if(S<r[0][0]||S>r[s][1])return!1;for(;s>=o;)if(e=o+s>>1,S>r[e][1])o=e+1;else{if(!(S<r[e][0]))return!0;s=e-1}return!1})(p,n)?0:p>=131072&&p<=196605||p>=196608&&p<=262141?2:1}charProperties(p,S){let r=this.wcwidth(p),e=r===0&&S!==0;if(e){let o=l.UnicodeService.extractWidth(S);o===0?e=!1:o>r&&(r=o)}return l.UnicodeService.createPropertyValue(0,r,e)}}},5981:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WriteBuffer=void 0;let l=a(8460),u=a(844);class n extends u.Disposable{constructor(p){super(),this._action=p,this._writeBuffer=[],this._callbacks=[],this._pendingData=0,this._bufferOffset=0,this._isSyncWriting=!1,this._syncCalls=0,this._didUserInput=!1,this._onWriteParsed=this.register(new l.EventEmitter),this.onWriteParsed=this._onWriteParsed.event}handleUserInput(){this._didUserInput=!0}writeSync(p,S){if(S!==void 0&&this._syncCalls>S)return void(this._syncCalls=0);if(this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(void 0),this._syncCalls++,this._isSyncWriting)return;let r;for(this._isSyncWriting=!0;r=this._writeBuffer.shift();){this._action(r);let e=this._callbacks.shift();e&&e()}this._pendingData=0,this._bufferOffset=2147483647,this._isSyncWriting=!1,this._syncCalls=0}write(p,S){if(this._pendingData>5e7)throw Error("write data discarded, use flow control to avoid losing data");if(!this._writeBuffer.length){if(this._bufferOffset=0,this._didUserInput)return this._didUserInput=!1,this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(S),void this._innerWrite();setTimeout((()=>this._innerWrite()))}this._pendingData+=p.length,this._writeBuffer.push(p),this._callbacks.push(S)}_innerWrite(p=0,S=!0){let r=p||Date.now();for(;this._writeBuffer.length>this._bufferOffset;){let e=this._writeBuffer[this._bufferOffset],o=this._action(e,S);if(o){o.catch((i=>(queueMicrotask((()=>{throw i})),Promise.resolve(!1)))).then(i=>Date.now()-r>=12?setTimeout((()=>this._innerWrite(0,i))):this._innerWrite(r,i));return}let s=this._callbacks[this._bufferOffset];if(s&&s(),this._bufferOffset++,this._pendingData-=e.length,Date.now()-r>=12)break}this._writeBuffer.length>this._bufferOffset?(this._bufferOffset>50&&(this._writeBuffer=this._writeBuffer.slice(this._bufferOffset),this._callbacks=this._callbacks.slice(this._bufferOffset),this._bufferOffset=0),setTimeout((()=>this._innerWrite()))):(this._writeBuffer.length=0,this._callbacks.length=0,this._pendingData=0,this._bufferOffset=0),this._onWriteParsed.fire()}}t.WriteBuffer=n},5941:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.toRgbString=t.parseColor=void 0;let a=/^([\da-f])\/([\da-f])\/([\da-f])$|^([\da-f]{2})\/([\da-f]{2})\/([\da-f]{2})$|^([\da-f]{3})\/([\da-f]{3})\/([\da-f]{3})$|^([\da-f]{4})\/([\da-f]{4})\/([\da-f]{4})$/,l=/^[\da-f]+$/;function u(n,f){let p=n.toString(16),S=p.length<2?"0"+p:p;switch(f){case 4:return p[0];case 8:return S;case 12:return(S+S).slice(0,3);default:return S+S}}t.parseColor=function(n){if(!n)return;let f=n.toLowerCase();if(f.indexOf("rgb:")===0){f=f.slice(4);let p=a.exec(f);if(p){let S=p[1]?15:p[4]?255:p[7]?4095:65535;return[Math.round(parseInt(p[1]||p[4]||p[7]||p[10],16)/S*255),Math.round(parseInt(p[2]||p[5]||p[8]||p[11],16)/S*255),Math.round(parseInt(p[3]||p[6]||p[9]||p[12],16)/S*255)]}}else if(f.indexOf("#")===0&&(f=f.slice(1),l.exec(f)&&[3,6,9,12].includes(f.length))){let p=f.length/3,S=[0,0,0];for(let r=0;r<3;++r){let e=parseInt(f.slice(p*r,p*r+p),16);S[r]=p===1?e<<4:p===2?e:p===3?e>>4:e>>8}return S}},t.toRgbString=function(n,f=16){let[p,S,r]=n;return`rgb:${u(p,f)}/${u(S,f)}/${u(r,f)}`}},5770:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.PAYLOAD_LIMIT=void 0,t.PAYLOAD_LIMIT=1e7},6351:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DcsHandler=t.DcsParser=void 0;let l=a(482),u=a(8742),n=a(5770),f=[];t.DcsParser=class{constructor(){this._handlers=Object.create(null),this._active=f,this._ident=0,this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=f}registerHandler(S,r){this._handlers[S]===void 0&&(this._handlers[S]=[]);let e=this._handlers[S];return e.push(r),{dispose:()=>{let o=e.indexOf(r);o!==-1&&e.splice(o,1)}}}clearHandler(S){this._handlers[S]&&delete this._handlers[S]}setHandlerFallback(S){this._handlerFb=S}reset(){if(this._active.length)for(let S=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;S>=0;--S)this._active[S].unhook(!1);this._stack.paused=!1,this._active=f,this._ident=0}hook(S,r){if(this.reset(),this._ident=S,this._active=this._handlers[S]||f,this._active.length)for(let e=this._active.length-1;e>=0;e--)this._active[e].hook(r);else this._handlerFb(this._ident,"HOOK",r)}put(S,r,e){if(this._active.length)for(let o=this._active.length-1;o>=0;o--)this._active[o].put(S,r,e);else this._handlerFb(this._ident,"PUT",(0,l.utf32ToString)(S,r,e))}unhook(S,r=!0){if(this._active.length){let e=!1,o=this._active.length-1,s=!1;if(this._stack.paused&&(o=this._stack.loopPosition-1,e=r,s=this._stack.fallThrough,this._stack.paused=!1),!s&&e===!1){for(;o>=0&&(e=this._active[o].unhook(S),e!==!0);o--)if(e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!1,e;o--}for(;o>=0;o--)if(e=this._active[o].unhook(!1),e instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=o,this._stack.fallThrough=!0,e}else this._handlerFb(this._ident,"UNHOOK",S);this._active=f,this._ident=0}};let p=new u.Params;p.addParam(0),t.DcsHandler=class{constructor(S){this._handler=S,this._data="",this._params=p,this._hitLimit=!1}hook(S){this._params=S.length>1||S.params[0]?S.clone():p,this._data="",this._hitLimit=!1}put(S,r,e){this._hitLimit||(this._data+=(0,l.utf32ToString)(S,r,e),this._data.length>n.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}unhook(S){let r=!1;if(this._hitLimit)r=!1;else if(S&&(r=this._handler(this._data,this._params),r instanceof Promise))return r.then((e=>(this._params=p,this._data="",this._hitLimit=!1,e)));return this._params=p,this._data="",this._hitLimit=!1,r}}},2015:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.EscapeSequenceParser=t.VT500_TRANSITION_TABLE=t.TransitionTable=void 0;let l=a(844),u=a(8742),n=a(6242),f=a(6351);class p{constructor(e){this.table=new Uint8Array(e)}setDefault(e,o){this.table.fill(e<<4|o)}add(e,o,s,i){this.table[o<<8|e]=s<<4|i}addMany(e,o,s,i){for(let h=0;h<e.length;h++)this.table[o<<8|e[h]]=s<<4|i}}t.TransitionTable=p,t.VT500_TRANSITION_TABLE=(function(){let r=new p(4095),e=Array.apply(null,Array(256)).map(((d,c)=>c)),o=(d,c)=>e.slice(d,c),s=o(32,127),i=o(0,24);i.push(25),i.push.apply(i,o(28,32));let h=o(0,14),m;for(m in r.setDefault(1,0),r.addMany(s,0,2,0),h)r.addMany([24,26,153,154],m,3,0),r.addMany(o(128,144),m,3,0),r.addMany(o(144,152),m,3,0),r.add(156,m,0,0),r.add(27,m,11,1),r.add(157,m,4,8),r.addMany([152,158,159],m,0,7),r.add(155,m,11,3),r.add(144,m,11,9);return r.addMany(i,0,3,0),r.addMany(i,1,3,1),r.add(127,1,0,1),r.addMany(i,8,0,8),r.addMany(i,3,3,3),r.add(127,3,0,3),r.addMany(i,4,3,4),r.add(127,4,0,4),r.addMany(i,6,3,6),r.addMany(i,5,3,5),r.add(127,5,0,5),r.addMany(i,2,3,2),r.add(127,2,0,2),r.add(93,1,4,8),r.addMany(s,8,5,8),r.add(127,8,5,8),r.addMany([156,27,24,26,7],8,6,0),r.addMany(o(28,32),8,0,8),r.addMany([88,94,95],1,0,7),r.addMany(s,7,0,7),r.addMany(i,7,0,7),r.add(156,7,0,0),r.add(127,7,0,7),r.add(91,1,11,3),r.addMany(o(64,127),3,7,0),r.addMany(o(48,60),3,8,4),r.addMany([60,61,62,63],3,9,4),r.addMany(o(48,60),4,8,4),r.addMany(o(64,127),4,7,0),r.addMany([60,61,62,63],4,0,6),r.addMany(o(32,64),6,0,6),r.add(127,6,0,6),r.addMany(o(64,127),6,0,0),r.addMany(o(32,48),3,9,5),r.addMany(o(32,48),5,9,5),r.addMany(o(48,64),5,0,6),r.addMany(o(64,127),5,7,0),r.addMany(o(32,48),4,9,5),r.addMany(o(32,48),1,9,2),r.addMany(o(32,48),2,9,2),r.addMany(o(48,127),2,10,0),r.addMany(o(48,80),1,10,0),r.addMany(o(81,88),1,10,0),r.addMany([89,90,92],1,10,0),r.addMany(o(96,127),1,10,0),r.add(80,1,11,9),r.addMany(i,9,0,9),r.add(127,9,0,9),r.addMany(o(28,32),9,0,9),r.addMany(o(32,48),9,9,12),r.addMany(o(48,60),9,8,10),r.addMany([60,61,62,63],9,9,10),r.addMany(i,11,0,11),r.addMany(o(32,128),11,0,11),r.addMany(o(28,32),11,0,11),r.addMany(i,10,0,10),r.add(127,10,0,10),r.addMany(o(28,32),10,0,10),r.addMany(o(48,60),10,8,10),r.addMany([60,61,62,63],10,0,11),r.addMany(o(32,48),10,9,12),r.addMany(i,12,0,12),r.add(127,12,0,12),r.addMany(o(28,32),12,0,12),r.addMany(o(32,48),12,9,12),r.addMany(o(48,64),12,0,11),r.addMany(o(64,127),12,12,13),r.addMany(o(64,127),10,12,13),r.addMany(o(64,127),9,12,13),r.addMany(i,13,13,13),r.addMany(s,13,13,13),r.add(127,13,0,13),r.addMany([27,156,24,26],13,14,0),r.add(160,0,2,0),r.add(160,8,5,8),r.add(160,6,0,6),r.add(160,11,0,11),r.add(160,13,13,13),r})();class S extends l.Disposable{constructor(e=t.VT500_TRANSITION_TABLE){super(),this._transitions=e,this._parseStack={state:0,handlers:[],handlerPos:0,transition:0,chunkPos:0},this.initialState=0,this.currentState=this.initialState,this._params=new u.Params,this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._printHandlerFb=(o,s,i)=>{},this._executeHandlerFb=o=>{},this._csiHandlerFb=(o,s)=>{},this._escHandlerFb=o=>{},this._errorHandlerFb=o=>o,this._printHandler=this._printHandlerFb,this._executeHandlers=Object.create(null),this._csiHandlers=Object.create(null),this._escHandlers=Object.create(null),this.register((0,l.toDisposable)((()=>{this._csiHandlers=Object.create(null),this._executeHandlers=Object.create(null),this._escHandlers=Object.create(null)}))),this._oscParser=this.register(new n.OscParser),this._dcsParser=this.register(new f.DcsParser),this._errorHandler=this._errorHandlerFb,this.registerEscHandler({final:"\\"},(()=>!0))}_identifier(e,o=[64,126]){let s=0;if(e.prefix){if(e.prefix.length>1)throw Error("only one byte as prefix supported");if(s=e.prefix.charCodeAt(0),s&&60>s||s>63)throw Error("prefix must be in range 0x3c .. 0x3f")}if(e.intermediates){if(e.intermediates.length>2)throw Error("only two bytes as intermediates are supported");for(let h=0;h<e.intermediates.length;++h){let m=e.intermediates.charCodeAt(h);if(32>m||m>47)throw Error("intermediate must be in range 0x20 .. 0x2f");s<<=8,s|=m}}if(e.final.length!==1)throw Error("final must be a single byte");let i=e.final.charCodeAt(0);if(o[0]>i||i>o[1])throw Error(`final must be in range ${o[0]} .. ${o[1]}`);return s<<=8,s|=i,s}identToString(e){let o=[];for(;e;)o.push(String.fromCharCode(255&e)),e>>=8;return o.reverse().join("")}setPrintHandler(e){this._printHandler=e}clearPrintHandler(){this._printHandler=this._printHandlerFb}registerEscHandler(e,o){let s=this._identifier(e,[48,126]);this._escHandlers[s]===void 0&&(this._escHandlers[s]=[]);let i=this._escHandlers[s];return i.push(o),{dispose:()=>{let h=i.indexOf(o);h!==-1&&i.splice(h,1)}}}clearEscHandler(e){this._escHandlers[this._identifier(e,[48,126])]&&delete this._escHandlers[this._identifier(e,[48,126])]}setEscHandlerFallback(e){this._escHandlerFb=e}setExecuteHandler(e,o){this._executeHandlers[e.charCodeAt(0)]=o}clearExecuteHandler(e){this._executeHandlers[e.charCodeAt(0)]&&delete this._executeHandlers[e.charCodeAt(0)]}setExecuteHandlerFallback(e){this._executeHandlerFb=e}registerCsiHandler(e,o){let s=this._identifier(e);this._csiHandlers[s]===void 0&&(this._csiHandlers[s]=[]);let i=this._csiHandlers[s];return i.push(o),{dispose:()=>{let h=i.indexOf(o);h!==-1&&i.splice(h,1)}}}clearCsiHandler(e){this._csiHandlers[this._identifier(e)]&&delete this._csiHandlers[this._identifier(e)]}setCsiHandlerFallback(e){this._csiHandlerFb=e}registerDcsHandler(e,o){return this._dcsParser.registerHandler(this._identifier(e),o)}clearDcsHandler(e){this._dcsParser.clearHandler(this._identifier(e))}setDcsHandlerFallback(e){this._dcsParser.setHandlerFallback(e)}registerOscHandler(e,o){return this._oscParser.registerHandler(e,o)}clearOscHandler(e){this._oscParser.clearHandler(e)}setOscHandlerFallback(e){this._oscParser.setHandlerFallback(e)}setErrorHandler(e){this._errorHandler=e}clearErrorHandler(){this._errorHandler=this._errorHandlerFb}reset(){this.currentState=this.initialState,this._oscParser.reset(),this._dcsParser.reset(),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0,this._parseStack.state!==0&&(this._parseStack.state=2,this._parseStack.handlers=[])}_preserveStack(e,o,s,i,h){this._parseStack.state=e,this._parseStack.handlers=o,this._parseStack.handlerPos=s,this._parseStack.transition=i,this._parseStack.chunkPos=h}parse(e,o,s){let i,h=0,m=0,d=0;if(this._parseStack.state)if(this._parseStack.state===2)this._parseStack.state=0,d=this._parseStack.chunkPos+1;else{if(s===void 0||this._parseStack.state===1)throw this._parseStack.state=1,Error("improper continuation due to previous async handler, giving up parsing");let c=this._parseStack.handlers,v=this._parseStack.handlerPos-1;switch(this._parseStack.state){case 3:if(s===!1&&v>-1){for(;v>=0&&(i=c[v](this._params),i!==!0);v--)if(i instanceof Promise)return this._parseStack.handlerPos=v,i}this._parseStack.handlers=[];break;case 4:if(s===!1&&v>-1){for(;v>=0&&(i=c[v](),i!==!0);v--)if(i instanceof Promise)return this._parseStack.handlerPos=v,i}this._parseStack.handlers=[];break;case 6:if(h=e[this._parseStack.chunkPos],i=this._dcsParser.unhook(h!==24&&h!==26,s),i)return i;h===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0;break;case 5:if(h=e[this._parseStack.chunkPos],i=this._oscParser.end(h!==24&&h!==26,s),i)return i;h===27&&(this._parseStack.transition|=1),this._params.reset(),this._params.addParam(0),this._collect=0}this._parseStack.state=0,d=this._parseStack.chunkPos+1,this.precedingJoinState=0,this.currentState=15&this._parseStack.transition}for(let c=d;c<o;++c){switch(h=e[c],m=this._transitions.table[this.currentState<<8|(h<160?h:160)],m>>4){case 2:for(let x=c+1;;++x){if(x>=o||(h=e[x])<32||h>126&&h<160){this._printHandler(e,c,x),c=x-1;break}if(++x>=o||(h=e[x])<32||h>126&&h<160){this._printHandler(e,c,x),c=x-1;break}if(++x>=o||(h=e[x])<32||h>126&&h<160){this._printHandler(e,c,x),c=x-1;break}if(++x>=o||(h=e[x])<32||h>126&&h<160){this._printHandler(e,c,x),c=x-1;break}}break;case 3:this._executeHandlers[h]?this._executeHandlers[h]():this._executeHandlerFb(h),this.precedingJoinState=0;break;case 0:break;case 1:if(this._errorHandler({position:c,code:h,currentState:this.currentState,collect:this._collect,params:this._params,abort:!1}).abort)return;break;case 7:let v=this._csiHandlers[this._collect<<8|h],C=v?v.length-1:-1;for(;C>=0&&(i=v[C](this._params),i!==!0);C--)if(i instanceof Promise)return this._preserveStack(3,v,C,m,c),i;C<0&&this._csiHandlerFb(this._collect<<8|h,this._params),this.precedingJoinState=0;break;case 8:do switch(h){case 59:this._params.addParam(0);break;case 58:this._params.addSubParam(-1);break;default:this._params.addDigit(h-48)}while(++c<o&&(h=e[c])>47&&h<60);c--;break;case 9:this._collect<<=8,this._collect|=h;break;case 10:let k=this._escHandlers[this._collect<<8|h],D=k?k.length-1:-1;for(;D>=0&&(i=k[D](),i!==!0);D--)if(i instanceof Promise)return this._preserveStack(4,k,D,m,c),i;D<0&&this._escHandlerFb(this._collect<<8|h),this.precedingJoinState=0;break;case 11:this._params.reset(),this._params.addParam(0),this._collect=0;break;case 12:this._dcsParser.hook(this._collect<<8|h,this._params);break;case 13:for(let x=c+1;;++x)if(x>=o||(h=e[x])===24||h===26||h===27||h>127&&h<160){this._dcsParser.put(e,c,x),c=x-1;break}break;case 14:if(i=this._dcsParser.unhook(h!==24&&h!==26),i)return this._preserveStack(6,[],0,m,c),i;h===27&&(m|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0;break;case 4:this._oscParser.start();break;case 5:for(let x=c+1;;x++)if(x>=o||(h=e[x])<32||h>127&&h<160){this._oscParser.put(e,c,x),c=x-1;break}break;case 6:if(i=this._oscParser.end(h!==24&&h!==26),i)return this._preserveStack(5,[],0,m,c),i;h===27&&(m|=1),this._params.reset(),this._params.addParam(0),this._collect=0,this.precedingJoinState=0}this.currentState=15&m}}}t.EscapeSequenceParser=S},6242:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OscHandler=t.OscParser=void 0;let l=a(5770),u=a(482),n=[];t.OscParser=class{constructor(){this._state=0,this._active=n,this._id=-1,this._handlers=Object.create(null),this._handlerFb=()=>{},this._stack={paused:!1,loopPosition:0,fallThrough:!1}}registerHandler(f,p){this._handlers[f]===void 0&&(this._handlers[f]=[]);let S=this._handlers[f];return S.push(p),{dispose:()=>{let r=S.indexOf(p);r!==-1&&S.splice(r,1)}}}clearHandler(f){this._handlers[f]&&delete this._handlers[f]}setHandlerFallback(f){this._handlerFb=f}dispose(){this._handlers=Object.create(null),this._handlerFb=()=>{},this._active=n}reset(){if(this._state===2)for(let f=this._stack.paused?this._stack.loopPosition-1:this._active.length-1;f>=0;--f)this._active[f].end(!1);this._stack.paused=!1,this._active=n,this._id=-1,this._state=0}_start(){if(this._active=this._handlers[this._id]||n,this._active.length)for(let f=this._active.length-1;f>=0;f--)this._active[f].start();else this._handlerFb(this._id,"START")}_put(f,p,S){if(this._active.length)for(let r=this._active.length-1;r>=0;r--)this._active[r].put(f,p,S);else this._handlerFb(this._id,"PUT",(0,u.utf32ToString)(f,p,S))}start(){this.reset(),this._state=1}put(f,p,S){if(this._state!==3){if(this._state===1)for(;p<S;){let r=f[p++];if(r===59){this._state=2,this._start();break}if(r<48||57<r)return void(this._state=3);this._id===-1&&(this._id=0),this._id=10*this._id+r-48}this._state===2&&S-p>0&&this._put(f,p,S)}}end(f,p=!0){if(this._state!==0){if(this._state!==3)if(this._state===1&&this._start(),this._active.length){let S=!1,r=this._active.length-1,e=!1;if(this._stack.paused&&(r=this._stack.loopPosition-1,S=p,e=this._stack.fallThrough,this._stack.paused=!1),!e&&S===!1){for(;r>=0&&(S=this._active[r].end(f),S!==!0);r--)if(S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!1,S;r--}for(;r>=0;r--)if(S=this._active[r].end(!1),S instanceof Promise)return this._stack.paused=!0,this._stack.loopPosition=r,this._stack.fallThrough=!0,S}else this._handlerFb(this._id,"END",f);this._active=n,this._id=-1,this._state=0}}},t.OscHandler=class{constructor(f){this._handler=f,this._data="",this._hitLimit=!1}start(){this._data="",this._hitLimit=!1}put(f,p,S){this._hitLimit||(this._data+=(0,u.utf32ToString)(f,p,S),this._data.length>l.PAYLOAD_LIMIT&&(this._data="",this._hitLimit=!0))}end(f){let p=!1;if(this._hitLimit)p=!1;else if(f&&(p=this._handler(this._data),p instanceof Promise))return p.then((S=>(this._data="",this._hitLimit=!1,S)));return this._data="",this._hitLimit=!1,p}}},8742:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.Params=void 0;let a=2147483647;class l{static fromArray(n){let f=new l;if(!n.length)return f;for(let p=Array.isArray(n[0])?1:0;p<n.length;++p){let S=n[p];if(Array.isArray(S))for(let r=0;r<S.length;++r)f.addSubParam(S[r]);else f.addParam(S)}return f}constructor(n=32,f=32){if(this.maxLength=n,this.maxSubParamsLength=f,f>256)throw Error("maxSubParamsLength must not be greater than 256");this.params=new Int32Array(n),this.length=0,this._subParams=new Int32Array(f),this._subParamsLength=0,this._subParamsIdx=new Uint16Array(n),this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}clone(){let n=new l(this.maxLength,this.maxSubParamsLength);return n.params.set(this.params),n.length=this.length,n._subParams.set(this._subParams),n._subParamsLength=this._subParamsLength,n._subParamsIdx.set(this._subParamsIdx),n._rejectDigits=this._rejectDigits,n._rejectSubDigits=this._rejectSubDigits,n._digitIsSub=this._digitIsSub,n}toArray(){let n=[];for(let f=0;f<this.length;++f){n.push(this.params[f]);let p=this._subParamsIdx[f]>>8,S=255&this._subParamsIdx[f];S-p>0&&n.push(Array.prototype.slice.call(this._subParams,p,S))}return n}reset(){this.length=0,this._subParamsLength=0,this._rejectDigits=!1,this._rejectSubDigits=!1,this._digitIsSub=!1}addParam(n){if(this._digitIsSub=!1,this.length>=this.maxLength)this._rejectDigits=!0;else{if(n<-1)throw Error("values lesser than -1 are not allowed");this._subParamsIdx[this.length]=this._subParamsLength<<8|this._subParamsLength,this.params[this.length++]=n>a?a:n}}addSubParam(n){if(this._digitIsSub=!0,this.length)if(this._rejectDigits||this._subParamsLength>=this.maxSubParamsLength)this._rejectSubDigits=!0;else{if(n<-1)throw Error("values lesser than -1 are not allowed");this._subParams[this._subParamsLength++]=n>a?a:n,this._subParamsIdx[this.length-1]++}}hasSubParams(n){return(255&this._subParamsIdx[n])-(this._subParamsIdx[n]>>8)>0}getSubParams(n){let f=this._subParamsIdx[n]>>8,p=255&this._subParamsIdx[n];return p-f>0?this._subParams.subarray(f,p):null}getSubParamsAll(){let n={};for(let f=0;f<this.length;++f){let p=this._subParamsIdx[f]>>8,S=255&this._subParamsIdx[f];S-p>0&&(n[f]=this._subParams.slice(p,S))}return n}addDigit(n){let f;if(this._rejectDigits||!(f=this._digitIsSub?this._subParamsLength:this.length)||this._digitIsSub&&this._rejectSubDigits)return;let p=this._digitIsSub?this._subParams:this.params,S=p[f-1];p[f-1]=~S?Math.min(10*S+n,a):n}}t.Params=l},5741:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.AddonManager=void 0,t.AddonManager=class{constructor(){this._addons=[]}dispose(){for(let a=this._addons.length-1;a>=0;a--)this._addons[a].instance.dispose()}loadAddon(a,l){let u={instance:l,dispose:l.dispose,isDisposed:!1};this._addons.push(u),l.dispose=()=>this._wrappedAddonDispose(u),l.activate(a)}_wrappedAddonDispose(a){if(a.isDisposed)return;let l=-1;for(let u=0;u<this._addons.length;u++)if(this._addons[u]===a){l=u;break}if(l===-1)throw Error("Could not dispose an addon that has not been loaded");a.isDisposed=!0,a.dispose.apply(a.instance),this._addons.splice(l,1)}}},8771:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferApiView=void 0;let l=a(3785),u=a(511);t.BufferApiView=class{constructor(n,f){this._buffer=n,this.type=f}init(n){return this._buffer=n,this}get cursorY(){return this._buffer.y}get cursorX(){return this._buffer.x}get viewportY(){return this._buffer.ydisp}get baseY(){return this._buffer.ybase}get length(){return this._buffer.lines.length}getLine(n){let f=this._buffer.lines.get(n);if(f)return new l.BufferLineApiView(f)}getNullCell(){return new u.CellData}}},3785:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferLineApiView=void 0;let l=a(511);t.BufferLineApiView=class{constructor(u){this._line=u}get isWrapped(){return this._line.isWrapped}get length(){return this._line.length}getCell(u,n){if(!(u<0||u>=this._line.length))return n?(this._line.loadCell(u,n),n):this._line.loadCell(u,new l.CellData)}translateToString(u,n,f){return this._line.translateToString(u,n,f)}}},8285:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.BufferNamespaceApi=void 0;let l=a(8771),u=a(8460),n=a(844);class f extends n.Disposable{constructor(S){super(),this._core=S,this._onBufferChange=this.register(new u.EventEmitter),this.onBufferChange=this._onBufferChange.event,this._normal=new l.BufferApiView(this._core.buffers.normal,"normal"),this._alternate=new l.BufferApiView(this._core.buffers.alt,"alternate"),this._core.buffers.onBufferActivate((()=>this._onBufferChange.fire(this.active)))}get active(){if(this._core.buffers.active===this._core.buffers.normal)return this.normal;if(this._core.buffers.active===this._core.buffers.alt)return this.alternate;throw Error("Active buffer is neither normal nor alternate")}get normal(){return this._normal.init(this._core.buffers.normal)}get alternate(){return this._alternate.init(this._core.buffers.alt)}}t.BufferNamespaceApi=f},7975:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.ParserApi=void 0,t.ParserApi=class{constructor(a){this._core=a}registerCsiHandler(a,l){return this._core.registerCsiHandler(a,(u=>l(u.toArray())))}addCsiHandler(a,l){return this.registerCsiHandler(a,l)}registerDcsHandler(a,l){return this._core.registerDcsHandler(a,((u,n)=>l(u,n.toArray())))}addDcsHandler(a,l){return this.registerDcsHandler(a,l)}registerEscHandler(a,l){return this._core.registerEscHandler(a,l)}addEscHandler(a,l){return this.registerEscHandler(a,l)}registerOscHandler(a,l){return this._core.registerOscHandler(a,l)}addOscHandler(a,l){return this.registerOscHandler(a,l)}}},7090:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeApi=void 0,t.UnicodeApi=class{constructor(a){this._core=a}register(a){this._core.unicodeService.register(a)}get versions(){return this._core.unicodeService.versions}get activeVersion(){return this._core.unicodeService.activeVersion}set activeVersion(a){this._core.unicodeService.activeVersion=a}}},744:function(A,t,a){var l=this&&this.__decorate||function(e,o,s,i){var h,m=arguments.length,d=m<3?o:i===null?i=Object.getOwnPropertyDescriptor(o,s):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,o,s,i);else for(var c=e.length-1;c>=0;c--)(h=e[c])&&(d=(m<3?h(d):m>3?h(o,s,d):h(o,s))||d);return m>3&&d&&Object.defineProperty(o,s,d),d},u=this&&this.__param||function(e,o){return function(s,i){o(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.BufferService=t.MINIMUM_ROWS=t.MINIMUM_COLS=void 0;let n=a(8460),f=a(844),p=a(5295),S=a(2585);t.MINIMUM_COLS=2,t.MINIMUM_ROWS=1;let r=t.BufferService=class extends f.Disposable{get buffer(){return this.buffers.active}constructor(e){super(),this.isUserScrolling=!1,this._onResize=this.register(new n.EventEmitter),this.onResize=this._onResize.event,this._onScroll=this.register(new n.EventEmitter),this.onScroll=this._onScroll.event,this.cols=Math.max(e.rawOptions.cols||0,t.MINIMUM_COLS),this.rows=Math.max(e.rawOptions.rows||0,t.MINIMUM_ROWS),this.buffers=this.register(new p.BufferSet(e,this))}resize(e,o){this.cols=e,this.rows=o,this.buffers.resize(e,o),this._onResize.fire({cols:e,rows:o})}reset(){this.buffers.reset(),this.isUserScrolling=!1}scroll(e,o=!1){let s=this.buffer,i;i=this._cachedBlankLine,i&&i.length===this.cols&&i.getFg(0)===e.fg&&i.getBg(0)===e.bg||(i=s.getBlankLine(e,o),this._cachedBlankLine=i),i.isWrapped=o;let h=s.ybase+s.scrollTop,m=s.ybase+s.scrollBottom;if(s.scrollTop===0){let d=s.lines.isFull;m===s.lines.length-1?d?s.lines.recycle().copyFrom(i):s.lines.push(i.clone()):s.lines.splice(m+1,0,i.clone()),d?this.isUserScrolling&&(s.ydisp=Math.max(s.ydisp-1,0)):(s.ybase++,this.isUserScrolling||s.ydisp++)}else{let d=m-h+1;s.lines.shiftElements(h+1,d-1,-1),s.lines.set(m,i.clone())}this.isUserScrolling||(s.ydisp=s.ybase),this._onScroll.fire(s.ydisp)}scrollLines(e,o,s){let i=this.buffer;if(e<0){if(i.ydisp===0)return;this.isUserScrolling=!0}else e+i.ydisp>=i.ybase&&(this.isUserScrolling=!1);let h=i.ydisp;i.ydisp=Math.max(Math.min(i.ydisp+e,i.ybase),0),h!==i.ydisp&&(o||this._onScroll.fire(i.ydisp))}};t.BufferService=r=l([u(0,S.IOptionsService)],r)},7994:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.CharsetService=void 0,t.CharsetService=class{constructor(){this.glevel=0,this._charsets=[]}reset(){this.charset=void 0,this._charsets=[],this.glevel=0}setgLevel(a){this.glevel=a,this.charset=this._charsets[a]}setgCharset(a,l){this._charsets[a]=l,this.glevel===a&&(this.charset=l)}}},1753:function(A,t,a){var l=this&&this.__decorate||function(i,h,m,d){var c,v=arguments.length,C=v<3?h:d===null?d=Object.getOwnPropertyDescriptor(h,m):d;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")C=Reflect.decorate(i,h,m,d);else for(var k=i.length-1;k>=0;k--)(c=i[k])&&(C=(v<3?c(C):v>3?c(h,m,C):c(h,m))||C);return v>3&&C&&Object.defineProperty(h,m,C),C},u=this&&this.__param||function(i,h){return function(m,d){h(m,d,i)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreMouseService=void 0;let n=a(2585),f=a(8460),p=a(844),S={NONE:{events:0,restrict:()=>!1},X10:{events:1,restrict:i=>i.button!==4&&i.action===1&&(i.ctrl=!1,i.alt=!1,i.shift=!1,!0)},VT200:{events:19,restrict:i=>i.action!==32},DRAG:{events:23,restrict:i=>i.action!==32||i.button!==3},ANY:{events:31,restrict:i=>!0}};function r(i,h){let m=(i.ctrl?16:0)|(i.shift?4:0)|(i.alt?8:0);return i.button===4?(m|=64,m|=i.action):(m|=3&i.button,4&i.button&&(m|=64),8&i.button&&(m|=128),i.action===32?m|=32:i.action!==0||h||(m|=3)),m}let e=String.fromCharCode,o={DEFAULT:i=>{let h=[r(i,!1)+32,i.col+32,i.row+32];return h[0]>255||h[1]>255||h[2]>255?"":`\x1B[M${e(h[0])}${e(h[1])}${e(h[2])}`},SGR:i=>{let h=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${r(i,!0)};${i.col};${i.row}${h}`},SGR_PIXELS:i=>{let h=i.action===0&&i.button!==4?"m":"M";return`\x1B[<${r(i,!0)};${i.x};${i.y}${h}`}},s=t.CoreMouseService=class extends p.Disposable{constructor(i,h){super(),this._bufferService=i,this._coreService=h,this._protocols={},this._encodings={},this._activeProtocol="",this._activeEncoding="",this._lastEvent=null,this._onProtocolChange=this.register(new f.EventEmitter),this.onProtocolChange=this._onProtocolChange.event;for(let m of Object.keys(S))this.addProtocol(m,S[m]);for(let m of Object.keys(o))this.addEncoding(m,o[m]);this.reset()}addProtocol(i,h){this._protocols[i]=h}addEncoding(i,h){this._encodings[i]=h}get activeProtocol(){return this._activeProtocol}get areMouseEventsActive(){return this._protocols[this._activeProtocol].events!==0}set activeProtocol(i){if(!this._protocols[i])throw Error(`unknown protocol "${i}"`);this._activeProtocol=i,this._onProtocolChange.fire(this._protocols[i].events)}get activeEncoding(){return this._activeEncoding}set activeEncoding(i){if(!this._encodings[i])throw Error(`unknown encoding "${i}"`);this._activeEncoding=i}reset(){this.activeProtocol="NONE",this.activeEncoding="DEFAULT",this._lastEvent=null}triggerMouseEvent(i){if(i.col<0||i.col>=this._bufferService.cols||i.row<0||i.row>=this._bufferService.rows||i.button===4&&i.action===32||i.button===3&&i.action!==32||i.button!==4&&(i.action===2||i.action===3)||(i.col++,i.row++,i.action===32&&this._lastEvent&&this._equalEvents(this._lastEvent,i,this._activeEncoding==="SGR_PIXELS"))||!this._protocols[this._activeProtocol].restrict(i))return!1;let h=this._encodings[this._activeEncoding](i);return h&&(this._activeEncoding==="DEFAULT"?this._coreService.triggerBinaryEvent(h):this._coreService.triggerDataEvent(h,!0)),this._lastEvent=i,!0}explainEvents(i){return{down:!!(1&i),up:!!(2&i),drag:!!(4&i),move:!!(8&i),wheel:!!(16&i)}}_equalEvents(i,h,m){if(m){if(i.x!==h.x||i.y!==h.y)return!1}else if(i.col!==h.col||i.row!==h.row)return!1;return i.button===h.button&&i.action===h.action&&i.ctrl===h.ctrl&&i.alt===h.alt&&i.shift===h.shift}};t.CoreMouseService=s=l([u(0,n.IBufferService),u(1,n.ICoreService)],s)},6975:function(A,t,a){var l=this&&this.__decorate||function(s,i,h,m){var d,c=arguments.length,v=c<3?i:m===null?m=Object.getOwnPropertyDescriptor(i,h):m;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")v=Reflect.decorate(s,i,h,m);else for(var C=s.length-1;C>=0;C--)(d=s[C])&&(v=(c<3?d(v):c>3?d(i,h,v):d(i,h))||v);return c>3&&v&&Object.defineProperty(i,h,v),v},u=this&&this.__param||function(s,i){return function(h,m){i(h,m,s)}};Object.defineProperty(t,"__esModule",{value:!0}),t.CoreService=void 0;let n=a(1439),f=a(8460),p=a(844),S=a(2585),r=Object.freeze({insertMode:!1}),e=Object.freeze({applicationCursorKeys:!1,applicationKeypad:!1,bracketedPasteMode:!1,origin:!1,reverseWraparound:!1,sendFocus:!1,wraparound:!0}),o=t.CoreService=class extends p.Disposable{constructor(s,i,h){super(),this._bufferService=s,this._logService=i,this._optionsService=h,this.isCursorInitialized=!1,this.isCursorHidden=!1,this._onData=this.register(new f.EventEmitter),this.onData=this._onData.event,this._onUserInput=this.register(new f.EventEmitter),this.onUserInput=this._onUserInput.event,this._onBinary=this.register(new f.EventEmitter),this.onBinary=this._onBinary.event,this._onRequestScrollToBottom=this.register(new f.EventEmitter),this.onRequestScrollToBottom=this._onRequestScrollToBottom.event,this.modes=(0,n.clone)(r),this.decPrivateModes=(0,n.clone)(e)}reset(){this.modes=(0,n.clone)(r),this.decPrivateModes=(0,n.clone)(e)}triggerDataEvent(s,i=!1){if(this._optionsService.rawOptions.disableStdin)return;let h=this._bufferService.buffer;i&&this._optionsService.rawOptions.scrollOnUserInput&&h.ybase!==h.ydisp&&this._onRequestScrollToBottom.fire(),i&&this._onUserInput.fire(),this._logService.debug(`sending data "${s}"`,(()=>s.split("").map((m=>m.charCodeAt(0))))),this._onData.fire(s)}triggerBinaryEvent(s){this._optionsService.rawOptions.disableStdin||(this._logService.debug(`sending binary "${s}"`,(()=>s.split("").map((i=>i.charCodeAt(0))))),this._onBinary.fire(s))}};t.CoreService=o=l([u(0,S.IBufferService),u(1,S.ILogService),u(2,S.IOptionsService)],o)},9074:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.DecorationService=void 0;let l=a(8055),u=a(8460),n=a(844),f=a(6106),p=0,S=0;class r extends n.Disposable{get decorations(){return this._decorations.values()}constructor(){super(),this._decorations=new f.SortedList((s=>s==null?void 0:s.marker.line)),this._onDecorationRegistered=this.register(new u.EventEmitter),this.onDecorationRegistered=this._onDecorationRegistered.event,this._onDecorationRemoved=this.register(new u.EventEmitter),this.onDecorationRemoved=this._onDecorationRemoved.event,this.register((0,n.toDisposable)((()=>this.reset())))}registerDecoration(s){if(s.marker.isDisposed)return;let i=new e(s);if(i){let h=i.marker.onDispose((()=>i.dispose()));i.onDispose((()=>{i&&(this._decorations.delete(i)&&this._onDecorationRemoved.fire(i),h.dispose())})),this._decorations.insert(i),this._onDecorationRegistered.fire(i)}return i}reset(){for(let s of this._decorations.values())s.dispose();this._decorations.clear()}*getDecorationsAtCell(s,i,h){let m=0,d=0;for(let c of this._decorations.getKeyIterator(i))m=c.options.x??0,d=m+(c.options.width??1),s>=m&&s<d&&(!h||(c.options.layer??"bottom")===h)&&(yield c)}forEachDecorationAtCell(s,i,h,m){this._decorations.forEachByKey(i,(d=>{p=d.options.x??0,S=p+(d.options.width??1),s>=p&&s<S&&(!h||(d.options.layer??"bottom")===h)&&m(d)}))}}t.DecorationService=r;class e extends n.Disposable{get isDisposed(){return this._isDisposed}get backgroundColorRGB(){return this._cachedBg===null&&(this.options.backgroundColor?this._cachedBg=l.css.toColor(this.options.backgroundColor):this._cachedBg=void 0),this._cachedBg}get foregroundColorRGB(){return this._cachedFg===null&&(this.options.foregroundColor?this._cachedFg=l.css.toColor(this.options.foregroundColor):this._cachedFg=void 0),this._cachedFg}constructor(s){super(),this.options=s,this.onRenderEmitter=this.register(new u.EventEmitter),this.onRender=this.onRenderEmitter.event,this._onDispose=this.register(new u.EventEmitter),this.onDispose=this._onDispose.event,this._cachedBg=null,this._cachedFg=null,this.marker=s.marker,this.options.overviewRulerOptions&&!this.options.overviewRulerOptions.position&&(this.options.overviewRulerOptions.position="full")}dispose(){this._onDispose.fire(),super.dispose()}}},4348:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.InstantiationService=t.ServiceCollection=void 0;let l=a(2585),u=a(8343);class n{constructor(...p){this._entries=new Map;for(let[S,r]of p)this.set(S,r)}set(p,S){let r=this._entries.get(p);return this._entries.set(p,S),r}forEach(p){for(let[S,r]of this._entries.entries())p(S,r)}has(p){return this._entries.has(p)}get(p){return this._entries.get(p)}}t.ServiceCollection=n,t.InstantiationService=class{constructor(){this._services=new n,this._services.set(l.IInstantiationService,this)}setService(f,p){this._services.set(f,p)}getService(f){return this._services.get(f)}createInstance(f,...p){let S=(0,u.getServiceDependencies)(f).sort(((o,s)=>o.index-s.index)),r=[];for(let o of S){let s=this._services.get(o.id);if(!s)throw Error(`[createInstance] ${f.name} depends on UNKNOWN service ${o.id}.`);r.push(s)}let e=S.length>0?S[0].index:p.length;if(p.length!==e)throw Error(`[createInstance] First service dependency of ${f.name} at position ${e+1} conflicts with ${p.length} static arguments`);return new f(...p,...r)}}},7866:function(A,t,a){var l=this&&this.__decorate||function(e,o,s,i){var h,m=arguments.length,d=m<3?o:i===null?i=Object.getOwnPropertyDescriptor(o,s):i;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")d=Reflect.decorate(e,o,s,i);else for(var c=e.length-1;c>=0;c--)(h=e[c])&&(d=(m<3?h(d):m>3?h(o,s,d):h(o,s))||d);return m>3&&d&&Object.defineProperty(o,s,d),d},u=this&&this.__param||function(e,o){return function(s,i){o(s,i,e)}};Object.defineProperty(t,"__esModule",{value:!0}),t.traceCall=t.setTraceLogger=t.LogService=void 0;let n=a(844),f=a(2585),p={trace:f.LogLevelEnum.TRACE,debug:f.LogLevelEnum.DEBUG,info:f.LogLevelEnum.INFO,warn:f.LogLevelEnum.WARN,error:f.LogLevelEnum.ERROR,off:f.LogLevelEnum.OFF},S,r=t.LogService=class extends n.Disposable{get logLevel(){return this._logLevel}constructor(e){super(),this._optionsService=e,this._logLevel=f.LogLevelEnum.OFF,this._updateLogLevel(),this.register(this._optionsService.onSpecificOptionChange("logLevel",(()=>this._updateLogLevel()))),S=this}_updateLogLevel(){this._logLevel=p[this._optionsService.rawOptions.logLevel]}_evalLazyOptionalParams(e){for(let o=0;o<e.length;o++)typeof e[o]=="function"&&(e[o]=e[o]())}_log(e,o,s){this._evalLazyOptionalParams(s),e.call(console,(this._optionsService.options.logger?"":"xterm.js: ")+o,...s)}trace(e,...o){var s;this._logLevel<=f.LogLevelEnum.TRACE&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.trace.bind(this._optionsService.options.logger))??console.log,e,o)}debug(e,...o){var s;this._logLevel<=f.LogLevelEnum.DEBUG&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.debug.bind(this._optionsService.options.logger))??console.log,e,o)}info(e,...o){var s;this._logLevel<=f.LogLevelEnum.INFO&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.info.bind(this._optionsService.options.logger))??console.info,e,o)}warn(e,...o){var s;this._logLevel<=f.LogLevelEnum.WARN&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.warn.bind(this._optionsService.options.logger))??console.warn,e,o)}error(e,...o){var s;this._logLevel<=f.LogLevelEnum.ERROR&&this._log(((s=this._optionsService.options.logger)==null?void 0:s.error.bind(this._optionsService.options.logger))??console.error,e,o)}};t.LogService=r=l([u(0,f.IOptionsService)],r),t.setTraceLogger=function(e){S=e},t.traceCall=function(e,o,s){if(typeof s.value!="function")throw Error("not supported");let i=s.value;s.value=function(...h){if(S.logLevel!==f.LogLevelEnum.TRACE)return i.apply(this,h);S.trace(`GlyphRenderer#${i.name}(${h.map((d=>JSON.stringify(d))).join(", ")})`);let m=i.apply(this,h);return S.trace(`GlyphRenderer#${i.name} return`,m),m}}},7302:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.OptionsService=t.DEFAULT_OPTIONS=void 0;let l=a(8460),u=a(844);t.DEFAULT_OPTIONS={cols:80,rows:24,cursorBlink:!1,cursorStyle:"block",cursorWidth:1,cursorInactiveStyle:"outline",customGlyphs:!0,drawBoldTextInBrightColors:!0,documentOverride:null,fastScrollModifier:"alt",fastScrollSensitivity:5,fontFamily:"courier-new, courier, monospace",fontSize:15,fontWeight:"normal",fontWeightBold:"bold",ignoreBracketedPasteMode:!1,lineHeight:1,letterSpacing:0,linkHandler:null,logLevel:"info",logger:null,scrollback:1e3,scrollOnUserInput:!0,scrollSensitivity:1,screenReaderMode:!1,smoothScrollDuration:0,macOptionIsMeta:!1,macOptionClickForcesSelection:!1,minimumContrastRatio:1,disableStdin:!1,allowProposedApi:!1,allowTransparency:!1,tabStopWidth:8,theme:{},rescaleOverlappingGlyphs:!1,rightClickSelectsWord:a(6114).isMac,windowOptions:{},windowsMode:!1,windowsPty:{},wordSeparator:" ()[]{}',\"`",altClickMovesCursor:!0,convertEol:!1,termName:"xterm",cancelEvents:!1,overviewRulerWidth:0};let n=["normal","bold","100","200","300","400","500","600","700","800","900"];class f extends u.Disposable{constructor(S){super(),this._onOptionChange=this.register(new l.EventEmitter),this.onOptionChange=this._onOptionChange.event;let r={...t.DEFAULT_OPTIONS};for(let e in S)if(e in r)try{let o=S[e];r[e]=this._sanitizeAndValidateOption(e,o)}catch(o){console.error(o)}this.rawOptions=r,this.options={...r},this._setupOptions(),this.register((0,u.toDisposable)((()=>{this.rawOptions.linkHandler=null,this.rawOptions.documentOverride=null})))}onSpecificOptionChange(S,r){return this.onOptionChange((e=>{e===S&&r(this.rawOptions[S])}))}onMultipleOptionChange(S,r){return this.onOptionChange((e=>{S.indexOf(e)!==-1&&r()}))}_setupOptions(){let S=e=>{if(!(e in t.DEFAULT_OPTIONS))throw Error(`No option with key "${e}"`);return this.rawOptions[e]},r=(e,o)=>{if(!(e in t.DEFAULT_OPTIONS))throw Error(`No option with key "${e}"`);o=this._sanitizeAndValidateOption(e,o),this.rawOptions[e]!==o&&(this.rawOptions[e]=o,this._onOptionChange.fire(e))};for(let e in this.rawOptions){let o={get:S.bind(this,e),set:r.bind(this,e)};Object.defineProperty(this.options,e,o)}}_sanitizeAndValidateOption(S,r){switch(S){case"cursorStyle":if(r||(r=t.DEFAULT_OPTIONS[S]),!(function(e){return e==="block"||e==="underline"||e==="bar"})(r))throw Error(`"${r}" is not a valid value for ${S}`);break;case"wordSeparator":r||(r=t.DEFAULT_OPTIONS[S]);break;case"fontWeight":case"fontWeightBold":if(typeof r=="number"&&1<=r&&r<=1e3)break;r=n.includes(r)?r:t.DEFAULT_OPTIONS[S];break;case"cursorWidth":r=Math.floor(r);case"lineHeight":case"tabStopWidth":if(r<1)throw Error(`${S} cannot be less than 1, value: ${r}`);break;case"minimumContrastRatio":r=Math.max(1,Math.min(21,Math.round(10*r)/10));break;case"scrollback":if((r=Math.min(r,4294967295))<0)throw Error(`${S} cannot be less than 0, value: ${r}`);break;case"fastScrollSensitivity":case"scrollSensitivity":if(r<=0)throw Error(`${S} cannot be less than or equal to 0, value: ${r}`);break;case"rows":case"cols":if(!r&&r!==0)throw Error(`${S} must be numeric, value: ${r}`);break;case"windowsPty":r??(r={})}return r}}t.OptionsService=f},2660:function(A,t,a){var l=this&&this.__decorate||function(p,S,r,e){var o,s=arguments.length,i=s<3?S:e===null?e=Object.getOwnPropertyDescriptor(S,r):e;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")i=Reflect.decorate(p,S,r,e);else for(var h=p.length-1;h>=0;h--)(o=p[h])&&(i=(s<3?o(i):s>3?o(S,r,i):o(S,r))||i);return s>3&&i&&Object.defineProperty(S,r,i),i},u=this&&this.__param||function(p,S){return function(r,e){S(r,e,p)}};Object.defineProperty(t,"__esModule",{value:!0}),t.OscLinkService=void 0;let n=a(2585),f=t.OscLinkService=class{constructor(p){this._bufferService=p,this._nextId=1,this._entriesWithId=new Map,this._dataByLinkId=new Map}registerLink(p){let S=this._bufferService.buffer;if(p.id===void 0){let h=S.addMarker(S.ybase+S.y),m={data:p,id:this._nextId++,lines:[h]};return h.onDispose((()=>this._removeMarkerFromLink(m,h))),this._dataByLinkId.set(m.id,m),m.id}let r=p,e=this._getEntryIdKey(r),o=this._entriesWithId.get(e);if(o)return this.addLineToLink(o.id,S.ybase+S.y),o.id;let s=S.addMarker(S.ybase+S.y),i={id:this._nextId++,key:this._getEntryIdKey(r),data:r,lines:[s]};return s.onDispose((()=>this._removeMarkerFromLink(i,s))),this._entriesWithId.set(i.key,i),this._dataByLinkId.set(i.id,i),i.id}addLineToLink(p,S){let r=this._dataByLinkId.get(p);if(r&&r.lines.every((e=>e.line!==S))){let e=this._bufferService.buffer.addMarker(S);r.lines.push(e),e.onDispose((()=>this._removeMarkerFromLink(r,e)))}}getLinkData(p){var S;return(S=this._dataByLinkId.get(p))==null?void 0:S.data}_getEntryIdKey(p){return`${p.id};;${p.uri}`}_removeMarkerFromLink(p,S){let r=p.lines.indexOf(S);r!==-1&&(p.lines.splice(r,1),p.lines.length===0&&(p.data.id!==void 0&&this._entriesWithId.delete(p.key),this._dataByLinkId.delete(p.id)))}};t.OscLinkService=f=l([u(0,n.IBufferService)],f)},8343:(A,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.createDecorator=t.getServiceDependencies=t.serviceRegistry=void 0;let a="di$target",l="di$dependencies";t.serviceRegistry=new Map,t.getServiceDependencies=function(u){return u[l]||[]},t.createDecorator=function(u){if(t.serviceRegistry.has(u))return t.serviceRegistry.get(u);let n=function(f,p,S){if(arguments.length!==3)throw Error("@IServiceName-decorator can only be used to decorate a parameter");(function(r,e,o){e[a]===e?e[l].push({id:r,index:o}):(e[l]=[{id:r,index:o}],e[a]=e)})(n,f,S)};return n.toString=()=>u,t.serviceRegistry.set(u,n),n}},2585:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.IDecorationService=t.IUnicodeService=t.IOscLinkService=t.IOptionsService=t.ILogService=t.LogLevelEnum=t.IInstantiationService=t.ICharsetService=t.ICoreService=t.ICoreMouseService=t.IBufferService=void 0;let l=a(8343);var u;t.IBufferService=(0,l.createDecorator)("BufferService"),t.ICoreMouseService=(0,l.createDecorator)("CoreMouseService"),t.ICoreService=(0,l.createDecorator)("CoreService"),t.ICharsetService=(0,l.createDecorator)("CharsetService"),t.IInstantiationService=(0,l.createDecorator)("InstantiationService"),(function(n){n[n.TRACE=0]="TRACE",n[n.DEBUG=1]="DEBUG",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.OFF=5]="OFF"})(u||(t.LogLevelEnum=u={})),t.ILogService=(0,l.createDecorator)("LogService"),t.IOptionsService=(0,l.createDecorator)("OptionsService"),t.IOscLinkService=(0,l.createDecorator)("OscLinkService"),t.IUnicodeService=(0,l.createDecorator)("UnicodeService"),t.IDecorationService=(0,l.createDecorator)("DecorationService")},1480:(A,t,a)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UnicodeService=void 0;let l=a(8460),u=a(225);class n{static extractShouldJoin(p){return(1&p)!=0}static extractWidth(p){return p>>1&3}static extractCharKind(p){return p>>3}static createPropertyValue(p,S,r=!1){return(16777215&p)<<3|(3&S)<<1|(r?1:0)}constructor(){this._providers=Object.create(null),this._active="",this._onChange=new l.EventEmitter,this.onChange=this._onChange.event;let p=new u.UnicodeV6;this.register(p),this._active=p.version,this._activeProvider=p}dispose(){this._onChange.dispose()}get versions(){return Object.keys(this._providers)}get activeVersion(){return this._active}set activeVersion(p){if(!this._providers[p])throw Error(`unknown Unicode version "${p}"`);this._active=p,this._activeProvider=this._providers[p],this._onChange.fire(p)}register(p){this._providers[p.version]=p}wcwidth(p){return this._activeProvider.wcwidth(p)}getStringCellWidth(p){let S=0,r=0,e=p.length;for(let o=0;o<e;++o){let s=p.charCodeAt(o);if(55296<=s&&s<=56319){if(++o>=e)return S+this.wcwidth(s);let m=p.charCodeAt(o);56320<=m&&m<=57343?s=1024*(s-55296)+m-56320+65536:S+=this.wcwidth(m)}let i=this.charProperties(s,r),h=n.extractWidth(i);n.extractShouldJoin(i)&&(h-=n.extractWidth(r)),S+=h,r=i}return S}charProperties(p,S){return this._activeProvider.charProperties(p,S)}}t.UnicodeService=n}},E={};function T(A){var t=E[A];if(t!==void 0)return t.exports;var a=E[A]={exports:{}};return b[A].call(a.exports,a,a.exports,T),a.exports}var N={};return(()=>{var A=N;Object.defineProperty(A,"__esModule",{value:!0}),A.Terminal=void 0;let t=T(9042),a=T(3236),l=T(844),u=T(5741),n=T(8285),f=T(7975),p=T(7090),S=["cols","rows"];class r extends l.Disposable{constructor(o){super(),this._core=this.register(new a.Terminal(o)),this._addonManager=this.register(new u.AddonManager),this._publicOptions={...this._core.options};let s=h=>this._core.options[h],i=(h,m)=>{this._checkReadonlyOptions(h),this._core.options[h]=m};for(let h in this._core.options){let m={get:s.bind(this,h),set:i.bind(this,h)};Object.defineProperty(this._publicOptions,h,m)}}_checkReadonlyOptions(o){if(S.includes(o))throw Error(`Option "${o}" can only be set in the constructor`)}_checkProposedApi(){if(!this._core.optionsService.rawOptions.allowProposedApi)throw Error("You must set the allowProposedApi option to true to use proposed API")}get onBell(){return this._core.onBell}get onBinary(){return this._core.onBinary}get onCursorMove(){return this._core.onCursorMove}get onData(){return this._core.onData}get onKey(){return this._core.onKey}get onLineFeed(){return this._core.onLineFeed}get onRender(){return this._core.onRender}get onResize(){return this._core.onResize}get onScroll(){return this._core.onScroll}get onSelectionChange(){return this._core.onSelectionChange}get onTitleChange(){return this._core.onTitleChange}get onWriteParsed(){return this._core.onWriteParsed}get element(){return this._core.element}get parser(){return this._parser||(this._parser=new f.ParserApi(this._core)),this._parser}get unicode(){return this._checkProposedApi(),new p.UnicodeApi(this._core)}get textarea(){return this._core.textarea}get rows(){return this._core.rows}get cols(){return this._core.cols}get buffer(){return this._buffer||(this._buffer=this.register(new n.BufferNamespaceApi(this._core))),this._buffer}get markers(){return this._checkProposedApi(),this._core.markers}get modes(){let o=this._core.coreService.decPrivateModes,s="none";switch(this._core.coreMouseService.activeProtocol){case"X10":s="x10";break;case"VT200":s="vt200";break;case"DRAG":s="drag";break;case"ANY":s="any"}return{applicationCursorKeysMode:o.applicationCursorKeys,applicationKeypadMode:o.applicationKeypad,bracketedPasteMode:o.bracketedPasteMode,insertMode:this._core.coreService.modes.insertMode,mouseTrackingMode:s,originMode:o.origin,reverseWraparoundMode:o.reverseWraparound,sendFocusMode:o.sendFocus,wraparoundMode:o.wraparound}}get options(){return this._publicOptions}set options(o){for(let s in o)this._publicOptions[s]=o[s]}blur(){this._core.blur()}focus(){this._core.focus()}input(o,s=!0){this._core.input(o,s)}resize(o,s){this._verifyIntegers(o,s),this._core.resize(o,s)}open(o){this._core.open(o)}attachCustomKeyEventHandler(o){this._core.attachCustomKeyEventHandler(o)}attachCustomWheelEventHandler(o){this._core.attachCustomWheelEventHandler(o)}registerLinkProvider(o){return this._core.registerLinkProvider(o)}registerCharacterJoiner(o){return this._checkProposedApi(),this._core.registerCharacterJoiner(o)}deregisterCharacterJoiner(o){this._checkProposedApi(),this._core.deregisterCharacterJoiner(o)}registerMarker(o=0){return this._verifyIntegers(o),this._core.registerMarker(o)}registerDecoration(o){return this._checkProposedApi(),this._verifyPositiveIntegers(o.x??0,o.width??0,o.height??0),this._core.registerDecoration(o)}hasSelection(){return this._core.hasSelection()}select(o,s,i){this._verifyIntegers(o,s,i),this._core.select(o,s,i)}getSelection(){return this._core.getSelection()}getSelectionPosition(){return this._core.getSelectionPosition()}clearSelection(){this._core.clearSelection()}selectAll(){this._core.selectAll()}selectLines(o,s){this._verifyIntegers(o,s),this._core.selectLines(o,s)}dispose(){super.dispose()}scrollLines(o){this._verifyIntegers(o),this._core.scrollLines(o)}scrollPages(o){this._verifyIntegers(o),this._core.scrollPages(o)}scrollToTop(){this._core.scrollToTop()}scrollToBottom(){this._core.scrollToBottom()}scrollToLine(o){this._verifyIntegers(o),this._core.scrollToLine(o)}clear(){this._core.clear()}write(o,s){this._core.write(o,s)}writeln(o,s){this._core.write(o),this._core.write(`\r
`,s)}paste(o){this._core.paste(o)}refresh(o,s){this._verifyIntegers(o,s),this._core.refresh(o,s)}reset(){this._core.reset()}clearTextureAtlas(){this._core.clearTextureAtlas()}loadAddon(o){this._addonManager.loadAddon(this,o)}static get strings(){return t}_verifyIntegers(...o){for(let s of o)if(s===1/0||isNaN(s)||s%1!=0)throw Error("This API only accepts integers")}_verifyPositiveIntegers(...o){for(let s of o)if(s&&(s===1/0||isNaN(s)||s%1!=0||s<0))throw Error("This API only accepts positive integers")}}A.Terminal=r})(),N})()))}))(),me=Mt(Li(),1);function mr(g){let _={cursor:"#ffffff",cursorAccent:"#000000"};return g==="dark"?{..._,background:"#0f172a",foreground:"#f8fafc",black:"#0f172a",red:"#ef4444",green:"#22c55e",yellow:"#eab308",blue:"#3b82f6",magenta:"#a855f7",cyan:"#06b6d4",white:"#f1f5f9",brightBlack:"#475569",brightRed:"#f87171",brightGreen:"#4ade80",brightYellow:"#facc15",brightBlue:"#60a5fa",brightMagenta:"#c084fc",brightCyan:"#22d3ee",brightWhite:"#ffffff",selection:"rgba(148, 163, 184, 0.3)"}:{..._,background:"#ffffff",foreground:"#0f172a",cursor:"#0f172a",black:"#0f172a",red:"#dc2626",green:"#16a34a",yellow:"#ca8a04",blue:"#2563eb",magenta:"#9333ea",cyan:"#0891b2",white:"#e2e8f0",brightBlack:"#64748b",brightRed:"#ef4444",brightGreen:"#22c55e",brightYellow:"#eab308",brightBlue:"#3b82f6",brightMagenta:"#a855f7",brightCyan:"#06b6d4",brightWhite:"#ffffff",selection:"rgba(71, 85, 105, 0.2)"}}var Se=Mt(Di(),1),Xe=g=>{let _=(0,Wi.c)(11),{onClick:b,disabled:E,icon:T,children:N,keyboardShortcut:A}=g,t=E===void 0?!1:E,a;_[0]===Symbol.for("react.memo_cache_sentinel")?(a=Tt("w-full text-left px-3 py-2 text-sm flex items-center gap-3 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-muted"),_[0]=a):a=_[0];let l;_[1]===T?l=_[2]:(l=(0,Se.jsx)(T,{className:"w-4 h-4"}),_[1]=T,_[2]=l);let u;_[3]===A?u=_[4]:(u=A&&(0,Se.jsx)(Pi,{className:"ml-auto",shortcut:A}),_[3]=A,_[4]=u);let n;return _[5]!==N||_[6]!==t||_[7]!==b||_[8]!==l||_[9]!==u?(n=(0,Se.jsxs)("button",{className:a,type:"button",onClick:b,disabled:t,children:[l,N,u]}),_[5]=N,_[6]=t,_[7]=b,_[8]=l,_[9]=u,_[10]=n):n=_[10],n};function Sr(g,_){return b=>{let{ctrlKey:E,metaKey:T,key:N}=b;if(E||T)switch(N){case"c":g.hasSelection()&&(b.preventDefault(),Oi(g.getSelection()));break;case"v":b.preventDefault(),navigator.clipboard.readText().then(A=>{g.paste(A)});break;case"a":b.preventDefault(),g.selectAll();break;case"l":b.preventDefault(),g.clear();break}}}function Cr(g,_){let b=()=>_(null);return{handleCopy:()=>{g.hasSelection()&&navigator.clipboard.writeText(g.getSelection()),b()},handlePaste:()=>{navigator.clipboard.readText().then(E=>{g.paste(E)}),b()},handleSelectAll:()=>{g.selectAll(),b()},handleClear:()=>{g.clear(),b()},closeMenu:b}}var ni=100,br=me.memo(({visible:g,onClose:_})=>{let b=(0,me.useRef)(null),E=(0,me.useRef)(null),[{terminal:T,fitAddon:N,searchAddon:A}]=(0,me.useState)(()=>{let v=new pr.Terminal({fontFamily:"Menlo, DejaVu Sans Mono, Consolas, Lucida Console, monospace",fontSize:14,scrollback:1e4,cursorBlink:!0,cursorStyle:"block",allowTransparency:!1,theme:mr("dark"),rightClickSelectsWord:!0,wordSeparator:` 	\r
"'\`(){}[]<>|&;`,allowProposedApi:!0}),C=new ji,k=new Rs,D=new Ni.CanvasAddon,x=new cr,y=new vr;return v.loadAddon(C),v.loadAddon(k),v.loadAddon(D),v.loadAddon(x),v.loadAddon(y),v.unicode.activeVersion="11",{terminal:v,fitAddon:C,searchAddon:k}}),[t,a]=me.useState(!1),[l,u]=(0,me.useState)(null),n=ki(),f=Ii(),{removeCommand:p,setReady:S}=Hi(),r=$e(Sr(T,A)),e=$e(v=>{v.preventDefault();let C=window.innerHeight-v.clientY<200;u({x:v.clientX,y:v.clientY,placement:C?"top":"bottom"})}),o=$e(v=>{let C=v.target,k=C&&C instanceof HTMLElement&&C.closest(".xterm-context-menu");l&&!k&&u(null)}),s=Bi(({cols:v,rows:C})=>{E.current&&E.current.readyState===WebSocket.OPEN&&(Ze.debug("Sending resize to backend terminal",{cols:v,rows:C}),E.current.send(JSON.stringify({type:"resize",cols:v,rows:C})))},ni),i=$e(()=>{!T||!N||N.fit()}),{handleCopy:h,handlePaste:m,handleSelectAll:d,handleClear:c}=(0,me.useMemo)(()=>Cr(T,u),[T]);return(0,me.useEffect)(()=>t?void 0:((async()=>{try{await Ei();let v=new WebSocket(n.getTerminalWsURL()),C=new $i(v);T.loadAddon(C),E.current=v;let k=()=>{S(v.readyState===WebSocket.OPEN)};v.addEventListener("open",()=>{k()}),v.addEventListener("close",()=>{_(),C.dispose(),E.current=null,T.clear(),a(!1),S(!1)}),v.addEventListener("error",()=>{k()}),k(),a(!0)}catch(v){Ze.error("Runtime health check failed for terminal",v),_()}})(),()=>{}),[t]),(0,me.useEffect)(()=>{var v;if(!(!f.isReady||f.pendingCommands.length===0))for(let C of f.pendingCommands)T&&((v=E.current)==null?void 0:v.readyState)===WebSocket.OPEN&&(Ze.debug("Sending programmatic command to terminal",{command:C.text}),T.input(C.text),T.focus(),p(C.id))},[T,f.isReady,f.pendingCommands,p]),(0,me.useEffect)(()=>{g&&(N.fit(),T.focus())},[g]),(0,me.useEffect)(()=>{if(!b.current)return;T.open(b.current),setTimeout(()=>{N.fit()},ni),T.focus();let v=new AbortController;return window.addEventListener("resize",i,{signal:v.signal}),b.current.addEventListener("keydown",r,{signal:v.signal}),b.current.addEventListener("contextmenu",e,{signal:v.signal}),T.onResize(s),document.addEventListener("click",o,{signal:v.signal}),()=>{v.abort()}},[]),(0,Se.jsxs)("div",{className:"relative w-full h-[calc(100%-4px)] bg-popover",children:[(0,Se.jsx)("div",{className:"w-full h-full",ref:b}),l&&(0,Se.jsxs)("div",{className:"xterm-context-menu fixed z-50 rounded-md shadow-lg py-1 min-w-[160px] border bg-popover",style:{left:l.x,[l.placement==="top"?"bottom":"top"]:l.placement==="top"?window.innerHeight-l.y:l.y},children:[(0,Se.jsx)(Xe,{onClick:h,disabled:!T.hasSelection(),icon:Ai,keyboardShortcut:"mod-c",children:"Copy"}),(0,Se.jsx)(Xe,{onClick:m,icon:Mi,keyboardShortcut:"mod-v",children:"Paste"}),(0,Se.jsx)("hr",{className:Tt("my-1 border-border")}),(0,Se.jsx)(Xe,{onClick:d,icon:Fi,keyboardShortcut:"mod-a",children:"Select all"}),(0,Se.jsx)(Xe,{onClick:c,icon:Ti,keyboardShortcut:"mod-l",children:"Clear terminal"})]})]})});export{br as default};
