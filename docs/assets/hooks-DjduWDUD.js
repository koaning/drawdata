import{l as S,p as _,u as E}from"./useEvent-DlWF5OMa.js";import{o as I}from"./cells-CmJW_FeD.js";import{t as N}from"./compiler-runtime-DeeZ7FnK.js";import{a as k,d as x}from"./hotkeys-uKX61F1_.js";import{i as P}from"./utils-Czt8B2GX.js";import{A as T,w as F}from"./config-CENq_7Pd.js";import{r as V}from"./requests-C0HaHO6a.js";import{f as D}from"./layout-CBI2c778.js";import{o as $}from"./download-C_slsU-7.js";import{t as B}from"./use-toast-Bzf3rpev.js";import{t as j}from"./useInterval-DPyGJkQD.js";var C=N(),A=5e3;function H(){let t=(0,C.c)(14),a=E(P),{state:e}=E(F),n=a.auto_download.includes("markdown"),s=a.auto_download.includes("html"),m=a.auto_download.includes("ipynb"),r=e===T.OPEN,d=!n||!r,p=!s||!r,u=!m||!r,{autoExportAsHTML:i,autoExportAsIPYNB:o,autoExportAsMarkdown:l,updateCellOutputs:c}=V(),b=M(),f;t[0]===l?f=t[1]:(f=async()=>{await l({download:!1})},t[0]=l,t[1]=f);let w;t[2]===d?w=t[3]:(w={delayMs:A,whenVisible:!0,disabled:d},t[2]=d,t[3]=w),j(f,w);let h;t[4]===i?h=t[5]:(h=async()=>{await i({download:!1,includeCode:!0,files:D.INSTANCE.filenames()})},t[4]=i,t[5]=h);let y;t[6]===p?y=t[7]:(y={delayMs:A,whenVisible:!0,disabled:p},t[6]=p,t[7]=y),j(h,y);let v;t[8]!==o||t[9]!==b||t[10]!==c?(v=async()=>{await O(b,c),await o({download:!1})},t[8]=o,t[9]=b,t[10]=c,t[11]=v):v=t[11];let g;t[12]===u?g=t[13]:(g={delayMs:A,whenVisible:!0,disabled:u,skipIfRunning:!0},t[12]=u,t[13]=g),j(v,g)}var L=_({}),R=new Set(["text/html","application/vnd.vegalite.v5+json","application/vnd.vega.v5+json","application/vnd.vegalite.v6+json","application/vnd.vega.v6+json"]);function M(){let t=(0,C.c)(4),[a,e]=S(L),n=E(I),s;return t[0]!==n||t[1]!==a||t[2]!==e?(s=async()=>{var p,u;let m={},r=[];for(let[i,o]of k.entries(n)){let l=(p=o.output)==null?void 0:p.data,c=a[i]!==l;m[i]=l,(u=o.output)!=null&&u.mimetype&&R.has(o.output.mimetype)&&l&&c&&r.push([i,o])}if(e(m),r.length===0)return{};let d=await Promise.all(r.map(q));return k.fromEntries(d.filter(Y))},t[0]=n,t[1]=a,t[2]=e,t[3]=s):s=t[3],s}function Y(t){return t!==null}async function q(t){let[a]=t;try{let e=await $(a);return e?[a,["image/png",e]]:(x.error(`Failed to capture screenshot for cell ${a}`),null)}catch(e){let n=e;return x.error(`Error screenshotting cell ${a}:`,n),null}}async function O(t,a){try{let e=await t();Object.keys(e).length>0&&await a({cellIdsToOutput:e})}catch(e){x.error("Error updating cell outputs with screenshots:",e),B({title:"Failed to capture cell outputs",description:"Some outputs may not appear in the PDF. Continuing with export.",variant:"danger"})}}export{H as n,M as r,O as t};
