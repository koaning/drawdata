import{S as Fn,g as Vn,m as rn}from"./_Uint8Array-BGESiCQL.js";import{t as An}from"./toString-DlRqgfqz.js";import{t as en}from"./now-6sUe0ZdD.js";import{t as Jn}from"./toInteger-CDcO32Gx.js";import{n as Hn,t as Kn}from"./_baseFor-Duhs3RiJ.js";import{r as Qn,t as Un}from"./_getTag-BWqNuuwU.js";import{c as tn,g as z,l as Wn,m as Xn,p as Yn,t as I,u as Zn}from"./merge-BBX6ug-N.js";import{n as $n}from"./_baseUniq-CsutM-S0.js";import{i as on,n as _,r as f,t as C}from"./reduce-NgiHP_CR.js";import{d as nr}from"./_baseIsEqual-Cz9Tt_-E.js";import{t as P}from"./flatten-Buk63LQO.js";import{t as L}from"./pick-DeQioq0G.js";import{t as rr}from"./_hasUnicode-zBEpxwYe.js";import{i as er,n as w,r as k,t as b}from"./graphlib-Dtxn1kuc.js";import{n as an,r as S}from"./_baseEach-BH6a1vAB.js";import{n as tr}from"./hasIn-DydgU7lx.js";import{t as or}from"./_baseProperty-DuoFhI7N.js";import{i as p,n as un,r as ir,t as N}from"./min-BgkyNW2f.js";import{t as ar}from"./isString-CqoLqJdS.js";import{t as R}from"./sortBy-Bdnw8bdS.js";import{t as E}from"./range-sshwVRcP.js";var ur=1,dr=4;function cr(n){return er(n,ur|dr)}var fr=cr,dn=Object.prototype,sr=dn.hasOwnProperty,hr=Zn(function(n,r){n=Object(n);var e=-1,t=r.length,o=t>2?r[2]:void 0;for(o&&Wn(r[0],r[1],o)&&(t=1);++e<t;)for(var i=r[e],a=tn(i),u=-1,c=a.length;++u<c;){var d=a[u],s=n[d];(s===void 0||Vn(s,dn[d])&&!sr.call(n,d))&&(n[d]=i[d])}return n});function gr(n){var r=n==null?0:n.length;return r?n[r-1]:void 0}var T=gr;function vr(n){return function(r,e,t){var o=Object(r);if(!rn(r)){var i=S(e,3);r=nr(r),e=function(u){return i(o[u],u,o)}}var a=n(r,e,t);return a>-1?o[i?r[a]:a]:void 0}}var lr=vr,pr=Math.max;function mr(n,r,e){var t=n==null?0:n.length;if(!t)return-1;var o=e==null?0:Jn(e);return o<0&&(o=pr(t+o,0)),$n(n,S(r,3),o)}var D=lr(mr);function wr(n,r){return n==null?n:Kn(n,on(r),tn)}var br=wr;function yr(n,r){return n&&an(n,on(r))}var xr=yr;function kr(n,r){return n>r}var Er=kr,Or=Object.prototype.hasOwnProperty;function jr(n,r){return n!=null&&Or.call(n,r)}var _r=jr;function Pr(n,r){return n!=null&&tr(n,r,_r)}var cn=Pr;function Nr(n,r){var e={};return r=S(r,3),an(n,function(t,o,i){Xn(e,o,r(t,o,i))}),e}var G=Nr;function Rr(n){return n&&n.length?un(n,Hn,Er):void 0}var y=Rr;function Mr(n,r){return n&&n.length?un(n,S(r,2),ir):void 0}var F=Mr,Cr=or("length"),fn="\\ud800-\\udfff",Lr="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Sr="\\ufe0e\\ufe0f",Tr="["+fn+"]",V="["+Lr+"]",A="\\ud83c[\\udffb-\\udfff]",Gr="(?:"+V+"|"+A+")",sn="[^"+fn+"]",hn="(?:\\ud83c[\\udde6-\\uddff]){2}",gn="[\\ud800-\\udbff][\\udc00-\\udfff]",Br="\\u200d",vn=Gr+"?",ln="["+Sr+"]?",qr="(?:"+Br+"(?:"+[sn,hn,gn].join("|")+")"+ln+vn+")*",zr=ln+vn+qr,Ir="(?:"+[sn+V+"?",V,hn,gn,Tr].join("|")+")",pn=RegExp(A+"(?="+A+")|"+Ir+zr,"g");function Dr(n){for(var r=pn.lastIndex=0;pn.test(n);)++r;return r}var Fr=Dr;function Vr(n){return rr(n)?Fr(n):Cr(n)}var Ar=Vr,Jr="[object Map]",Hr="[object Set]";function Kr(n){if(n==null)return 0;if(rn(n))return ar(n)?Ar(n):n.length;var r=Un(n);return r==Jr||r==Hr?n.size:Qn(n).length}var Qr=Kr,Ur=0;function Wr(n){var r=++Ur;return An(n)+r}var J=Wr;function Xr(n,r,e){for(var t=-1,o=n.length,i=r.length,a={};++t<o;){var u=t<i?r[t]:void 0;e(a,n[t],u)}return a}var Yr=Xr;function Zr(n,r){return Yr(n||[],r||[],Yn)}var $r=Zr,ne=class{constructor(){var n={};n._next=n._prev=n,this._sentinel=n}dequeue(){var n=this._sentinel,r=n._prev;if(r!==n)return mn(r),r}enqueue(n){var r=this._sentinel;n._prev&&n._next&&mn(n),n._next=r._next,r._next._prev=n,r._next=n,n._prev=r}toString(){for(var n=[],r=this._sentinel,e=r._prev;e!==r;)n.push(JSON.stringify(e,re)),e=e._prev;return"["+n.join(", ")+"]"}};function mn(n){n._prev._next=n._next,n._next._prev=n._prev,delete n._next,delete n._prev}function re(n,r){if(n!=="_next"&&n!=="_prev")return r}var ee=z(1);function te(n,r){if(n.nodeCount()<=1)return[];var e=ie(n,r||ee);return P(p(oe(e.graph,e.buckets,e.zeroIdx),function(t){return n.outEdges(t.v,t.w)}))}function oe(n,r,e){for(var t=[],o=r[r.length-1],i=r[0],a;n.nodeCount();){for(;a=i.dequeue();)H(n,r,e,a);for(;a=o.dequeue();)H(n,r,e,a);if(n.nodeCount()){for(var u=r.length-2;u>0;--u)if(a=r[u].dequeue(),a){t=t.concat(H(n,r,e,a,!0));break}}}return t}function H(n,r,e,t,o){var i=o?[]:void 0;return f(n.inEdges(t.v),function(a){var u=n.edge(a),c=n.node(a.v);o&&i.push({v:a.v,w:a.w}),c.out-=u,K(r,e,c)}),f(n.outEdges(t.v),function(a){var u=n.edge(a),c=a.w,d=n.node(c);d.in-=u,K(r,e,d)}),n.removeNode(t.v),i}function ie(n,r){var e=new b,t=0,o=0;f(n.nodes(),function(u){e.setNode(u,{v:u,in:0,out:0})}),f(n.edges(),function(u){var c=e.edge(u.v,u.w)||0,d=r(u),s=c+d;e.setEdge(u.v,u.w,s),o=Math.max(o,e.node(u.v).out+=d),t=Math.max(t,e.node(u.w).in+=d)});var i=E(o+t+3).map(function(){return new ne}),a=t+1;return f(e.nodes(),function(u){K(i,a,e.node(u))}),{graph:e,buckets:i,zeroIdx:a}}function K(n,r,e){e.out?e.in?n[e.out-e.in+r].enqueue(e):n[n.length-1].enqueue(e):n[0].enqueue(e)}function ae(n){f(n.graph().acyclicer==="greedy"?te(n,r(n)):ue(n),function(e){var t=n.edge(e);n.removeEdge(e),t.forwardName=e.name,t.reversed=!0,n.setEdge(e.w,e.v,t,J("rev"))});function r(e){return function(t){return e.edge(t).weight}}}function ue(n){var r=[],e={},t={};function o(i){Object.prototype.hasOwnProperty.call(t,i)||(t[i]=!0,e[i]=!0,f(n.outEdges(i),function(a){Object.prototype.hasOwnProperty.call(e,a.w)?r.push(a):o(a.w)}),delete e[i])}return f(n.nodes(),o),r}function de(n){f(n.edges(),function(r){var e=n.edge(r);if(e.reversed){n.removeEdge(r);var t=e.forwardName;delete e.reversed,delete e.forwardName,n.setEdge(r.w,r.v,e,t)}})}function O(n,r,e,t){var o;do o=J(t);while(n.hasNode(o));return e.dummy=r,n.setNode(o,e),o}function ce(n){var r=new b().setGraph(n.graph());return f(n.nodes(),function(e){r.setNode(e,n.node(e))}),f(n.edges(),function(e){var t=r.edge(e.v,e.w)||{weight:0,minlen:1},o=n.edge(e);r.setEdge(e.v,e.w,{weight:t.weight+o.weight,minlen:Math.max(t.minlen,o.minlen)})}),r}function wn(n){var r=new b({multigraph:n.isMultigraph()}).setGraph(n.graph());return f(n.nodes(),function(e){n.children(e).length||r.setNode(e,n.node(e))}),f(n.edges(),function(e){r.setEdge(e,n.edge(e))}),r}function bn(n,r){var e=n.x,t=n.y,o=r.x-e,i=r.y-t,a=n.width/2,u=n.height/2;if(!o&&!i)throw Error("Not possible to find intersection inside of the rectangle");var c,d;return Math.abs(i)*a>Math.abs(o)*u?(i<0&&(u=-u),c=u*o/i,d=u):(o<0&&(a=-a),c=a,d=a*i/o),{x:e+c,y:t+d}}function B(n){var r=p(E(xn(n)+1),function(){return[]});return f(n.nodes(),function(e){var t=n.node(e),o=t.rank;w(o)||(r[o][t.order]=e)}),r}function fe(n){var r=N(p(n.nodes(),function(e){return n.node(e).rank}));f(n.nodes(),function(e){var t=n.node(e);cn(t,"rank")&&(t.rank-=r)})}function se(n){var r=N(p(n.nodes(),function(i){return n.node(i).rank})),e=[];f(n.nodes(),function(i){var a=n.node(i).rank-r;e[a]||(e[a]=[]),e[a].push(i)});var t=0,o=n.graph().nodeRankFactor;f(e,function(i,a){w(i)&&a%o!==0?--t:t&&f(i,function(u){n.node(u).rank+=t})})}function yn(n,r,e,t){var o={width:0,height:0};return arguments.length>=4&&(o.rank=e,o.order=t),O(n,"border",o,r)}function xn(n){return y(p(n.nodes(),function(r){var e=n.node(r).rank;if(!w(e))return e}))}function he(n,r){var e={lhs:[],rhs:[]};return f(n,function(t){r(t)?e.lhs.push(t):e.rhs.push(t)}),e}function ge(n,r){var e=en();try{return r()}finally{console.log(n+" time: "+(en()-e)+"ms")}}function ve(n,r){return r()}function le(n){function r(e){var t=n.children(e),o=n.node(e);if(t.length&&f(t,r),Object.prototype.hasOwnProperty.call(o,"minRank")){o.borderLeft=[],o.borderRight=[];for(var i=o.minRank,a=o.maxRank+1;i<a;++i)kn(n,"borderLeft","_bl",e,o,i),kn(n,"borderRight","_br",e,o,i)}}f(n.children(),r)}function kn(n,r,e,t,o,i){var a={width:0,height:0,rank:i,borderType:r},u=o[r][i-1],c=O(n,"border",a,e);o[r][i]=c,n.setParent(c,t),u&&n.setEdge(u,c,{weight:1})}function pe(n){var r=n.graph().rankdir.toLowerCase();(r==="lr"||r==="rl")&&En(n)}function me(n){var r=n.graph().rankdir.toLowerCase();(r==="bt"||r==="rl")&&we(n),(r==="lr"||r==="rl")&&(be(n),En(n))}function En(n){f(n.nodes(),function(r){On(n.node(r))}),f(n.edges(),function(r){On(n.edge(r))})}function On(n){var r=n.width;n.width=n.height,n.height=r}function we(n){f(n.nodes(),function(r){Q(n.node(r))}),f(n.edges(),function(r){var e=n.edge(r);f(e.points,Q),Object.prototype.hasOwnProperty.call(e,"y")&&Q(e)})}function Q(n){n.y=-n.y}function be(n){f(n.nodes(),function(r){U(n.node(r))}),f(n.edges(),function(r){var e=n.edge(r);f(e.points,U),Object.prototype.hasOwnProperty.call(e,"x")&&U(e)})}function U(n){var r=n.x;n.x=n.y,n.y=r}function ye(n){n.graph().dummyChains=[],f(n.edges(),function(r){xe(n,r)})}function xe(n,r){var e=r.v,t=n.node(e).rank,o=r.w,i=n.node(o).rank,a=r.name,u=n.edge(r),c=u.labelRank;if(i!==t+1){n.removeEdge(r);var d=void 0,s,h;for(h=0,++t;t<i;++h,++t)u.points=[],d={width:0,height:0,edgeLabel:u,edgeObj:r,rank:t},s=O(n,"edge",d,"_d"),t===c&&(d.width=u.width,d.height=u.height,d.dummy="edge-label",d.labelpos=u.labelpos),n.setEdge(e,s,{weight:u.weight},a),h===0&&n.graph().dummyChains.push(s),e=s;n.setEdge(e,o,{weight:u.weight},a)}}function ke(n){f(n.graph().dummyChains,function(r){var e=n.node(r),t=e.edgeLabel,o;for(n.setEdge(e.edgeObj,t);e.dummy;)o=n.successors(r)[0],n.removeNode(r),t.points.push({x:e.x,y:e.y}),e.dummy==="edge-label"&&(t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height),r=o,e=n.node(r)})}function W(n){var r={};function e(t){var o=n.node(t);if(Object.prototype.hasOwnProperty.call(r,t))return o.rank;r[t]=!0;var i=N(p(n.outEdges(t),function(a){return e(a.w)-n.edge(a).minlen}));return(i===1/0||i==null)&&(i=0),o.rank=i}f(n.sources(),e)}function M(n,r){return n.node(r.w).rank-n.node(r.v).rank-n.edge(r).minlen}function jn(n){var r=new b({directed:!1}),e=n.nodes()[0],t=n.nodeCount();r.setNode(e,{});for(var o,i;Ee(r,n)<t;)o=Oe(r,n),i=r.hasNode(o.v)?M(n,o):-M(n,o),je(r,n,i);return r}function Ee(n,r){function e(t){f(r.nodeEdges(t),function(o){var i=o.v,a=t===i?o.w:i;!n.hasNode(a)&&!M(r,o)&&(n.setNode(a,{}),n.setEdge(t,a,{}),e(a))})}return f(n.nodes(),e),n.nodeCount()}function Oe(n,r){return F(r.edges(),function(e){if(n.hasNode(e.v)!==n.hasNode(e.w))return M(r,e)})}function je(n,r,e){f(n.nodes(),function(t){r.node(t).rank+=e})}z(1),z(1),_e.CycleException=q;function _e(n){var r={},e={},t=[];function o(i){if(Object.prototype.hasOwnProperty.call(e,i))throw new q;Object.prototype.hasOwnProperty.call(r,i)||(e[i]=!0,r[i]=!0,f(n.predecessors(i),o),delete e[i],t.push(i))}if(f(n.sinks(),o),Qr(r)!==n.nodeCount())throw new q;return t}function q(){}q.prototype=Error();function _n(n,r,e){Fn(r)||(r=[r]);var t=(n.isDirected()?n.successors:n.neighbors).bind(n),o=[],i={};return f(r,function(a){if(!n.hasNode(a))throw Error("Graph does not have node: "+a);Pn(n,a,e==="post",i,t,o)}),o}function Pn(n,r,e,t,o,i){Object.prototype.hasOwnProperty.call(t,r)||(t[r]=!0,e||i.push(r),f(o(r),function(a){Pn(n,a,e,t,o,i)}),e&&i.push(r))}function Pe(n,r){return _n(n,r,"post")}function Ne(n,r){return _n(n,r,"pre")}x.initLowLimValues=Y,x.initCutValues=X,x.calcCutValue=Nn,x.leaveEdge=Mn,x.enterEdge=Cn,x.exchangeEdges=Ln;function x(n){n=ce(n),W(n);var r=jn(n);Y(r),X(r,n);for(var e,t;e=Mn(r);)t=Cn(r,n,e),Ln(r,n,e,t)}function X(n,r){var e=Pe(n,n.nodes());e=e.slice(0,e.length-1),f(e,function(t){Re(n,r,t)})}function Re(n,r,e){var t=n.node(e).parent;n.edge(e,t).cutvalue=Nn(n,r,e)}function Nn(n,r,e){var t=n.node(e).parent,o=!0,i=r.edge(e,t),a=0;return i||(i=(o=!1,r.edge(t,e))),a=i.weight,f(r.nodeEdges(e),function(u){var c=u.v===e,d=c?u.w:u.v;if(d!==t){var s=c===o,h=r.edge(u).weight;if(a+=s?h:-h,Ce(n,e,d)){var g=n.edge(e,d).cutvalue;a+=s?-g:g}}}),a}function Y(n,r){arguments.length<2&&(r=n.nodes()[0]),Rn(n,{},1,r)}function Rn(n,r,e,t,o){var i=e,a=n.node(t);return r[t]=!0,f(n.neighbors(t),function(u){Object.prototype.hasOwnProperty.call(r,u)||(e=Rn(n,r,e,u,t))}),a.low=i,a.lim=e++,o?a.parent=o:delete a.parent,e}function Mn(n){return D(n.edges(),function(r){return n.edge(r).cutvalue<0})}function Cn(n,r,e){var t=e.v,o=e.w;r.hasEdge(t,o)||(t=e.w,o=e.v);var i=n.node(t),a=n.node(o),u=i,c=!1;return i.lim>a.lim&&(u=a,c=!0),F(_(r.edges(),function(d){return c===Sn(n,n.node(d.v),u)&&c!==Sn(n,n.node(d.w),u)}),function(d){return M(r,d)})}function Ln(n,r,e,t){var o=e.v,i=e.w;n.removeEdge(o,i),n.setEdge(t.v,t.w,{}),Y(n),X(n,r),Me(n,r)}function Me(n,r){var e=Ne(n,D(n.nodes(),function(t){return!r.node(t).parent}));e=e.slice(1),f(e,function(t){var o=n.node(t).parent,i=r.edge(t,o),a=!1;i||(i=r.edge(o,t),a=!0),r.node(t).rank=r.node(o).rank+(a?i.minlen:-i.minlen)})}function Ce(n,r,e){return n.hasEdge(r,e)}function Sn(n,r,e){return e.low<=r.lim&&r.lim<=e.lim}function Le(n){switch(n.graph().ranker){case"network-simplex":Tn(n);break;case"tight-tree":Te(n);break;case"longest-path":Se(n);break;default:Tn(n)}}var Se=W;function Te(n){W(n),jn(n)}function Tn(n){x(n)}function Ge(n){var r=O(n,"root",{},"_root"),e=Be(n),t=y(k(e))-1,o=2*t+1;n.graph().nestingRoot=r,f(n.edges(),function(a){n.edge(a).minlen*=o});var i=qe(n)+1;f(n.children(),function(a){Gn(n,r,o,i,t,e,a)}),n.graph().nodeRankFactor=o}function Gn(n,r,e,t,o,i,a){var u=n.children(a);if(!u.length){a!==r&&n.setEdge(r,a,{weight:0,minlen:e});return}var c=yn(n,"_bt"),d=yn(n,"_bb"),s=n.node(a);n.setParent(c,a),s.borderTop=c,n.setParent(d,a),s.borderBottom=d,f(u,function(h){Gn(n,r,e,t,o,i,h);var g=n.node(h),l=g.borderTop?g.borderTop:h,v=g.borderBottom?g.borderBottom:h,m=g.borderTop?t:2*t,j=l===v?o-i[a]+1:1;n.setEdge(c,l,{weight:m,minlen:j,nestingEdge:!0}),n.setEdge(v,d,{weight:m,minlen:j,nestingEdge:!0})}),n.parent(a)||n.setEdge(r,c,{weight:0,minlen:o+i[a]})}function Be(n){var r={};function e(t,o){var i=n.children(t);i&&i.length&&f(i,function(a){e(a,o+1)}),r[t]=o}return f(n.children(),function(t){e(t,1)}),r}function qe(n){return C(n.edges(),function(r,e){return r+n.edge(e).weight},0)}function ze(n){var r=n.graph();n.removeNode(r.nestingRoot),delete r.nestingRoot,f(n.edges(),function(e){n.edge(e).nestingEdge&&n.removeEdge(e)})}function Ie(n,r,e){var t={},o;f(e,function(i){for(var a=n.parent(i),u,c;a;){if(u=n.parent(a),u?(c=t[u],t[u]=a):(c=o,o=a),c&&c!==a){r.setEdge(c,a);return}a=u}})}function De(n,r,e){var t=Fe(n),o=new b({compound:!0}).setGraph({root:t}).setDefaultNodeLabel(function(i){return n.node(i)});return f(n.nodes(),function(i){var a=n.node(i),u=n.parent(i);(a.rank===r||a.minRank<=r&&r<=a.maxRank)&&(o.setNode(i),o.setParent(i,u||t),f(n[e](i),function(c){var d=c.v===i?c.w:c.v,s=o.edge(d,i),h=w(s)?0:s.weight;o.setEdge(d,i,{weight:n.edge(c).weight+h})}),Object.prototype.hasOwnProperty.call(a,"minRank")&&o.setNode(i,{borderLeft:a.borderLeft[r],borderRight:a.borderRight[r]}))}),o}function Fe(n){for(var r;n.hasNode(r=J("_root")););return r}function Ve(n,r){for(var e=0,t=1;t<r.length;++t)e+=Ae(n,r[t-1],r[t]);return e}function Ae(n,r,e){for(var t=$r(e,p(e,function(d,s){return s})),o=P(p(r,function(d){return R(p(n.outEdges(d),function(s){return{pos:t[s.w],weight:n.edge(s).weight}}),"pos")})),i=1;i<e.length;)i<<=1;var a=2*i-1;--i;var u=p(Array(a),function(){return 0}),c=0;return f(o.forEach(function(d){var s=d.pos+i;u[s]+=d.weight;for(var h=0;s>0;)s%2&&(h+=u[s+1]),s=s-1>>1,u[s]+=d.weight;c+=d.weight*h})),c}function Je(n){var r={},e=_(n.nodes(),function(i){return!n.children(i).length}),t=p(E(y(p(e,function(i){return n.node(i).rank}))+1),function(){return[]});function o(i){cn(r,i)||(r[i]=!0,t[n.node(i).rank].push(i),f(n.successors(i),o))}return f(R(e,function(i){return n.node(i).rank}),o),t}function He(n,r){return p(r,function(e){var t=n.inEdges(e);if(t.length){var o=C(t,function(i,a){var u=n.edge(a),c=n.node(a.v);return{sum:i.sum+u.weight*c.order,weight:i.weight+u.weight}},{sum:0,weight:0});return{v:e,barycenter:o.sum/o.weight,weight:o.weight}}else return{v:e}})}function Ke(n,r){var e={};return f(n,function(t,o){var i=e[t.v]={indegree:0,in:[],out:[],vs:[t.v],i:o};w(t.barycenter)||(i.barycenter=t.barycenter,i.weight=t.weight)}),f(r.edges(),function(t){var o=e[t.v],i=e[t.w];!w(o)&&!w(i)&&(i.indegree++,o.out.push(e[t.w]))}),Qe(_(e,function(t){return!t.indegree}))}function Qe(n){var r=[];function e(i){return function(a){a.merged||(w(a.barycenter)||w(i.barycenter)||a.barycenter>=i.barycenter)&&Ue(i,a)}}function t(i){return function(a){a.in.push(i),--a.indegree===0&&n.push(a)}}for(;n.length;){var o=n.pop();r.push(o),f(o.in.reverse(),e(o)),f(o.out,t(o))}return p(_(r,function(i){return!i.merged}),function(i){return L(i,["vs","i","barycenter","weight"])})}function Ue(n,r){var e=0,t=0;n.weight&&(e+=n.barycenter*n.weight,t+=n.weight),r.weight&&(e+=r.barycenter*r.weight,t+=r.weight),n.vs=r.vs.concat(n.vs),n.barycenter=e/t,n.weight=t,n.i=Math.min(r.i,n.i),r.merged=!0}function We(n,r){var e=he(n,function(s){return Object.prototype.hasOwnProperty.call(s,"barycenter")}),t=e.lhs,o=R(e.rhs,function(s){return-s.i}),i=[],a=0,u=0,c=0;t.sort(Xe(!!r)),c=Bn(i,o,c),f(t,function(s){c+=s.vs.length,i.push(s.vs),a+=s.barycenter*s.weight,u+=s.weight,c=Bn(i,o,c)});var d={vs:P(i)};return u&&(d.barycenter=a/u,d.weight=u),d}function Bn(n,r,e){for(var t;r.length&&(t=T(r)).i<=e;)r.pop(),n.push(t.vs),e++;return e}function Xe(n){return function(r,e){return r.barycenter<e.barycenter?-1:r.barycenter>e.barycenter?1:n?e.i-r.i:r.i-e.i}}function qn(n,r,e,t){var o=n.children(r),i=n.node(r),a=i?i.borderLeft:void 0,u=i?i.borderRight:void 0,c={};a&&(o=_(o,function(v){return v!==a&&v!==u}));var d=He(n,o);f(d,function(v){if(n.children(v.v).length){var m=qn(n,v.v,e,t);c[v.v]=m,Object.prototype.hasOwnProperty.call(m,"barycenter")&&Ze(v,m)}});var s=Ke(d,e);Ye(s,c);var h=We(s,t);if(a&&(h.vs=P([a,h.vs,u]),n.predecessors(a).length)){var g=n.node(n.predecessors(a)[0]),l=n.node(n.predecessors(u)[0]);Object.prototype.hasOwnProperty.call(h,"barycenter")||(h.barycenter=0,h.weight=0),h.barycenter=(h.barycenter*h.weight+g.order+l.order)/(h.weight+2),h.weight+=2}return h}function Ye(n,r){f(n,function(e){e.vs=P(e.vs.map(function(t){return r[t]?r[t].vs:t}))})}function Ze(n,r){w(n.barycenter)?(n.barycenter=r.barycenter,n.weight=r.weight):(n.barycenter=(n.barycenter*n.weight+r.barycenter*r.weight)/(n.weight+r.weight),n.weight+=r.weight)}function $e(n){var r=xn(n),e=zn(n,E(1,r+1),"inEdges"),t=zn(n,E(r-1,-1,-1),"outEdges"),o=Je(n);In(n,o);for(var i=1/0,a,u=0,c=0;c<4;++u,++c){nt(u%2?e:t,u%4>=2),o=B(n);var d=Ve(n,o);d<i&&(c=0,a=fr(o),i=d)}In(n,a)}function zn(n,r,e){return p(r,function(t){return De(n,t,e)})}function nt(n,r){var e=new b;f(n,function(t){var o=t.graph().root,i=qn(t,o,e,r);f(i.vs,function(a,u){t.node(a).order=u}),Ie(t,e,i.vs)})}function In(n,r){f(r,function(e){f(e,function(t,o){n.node(t).order=o})})}function rt(n){var r=tt(n);f(n.graph().dummyChains,function(e){for(var t=n.node(e),o=t.edgeObj,i=et(n,r,o.v,o.w),a=i.path,u=i.lca,c=0,d=a[c],s=!0;e!==o.w;){if(t=n.node(e),s){for(;(d=a[c])!==u&&n.node(d).maxRank<t.rank;)c++;d===u&&(s=!1)}if(!s){for(;c<a.length-1&&n.node(d=a[c+1]).minRank<=t.rank;)c++;d=a[c]}n.setParent(e,d),e=n.successors(e)[0]}})}function et(n,r,e,t){var o=[],i=[],a=Math.min(r[e].low,r[t].low),u=Math.max(r[e].lim,r[t].lim),c=e,d;do c=n.parent(c),o.push(c);while(c&&(r[c].low>a||u>r[c].lim));for(d=c,c=t;(c=n.parent(c))!==d;)i.push(c);return{path:o.concat(i.reverse()),lca:d}}function tt(n){var r={},e=0;function t(o){var i=e;f(n.children(o),t),r[o]={low:i,lim:e++}}return f(n.children(),t),r}function ot(n,r){var e={};function t(o,i){var a=0,u=0,c=o.length,d=T(i);return f(i,function(s,h){var g=at(n,s),l=g?n.node(g).order:c;(g||s===d)&&(f(i.slice(u,h+1),function(v){f(n.predecessors(v),function(m){var j=n.node(m),nn=j.order;(nn<a||l<nn)&&!(j.dummy&&n.node(v).dummy)&&Dn(e,m,v)})}),u=h+1,a=l)}),i}return C(r,t),e}function it(n,r){var e={};function t(i,a,u,c,d){var s;f(E(a,u),function(h){s=i[h],n.node(s).dummy&&f(n.predecessors(s),function(g){var l=n.node(g);l.dummy&&(l.order<c||l.order>d)&&Dn(e,g,s)})})}function o(i,a){var u=-1,c,d=0;return f(a,function(s,h){if(n.node(s).dummy==="border"){var g=n.predecessors(s);g.length&&(c=n.node(g[0]).order,t(a,d,h,u,c),d=h,u=c)}t(a,d,a.length,c,i.length)}),a}return C(r,o),e}function at(n,r){if(n.node(r).dummy)return D(n.predecessors(r),function(e){return n.node(e).dummy})}function Dn(n,r,e){if(r>e){var t=r;r=e,e=t}Object.prototype.hasOwnProperty.call(n,r)||Object.defineProperty(n,r,{enumerable:!0,configurable:!0,value:{},writable:!0});var o=n[r];Object.defineProperty(o,e,{enumerable:!0,configurable:!0,value:!0,writable:!0})}function ut(n,r,e){if(r>e){var t=r;r=e,e=t}return!!n[r]&&Object.prototype.hasOwnProperty.call(n[r],e)}function dt(n,r,e,t){var o={},i={},a={};return f(r,function(u){f(u,function(c,d){o[c]=c,i[c]=c,a[c]=d})}),f(r,function(u){var c=-1;f(u,function(d){var s=t(d);if(s.length){s=R(s,function(m){return a[m]});for(var h=(s.length-1)/2,g=Math.floor(h),l=Math.ceil(h);g<=l;++g){var v=s[g];i[d]===d&&c<a[v]&&!ut(e,d,v)&&(i[v]=d,i[d]=o[d]=o[v],c=a[v])}}})}),{root:o,align:i}}function ct(n,r,e,t,o){var i={},a=ft(n,r,e,o),u=o?"borderLeft":"borderRight";function c(h,g){for(var l=a.nodes(),v=l.pop(),m={};v;)m[v]?h(v):(m[v]=!0,l.push(v),l=l.concat(g(v))),v=l.pop()}function d(h){i[h]=a.inEdges(h).reduce(function(g,l){return Math.max(g,i[l.v]+a.edge(l))},0)}function s(h){var g=a.outEdges(h).reduce(function(v,m){return Math.min(v,i[m.w]-a.edge(m))},1/0),l=n.node(h);g!==1/0&&l.borderType!==u&&(i[h]=Math.max(i[h],g))}return c(d,a.predecessors.bind(a)),c(s,a.successors.bind(a)),f(t,function(h){i[h]=i[e[h]]}),i}function ft(n,r,e,t){var o=new b,i=n.graph(),a=lt(i.nodesep,i.edgesep,t);return f(r,function(u){var c;f(u,function(d){var s=e[d];if(o.setNode(s),c){var h=e[c],g=o.edge(h,s);o.setEdge(h,s,Math.max(a(n,d,c),g||0))}c=d})}),o}function st(n,r){return F(k(r),function(e){var t=-1/0,o=1/0;return br(e,function(i,a){var u=pt(n,a)/2;t=Math.max(i+u,t),o=Math.min(i-u,o)}),t-o})}function ht(n,r){var e=k(r),t=N(e),o=y(e);f(["u","d"],function(i){f(["l","r"],function(a){var u=i+a,c=n[u],d;if(c!==r){var s=k(c);d=a==="l"?t-N(s):o-y(s),d&&(n[u]=G(c,function(h){return h+d}))}})})}function gt(n,r){return G(n.ul,function(e,t){if(r)return n[r.toLowerCase()][t];var o=R(p(n,t));return(o[1]+o[2])/2})}function vt(n){var r=B(n),e=I(ot(n,r),it(n,r)),t={},o;return f(["u","d"],function(i){o=i==="u"?r:k(r).reverse(),f(["l","r"],function(a){a==="r"&&(o=p(o,function(s){return k(s).reverse()}));var u=(i==="u"?n.predecessors:n.successors).bind(n),c=dt(n,o,e,u),d=ct(n,o,c.root,c.align,a==="r");a==="r"&&(d=G(d,function(s){return-s})),t[i+a]=d})}),ht(t,st(n,t)),gt(t,n.graph().align)}function lt(n,r,e){return function(t,o,i){var a=t.node(o),u=t.node(i),c=0,d;if(c+=a.width/2,Object.prototype.hasOwnProperty.call(a,"labelpos"))switch(a.labelpos.toLowerCase()){case"l":d=-a.width/2;break;case"r":d=a.width/2;break}if(d&&(c+=e?d:-d),d=0,c+=(a.dummy?r:n)/2,c+=(u.dummy?r:n)/2,c+=u.width/2,Object.prototype.hasOwnProperty.call(u,"labelpos"))switch(u.labelpos.toLowerCase()){case"l":d=u.width/2;break;case"r":d=-u.width/2;break}return d&&(c+=e?d:-d),d=0,c}}function pt(n,r){return n.node(r).width}function mt(n){n=wn(n),wt(n),xr(vt(n),function(r,e){n.node(e).x=r})}function wt(n){var r=B(n),e=n.graph().ranksep,t=0;f(r,function(o){var i=y(p(o,function(a){return n.node(a).height}));f(o,function(a){n.node(a).y=t+i/2}),t+=i+e})}function bt(n,r){var e=r&&r.debugTiming?ge:ve;e("layout",()=>{var t=e("  buildLayoutGraph",()=>Mt(n));e("  runLayout",()=>yt(t,e)),e("  updateInputGraph",()=>xt(n,t))})}function yt(n,r){r("    makeSpaceForEdgeLabels",()=>Ct(n)),r("    removeSelfEdges",()=>Dt(n)),r("    acyclic",()=>ae(n)),r("    nestingGraph.run",()=>Ge(n)),r("    rank",()=>Le(wn(n))),r("    injectEdgeLabelProxies",()=>Lt(n)),r("    removeEmptyRanks",()=>se(n)),r("    nestingGraph.cleanup",()=>ze(n)),r("    normalizeRanks",()=>fe(n)),r("    assignRankMinMax",()=>St(n)),r("    removeEdgeLabelProxies",()=>Tt(n)),r("    normalize.run",()=>ye(n)),r("    parentDummyChains",()=>rt(n)),r("    addBorderSegments",()=>le(n)),r("    order",()=>$e(n)),r("    insertSelfEdges",()=>Ft(n)),r("    adjustCoordinateSystem",()=>pe(n)),r("    position",()=>mt(n)),r("    positionSelfEdges",()=>Vt(n)),r("    removeBorderNodes",()=>It(n)),r("    normalize.undo",()=>ke(n)),r("    fixupEdgeLabelCoords",()=>qt(n)),r("    undoCoordinateSystem",()=>me(n)),r("    translateGraph",()=>Gt(n)),r("    assignNodeIntersects",()=>Bt(n)),r("    reversePoints",()=>zt(n)),r("    acyclic.undo",()=>de(n))}function xt(n,r){f(n.nodes(),function(e){var t=n.node(e),o=r.node(e);t&&(t.x=o.x,t.y=o.y,r.children(e).length&&(t.width=o.width,t.height=o.height))}),f(n.edges(),function(e){var t=n.edge(e),o=r.edge(e);t.points=o.points,Object.prototype.hasOwnProperty.call(o,"x")&&(t.x=o.x,t.y=o.y)}),n.graph().width=r.graph().width,n.graph().height=r.graph().height}var kt=["nodesep","edgesep","ranksep","marginx","marginy"],Et={ranksep:50,edgesep:20,nodesep:50,rankdir:"tb"},Ot=["acyclicer","ranker","rankdir","align"],jt=["width","height"],_t={width:0,height:0},Pt=["minlen","weight","width","height","labeloffset"],Nt={minlen:1,weight:1,width:0,height:0,labeloffset:10,labelpos:"r"},Rt=["labelpos"];function Mt(n){var r=new b({multigraph:!0,compound:!0}),e=$(n.graph());return r.setGraph(I({},Et,Z(e,kt),L(e,Ot))),f(n.nodes(),function(t){var o=$(n.node(t));r.setNode(t,hr(Z(o,jt),_t)),r.setParent(t,n.parent(t))}),f(n.edges(),function(t){var o=$(n.edge(t));r.setEdge(t,I({},Nt,Z(o,Pt),L(o,Rt)))}),r}function Ct(n){var r=n.graph();r.ranksep/=2,f(n.edges(),function(e){var t=n.edge(e);t.minlen*=2,t.labelpos.toLowerCase()!=="c"&&(r.rankdir==="TB"||r.rankdir==="BT"?t.width+=t.labeloffset:t.height+=t.labeloffset)})}function Lt(n){f(n.edges(),function(r){var e=n.edge(r);if(e.width&&e.height){var t=n.node(r.v);O(n,"edge-proxy",{rank:(n.node(r.w).rank-t.rank)/2+t.rank,e:r},"_ep")}})}function St(n){var r=0;f(n.nodes(),function(e){var t=n.node(e);t.borderTop&&(t.minRank=n.node(t.borderTop).rank,t.maxRank=n.node(t.borderBottom).rank,r=y(r,t.maxRank))}),n.graph().maxRank=r}function Tt(n){f(n.nodes(),function(r){var e=n.node(r);e.dummy==="edge-proxy"&&(n.edge(e.e).labelRank=e.rank,n.removeNode(r))})}function Gt(n){var r=1/0,e=0,t=1/0,o=0,i=n.graph(),a=i.marginx||0,u=i.marginy||0;function c(d){var s=d.x,h=d.y,g=d.width,l=d.height;r=Math.min(r,s-g/2),e=Math.max(e,s+g/2),t=Math.min(t,h-l/2),o=Math.max(o,h+l/2)}f(n.nodes(),function(d){c(n.node(d))}),f(n.edges(),function(d){var s=n.edge(d);Object.prototype.hasOwnProperty.call(s,"x")&&c(s)}),r-=a,t-=u,f(n.nodes(),function(d){var s=n.node(d);s.x-=r,s.y-=t}),f(n.edges(),function(d){var s=n.edge(d);f(s.points,function(h){h.x-=r,h.y-=t}),Object.prototype.hasOwnProperty.call(s,"x")&&(s.x-=r),Object.prototype.hasOwnProperty.call(s,"y")&&(s.y-=t)}),i.width=e-r+a,i.height=o-t+u}function Bt(n){f(n.edges(),function(r){var e=n.edge(r),t=n.node(r.v),o=n.node(r.w),i,a;e.points?(i=e.points[0],a=e.points[e.points.length-1]):(e.points=[],i=o,a=t),e.points.unshift(bn(t,i)),e.points.push(bn(o,a))})}function qt(n){f(n.edges(),function(r){var e=n.edge(r);if(Object.prototype.hasOwnProperty.call(e,"x"))switch((e.labelpos==="l"||e.labelpos==="r")&&(e.width-=e.labeloffset),e.labelpos){case"l":e.x-=e.width/2+e.labeloffset;break;case"r":e.x+=e.width/2+e.labeloffset;break}})}function zt(n){f(n.edges(),function(r){var e=n.edge(r);e.reversed&&e.points.reverse()})}function It(n){f(n.nodes(),function(r){if(n.children(r).length){var e=n.node(r),t=n.node(e.borderTop),o=n.node(e.borderBottom),i=n.node(T(e.borderLeft)),a=n.node(T(e.borderRight));e.width=Math.abs(a.x-i.x),e.height=Math.abs(o.y-t.y),e.x=i.x+e.width/2,e.y=t.y+e.height/2}}),f(n.nodes(),function(r){n.node(r).dummy==="border"&&n.removeNode(r)})}function Dt(n){f(n.edges(),function(r){if(r.v===r.w){var e=n.node(r.v);e.selfEdges||(e.selfEdges=[]),e.selfEdges.push({e:r,label:n.edge(r)}),n.removeEdge(r)}})}function Ft(n){f(B(n),function(r){var e=0;f(r,function(t,o){var i=n.node(t);i.order=o+e,f(i.selfEdges,function(a){O(n,"selfedge",{width:a.label.width,height:a.label.height,rank:i.rank,order:o+ ++e,e:a.e,label:a.label},"_se")}),delete i.selfEdges})})}function Vt(n){f(n.nodes(),function(r){var e=n.node(r);if(e.dummy==="selfedge"){var t=n.node(e.e.v),o=t.x+t.width/2,i=t.y,a=e.x-o,u=t.height/2;n.setEdge(e.e,e.label),n.removeNode(r),e.label.points=[{x:o+2*a/3,y:i-u},{x:o+5*a/6,y:i-u},{x:o+a,y:i},{x:o+5*a/6,y:i+u},{x:o+2*a/3,y:i+u}],e.label.x=e.x,e.label.y=e.y}})}function Z(n,r){return G(L(n,r),Number)}function $(n){var r={};return f(n,function(e,t){r[t.toLowerCase()]=e}),r}export{bt as t};
