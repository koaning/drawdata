var zn=Object.defineProperty;var Un=(t,e,a)=>e in t?zn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var L=(t,e,a)=>Un(t,typeof e!="symbol"?e+"":e,a);import{s as ka,t as Vn}from"./chunk-LvLJmgfZ.js";import{f as Rr,i as Nr,l as qn,n as Bn,o as Wn,u as Jn}from"./useEvent-DlWF5OMa.js";import{t as Kn}from"./react-BGmjiNul.js";import{At as Mr,Dr as Yn,Ft as Hn,Gn,Gr as Qn,On as Xn,Yr as ei,Zr as ti,_n as ai,at as Ca,bn as ri,f as si,i as ni,ii,ir as Pr,ri as jr,rr as oi,tr as li,vt as di,w as Lr,wr as ui,y as Ge}from"./cells-CmJW_FeD.js";import{B as Te,D as ci,E as $r,H as pi,I as It,J as Dr,L as ee,N as Zr,O as mi,P as Q,R as k,S as hi,T as de,V as Ue,W as Fr,b as Bt,k as N,w as Ve,x as Wt}from"./zod-Cg4WLWh2.js";import{t as Ea}from"./compiler-runtime-DeeZ7FnK.js";import{i as zr}from"./useLifecycle-CmDXEyIC.js";import{d as oe,s as fi}from"./hotkeys-uKX61F1_.js";import{o as gi}from"./config-CENq_7Pd.js";import{t as yi}from"./jsx-runtime-DN_bIXfG.js";import{t as Qe}from"./button-B8cGZzP5.js";import{t as Ur}from"./cn-C1rgT0yh.js";import{Bt as vi,Jt,St as Kt,Ut as Vr,Vt as _i,Xt as bi,at as qr,ct as xi,lt as Br,qt as Yt,rt as Ta,xt as wi}from"./dist-CAcX026F.js";import{t as ki}from"./createReducer-DDa-hVe3.js";import{h as Ci,n as Ei,o as Ti,r as Ii}from"./dist-DKNOF5xd.js";import{r as Si,t as Oi}from"./requests-C0HaHO6a.js";import{t as Ia}from"./createLucideIcon-CW2xpJ57.js";import{t as Ai}from"./ai-model-dropdown-C-5PlP5A.js";import{h as Ri}from"./select-D9lTzMzP.js";import{d as Ni,l as Wr,n as Mi}from"./markdown-renderer-DjqhqmES.js";import{a as Jr,c as Pi,p as ji,r as Li,t as $i}from"./dropdown-menu-BP4_BZLr.js";import{t as Di}from"./play-BJDBXApx.js";import{n as Zi}from"./spinner-C1czjtp7.js";import{a as Fi}from"./state-B8vBQnkH.js";import{a as St,i as yt,o as Ot,r as vt,s as zi,t as Ui}from"./datasource-CCq9qyVG.js";import{a as Vi}from"./dist-HGZzCB0y.js";import{t as Kr}from"./use-toast-Bzf3rpev.js";import{r as qi}from"./useTheme-BSVRc0kJ.js";import{t as Bi}from"./tooltip-CvjcEpZC.js";import{s as Wi}from"./popover-DtnzNVk-.js";import{r as Ji}from"./errors-z7WpYca5.js";import{n as Ki}from"./useRunCells-DNnhJ0Gs.js";import{i as Sa}from"./cell-link-D7bPw7Fz.js";import{r as Yi,t as Hi}from"./es-BJsT6vfZ.js";import{n as Oa}from"./renderShortcut-BzTDKVab.js";import{t as Gi}from"./process-output-DN66BQYe.js";import{t as Qi}from"./blob-DtJQFQyD.js";import{t as Xi}from"./useDeleteCell-D-55qWAK.js";import{r as eo,t as to}from"./esm-D2_Kx6xF.js";import{n as ao}from"./icons-9QU2Dup7.js";var ro=Ia("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),so=Ia("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),no=Ia("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]),Yr="vercel.ai.error",io=Symbol.for(Yr),Hr,Gr,Xe=class Mn extends(Gr=Error,Hr=io,Gr){constructor({name:e,message:a,cause:r}){super(a),this[Hr]=!0,this.name=e,this.cause=r}static isInstance(e){return Mn.hasMarker(e,Yr)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};function Qr(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var Xr="AI_InvalidArgumentError",es=`vercel.ai.error.${Xr}`,oo=Symbol.for(es),ts,as,lo=class extends(as=Xe,ts=oo,as){constructor({message:t,cause:e,argument:a}){super({name:Xr,message:t,cause:e}),this[ts]=!0,this.argument=a}static isInstance(t){return Xe.hasMarker(t,es)}},rs="AI_JSONParseError",ss=`vercel.ai.error.${rs}`,uo=Symbol.for(ss),ns,is,os=class extends(is=Xe,ns=uo,is){constructor({text:t,cause:e}){super({name:rs,message:`JSON parsing failed: Text: ${t}.
Error message: ${Qr(e)}`,cause:e}),this[ns]=!0,this.text=t}static isInstance(t){return Xe.hasMarker(t,ss)}},ls="AI_TypeValidationError",ds=`vercel.ai.error.${ls}`,co=Symbol.for(ds),us,cs,Ht=class Er extends(cs=Xe,us=co,cs){constructor({value:e,cause:a}){super({name:ls,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${Qr(a)}`,cause:a}),this[us]=!0,this.value=e}static isInstance(e){return Xe.hasMarker(e,ds)}static wrap({value:e,cause:a}){return Er.isInstance(a)&&a.value===e?a:new Er({value:e,cause:a})}},ps=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Aa(t){}function po(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Aa,onError:a=Aa,onRetry:r=Aa,onComment:s}=t,n="",o=!0,i,l="",d="";function u(f){let c=o?f.replace(/^\xEF\xBB\xBF/,""):f,[m,_]=mo(`${n}${c}`);for(let E of m)p(E);n=_,o=!1}function p(f){if(f===""){h();return}if(f.startsWith(":")){s&&s(f.slice(f.startsWith(": ")?2:1));return}let c=f.indexOf(":");if(c!==-1){let m=f.slice(0,c),_=f[c+1]===" "?2:1;g(m,f.slice(c+_),f);return}g(f,"",f)}function g(f,c,m){switch(f){case"event":d=c;break;case"data":l=`${l}${c}
`;break;case"id":i=c.includes("\0")?void 0:c;break;case"retry":/^\d+$/.test(c)?r(parseInt(c,10)):a(new ps(`Invalid \`retry\` value: "${c}"`,{type:"invalid-retry",value:c,line:m}));break;default:a(new ps(`Unknown field "${f.length>20?`${f.slice(0,20)}\u2026`:f}"`,{type:"unknown-field",field:f,value:c,line:m}));break}}function h(){l.length>0&&e({id:i,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),i=void 0,l="",d=""}function b(f={}){n&&f.consume&&p(n),o=!0,i=void 0,l="",d="",n=""}return{feed:u,reset:b}}function mo(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),o=-1;if(s!==-1&&n!==-1?o=Math.min(s,n):s===-1?n!==-1&&(o=n):o=s===t.length-1?-1:s,o===-1){a=t.slice(r);break}else{let i=t.slice(r,o);e.push(i),r=o+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var ho=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=po({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},z;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let o of s)n[o]=o;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(i=>typeof s[s[i]]!="number"),o={};for(let i of n)o[i]=s[i];return t.objectValues(o)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let o in s)Object.prototype.hasOwnProperty.call(s,o)&&n.push(o);return n},t.find=(s,n)=>{for(let o of s)if(n(o))return o},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(o=>typeof o=="string"?`'${o}'`:o).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(z||(z={}));var fo;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(fo||(fo={}));const w=z.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),et=t=>{switch(typeof t){case"undefined":return w.undefined;case"string":return w.string;case"number":return Number.isNaN(t)?w.nan:w.number;case"boolean":return w.boolean;case"function":return w.function;case"bigint":return w.bigint;case"symbol":return w.symbol;case"object":return Array.isArray(t)?w.array:t===null?w.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?w.promise:typeof Map<"u"&&t instanceof Map?w.map:typeof Set<"u"&&t instanceof Set?w.set:typeof Date<"u"&&t instanceof Date?w.date:w.object;default:return w.unknown}},y=z.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var je=class Pn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let o of n.issues)if(o.code==="invalid_union")o.unionErrors.map(s);else if(o.code==="invalid_return_type")s(o.returnTypeError);else if(o.code==="invalid_arguments")s(o.argumentsError);else if(o.path.length===0)r._errors.push(a(o));else{let i=r,l=0;for(;l<o.path.length;){let d=o.path[l];l===o.path.length-1?(i[d]=i[d]||{_errors:[]},i[d]._errors.push(a(o))):i[d]=i[d]||{_errors:[]},i=i[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof Pn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,z.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a=Object.create(null),r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};je.create=t=>new je(t);var At=(t,e)=>{let a;switch(t.code){case y.invalid_type:a=t.received===w.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case y.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,z.jsonStringifyReplacer)}`;break;case y.unrecognized_keys:a=`Unrecognized key(s) in object: ${z.joinValues(t.keys,", ")}`;break;case y.invalid_union:a="Invalid input";break;case y.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${z.joinValues(t.options)}`;break;case y.invalid_enum_value:a=`Invalid enum value. Expected ${z.joinValues(t.options)}, received '${t.received}'`;break;case y.invalid_arguments:a="Invalid function arguments";break;case y.invalid_return_type:a="Invalid function return type";break;case y.invalid_date:a="Invalid date";break;case y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:z.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case y.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case y.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case y.custom:a="Invalid input";break;case y.invalid_intersection_types:a="Intersection results could not be merged";break;case y.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case y.not_finite:a="Number must be finite";break;default:a=e.defaultError,z.assertNever(t)}return{message:a}},go=At;function Ra(){return go}const Na=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],o={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let i="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)i=d(o,{data:e,defaultError:i}).message;return{...s,path:n,message:i}};function x(t,e){let a=Ra(),r=Na({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===At?void 0:At].filter(s=>!!s)});t.common.issues.push(r)}var ve=class jn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return S;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,o=await s.value;r.push({key:n,value:o})}return jn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:o}=s;if(n.status==="aborted"||o.status==="aborted")return S;n.status==="dirty"&&e.dirty(),o.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(o.value!==void 0||s.alwaysSet)&&(r[n.value]=o.value)}return{status:e.value,value:r}}};const S=Object.freeze({status:"aborted"}),Ma=t=>({status:"dirty",value:t}),ge=t=>({status:"valid",value:t}),ms=t=>t.status==="aborted",hs=t=>t.status==="dirty",_t=t=>t.status==="valid",Gt=t=>typeof Promise<"u"&&t instanceof Promise;var T;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(T||(T={}));var Le=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},fs=(t,e)=>{if(_t(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new je(t.common.issues)),this._error}}};function R(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,o)=>{let{message:i}=t;return n.code==="invalid_enum_value"?{message:i??o.defaultError}:o.data===void 0?{message:i??r??o.defaultError}:n.code==="invalid_type"?{message:i??a??o.defaultError}:{message:o.defaultError}},description:s}}var $=class{get description(){return this._def.description}_getType(t){return et(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:et(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new ve,ctx:{common:t.parent.common,data:t.data,parsedType:et(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(Gt(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:et(t)};return fs(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:et(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return _t(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>_t(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:et(t)},r=this._parse({data:t,path:a.path,parent:a});return fs(a,await(Gt(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),o=()=>s.addIssue({code:y.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(i=>i?!0:(o(),!1)):n?!0:(o(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new qe({schema:this,typeName:v.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Be.create(this,this._def)}nullable(){return ut.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return xt.create(this)}promise(){return Rt.create(this,this._def)}or(t){return ta.create([this,t],this._def)}and(t){return aa.create(this,t,this._def)}transform(t){return new qe({...R(this._def),schema:this,typeName:v.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new oa({...R(this._def),innerType:this,defaultValue:e,typeName:v.ZodDefault})}brand(){return new bs({typeName:v.ZodBranded,type:this,...R(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new la({...R(this._def),innerType:this,catchValue:e,typeName:v.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return xs.create(this,t)}readonly(){return da.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},yo=/^c[^\s-]{8,}$/i,vo=/^[0-9a-z]+$/,_o=/^[0-9A-HJKMNP-TV-Z]{26}$/i,bo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,xo=/^[a-z0-9_-]{21}$/i,wo=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ko=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Co=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Eo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",gs,To=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Io=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,So=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Oo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ao=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Ro=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,ys="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",No=RegExp(`^${ys}$`);function vs(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function Mo(t){return RegExp(`^${vs(t)}$`)}function Po(t){let e=`${ys}T${vs(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function jo(t,e){return!!((e==="v4"||!e)&&To.test(t)||(e==="v6"||!e)&&So.test(t))}function Lo(t,e){if(!wo.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function $o(t,e){return!!((e==="v4"||!e)&&Io.test(t)||(e==="v6"||!e)&&Oo.test(t))}var Qt=class Ut extends ${_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==w.string){let s=this._getOrReturnCtx(e);return x(s,{code:y.invalid_type,expected:w.string,received:s.parsedType}),S}let a=new ve,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,o=e.data.length<s.value;(n||o)&&(r=this._getOrReturnCtx(e,r),n?x(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):o&&x(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")Co.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"email",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")gs||(gs=new RegExp(Eo,"u")),gs.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"emoji",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")bo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"uuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")xo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"nanoid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")yo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"cuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")vo.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"cuid2",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")_o.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"ulid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),x(r,{validation:"url",code:y.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"regex",code:y.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?Po(s).test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?No.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?Mo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{code:y.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?ko.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"duration",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?jo(e.data,s.version)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"ip",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?Lo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"jwt",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?$o(e.data,s.version)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"cidr",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?Ao.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"base64",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?Ro.test(e.data)||(r=this._getOrReturnCtx(e,r),x(r,{validation:"base64url",code:y.invalid_string,message:s.message}),a.dirty()):z.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:y.invalid_string,...T.errToObj(r)})}_addCheck(e){return new Ut({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...T.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...T.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...T.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...T.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...T.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...T.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...T.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...T.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...T.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...T.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...T.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...T.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...T.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...T.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...T.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...T.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...T.errToObj(a)})}nonempty(e){return this.min(1,T.errToObj(e))}trim(){return new Ut({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Ut({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Ut({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Qt.create=t=>new Qt({checks:[],typeName:v.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...R(t)});function Do(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var Pa=class Tr extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==w.number){let s=this._getOrReturnCtx(e);return x(s,{code:y.invalid_type,expected:w.number,received:s.parsedType}),S}let a,r=new ve;for(let s of this._def.checks)s.kind==="int"?z.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),x(a,{code:y.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Do(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),x(a,{code:y.not_finite,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,T.toString(a))}gt(e,a){return this.setLimit("min",e,!1,T.toString(a))}lte(e,a){return this.setLimit("max",e,!0,T.toString(a))}lt(e,a){return this.setLimit("max",e,!1,T.toString(a))}setLimit(e,a,r,s){return new Tr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:T.toString(s)}]})}_addCheck(e){return new Tr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:T.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:T.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:T.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&z.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Pa.create=t=>new Pa({checks:[],typeName:v.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...R(t)});var ja=class Ir extends ${constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==w.bigint)return this._getInvalidInput(e);let a,r=new ve;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),x(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):z.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return x(a,{code:y.invalid_type,expected:w.bigint,received:a.parsedType}),S}gte(e,a){return this.setLimit("min",e,!0,T.toString(a))}gt(e,a){return this.setLimit("min",e,!1,T.toString(a))}lte(e,a){return this.setLimit("max",e,!0,T.toString(a))}lt(e,a){return this.setLimit("max",e,!1,T.toString(a))}setLimit(e,a,r,s){return new Ir({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:T.toString(s)}]})}_addCheck(e){return new Ir({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};ja.create=t=>new ja({checks:[],typeName:v.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...R(t)});var La=class extends ${_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==w.boolean){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.boolean,received:e.parsedType}),S}return ge(t.data)}};La.create=t=>new La({typeName:v.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...R(t)});var $a=class Ln extends ${_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==w.date){let s=this._getOrReturnCtx(e);return x(s,{code:y.invalid_type,expected:w.date,received:s.parsedType}),S}if(Number.isNaN(e.data.getTime()))return x(this._getOrReturnCtx(e),{code:y.invalid_date}),S;let a=new ve,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),x(r,{code:y.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):z.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Ln({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:T.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:T.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};$a.create=t=>new $a({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:v.ZodDate,...R(t)});var Da=class extends ${_parse(t){if(this._getType(t)!==w.symbol){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.symbol,received:e.parsedType}),S}return ge(t.data)}};Da.create=t=>new Da({typeName:v.ZodSymbol,...R(t)});var Xt=class extends ${_parse(t){if(this._getType(t)!==w.undefined){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.undefined,received:e.parsedType}),S}return ge(t.data)}};Xt.create=t=>new Xt({typeName:v.ZodUndefined,...R(t)});var ea=class extends ${_parse(t){if(this._getType(t)!==w.null){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.null,received:e.parsedType}),S}return ge(t.data)}};ea.create=t=>new ea({typeName:v.ZodNull,...R(t)});var Za=class extends ${constructor(){super(...arguments),this._any=!0}_parse(t){return ge(t.data)}};Za.create=t=>new Za({typeName:v.ZodAny,...R(t)});var bt=class extends ${constructor(){super(...arguments),this._unknown=!0}_parse(t){return ge(t.data)}};bt.create=t=>new bt({typeName:v.ZodUnknown,...R(t)});var tt=class extends ${_parse(t){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.never,received:e.parsedType}),S}};tt.create=t=>new tt({typeName:v.ZodNever,...R(t)});var Fa=class extends ${_parse(t){if(this._getType(t)!==w.undefined){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.void,received:e.parsedType}),S}return ge(t.data)}};Fa.create=t=>new Fa({typeName:v.ZodVoid,...R(t)});var xt=class xa extends ${_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==w.array)return x(a,{code:y.invalid_type,expected:w.array,received:a.parsedType}),S;if(s.exactLength!==null){let o=a.data.length>s.exactLength.value,i=a.data.length<s.exactLength.value;(o||i)&&(x(a,{code:o?y.too_big:y.too_small,minimum:i?s.exactLength.value:void 0,maximum:o?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(x(a,{code:y.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(x(a,{code:y.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((o,i)=>s.type._parseAsync(new Le(a,o,a.path,i)))).then(o=>ve.mergeArray(r,o));let n=[...a.data].map((o,i)=>s.type._parseSync(new Le(a,o,a.path,i)));return ve.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new xa({...this._def,minLength:{value:e,message:T.toString(a)}})}max(e,a){return new xa({...this._def,maxLength:{value:e,message:T.toString(a)}})}length(e,a){return new xa({...this._def,exactLength:{value:e,message:T.toString(a)}})}nonempty(e){return this.min(1,e)}};xt.create=(t,e)=>new xt({type:t,minLength:null,maxLength:null,exactLength:null,typeName:v.ZodArray,...R(e)});function wt(t){if(t instanceof Ie){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=Be.create(wt(r))}return new Ie({...t._def,shape:()=>e})}else return t instanceof xt?new xt({...t._def,type:wt(t.element)}):t instanceof Be?Be.create(wt(t.unwrap())):t instanceof ut?ut.create(wt(t.unwrap())):t instanceof dt?dt.create(t.items.map(e=>wt(e))):t}var Ie=class Re extends ${constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:z.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==w.object){let l=this._getOrReturnCtx(e);return x(l,{code:y.invalid_type,expected:w.object,received:l.parsedType}),S}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),o=[];if(!(this._def.catchall instanceof tt&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||o.push(l);let i=[];for(let l of n){let d=s[l],u=r.data[l];i.push({key:{status:"valid",value:l},value:d._parse(new Le(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof tt){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of o)i.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")o.length>0&&(x(r,{code:y.unrecognized_keys,keys:o}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of o){let u=r.data[d];i.push({key:{status:"valid",value:d},value:l._parse(new Le(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of i){let u=await d.key,p=await d.value;l.push({key:u,value:p,alwaysSet:d.alwaysSet})}return l}).then(l=>ve.mergeObjectSync(a,l)):ve.mergeObjectSync(a,i)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new Re({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,o;let s=((o=(n=this._def).errorMap)==null?void 0:o.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:T.errToObj(e).message??s}:{message:s}}}})}strip(){return new Re({...this._def,unknownKeys:"strip"})}passthrough(){return new Re({...this._def,unknownKeys:"passthrough"})}extend(e){return new Re({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Re({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:v.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Re({...this._def,catchall:e})}pick(e){let a={};for(let r of z.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new Re({...this._def,shape:()=>a})}omit(e){let a={};for(let r of z.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new Re({...this._def,shape:()=>a})}deepPartial(){return wt(this)}partial(e){let a={};for(let r of z.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new Re({...this._def,shape:()=>a})}required(e){let a={};for(let r of z.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Be;)s=s._def.innerType;a[r]=s}return new Re({...this._def,shape:()=>a})}keyof(){return _s(z.objectKeys(this.shape))}};Ie.create=(t,e)=>new Ie({shape:()=>t,unknownKeys:"strip",catchall:tt.create(),typeName:v.ZodObject,...R(e)}),Ie.strictCreate=(t,e)=>new Ie({shape:()=>t,unknownKeys:"strict",catchall:tt.create(),typeName:v.ZodObject,...R(e)}),Ie.lazycreate=(t,e)=>new Ie({shape:t,unknownKeys:"strip",catchall:tt.create(),typeName:v.ZodObject,...R(e)});var ta=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let o of s)if(o.result.status==="valid")return o.result;for(let o of s)if(o.result.status==="dirty")return e.common.issues.push(...o.ctx.common.issues),o.result;let n=s.map(o=>new je(o.ctx.common.issues));return x(e,{code:y.invalid_union,unionErrors:n}),S}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let i of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=i._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let o=n.map(i=>new je(i));return x(e,{code:y.invalid_union,unionErrors:o}),S}}get options(){return this._def.options}};ta.create=(t,e)=>new ta({options:t,typeName:v.ZodUnion,...R(e)});var at=t=>t instanceof ra?at(t.schema):t instanceof qe?at(t.innerType()):t instanceof sa?[t.value]:t instanceof na?t.options:t instanceof ia?z.objectValues(t.enum):t instanceof oa?at(t._def.innerType):t instanceof Xt?[void 0]:t instanceof ea?[null]:t instanceof Be?[void 0,...at(t.unwrap())]:t instanceof ut?[null,...at(t.unwrap())]:t instanceof bs||t instanceof da?at(t.unwrap()):t instanceof la?at(t._def.innerType):[],Zo=class $n extends ${_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==w.object)return x(a,{code:y.invalid_type,expected:w.object,received:a.parsedType}),S;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(x(a,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),S)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let o=at(n.shape[e]);if(!o.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let i of o){if(s.has(i))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(i)}`);s.set(i,n)}}return new $n({typeName:v.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...R(r)})}};function za(t,e){let a=et(t),r=et(e);if(t===e)return{valid:!0,data:t};if(a===w.object&&r===w.object){let s=z.objectKeys(e),n=z.objectKeys(t).filter(i=>s.indexOf(i)!==-1),o={...t,...e};for(let i of n){let l=za(t[i],e[i]);if(!l.valid)return{valid:!1};o[i]=l.data}return{valid:!0,data:o}}else if(a===w.array&&r===w.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let o=t[n],i=e[n],l=za(o,i);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===w.date&&r===w.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var aa=class extends ${_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(ms(s)||ms(n))return S;let o=za(s.value,n.value);return o.valid?((hs(s)||hs(n))&&e.dirty(),{status:e.value,value:o.data}):(x(a,{code:y.invalid_intersection_types}),S)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};aa.create=(t,e,a)=>new aa({left:t,right:e,typeName:v.ZodIntersection,...R(a)});var dt=class Dn extends ${_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==w.array)return x(r,{code:y.invalid_type,expected:w.array,received:r.parsedType}),S;if(r.data.length<this._def.items.length)return x(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),S;!this._def.rest&&r.data.length>this._def.items.length&&(x(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,o)=>{let i=this._def.items[o]||this._def.rest;return i?i._parse(new Le(r,n,r.path,o)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>ve.mergeArray(a,n)):ve.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new Dn({...this._def,rest:e})}};dt.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new dt({items:t,typeName:v.ZodTuple,rest:null,...R(e)})};var Fo=class Sr extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==w.object)return x(r,{code:y.invalid_type,expected:w.object,received:r.parsedType}),S;let s=[],n=this._def.keyType,o=this._def.valueType;for(let i in r.data)s.push({key:n._parse(new Le(r,i,r.path,i)),value:o._parse(new Le(r,r.data[i],r.path,i)),alwaysSet:i in r.data});return r.common.async?ve.mergeObjectAsync(a,s):ve.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof $?new Sr({keyType:e,valueType:a,typeName:v.ZodRecord,...R(r)}):new Sr({keyType:Qt.create(),valueType:e,typeName:v.ZodRecord,...R(a)})}},Ua=class extends ${get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==w.map)return x(a,{code:y.invalid_type,expected:w.map,received:a.parsedType}),S;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([o,i],l)=>({key:r._parse(new Le(a,o,a.path,[l,"key"])),value:s._parse(new Le(a,i,a.path,[l,"value"]))}));if(a.common.async){let o=new Map;return Promise.resolve().then(async()=>{for(let i of n){let l=await i.key,d=await i.value;if(l.status==="aborted"||d.status==="aborted")return S;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}})}else{let o=new Map;for(let i of n){let l=i.key,d=i.value;if(l.status==="aborted"||d.status==="aborted")return S;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),o.set(l.value,d.value)}return{status:e.value,value:o}}}};Ua.create=(t,e,a)=>new Ua({valueType:e,keyType:t,typeName:v.ZodMap,...R(a)});var Va=class Or extends ${_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==w.set)return x(r,{code:y.invalid_type,expected:w.set,received:r.parsedType}),S;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(x(r,{code:y.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(x(r,{code:y.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function o(l){let d=new Set;for(let u of l){if(u.status==="aborted")return S;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let i=[...r.data.values()].map((l,d)=>n._parse(new Le(r,l,r.path,d)));return r.common.async?Promise.all(i).then(l=>o(l)):o(i)}min(e,a){return new Or({...this._def,minSize:{value:e,message:T.toString(a)}})}max(e,a){return new Or({...this._def,maxSize:{value:e,message:T.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};Va.create=(t,e)=>new Va({valueType:t,minSize:null,maxSize:null,typeName:v.ZodSet,...R(e)});var zo=class wa extends ${constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==w.function)return x(a,{code:y.invalid_type,expected:w.function,received:a.parsedType}),S;function r(i,l){return Na({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ra(),At].filter(d=>!!d),issueData:{code:y.invalid_arguments,argumentsError:l}})}function s(i,l){return Na({data:i,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Ra(),At].filter(d=>!!d),issueData:{code:y.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},o=a.data;if(this._def.returns instanceof Rt){let i=this;return ge(async function(...l){let d=new je([]),u=await i._def.args.parseAsync(l,n).catch(g=>{throw d.addIssue(r(l,g)),d}),p=await Reflect.apply(o,this,u);return await i._def.returns._def.type.parseAsync(p,n).catch(g=>{throw d.addIssue(s(p,g)),d})})}else{let i=this;return ge(function(...l){let d=i._def.args.safeParse(l,n);if(!d.success)throw new je([r(l,d.error)]);let u=Reflect.apply(o,this,d.data),p=i._def.returns.safeParse(u,n);if(!p.success)throw new je([s(u,p.error)]);return p.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new wa({...this._def,args:dt.create(e).rest(bt.create())})}returns(e){return new wa({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new wa({args:e||dt.create([]).rest(bt.create()),returns:a||bt.create(),typeName:v.ZodFunction,...R(r)})}},ra=class extends ${get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};ra.create=(t,e)=>new ra({getter:t,typeName:v.ZodLazy,...R(e)});var sa=class extends ${_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return x(e,{received:e.data,code:y.invalid_literal,expected:this._def.value}),S}return{status:"valid",value:t.data}}get value(){return this._def.value}};sa.create=(t,e)=>new sa({value:t,typeName:v.ZodLiteral,...R(e)});function _s(t,e){return new na({values:t,typeName:v.ZodEnum,...R(e)})}var na=class Ar extends ${_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return x(a,{expected:z.joinValues(r),received:a.parsedType,code:y.invalid_type}),S}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return x(a,{received:a.data,code:y.invalid_enum_value,options:r}),S}return ge(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return Ar.create(e,{...this._def,...a})}exclude(e,a=this._def){return Ar.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};na.create=_s;var ia=class extends ${_parse(t){let e=z.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==w.string&&a.parsedType!==w.number){let r=z.objectValues(e);return x(a,{expected:z.joinValues(r),received:a.parsedType,code:y.invalid_type}),S}if(this._cache||(this._cache=new Set(z.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=z.objectValues(e);return x(a,{received:a.data,code:y.invalid_enum_value,options:r}),S}return ge(t.data)}get enum(){return this._def.values}};ia.create=(t,e)=>new ia({values:t,typeName:v.ZodNativeEnum,...R(e)});var Rt=class extends ${unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==w.promise&&e.common.async===!1?(x(e,{code:y.invalid_type,expected:w.promise,received:e.parsedType}),S):ge((e.parsedType===w.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};Rt.create=(t,e)=>new Rt({type:t,typeName:v.ZodPromise,...R(e)});var qe=class extends ${innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===v.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{x(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async o=>{if(e.value==="aborted")return S;let i=await this._def.schema._parseAsync({data:o,path:a.path,parent:a});return i.status==="aborted"?S:i.status==="dirty"||e.value==="dirty"?Ma(i.value):i});{if(e.value==="aborted")return S;let o=this._def.schema._parseSync({data:n,path:a.path,parent:a});return o.status==="aborted"?S:o.status==="dirty"||e.value==="dirty"?Ma(o.value):o}}if(r.type==="refinement"){let n=o=>{let i=r.refinement(o,s);if(a.common.async)return Promise.resolve(i);if(i instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return o};if(a.common.async===!1){let o=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return o.status==="aborted"?S:(o.status==="dirty"&&e.dirty(),n(o.value),{status:e.value,value:o.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(o=>o.status==="aborted"?S:(o.status==="dirty"&&e.dirty(),n(o.value).then(()=>({status:e.value,value:o.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!_t(n))return S;let o=r.transform(n.value,s);if(o instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:o}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>_t(n)?Promise.resolve(r.transform(n.value,s)).then(o=>({status:e.value,value:o})):S);z.assertNever(r)}};qe.create=(t,e,a)=>new qe({schema:t,typeName:v.ZodEffects,effect:e,...R(a)}),qe.createWithPreprocess=(t,e,a)=>new qe({schema:e,effect:{type:"preprocess",transform:t},typeName:v.ZodEffects,...R(a)});var Be=class extends ${_parse(t){return this._getType(t)===w.undefined?ge(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Be.create=(t,e)=>new Be({innerType:t,typeName:v.ZodOptional,...R(e)});var ut=class extends ${_parse(t){return this._getType(t)===w.null?ge(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};ut.create=(t,e)=>new ut({innerType:t,typeName:v.ZodNullable,...R(e)});var oa=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===w.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};oa.create=(t,e)=>new oa({innerType:t,typeName:v.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...R(e)});var la=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return Gt(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new je(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new je(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};la.create=(t,e)=>new la({innerType:t,typeName:v.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...R(e)});var qa=class extends ${_parse(t){if(this._getType(t)!==w.nan){let e=this._getOrReturnCtx(t);return x(e,{code:y.invalid_type,expected:w.nan,received:e.parsedType}),S}return{status:"valid",value:t.data}}};qa.create=t=>new qa({typeName:v.ZodNaN,...R(t)});var bs=class extends ${_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},xs=class Zn extends ${_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?S:s.status==="dirty"?(a.dirty(),Ma(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?S:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new Zn({in:e,out:a,typeName:v.ZodPipeline})}},da=class extends ${_parse(t){let e=this._def.innerType._parse(t),a=r=>(_t(r)&&(r.value=Object.freeze(r.value)),r);return Gt(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};da.create=(t,e)=>new da({innerType:t,typeName:v.ZodReadonly,...R(e)}),Ie.lazycreate;var v;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(v||(v={})),Qt.create,Pa.create,qa.create,ja.create,La.create,$a.create,Da.create,Xt.create,ea.create,Za.create,bt.create,tt.create,Fa.create,xt.create,Ie.create,Ie.strictCreate,ta.create,Zo.create,aa.create,dt.create,Fo.create,Ua.create,Va.create,zo.create,ra.create,sa.create,na.create,ia.create,Rt.create,qe.create,Be.create,ut.create,qe.createWithPreprocess,xs.create;var Nt=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,o=Array(e);for(let i=0;i<e;i++)o[i]=a[Math.random()*n|0];return o.join("")};if(t==null)return s;if(a.includes(r))throw new lo({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Uo=Nt();function Ba(t=globalThis){var e,a,r;return t.window?"runtime/browser":(e=t.navigator)!=null&&e.userAgent?`runtime/${t.navigator.userAgent.toLowerCase()}`:(r=(a=t.process)==null?void 0:a.versions)!=null&&r.node?`runtime/node.js/${t.process.version.substring(0)}`:t.EdgeRuntime?"runtime/vercel-edge":"runtime/unknown"}function ct(t){if(t==null)return{};let e={};if(t instanceof Headers)t.forEach((a,r)=>{e[r.toLowerCase()]=a});else{Array.isArray(t)||(t=Object.entries(t));for(let[a,r]of t)r!=null&&(e[a.toLowerCase()]=r)}return e}function Wa(t,...e){let a=new Headers(ct(t)),r=a.get("user-agent")||"";return a.set("user-agent",[r,...e].filter(Boolean).join(" ")),Object.fromEntries(a.entries())}var Vo=/"__proto__"\s*:/,qo=/"constructor"\s*:/;function ws(t){let e=JSON.parse(t);return typeof e!="object"||!e||Vo.test(t)===!1&&qo.test(t)===!1?e:Bo(e)}function Bo(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Wo(t){let{stackTraceLimit:e}=Error;try{Error.stackTraceLimit=0}catch{return ws(t)}try{return ws(t)}finally{Error.stackTraceLimit=e}}var ua=Symbol.for("vercel.ai.validator");function Jo(t){return{[ua]:!0,validate:t}}function Ko(t){return typeof t=="object"&&!!t&&ua in t&&t[ua]===!0&&"validate"in t}function Yo(t){let e;return()=>(e??(e=t()),e)}function Ho(t){return Ko(t)?t:typeof t=="function"?t():Go(t)}function Go(t){return Jo(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new Ht({value:e,cause:a.issues})}})}async function ks({value:t,schema:e}){let a=await Ja({value:t,schema:e});if(!a.success)throw Ht.wrap({value:t,cause:a.error});return a.value}async function Ja({value:t,schema:e}){let a=Ho(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:Ht.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:Ht.wrap({value:t,cause:r}),rawValue:t}}}async function ca({text:t,schema:e}){try{let a=Wo(t);return e==null?{success:!0,value:a,rawValue:a}:await Ja({value:a,schema:e})}catch(a){return{success:!1,error:os.isInstance(a)?a:new os({text:t,cause:a}),rawValue:void 0}}}function Cs({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new ho).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await ca({text:a,schema:e}))}}))}async function kt(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}function pa(t){if(t.type==="object"){t.additionalProperties=!1;let e=t.properties;if(e!=null)for(let a in e)e[a]=pa(e[a])}return t.type==="array"&&t.items!=null&&(Array.isArray(t.items)?t.items=t.items.map(e=>pa(e)):t.items=pa(t.items)),t}var Qo=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},Xo=Symbol("Let zodToJsonSchema decide on which parser to use"),Es={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},el=t=>typeof t=="string"?{...Es,name:t}:{...Es,...t};function _e(){return{}}function tl(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==v.ZodAny&&(a.items=q(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function al(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function rl(){return{type:"boolean"}}function Ts(t,e){return q(t.type._def,e)}var sl=(t,e)=>q(t.innerType._def,e);function Is(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Is(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return nl(t)}}var nl=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function il(t,e){return{...q(t.innerType._def,e),default:t.defaultValue()}}function ol(t,e){return e.effectStrategy==="input"?q(t.schema._def,e):_e()}function ll(t){return{type:"string",enum:Array.from(t.values)}}var dl=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function ul(t,e){let a=[q(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),q(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(dl(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:o,...i}=s;n=i}r.push(n)}}),r.length?{allOf:r}:void 0}function cl(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Ka=void 0,Se={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ka===void 0&&(Ka=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ka),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ss(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Oe(a,"email",r.message,e);break;case"format:idn-email":Oe(a,"idn-email",r.message,e);break;case"pattern:zod":pe(a,Se.email,r.message,e);break}break;case"url":Oe(a,"uri",r.message,e);break;case"uuid":Oe(a,"uuid",r.message,e);break;case"regex":pe(a,r.regex,r.message,e);break;case"cuid":pe(a,Se.cuid,r.message,e);break;case"cuid2":pe(a,Se.cuid2,r.message,e);break;case"startsWith":pe(a,RegExp(`^${Ya(r.value,e)}`),r.message,e);break;case"endsWith":pe(a,RegExp(`${Ya(r.value,e)}$`),r.message,e);break;case"datetime":Oe(a,"date-time",r.message,e);break;case"date":Oe(a,"date",r.message,e);break;case"time":Oe(a,"time",r.message,e);break;case"duration":Oe(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":pe(a,RegExp(Ya(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Oe(a,"ipv4",r.message,e),r.version!=="v4"&&Oe(a,"ipv6",r.message,e);break;case"base64url":pe(a,Se.base64url,r.message,e);break;case"jwt":pe(a,Se.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&pe(a,Se.ipv4Cidr,r.message,e),r.version!=="v4"&&pe(a,Se.ipv6Cidr,r.message,e);break;case"emoji":pe(a,Se.emoji(),r.message,e);break;case"ulid":pe(a,Se.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Oe(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":pe(a,Se.base64,r.message,e);break}break;case"nanoid":pe(a,Se.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function Ya(t,e){return e.patternStrategy==="escape"?ml(t):t}var pl=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function ml(t){let e="";for(let a=0;a<t.length;a++)pl.has(t[a])||(e+="\\"),e+=t[a];return e}function Oe(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function pe(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Os(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Os(e,r)}function Os(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,o=!1,i=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(o){if(r[d].match(/[a-z]/)){i?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),i=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],i=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=o?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:o&&r[d]==="]"?o=!1:!o&&r[d]==="["&&(o=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function As(t,e){var r,s,n,o,i;let a={type:"object",additionalProperties:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===v.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=Ss(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===v.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((o=t.keyType)==null?void 0:o._def.typeName)===v.ZodBranded&&t.keyType._def.type._def.typeName===v.ZodString&&((i=t.keyType._def.type._def.checks)!=null&&i.length)){let{type:l,...d}=Ts(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function hl(t,e){return e.mapStrategy==="record"?As(t,e):{type:"array",maxItems:125,items:{type:"array",items:[q(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||_e(),q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||_e()],minItems:2,maxItems:2}}}function fl(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function gl(){return{not:_e()}}function yl(){return{type:"null"}}var Ha={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function vl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Ha&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let o=Ha[n._def.typeName];return o&&!s.includes(o)?[...s,o]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let o=typeof n._def.value;switch(o){case"string":case"number":case"boolean":return[...s,o];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];default:return s}},[]);if(r.length===a.length){let s=r.filter((n,o,i)=>i.indexOf(n)===o);return{type:s.length>1?s:s[0],enum:a.reduce((n,o)=>n.includes(o._def.value)?n:[...n,o._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return _l(t,e)}var _l=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>q(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function bl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Ha[t.innerType._def.typeName],"null"]};let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function xl(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function wl(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let o in s){let i=s[o];if(i===void 0||i._def===void 0)continue;let l=Cl(i),d=q(i._def,{...e,currentPath:[...e.currentPath,"properties",o],propertyPath:[...e.currentPath,"properties",o]});d!==void 0&&(a.properties[o]=d,l||r.push(o))}r.length&&(a.required=r);let n=kl(t,e);return n!==void 0&&(a.additionalProperties=n),a}function kl(t,e){if(t.catchall._def.typeName!=="ZodNever")return q(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Cl(t){try{return t.isOptional()}catch{return!0}}var El=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return q(t.innerType._def,e);let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:_e()},a]}:_e()},Tl=(t,e)=>{if(e.pipeStrategy==="input")return q(t.in._def,e);if(e.pipeStrategy==="output")return q(t.out._def,e);let a=q(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,q(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function Il(t,e){return q(t.type._def,e)}function Sl(t,e){let a={type:"array",uniqueItems:!0,items:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function Ol(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:q(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Al(){return{not:_e()}}function Rl(){return _e()}var Nl=(t,e)=>q(t.innerType._def,e),Ml=(t,e,a)=>{switch(e){case v.ZodString:return Ss(t,a);case v.ZodNumber:return xl(t);case v.ZodObject:return wl(t,a);case v.ZodBigInt:return al(t);case v.ZodBoolean:return rl();case v.ZodDate:return Is(t,a);case v.ZodUndefined:return Al();case v.ZodNull:return yl();case v.ZodArray:return tl(t,a);case v.ZodUnion:case v.ZodDiscriminatedUnion:return vl(t,a);case v.ZodIntersection:return ul(t,a);case v.ZodTuple:return Ol(t,a);case v.ZodRecord:return As(t,a);case v.ZodLiteral:return cl(t);case v.ZodEnum:return ll(t);case v.ZodNativeEnum:return fl(t);case v.ZodNullable:return bl(t,a);case v.ZodOptional:return El(t,a);case v.ZodMap:return hl(t,a);case v.ZodSet:return Sl(t,a);case v.ZodLazy:return()=>t.getter()._def;case v.ZodPromise:return Il(t,a);case v.ZodNaN:case v.ZodNever:return gl();case v.ZodEffects:return ol(t,a);case v.ZodAny:return _e();case v.ZodUnknown:return Rl();case v.ZodDefault:return il(t,a);case v.ZodBranded:return Ts(t,a);case v.ZodReadonly:return Nl(t,a);case v.ZodCatch:return sl(t,a);case v.ZodPipeline:return Tl(t,a);case v.ZodFunction:case v.ZodVoid:case v.ZodSymbol:return;default:return(r=>{})(e)}};function q(t,e,a=!1){var i;let r=e.seen.get(t);if(e.override){let l=(i=e.override)==null?void 0:i.call(e,t,e,r,a);if(l!==Xo)return l}if(r&&!a){let l=Pl(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=Ml(t,t.typeName,e),o=typeof n=="function"?q(n(),e):n;if(o&&jl(t,e,o),e.postProcess){let l=e.postProcess(o,t,e);return s.jsonSchema=o,l}return s.jsonSchema=o,o}var Pl=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:Qo(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),_e()):e.$refStrategy==="seen"?_e():void 0}},jl=(t,e,a)=>(t.description&&(a.description=t.description),a),Ll=t=>{let e=el(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},$l=(t,e)=>{let a=Ll(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:q(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??_e()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=q(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??_e(),o=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;o!==void 0&&(n.title=o);let i=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return i.$schema="http://json-schema.org/draft-07/schema#",i};function Dl(t,e){let a=(e==null?void 0:e.useReferences)??!1;return Qa(()=>$l(t,{$refStrategy:a?"root":"none"}),{validate:async r=>{let s=await t.safeParseAsync(r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Zl(t,e){let a=(e==null?void 0:e.useReferences)??!1;return Qa(()=>pa(Fr(t,{target:"draft-7",io:"input",reused:a?"ref":"inline"})),{validate:async r=>{let s=await pi(t,r);return s.success?{success:!0,value:s.data}:{success:!1,error:s.error}}})}function Fl(t){return"_zod"in t}function Rs(t,e){return Fl(t)?Zl(t,e):Dl(t,e)}var Ga=Symbol.for("vercel.ai.schema");function Qa(t,{validate:e}={}){return{[Ga]:!0,_type:void 0,[ua]:!0,get jsonSchema(){return typeof t=="function"&&(t=t()),t},validate:e}}function zl(t){return typeof t=="object"&&!!t&&Ga in t&&t[Ga]===!0&&"jsonSchema"in t&&"validate"in t}function Ul(t){return t==null?Qa({properties:{},additionalProperties:!1}):zl(t)?t:typeof t=="function"?t():Rs(t)}var{btoa:Vc,atob:qc}=globalThis,Vl=Object.defineProperty,ql=(t,e)=>{for(var a in e)Vl(t,a,{get:e[a],enumerable:!0})},Ns="AI_NoObjectGeneratedError",Ms=`vercel.ai.error.${Ns}`,Bl=Symbol.for(Ms),Ps,js=class extends Xe{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:Ns,message:t,cause:e}),this[Ps]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return Xe.hasMarker(t,Ms)}};Ps=Bl;var Xa="5.0.117",Ls=Te([k(),Wt(Uint8Array),Wt(ArrayBuffer),$r(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Mt=mi(()=>Te([hi(),k(),Zr(),de(),It(k(),Mt),Ve(Mt)])),se=It(k(),It(k(),Mt)),$s=Q({type:N("text"),text:k(),providerOptions:se.optional()}),Wl=Q({type:N("image"),image:Te([Ls,Wt(URL)]),mediaType:k().optional(),providerOptions:se.optional()}),Ds=Q({type:N("file"),data:Te([Ls,Wt(URL)]),filename:k().optional(),mediaType:k(),providerOptions:se.optional()}),Jl=Q({type:N("reasoning"),text:k(),providerOptions:se.optional()}),Kl=Q({type:N("tool-call"),toolCallId:k(),toolName:k(),input:Ue(),providerOptions:se.optional(),providerExecuted:de().optional()}),Yl=ci("type",[Q({type:N("text"),value:k()}),Q({type:N("json"),value:Mt}),Q({type:N("error-text"),value:k()}),Q({type:N("error-json"),value:Mt}),Q({type:N("content"),value:Ve(Te([Q({type:N("text"),text:k()}),Q({type:N("media"),data:k(),mediaType:k()})]))})]),Zs=Q({type:N("tool-result"),toolCallId:k(),toolName:k(),output:Yl,providerOptions:se.optional()});Te([Q({role:N("system"),content:k(),providerOptions:se.optional()}),Q({role:N("user"),content:Te([k(),Ve(Te([$s,Wl,Ds]))]),providerOptions:se.optional()}),Q({role:N("assistant"),content:Te([k(),Ve(Te([$s,Ds,Jl,Kl,Zs]))]),providerOptions:se.optional()}),Q({role:N("tool"),content:Ve(Zs),providerOptions:se.optional()})]),Nt({prefix:"aitxt",size:24});function Hl(t,e){let a=new Headers(t??{});for(let[r,s]of Object.entries(e))a.has(r)||a.set(r,s);return a}var Gl=class extends TransformStream{constructor(){super({transform(t,e){e.enqueue(`data: ${JSON.stringify(t)}

`)},flush(t){t.enqueue(`data: [DONE]

`)}})}},Ql={"content-type":"text/event-stream","cache-control":"no-cache",connection:"keep-alive","x-vercel-ai-ui-message-stream":"v1","x-accel-buffering":"no"};function Xl({status:t,statusText:e,headers:a,stream:r,consumeSseStream:s}){let n=r.pipeThrough(new Gl);if(s){let[o,i]=n.tee();n=o,s({stream:i})}return new Response(n.pipeThrough(new TextEncoderStream),{status:t,statusText:e,headers:Hl(a,Ql)})}var Fs=Yo(()=>Rs(Te([ee({type:N("text-start"),id:k(),providerMetadata:se.optional()}),ee({type:N("text-delta"),id:k(),delta:k(),providerMetadata:se.optional()}),ee({type:N("text-end"),id:k(),providerMetadata:se.optional()}),ee({type:N("error"),errorText:k()}),ee({type:N("tool-input-start"),toolCallId:k(),toolName:k(),providerExecuted:de().optional(),dynamic:de().optional()}),ee({type:N("tool-input-delta"),toolCallId:k(),inputTextDelta:k()}),ee({type:N("tool-input-available"),toolCallId:k(),toolName:k(),input:Ue(),providerExecuted:de().optional(),providerMetadata:se.optional(),dynamic:de().optional()}),ee({type:N("tool-input-error"),toolCallId:k(),toolName:k(),input:Ue(),providerExecuted:de().optional(),providerMetadata:se.optional(),dynamic:de().optional(),errorText:k()}),ee({type:N("tool-output-available"),toolCallId:k(),output:Ue(),providerExecuted:de().optional(),dynamic:de().optional(),preliminary:de().optional()}),ee({type:N("tool-output-error"),toolCallId:k(),errorText:k(),providerExecuted:de().optional(),dynamic:de().optional()}),ee({type:N("reasoning-start"),id:k(),providerMetadata:se.optional()}),ee({type:N("reasoning-delta"),id:k(),delta:k(),providerMetadata:se.optional()}),ee({type:N("reasoning-end"),id:k(),providerMetadata:se.optional()}),ee({type:N("source-url"),sourceId:k(),url:k(),title:k().optional(),providerMetadata:se.optional()}),ee({type:N("source-document"),sourceId:k(),mediaType:k(),title:k(),filename:k().optional(),providerMetadata:se.optional()}),ee({type:N("file"),url:k(),mediaType:k(),providerMetadata:se.optional()}),ee({type:$r(t=>typeof t=="string"&&t.startsWith("data-"),{message:'Type must start with "data-"'}),id:k().optional(),data:Ue(),transient:de().optional()}),ee({type:N("start-step")}),ee({type:N("finish-step")}),ee({type:N("start"),messageId:k().optional(),messageMetadata:Ue().optional()}),ee({type:N("finish"),finishReason:Bt(["stop","length","content-filter","tool-calls","error","other","unknown"]).optional(),messageMetadata:Ue().optional()}),ee({type:N("abort")}),ee({type:N("message-metadata"),messageMetadata:Ue()})])));function ed(t){return t.type.startsWith("data-")}function zs(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,o=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),i=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);o&&i?a[r]=zs(n,s):a[r]=s}return a}function td(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function o(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":d==='"'&&(e.pop(),e.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":d==='"'&&(e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":d===":"&&(e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":d==="]"?(a=l,e.pop()):(a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&o(d,l)):a=l;break}}}let i=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":i+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":i+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":i+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?i+="true".slice(d.length):"false".startsWith(d)?i+="false".slice(d.length):"null".startsWith(d)&&(i+="null".slice(d.length))}}return i}async function Us(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await ca({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await ca({text:td(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function ma(t){return t.type.startsWith("tool-")}function ad(t){return t.type==="dynamic-tool"}function Vs(t){return ma(t)||ad(t)}function qs(t){return t.type.split("-").slice(1).join("-")}function rd({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function sd({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:o}){return t.pipeThrough(new TransformStream({async transform(i,l){await r(async({state:d,write:u})=>{function p(c){let m=d.message.parts.filter(ma).find(_=>_.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function g(c){let m=d.message.parts.filter(_=>_.type==="dynamic-tool").find(_=>_.toolCallId===c);if(m==null)throw Error("tool-output-error must be preceded by a tool-input-available");return m}function h(c){let m=d.message.parts.find(C=>ma(C)&&C.toolCallId===c.toolCallId),_=c,E=m;m==null?d.message.parts.push({type:`tool-${c.toolName}`,toolCallId:c.toolCallId,state:c.state,input:_.input,output:_.output,rawInput:_.rawInput,errorText:_.errorText,providerExecuted:_.providerExecuted,preliminary:_.preliminary,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(m.state=c.state,E.input=_.input,E.output=_.output,E.errorText=_.errorText,E.rawInput=_.rawInput,E.preliminary=_.preliminary,E.providerExecuted=_.providerExecuted??m.providerExecuted,_.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=_.providerMetadata))}function b(c){let m=d.message.parts.find(C=>C.type==="dynamic-tool"&&C.toolCallId===c.toolCallId),_=c,E=m;m==null?d.message.parts.push({type:"dynamic-tool",toolName:c.toolName,toolCallId:c.toolCallId,state:c.state,input:_.input,output:_.output,errorText:_.errorText,preliminary:_.preliminary,providerExecuted:_.providerExecuted,..._.providerMetadata==null?{}:{callProviderMetadata:_.providerMetadata}}):(m.state=c.state,E.toolName=c.toolName,E.input=_.input,E.output=_.output,E.errorText=_.errorText,E.rawInput=_.rawInput??E.rawInput,E.preliminary=_.preliminary,E.providerExecuted=_.providerExecuted??m.providerExecuted,_.providerMetadata!=null&&m.state==="input-available"&&(m.callProviderMetadata=_.providerMetadata))}async function f(c){if(c!=null){let m=d.message.metadata==null?c:zs(d.message.metadata,c);e!=null&&await ks({value:m,schema:e}),d.message.metadata=m}}switch(i.type){case"text-start":{let c={type:"text",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeTextParts[i.id]=c,d.message.parts.push(c),u();break}case"text-delta":{let c=d.activeTextParts[i.id];c.text+=i.delta,c.providerMetadata=i.providerMetadata??c.providerMetadata,u();break}case"text-end":{let c=d.activeTextParts[i.id];c.state="done",c.providerMetadata=i.providerMetadata??c.providerMetadata,delete d.activeTextParts[i.id],u();break}case"reasoning-start":{let c={type:"reasoning",text:"",providerMetadata:i.providerMetadata,state:"streaming"};d.activeReasoningParts[i.id]=c,d.message.parts.push(c),u();break}case"reasoning-delta":{let c=d.activeReasoningParts[i.id];c.text+=i.delta,c.providerMetadata=i.providerMetadata??c.providerMetadata,u();break}case"reasoning-end":{let c=d.activeReasoningParts[i.id];c.providerMetadata=i.providerMetadata??c.providerMetadata,c.state="done",delete d.activeReasoningParts[i.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:i.mediaType,url:i.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:i.sourceId,url:i.url,title:i.title,providerMetadata:i.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:i.sourceId,mediaType:i.mediaType,title:i.title,filename:i.filename,providerMetadata:i.providerMetadata}),u();break;case"tool-input-start":{let c=d.message.parts.filter(ma);d.partialToolCalls[i.toolCallId]={text:"",toolName:i.toolName,index:c.length,dynamic:i.dynamic},i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}):h({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-streaming",input:void 0,providerExecuted:i.providerExecuted}),u();break}case"tool-input-delta":{let c=d.partialToolCalls[i.toolCallId];c.text+=i.inputTextDelta;let{value:m}=await Us(c.text);c.dynamic?b({toolCallId:i.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}):h({toolCallId:i.toolCallId,toolName:c.toolName,state:"input-streaming",input:m}),u();break}case"tool-input-available":i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):h({toolCallId:i.toolCallId,toolName:i.toolName,state:"input-available",input:i.input,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u(),n&&!i.providerExecuted&&await n({toolCall:i});break;case"tool-input-error":i.dynamic?b({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}):h({toolCallId:i.toolCallId,toolName:i.toolName,state:"output-error",input:void 0,rawInput:i.input,errorText:i.errorText,providerExecuted:i.providerExecuted,providerMetadata:i.providerMetadata}),u();break;case"tool-output-available":if(i.dynamic){let c=g(i.toolCallId);b({toolCallId:i.toolCallId,toolName:c.toolName,state:"output-available",input:c.input,output:i.output,preliminary:i.preliminary})}else{let c=p(i.toolCallId);h({toolCallId:i.toolCallId,toolName:qs(c),state:"output-available",input:c.input,output:i.output,providerExecuted:i.providerExecuted,preliminary:i.preliminary})}u();break;case"tool-output-error":if(i.dynamic){let c=g(i.toolCallId);b({toolCallId:i.toolCallId,toolName:c.toolName,state:"output-error",input:c.input,errorText:i.errorText,providerExecuted:i.providerExecuted})}else{let c=p(i.toolCallId);h({toolCallId:i.toolCallId,toolName:qs(c),state:"output-error",input:c.input,rawInput:c.rawInput,errorText:i.errorText,providerExecuted:i.providerExecuted})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":i.messageId!=null&&(d.message.id=i.messageId),await f(i.messageMetadata),(i.messageId!=null||i.messageMetadata!=null)&&u();break;case"finish":i.finishReason!=null&&(d.finishReason=i.finishReason),await f(i.messageMetadata),i.messageMetadata!=null&&u();break;case"message-metadata":await f(i.messageMetadata),i.messageMetadata!=null&&u();break;case"error":s==null||s(Error(i.errorText));break;default:if(ed(i)){(a==null?void 0:a[i.type])!=null&&await ks({value:i.data,schema:a[i.type]});let c=i;if(c.transient){o==null||o(c);break}let m=c.id==null?void 0:d.message.parts.find(_=>c.type===_.type&&c.id===_.id);m==null?d.message.parts.push(c):m.data=c.data,o==null||o(c),u()}}l.enqueue(i)})}}))}async function Bs({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}Nt({prefix:"aitxt",size:24}),Nt({prefix:"aiobj",size:24});var nd=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};Nt({prefix:"aiobj",size:24}),ql({},{object:()=>od,text:()=>id});var id=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),od=({schema:t})=>{let e=Ul(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await Us(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await ca({text:a});if(!s.success)throw new js({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await Ja({value:s.value,schema:e});if(!n.success)throw new js({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}};async function ld({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var dd=()=>fetch;async function ud({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:o,setLoading:i,setError:l,setAbortController:d,onFinish:u,onError:p,fetch:g=dd()}){try{i(!0),l(void 0);let h=new AbortController;d(h),o("");let b=await g(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:Wa({"Content-Type":"application/json",...r},`ai-sdk/${Xa}`,Ba()),signal:h.signal}).catch(c=>{throw c});if(!b.ok)throw Error(await b.text()??"Failed to fetch the chat response.");if(!b.body)throw Error("The response body is empty.");let f="";switch(n){case"text":await ld({stream:b.body,onTextPart:c=>{f+=c,o(f)}});break;case"data":await Bs({stream:Cs({stream:b.body,schema:Fs}).pipeThrough(new TransformStream({async transform(c){if(!c.success)throw c.error;let m=c.value;if(m.type==="text-delta")f+=m.delta,o(f);else if(m.type==="error")throw Error(m.errorText)}})),onError:c=>{throw c}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,f),d(null),f}catch(h){if(h.name==="AbortError")return d(null),null;h instanceof Error&&p&&p(h),l(h)}finally{i(!1)}}async function cd(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let o=new FileReader;o.onload=i=>{var l;s((l=i.target)==null?void 0:l.result)},o.onerror=i=>n(i),o.readAsDataURL(e)})}}))}var pd=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:o}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=o}async sendMessages({abortSignal:t,...e}){var g;let a=await kt(this.body),r=await kt(this.headers),s=await kt(this.credentials),n={...ct(r),...ct(e.headers)},o=await((g=this.prepareSendMessagesRequest)==null?void 0:g.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:n,credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(o==null?void 0:o.api)??this.api,l=(o==null?void 0:o.headers)===void 0?n:ct(o.headers),d=(o==null?void 0:o.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:o.body,u=(o==null?void 0:o.credentials)??s,p=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:Wa({"Content-Type":"application/json",...l},`ai-sdk/${Xa}`,Ba()),body:JSON.stringify(d),credentials:u,signal:t});if(!p.ok)throw Error(await p.text()??"Failed to fetch the chat response.");if(!p.body)throw Error("The response body is empty.");return this.processResponseStream(p.body)}async reconnectToStream(t){var u;let e=await kt(this.body),a=await kt(this.headers),r=await kt(this.credentials),s={...ct(a),...ct(t.headers)},n=await((u=this.prepareReconnectToStreamRequest)==null?void 0:u.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:s,credentials:r,requestMetadata:t.metadata})),o=(n==null?void 0:n.api)??`${this.api}/${t.chatId}/stream`,i=(n==null?void 0:n.headers)===void 0?s:ct(n.headers),l=(n==null?void 0:n.credentials)??r,d=await(this.fetch??globalThis.fetch)(o,{method:"GET",headers:Wa(i,`ai-sdk/${Xa}`,Ba()),credentials:l});if(d.status===204)return null;if(!d.ok)throw Error(await d.text()??"Failed to fetch the chat response.");if(!d.body)throw Error("The response body is empty.");return this.processResponseStream(d.body)}},er=class extends pd{constructor(t={}){super(t)}processResponseStream(t){return Cs({stream:t,schema:Fs}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},md=class{constructor({generateId:t=Uo,id:e=t(),transport:a=new er,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:o,onToolCall:i,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new nd,this.sendMessage=async(p,g)=>{var b;if(p==null){await this.makeRequest({trigger:"submit-message",messageId:(b=this.lastMessage)==null?void 0:b.id,...g});return}let h;if(h="text"in p||"files"in p?{parts:[...Array.isArray(p.files)?p.files:await cd(p.files),..."text"in p&&p.text!=null?[{type:"text",text:p.text}]:[]]}:p,p.messageId!=null){let f=this.state.messages.findIndex(c=>c.id===p.messageId);if(f===-1)throw Error(`message with id ${p.messageId} not found`);if(this.state.messages[f].role!=="user")throw Error(`message with id ${p.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,f+1),this.state.replaceMessage(f,{...h,id:p.messageId,role:h.role??"user",metadata:p.metadata})}else this.state.pushMessage({...h,id:h.id??this.generateId(),role:h.role??"user",metadata:p.metadata});await this.makeRequest({trigger:"submit-message",messageId:p.messageId,...g})},this.regenerate=async({messageId:p,...g}={})=>{let h=p==null?this.state.messages.length-1:this.state.messages.findIndex(b=>b.id===p);if(h===-1)throw Error(`message ${p} not found`);this.state.messages=this.state.messages.slice(0,this.messages[h].role==="assistant"?h:h+1),await this.makeRequest({trigger:"regenerate-message",messageId:p,...g})},this.resumeStream=async(p={})=>{await this.makeRequest({trigger:"resume-stream",...p})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolOutput=async({state:p="output-available",tool:g,toolCallId:h,output:b,errorText:f})=>this.jobExecutor.run(async()=>{var _,E;let c=this.state.messages,m=c[c.length-1];this.state.replaceMessage(c.length-1,{...m,parts:m.parts.map(C=>Vs(C)&&C.toolCallId===h?{...C,state:p,output:b,errorText:f}:C)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(C=>Vs(C)&&C.toolCallId===h?{...C,state:p,output:b,errorText:f}:C)),this.status!=="streaming"&&this.status!=="submitted"&&((_=this.sendAutomaticallyWhen)!=null&&_.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(E=this.lastMessage)==null?void 0:E.id})}),this.addToolResult=this.addToolOutput,this.stop=async()=>{var p;this.status!=="streaming"&&this.status!=="submitted"||(p=this.activeResponse)!=null&&p.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=o,this.onToolCall=i,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,p,g;var n;this.setStatus({status:"submitted",error:void 0});let o=this.lastMessage,i=!1,l=!1,d=!1;try{let h={state:rd({lastMessage:this.state.snapshot(o),messageId:this.generateId()}),abortController:new AbortController};h.abortController.signal.addEventListener("abort",()=>{i=!0}),this.activeResponse=h;let b;if(t==="resume-stream"){let f=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(f==null){this.setStatus({status:"ready"});return}b=f}else b=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:h.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await Bs({stream:sd({stream:b,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:f=>this.jobExecutor.run(()=>f({state:h.state,write:()=>{var c;this.setStatus({status:"streaming"}),h.state.message.id===((c=this.lastMessage)==null?void 0:c.id)?this.state.replaceMessage(this.state.messages.length-1,h.state.message):this.state.pushMessage(h.state.message)}})),onError:f=>{throw f}}),onError:f=>{throw f}}),this.setStatus({status:"ready"})}catch(h){if(i||h.name==="AbortError")return i=!0,this.setStatus({status:"ready"}),null;d=!0,h instanceof TypeError&&(h.message.toLowerCase().includes("fetch")||h.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&h instanceof Error&&this.onError(h),this.setStatus({status:"error",error:h})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:i,isDisconnect:l,isError:d,finishReason:(u=this.activeResponse)==null?void 0:u.state.finishReason})}catch(h){console.error(h)}this.activeResponse=void 0}(p=this.sendAutomaticallyWhen)!=null&&p.call(this,{messages:this.state.messages})&&!d&&await this.makeRequest({trigger:"submit-message",messageId:(g=this.lastMessage)==null?void 0:g.id,metadata:e,headers:a,body:r})}},hd=Vn(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,o=0;return function(...i){clearTimeout(n);let l=Date.now(),d=s-(l-o);d<=0?(o=l,r.apply(this,i)):n=setTimeout(()=>{o=Date.now(),r.apply(this,i)},d)}}e.exports=a})),Ws=Object.prototype.hasOwnProperty;function tr(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&tr(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(Ws.call(t,a)&&++r&&!Ws.call(e,a)||!(a in e)||!tr(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var A=ka(Kn(),1),We=new WeakMap,pt=()=>{},ue=void 0,ha=Object,Z=t=>t===ue,Ae=t=>typeof t=="function",Je=(t,e)=>({...t,...e}),Js=t=>Ae(t.then),ar={},fa={},rr="undefined",Pt=typeof window!=rr,sr=typeof document!=rr,fd=Pt&&"Deno"in window,gd=()=>Pt&&typeof window.requestAnimationFrame!=rr,Ks=(t,e)=>{let a=We.get(t);return[()=>!Z(e)&&t.get(e)||ar,r=>{if(!Z(e)){let s=t.get(e);e in fa||(fa[e]=s),a[5](e,Je(s,r),s||ar)}},a[6],()=>!Z(e)&&e in fa?fa[e]:!Z(e)&&t.get(e)||ar]},nr=!0,yd=()=>nr,[ir,or]=Pt&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[pt,pt],vd=()=>{let t=sr&&document.visibilityState;return Z(t)||t!=="hidden"},_d=t=>(sr&&document.addEventListener("visibilitychange",t),ir("focus",t),()=>{sr&&document.removeEventListener("visibilitychange",t),or("focus",t)}),bd=t=>{let e=()=>{nr=!0,t()},a=()=>{nr=!1};return ir("online",e),ir("offline",a),()=>{or("online",e),or("offline",a)}},xd={isOnline:yd,isVisible:vd},wd={initFocus:_d,initReconnect:bd},Ys=!A.useId,jt=!Pt||fd,kd=t=>gd()?window.requestAnimationFrame(t):setTimeout(t,1),ga=jt?A.useEffect:A.useLayoutEffect,lr=typeof navigator<"u"&&navigator.connection,Hs=!jt&&lr&&(["slow-2g","2g"].includes(lr.effectiveType)||lr.saveData),ya=new WeakMap,Cd=t=>ha.prototype.toString.call(t),dr=(t,e)=>t===`[object ${e}]`,Ed=0,ur=t=>{let e=typeof t,a=Cd(t),r=dr(a,"Date"),s=dr(a,"RegExp"),n=dr(a,"Object"),o,i;if(ha(t)===t&&!r&&!s){if(o=ya.get(t),o)return o;if(o=++Ed+"~",ya.set(t,o),Array.isArray(t)){for(o="@",i=0;i<t.length;i++)o+=ur(t[i])+",";ya.set(t,o)}if(n){o="#";let l=ha.keys(t).sort();for(;!Z(i=l.pop());)Z(t[i])||(o+=i+":"+ur(t[i])+",");ya.set(t,o)}}else o=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return o},cr=t=>{if(Ae(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?ur(t):"",[t,e]},Td=0,pr=()=>++Td;async function Gs(...t){let[e,a,r,s]=t,n=Je({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),o=n.populateCache,i=n.rollbackOnError,l=n.optimisticData,d=g=>typeof i=="function"?i(g):i!==!1,u=n.throwOnError;if(Ae(a)){let g=a,h=[],b=e.keys();for(let f of b)!/^\$(inf|sub)\$/.test(f)&&g(e.get(f)._k)&&h.push(f);return Promise.all(h.map(p))}return p(a);async function p(g){let[h]=cr(g);if(!h)return;let[b,f]=Ks(e,h),[c,m,_,E]=We.get(e),C=()=>{let W=c[h];return(Ae(n.revalidate)?n.revalidate(b().data,g):n.revalidate!==!1)&&(delete _[h],delete E[h],W&&W[0])?W[0](2).then(()=>b().data):b().data};if(t.length<3)return C();let I=r,P,D=!1,M=pr();m[h]=[M,0];let H=!Z(l),j=b(),F=j.data,K=j._c,X=Z(K)?F:K;if(H&&(l=Ae(l)?l(X,F):l,f({data:l,_c:X})),Ae(I))try{I=I(X)}catch(W){P=W,D=!0}if(I&&Js(I))if(I=await I.catch(W=>{P=W,D=!0}),M!==m[h][0]){if(D)throw P;return I}else D&&H&&d(P)&&(o=!0,f({data:X,_c:ue}));if(o&&(D||(Ae(o)?f({data:o(I,X),error:ue,_c:ue}):f({data:I,error:ue,_c:ue}))),m[h][1]=pr(),Promise.resolve(C()).then(()=>{f({_c:ue})}),D){if(u)throw P;return}return I}}var Qs=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},Xs=(t,e)=>{if(!We.has(t)){let a=Je(wd,e),r=Object.create(null),s=Gs.bind(ue,t),n=pt,o=Object.create(null),i=(u,p)=>{let g=o[u]||[];return o[u]=g,g.push(p),()=>g.splice(g.indexOf(p),1)},l=(u,p,g)=>{t.set(u,p);let h=o[u];if(h)for(let b of h)b(p,g)},d=()=>{if(!We.has(t)&&(We.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,i]),!jt)){let u=a.initFocus(setTimeout.bind(ue,Qs.bind(ue,r,0))),p=a.initReconnect(setTimeout.bind(ue,Qs.bind(ue,r,1)));n=()=>{u&&u(),p&&p(),We.delete(t)}}};return d(),[t,s,d,n]}return[t,We.get(t)[4]]},Id=(t,e,a,r,s)=>{let n=a.errorRetryCount,o=s.retryCount,i=~~((Math.random()+.5)*(1<<(o<8?o:8)))*a.errorRetryInterval;!Z(n)&&o>n||setTimeout(r,i,s)},Sd=tr,[mr,Od]=Xs(new Map),en=Je({onLoadingSlow:pt,onSuccess:pt,onError:pt,onErrorRetry:Id,onDiscarded:pt,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Hs?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Hs?5e3:3e3,compare:Sd,isPaused:()=>!1,cache:mr,mutate:Od,fallback:{}},xd),tn=(t,e)=>{let a=Je(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:o}=e;r&&n&&(a.use=r.concat(n)),s&&o&&(a.fallback=Je(s,o))}return a},hr=(0,A.createContext)({}),Ad=t=>{let{value:e}=t,a=(0,A.useContext)(hr),r=Ae(e),s=(0,A.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,A.useMemo)(()=>r?s:tn(a,s),[r,a,s]),o=s&&s.provider,i=(0,A.useRef)(ue);o&&!i.current&&(i.current=Xs(o(n.cache||mr),s));let l=i.current;return l&&(n.cache=l[0],n.mutate=l[1]),ga(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,A.createElement)(hr.Provider,Je(t,{value:n}))},an=Pt&&window.__SWR_DEVTOOLS_USE__,Rd=an?window.__SWR_DEVTOOLS_USE__:[],Nd=()=>{an&&(window.__SWR_DEVTOOLS_REACT__=A.default)},Md=t=>Ae(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],Pd=()=>Je(en,(0,A.useContext)(hr)),jd=Rd.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=cr(e),[,,,o]=We.get(mr);if(n.startsWith("$inf$"))return a(...s);let i=o[n];return Z(i)?a(...s):(delete o[n],i)}),r)),Ld=t=>function(...e){let a=Pd(),[r,s,n]=Md(e),o=tn(a,n),i=t,{use:l}=o,d=(l||[]).concat(jd);for(let u=d.length;u--;)i=d[u](i);return i(r,s||o.fetcher||null,o)},$d=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Nd();var Dd=Wi(),fr=A.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),gr={dedupe:!0},Zd=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:o,revalidateOnMount:i,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:p,keepPreviousData:g}=a,[h,b,f,c]=We.get(r),[m,_]=cr(t),E=(0,A.useRef)(!1),C=(0,A.useRef)(!1),I=(0,A.useRef)(m),P=(0,A.useRef)(e),D=(0,A.useRef)(a),M=()=>D.current,H=()=>M().isVisible()&&M().isOnline(),[j,F,K,X]=Ks(r,m),W=(0,A.useRef)({}).current,J=Z(o)?Z(a.fallback)?ue:a.fallback[m]:o,te=(B,U)=>{for(let G in W){let V=G;if(V==="data"){if(!s(B[V],U[V])&&(!Z(B[V])||!s(Ce,U[V])))return!1}else if(U[V]!==B[V])return!1}return!0},ie=(0,A.useMemo)(()=>{let B=!m||!e?!1:Z(i)?M().isPaused()||n?!1:l!==!1:i,U=ne=>{let ce=Je(ne);return delete ce._k,B?{isValidating:!0,isLoading:!0,...ce}:ce},G=j(),V=X(),me=U(G),he=G===V?me:U(V),re=me;return[()=>{let ne=U(j());return te(ne,re)?(re.data=ne.data,re.isLoading=ne.isLoading,re.isValidating=ne.isValidating,re.error=ne.error,re):(re=ne,ne)},()=>he]},[r,m]),ae=(0,Dd.useSyncExternalStore)((0,A.useCallback)(B=>K(m,(U,G)=>{te(G,U)||B()}),[r,m]),ie[0],ie[1]),Ye=!E.current,ke=h[m]&&h[m].length>0,ye=ae.data,be=Z(ye)?J&&Js(J)?fr(J):J:ye,De=ae.error,Ne=(0,A.useRef)(be),Ce=g?Z(ye)?Z(Ne.current)?be:Ne.current:ye:be,Ze=ke&&!Z(De)?!1:Ye&&!Z(i)?i:M().isPaused()?!1:n?Z(be)?!1:l:Z(be)||l,nt=!!(m&&e&&Ye&&Ze),Tt=Z(ae.isValidating)?nt:ae.isValidating,ht=Z(ae.isLoading)?nt:ae.isLoading,Fe=(0,A.useCallback)(async B=>{let U=P.current;if(!m||!U||C.current||M().isPaused())return!1;let G,V,me=!0,he=B||{},re=!f[m]||!he.dedupe,ne=()=>Ys?!C.current&&m===I.current&&E.current:m===I.current,ce={isValidating:!1,isLoading:!1},ot=()=>{F(ce)},ze=()=>{let le=f[m];le&&le[1]===V&&delete f[m]},lt={isValidating:!0};Z(j().data)&&(lt.isLoading=!0);try{if(re&&(F(lt),a.loadingTimeout&&Z(j().data)&&setTimeout(()=>{me&&ne()&&M().onLoadingSlow(m,a)},a.loadingTimeout),f[m]=[U(_),pr()]),[G,V]=f[m],G=await G,re&&setTimeout(ze,a.dedupingInterval),!f[m]||f[m][1]!==V)return re&&ne()&&M().onDiscarded(m),!1;ce.error=ue;let le=b[m];if(!Z(le)&&(V<=le[0]||V<=le[1]||le[1]===0))return ot(),re&&ne()&&M().onDiscarded(m),!1;let fe=j().data;ce.data=s(fe,G)?fe:G,re&&ne()&&M().onSuccess(G,m,a)}catch(le){ze();let fe=M(),{shouldRetryOnError:Me}=fe;fe.isPaused()||(ce.error=le,re&&ne()&&(fe.onError(le,m,fe),(Me===!0||Ae(Me)&&Me(le))&&(!M().revalidateOnFocus||!M().revalidateOnReconnect||H())&&fe.onErrorRetry(le,m,fe,ft=>{let Pe=h[m];Pe&&Pe[0]&&Pe[0](3,ft)},{retryCount:(he.retryCount||0)+1,dedupe:!0})))}return me=!1,ot(),!0},[m,r]),it=(0,A.useCallback)((...B)=>Gs(r,I.current,...B),[]);if(ga(()=>{P.current=e,D.current=a,Z(ye)||(Ne.current=ye)}),ga(()=>{if(!m)return;let B=Fe.bind(ue,gr),U=0;M().revalidateOnFocus&&(U=Date.now()+M().focusThrottleInterval);let G=$d(m,h,(V,me={})=>{if(V==0){let he=Date.now();M().revalidateOnFocus&&he>U&&H()&&(U=he+M().focusThrottleInterval,B())}else if(V==1)M().revalidateOnReconnect&&H()&&B();else{if(V==2)return Fe();if(V==3)return Fe(me)}});return C.current=!1,I.current=m,E.current=!0,F({_k:_}),Ze&&(f[m]||(Z(be)||jt?B():kd(B))),()=>{C.current=!0,G()}},[m]),ga(()=>{let B;function U(){let V=Ae(d)?d(j().data):d;V&&B!==-1&&(B=setTimeout(G,V))}function G(){!j().error&&(u||M().isVisible())&&(p||M().isOnline())?Fe(gr).then(U):U()}return U(),()=>{B&&(B=(clearTimeout(B),-1))}},[d,u,p,m]),(0,A.useDebugValue)(Ce),n&&Z(be)&&m){if(!Ys&&jt)throw Error("Fallback data is required when using Suspense in SSR.");P.current=e,D.current=a,C.current=!1;let B=c[m];if(Z(B)||fr(it(B)),Z(De)){let U=Fe(gr);Z(Ce)||(U.status="fulfilled",U.value=!0),fr(U)}else throw De}return{mutate:it,get data(){return W.data=!0,Ce},get error(){return W.error=!0,De},get isValidating(){return W.isValidating=!0,Tt},get isLoading(){return W.isLoading=!0,ht}}};ha.defineProperty(Ad,"defaultValue",{value:en});var rn=Ld(Zd),Fd=ka(hd(),1),sn=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},Y=(t,e,a)=>(sn(t,e,"read from private field"),a?a.call(t):e.get(t)),$e=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},rt=(t,e,a,r)=>(sn(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function nn(t,e){return e==null?t:(0,Fd.default)(t,e)}var xe,va,_a,Lt,$t,Dt,Ct,yr,vr,zd=class{constructor(t=[]){$e(this,xe,void 0),$e(this,va,"ready"),$e(this,_a,void 0),$e(this,Lt,new Set),$e(this,$t,new Set),$e(this,Dt,new Set),this.pushMessage=e=>{rt(this,xe,Y(this,xe).concat(e)),Y(this,Ct).call(this)},this.popMessage=()=>{rt(this,xe,Y(this,xe).slice(0,-1)),Y(this,Ct).call(this)},this.replaceMessage=(e,a)=>{rt(this,xe,[...Y(this,xe).slice(0,e),this.snapshot(a),...Y(this,xe).slice(e+1)]),Y(this,Ct).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?nn(e,a):e;return Y(this,Lt).add(r),()=>{Y(this,Lt).delete(r)}},this["~registerStatusCallback"]=e=>(Y(this,$t).add(e),()=>{Y(this,$t).delete(e)}),this["~registerErrorCallback"]=e=>(Y(this,Dt).add(e),()=>{Y(this,Dt).delete(e)}),$e(this,Ct,()=>{Y(this,Lt).forEach(e=>e())}),$e(this,yr,()=>{Y(this,$t).forEach(e=>e())}),$e(this,vr,()=>{Y(this,Dt).forEach(e=>e())}),rt(this,xe,t)}get status(){return Y(this,va)}set status(t){rt(this,va,t),Y(this,yr).call(this)}get error(){return Y(this,_a)}set error(t){rt(this,_a,t),Y(this,vr).call(this)}get messages(){return Y(this,xe)}set messages(t){rt(this,xe,[...t]),Y(this,Ct).call(this)}};xe=new WeakMap,va=new WeakMap,_a=new WeakMap,Lt=new WeakMap,$t=new WeakMap,Dt=new WeakMap,Ct=new WeakMap,yr=new WeakMap,vr=new WeakMap;var Et,on=class extends md{constructor({messages:t,...e}){let a=new zd(t);super({...e,state:a}),$e(this,Et,void 0),this["~registerMessagesCallback"]=(r,s)=>Y(this,Et)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>Y(this,Et)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>Y(this,Et)["~registerErrorCallback"](r),rt(this,Et,a)}};Et=new WeakMap;function ln({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,A.useRef)("chat"in a?a.chat:new on(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new on(a));let s=(0,A.useSyncExternalStore)((0,A.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,r.current.id]),()=>r.current.messages,()=>r.current.messages),n=(0,A.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),o=(0,A.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),i=(0,A.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,A.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:i,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:o,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolOutput,addToolOutput:r.current.addToolOutput}}function Ud({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:o,streamProtocol:i="data",fetch:l,onFinish:d,onError:u,experimental_throttle:p}={}){let g=(0,A.useId)(),h=e||g,{data:b,mutate:f}=rn([t,h],null,{fallbackData:a}),{data:c=!1,mutate:m}=rn([h,"loading"],null),[_,E]=(0,A.useState)(void 0),C=b,[I,P]=(0,A.useState)(null),D=(0,A.useRef)({credentials:s,headers:n,body:o});(0,A.useEffect)(()=>{D.current={credentials:s,headers:n,body:o}},[s,n,o]);let M=(0,A.useCallback)(async(J,te)=>ud({api:t,prompt:J,credentials:D.current.credentials,headers:{...D.current.headers,...te==null?void 0:te.headers},body:{...D.current.body,...te==null?void 0:te.body},streamProtocol:i,fetch:l,setCompletion:nn(ie=>f(ie,!1),p),setLoading:m,setError:E,setAbortController:P,onFinish:d,onError:u}),[f,m,t,D,P,d,u,E,i,l,p]),H=(0,A.useCallback)(()=>{I&&(I.abort(),P(null))},[I]),j=(0,A.useCallback)(J=>{f(J,!1)},[f]),F=(0,A.useCallback)(async(J,te)=>M(J,te),[M]),[K,X]=(0,A.useState)(r),W=(0,A.useCallback)(J=>{var te;return(te=J==null?void 0:J.preventDefault)==null||te.call(J),K?F(K):void 0},[K,F]);return{completion:C,complete:F,error:_,setCompletion:j,stop:H,input:K,setInput:X,handleInputChange:(0,A.useCallback)(J=>{X(J.target.value)},[X]),handleSubmit:W,isLoading:c}}var we=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,...this.suggestedFix&&{suggested_fix:this.suggestedFix},...this.meta&&{meta:this.meta}});return`Error invoking tool ${this.name}: ${t}`}};const dn=Q({status:Bt(["success","error","warning"]).optional(),auth_required:de().optional(),next_steps:Ve(k()).optional(),action_url:k().optional(),message:k().optional(),meta:It(k(),Ue()).optional()});function Vd(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var qd=class extends Ot{constructor(e){super();L(this,"title","Cell Outputs");L(this,"mentionPrefix","@");L(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(Ge),a=[];for(let r of e.cellIds.inOrderIds){let s=cn(r,e),n=s.cellOutput;if(!n)continue;let o=n.output.mimetype||"unknown";a.push({uri:this.asURI(r),name:s.cellName,type:this.contextType,description:`Cell output (${o})`,data:{...s,cellOutput:n}})}return a}formatCompletion(e){let{cellOutput:a,cellName:r,cellCode:s}=e.data;return{label:`@${r}`,displayLabel:r,detail:`${a.outputType} output`,boost:a.outputType==="media"?vt.HIGH:vt.MEDIUM,type:this.contextType,section:yt.CELL_OUTPUT,apply:`@${r}`,info:()=>{let n=document.createElement("div");n.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let o=document.createElement("div");o.classList.add("flex","flex-col","gap-1");let i=document.createElement("div");i.classList.add("font-bold","text-base"),i.textContent=r,o.append(i);let l=document.createElement("div");if(l.classList.add("text-sm","text-muted-foreground"),o.append(l),n.append(o),s){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground"),d.textContent="Code:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),u.textContent=s.slice(0,200)+(s.length>200?"...":""),n.append(u)}if(a.processedContent){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),d.textContent="Output Preview:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),u.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),n.append(u)}if(a.outputType==="media"){let d=document.createElement("div");d.classList.add("text-xs","text-muted-foreground","italic","mb-2"),d.textContent="A screenshot of the output will be attached",n.append(d)}return n}}}formatContext(e){let{cellOutput:a,cellName:r,cellId:s,cellCode:n}=e.data,o={name:r,cellId:s,outputType:a.outputType,mimetype:a.output.mimetype},i=`Cell Code:
${n}

`;return a.outputType==="text"&&a.processedContent?i+=`Output:
${a.processedContent}`:a.outputType==="media"&&(i+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(i+=`
Image URL: ${a.imageUrl}`)),St({type:this.contextType,data:o,details:i})}async getAttachments(e){let a=e[0].data.cellId,r=e[0].data.cellName;return Bd(e.map(s=>s.data.cellOutput),a,r)}};async function Bd(t,e,a){let r=t.filter(n=>n.shouldDownloadImage&&n.outputType==="media");if(r.length===0)return[];let s=r.flatMap(n=>{let o=document.getElementById(ii.create(e));return o?{cellId:e,cellName:a,mimetype:n.output.mimetype,element:o}:(oe.warn(`Output element not found for cell ${e}`),[])});try{return await Promise.all(s.map(async n=>({type:"file",filename:`${a}-output-screenshot`,mediaType:"image/png",url:await Hi(n.element)})))}catch(n){return oe.error("Error downloading cell output images:",n),[]}}function un(t){if(Wr(t))return null;let e=t.mimetype,a=Vd(e,String(t.data))?"media":"text",r=Gi(t),s,n=!1;return a==="media"&&(typeof t.data=="string"&&t.data.startsWith("data:")||typeof t.data=="string"&&t.data.startsWith("http")?s=t.data:n=!0),{processedContent:r,imageUrl:s,shouldDownloadImage:n,outputType:a,output:t}}function cn(t,e,a){let{includeConsoleOutput:r=!1}=a||{},s=e.cellRuntime[t],n=e.cellData[t],o=e.cellIds.inOrderIds.indexOf(t),i=di(n.name,o),l;r&&(l=s.consoleOutputs.map(p=>un(p)).filter(p=>p!==null));let d,u=s.output;return u&&!Wr(u)&&(d=un(u)??void 0),{cellId:t,cellName:i,cellCode:n.code,cellOutput:d,consoleOutputs:l}}function Wd(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(zr(t),"Unknown error")}var pn=new Xn("error","errors"),Jd=class extends Ot{constructor(e){super();L(this,"title","Errors");L(this,"mentionPrefix","@");L(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(ni);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${pn.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:yt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${pn.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:yt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>St({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>Wd(s)).join(`
`)}})).join(`

`)}};const mn=Yn();var Kd={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},Yd=class extends Ot{constructor(e,a=Kd){super();L(this,"title","Files");L(this,"mentionPrefix","#");L(this,"contextType","file");L(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(o=>{let i={uri:this.asURI(o.path),name:o.name,type:this.contextType,description:o.isDirectory?"Directory":"File",data:{path:o.path,isDirectory:o.isDirectory}};return this.formatCompletion(i)});return{from:a.from,options:n}}catch(n){return oe.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let o={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(o)});return{from:e.from,options:s}}}catch(r){oe.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return oe.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:yt.FILE,boost:a.isDirectory?vt.MEDIUM:vt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,o,i,l)=>{var h;let d=(h=n.state.facet(mn))==null?void 0:h.addAttachment;if(!d){oe.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(b=>(Kr({title:"Failed to get file details",description:b.message}),null));if(!u)return;let p=u.mimeType||"text/plain",g;if(p.startsWith("text/")||p.includes("json")||p.includes("xml"))g=new Blob([u.contents||""],{type:p});else if(u.contents)try{g=await Qi(Mi(u.contents,p))}catch{g=new Blob([u.contents],{type:p})}else g=new Blob([""],{type:p});d(new File([g],r,{type:p})),n.dispatch({changes:{from:i,to:l,insert:""}}),Ti(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let o=document.createElement("div");o.classList.add("font-bold"),o.textContent=r,n.append(o);let i=document.createElement("div");return i.classList.add("text-xs","text-muted-foreground"),i.textContent=a.path,n.append(i),n}}}formatContext(e){let{data:a,name:r}=e;return St({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},Hd=class extends Ot{constructor(e){super();L(this,"title","Tables");L(this,"mentionPrefix","@");L(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:o,name:i,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,o==null?void 0:`${o} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let p of r){let g=`  ${p.name} (${p.type})`;if(p.sample_values&&p.sample_values.length>0){let h=p.sample_values.slice(0,3).map(b=>b===null?"null":String(b)).join(", ");g+=` - samples: [${h}]`}u+=`${g}
`}}return St({type:this.contextType,data:{name:i,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?vt.LOCAL_TABLE:vt.REMOTE_TABLE,type:Pr(r),apply:`@${a}`,section:{name:Pr(r)==="dataframe"?"Dataframe":"Table",rank:yt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let i=document.createElement("div");i.classList.add("text-xs","text-muted-foreground"),i.textContent=`Source: ${a.source}`,s.append(i)}r.append(s);let o=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(o){let i=document.createElement("div");i.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),i.textContent=o,r.append(i)}if(a.columns&&a.columns.length>0){let i=document.createElement("div");i.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let p=d.insertCell();p.classList.add("p-2","font-medium","text-left"),p.textContent="Type";let g=a.columns.some(b=>this.getItemMetadata(a,b)!==void 0),h;g&&(h=d.insertCell(),h.classList.add("p-2","font-medium","text-left"),h.textContent="Metadata"),a.columns.forEach((b,f)=>{let c=l.insertRow();c.classList.add(f%2==0?"bg-background":"bg-muted/30");let m=c.insertCell();m.classList.add("p-2","font-mono"),m.textContent=b.name;let _=c.insertCell();if(_.classList.add("p-2","text-muted-foreground"),_.textContent=b.type,g){let E=c.insertCell();E.classList.add("p-2");let C=this.getItemMetadata(a,b);C&&E.append(C)}}),i.append(l),r.append(i)}return r}getItemMetadata(e,a){var n,o;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(o=e.indexes)==null?void 0:o.includes(a.name);if(r||s){let i=document.createElement("span");i.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return i.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),i}}},Gd=class extends Ot{constructor(e,a){super();L(this,"title","Variables");L(this,"mentionPrefix","@");L(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:yt.VARIABLE,info:()=>Hn(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return St({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function mt(t){let e=t.get(oi),a=t.get(li),r=t.get(ri);return new zi().register(new Hd(a)).register(new Gd(r,a)).register(new Jd(t)).register(new qd(t)).register(new Ui(e.connectionsMap,a))}function Qd(){return new Yd(Oi())}const Xd="@";function eu({input:t}){let e="";return t.includes("@")&&(e=au(t),oe.debug("Included context",e)),{includeOtherCode:Mr(""),context:{plainText:e,schema:[],variables:[]}}}async function tu({input:t}){let e="",a=[];if(t.includes("@")){let r=mt(Nr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),oe.debug("Included attachments",a.length)}catch(n){oe.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Mr(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function au(t){let e=mt(Nr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function ru(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function su(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),Ci(t.current.view)}}function nu(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),p=u===-1?d:d.slice(0,u),g=p==="markdown"?"markdown":p==="sql"?"sql":"python",h=u===-1?"":d.slice(u+1);h.trim()&&e.push({language:g,code:h.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let o=s+1,i=t.indexOf("```",o);if(i===-1){let d=t.slice(o).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(o,i).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=i+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}var iu=Ea(),hn=()=>new Map,{valueAtom:Zt,useActions:fn,createActions:Bc,reducer:Wc}=ki(hn,{addStagedCell:(t,e)=>{let{cellId:a,edit:r}=e;return new Map([...t,[a,r]])},removeStagedCell:(t,e)=>{let a=new Map(t);return a.delete(e),a},clearStagedCells:()=>hn()});function gn(t){let e=(0,iu.c)(27),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=fn(),{createNewCell:n,updateCellCode:o}=Lr(),i=Xi(),l=(0,A.useRef)(null),d;e[0]!==a||e[1]!==n?(d=C=>{let I=jr.create();return a({cellId:I,edit:{type:"add_cell"}}),n({cellId:"__end__",code:C,before:!1,newCellId:I}),I},e[0]=a,e[1]=n,e[2]=d):d=e[2];let u=d,p;e[3]!==t||e[4]!==o?(p=C=>{let{cellId:I,code:P}=C;if(!t.get(Zt).has(I)){oe.error("Staged cell not found",{cellId:I});return}let D=si(I);D?Ca(D,P):o({cellId:I,code:P,formattingChange:!1})},e[3]=t,e[4]=o,e[5]=p):p=e[5];let g=p,h;e[6]!==i||e[7]!==r?(h=C=>{r(C),i({cellId:C})},e[6]=i,e[7]=r,e[8]=h):h=e[8];let b=h,f;e[9]!==s||e[10]!==i||e[11]!==t?(f=()=>{let C=t.get(Zt);for(let I of C.keys())i({cellId:I});s()},e[9]=s,e[10]=i,e[11]=t,e[12]=f):f=e[12];let c=f,m;e[13]!==a||e[14]!==n||e[15]!==u||e[16]!==g?(m=C=>{e:switch(C.type){case"text-start":l.current=new ou(u,g,a,n);break e;case"text-delta":if(!l.current){oe.error("Cell creation stream not found");return}l.current.stream(C);break e;case"text-end":case"finish":if(!l.current){oe.error("Cell creation stream not found");return}l.current.stop();break e;case"abort":case"error":case"tool-input-error":case"tool-output-error":oe.error("Error",C.type,{chunk:C});break e;case"start":case"start-step":case"finish-step":case"data-reasoning-signature":break e;case"message-metadata":case"tool-input-available":case"tool-output-available":case"reasoning-start":case"reasoning-delta":case"reasoning-end":case"file":case"source-document":case"source-url":case"tool-input-start":case"tool-input-delta":oe.debug(C.type,{chunk:C});break e;default:if(lu(C)){oe.debug("Data chunk",{chunk:C});break e}zr(C)}},e[13]=a,e[14]=n,e[15]=u,e[16]=g,e[17]=m):m=e[17];let _=m,E;return e[18]!==a||e[19]!==s||e[20]!==u||e[21]!==c||e[22]!==b||e[23]!==_||e[24]!==r||e[25]!==g?(E={createStagedCell:u,updateStagedCell:g,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:b,deleteAllStagedCells:c,onStream:_},e[18]=a,e[19]=s,e[20]=u,e[21]=c,e[22]=b,e[23]=_,e[24]=r,e[25]=g,e[26]=E):E=e[26],E}var ou=class{constructor(t,e,a,r){L(this,"createdCells",[]);L(this,"buffer","");L(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=nu(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=Yi({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e,edit:{type:"add_cell"}}),this.hasMarimoImport=!0}stop(){this.buffer=""}};function lu(t){return t.type.startsWith("data-")}var du={baseDescription:"Perform editing operations on the current notebook. You should prefer to create new cells unless you need to edit existing cells. Call this tool multiple times to perform multiple edits. Separate code into logical individual cells to take advantage of the notebook's reactive execution model.",prerequisites:["If you are updating existing cells, you need the cellIds. If they are not known, call the lightweight_cell_map_tool to find out."],additionalInfo:`
  Args:
    edit (object): The editing operation to perform with the following structure:
      - type: One of "update_cell", "add_cell", or "delete_cell"
      - code (string, optional): Required for "update_cell" and "add_cell" operations. The code content for the cell.
      - position (object): Always present, with the following structure:
        - type: One of "relative", "column_end", or "notebook_end". Not needed for "delete_cell" or "update_cell" operations.
        - cellId (string, optional): Required for "update_cell", "delete_cell", and "add_cell" with "relative" position type
        - columnIndex (number, optional): Required for "add_cell" with "column_end" position type (0-based index)
        - before (boolean, optional): Required for "add_cell" with "relative" position type (true to add before, false to add after)

    Operation types:
    - update_cell: Update the code of an existing cell. Requires: code, position.cellId
    - add_cell: Add a new cell to the notebook. Requires: code, and position based on position.type:
        - position.type "notebook_end": Add at the end of the notebook (no additional position fields needed)
        - position.type "relative": Add relative to an existing cell. Requires: position.cellId, position.before
        - position.type "column_end": Add at the end of a specific column. Requires: position.columnIndex
    - delete_cell: Delete an existing cell. Requires: position.cellId. For deleting cells, the user needs to accept the deletion to actually delete the cell, so you may still see the cell in the notebook on subsequent edits which is fine.

    For adding code, use the following guidelines:
    - Markdown cells: use mo.md(f"""{content}""") function to insert content.
    - SQL cells: use mo.sql(f"""{content}""") function to insert content. If a database engine is specified, use mo.sql(f"""{content}""", engine=engine) instead.

    Returns:
    - A result object containing standard tool metadata.`},uu=Q({edit:Q({type:Bt(["update_cell","add_cell","delete_cell"]),code:k().optional(),position:Q({type:Bt(["relative","column_end","notebook_end"]).optional(),cellId:k().optional(),columnIndex:Zr().optional(),before:de().optional()})})}),cu=class{constructor(){L(this,"name","edit_notebook_tool");L(this,"description",du);L(this,"schema",uu);L(this,"outputSchema",dn);L(this,"mode",["agent"]);L(this,"handler",async({edit:t},e)=>{let{addStagedCell:a,createNewCell:r,store:s}=e;switch(t.type){case"update_cell":{let{position:n,code:o}=t,i=n.cellId;if(i){if(!o)throw new we("Code is required for update_cell","CODE_REQUIRED_FOR_UPDATE_CELL",!0,"Provide the new code to update the cell")}else throw new we("Cell ID is required for update_cell","CELL_ID_REQUIRED_FOR_UPDATE_CELL",!0,"Provide a cell ID to update");let l=s.get(Ge);this.validateCellIdExists(i,l);let d=this.getCellEditorView(i,l);Sa(i);let u=s.get(Zt).get(i);if((u==null?void 0:u.type)==="add_cell"){Ca(d,o);break}let p=d.state.doc.toString();a({cellId:i,edit:{type:"update_cell",previousCode:(u==null?void 0:u.previousCode)??p}}),Ca(d,o);break}case"add_cell":{let{position:n,code:o}=t,i="__end__",l=!1,d=jr.create(),u=s.get(Ge);switch(n.type){case"relative":{let p=n.cellId;if(!p)throw new we("Cell ID is required for add_cell with relative position","TOOL_ERROR",!0,"Provide a cell ID to add the cell before");if(n.before===void 0)throw new we("Before is required for add_cell with relative position","TOOL_ERROR",!0,`Provide a boolean value for before, true to add before cell ${p}, false to add after the cell`);this.validateCellIdExists(p,u),i=p,l=n.before;break}case"column_end":if(!n.columnIndex)throw new we("Column index is required for add_cell with column_end position","TOOL_ERROR",!0,"Provide a column index to add the cell at the end of");i={type:"__end__",columnId:this.getColumnId(n.columnIndex,u)};break;case"notebook_end":break}r({cellId:i,before:l,code:o,newCellId:d}),a({cellId:d,edit:{type:"add_cell"}}),Sa(d);break}case"delete_cell":{let{position:n}=t,o=n.cellId;if(!o)throw new we("Cell ID is required for delete_cell","CELL_ID_REQUIRED_FOR_DELETE_CELL",!0,"Provide a cell ID to delete");let i=s.get(Ge);this.validateCellIdExists(o,i),a({cellId:o,edit:{type:"delete_cell",previousCode:this.getCellEditorView(o,i).state.doc.toString()}}),Sa(o);break}}return{status:"success",next_steps:["If you need to perform more edits, call this tool again.","You should use the lint notebook tool to check for errors and lint issues. Fix them by editing the notebook.","You should use the run stale cells tool to run the cells that have been edited or newly added. This allows you to see the output of the cells and fix any errors."]}})}validateCellIdExists(t,e){if(!e.cellIds.getColumns().some(a=>a.idSet.has(t)))throw new we("Cell not found","CELL_NOT_FOUND",!1,"Check which cells exist in the notebook")}getColumnId(t,e){let a=e.cellIds.getColumns();if(t<0||t>=a.length)throw new we("Column index is out of range","COLUMN_INDEX_OUT_OF_RANGE",!0,"Choose a column index between 0 and the number of columns in the notebook (0-based)");return a[t].id}getCellEditorView(t,e){let a=e.cellHandles[t].current;if(!(a!=null&&a.editorView))throw new we("Cell editor not found","CELL_EDITOR_NOT_FOUND",!1,"Internal error, ask the user to report this error");return a.editorView}},pu=200,mu=3e4,hu={baseDescription:"Run cells in the current notebook that are stale. Stale cells are cells that have been edited or newly added. You can run this tool after editing the notebook or when requested. The output of the ran cells will be returned alongside metadata."},yn=Q({type:N("file"),url:k(),mediaType:k()}),fu=class{constructor(t){L(this,"name","run_stale_cells_tool");L(this,"description",hu);L(this,"schema",Q({}));L(this,"outputSchema",dn.extend({cellsToOutput:It(k(),Q({consoleOutput:k().optional(),cellOutput:k().optional(),consoleAttachments:Ve(yn).optional(),cellAttachments:Ve(yn).optional()}).nullable()).optional()}));L(this,"mode",["agent"]);L(this,"handler",async(t,e)=>{let{prepareForRun:a,sendRun:r,store:s}=e,n=s.get(Ge),o=ui(n);if(o.length===0)return{status:"success",message:"No stale cells found."};if(await Ki({cellIds:o,sendRun:r,prepareForRun:a,notebook:n}),!await this.waitForCellsToFinish(s,o,mu,this.postExecutionDelay))return{status:"success",message:"No output was returned because some cells have not finished executing"};let i=s.get(Ge),l=new Map,d="",u=!1;for(let g of o){let h=cn(g,i,{includeConsoleOutput:!0}),b,f,c=h.cellOutput,m=h.consoleOutputs,_=m&&m.length>0;if(!c&&!_){l.set(g,null);continue}c&&(b=this.formatOutputString(c),this.outputHasErrors(c)&&(u=!0)),_&&(f=m.map(E=>this.formatOutputString(E)).join(`
`),d+="Console output represents the stdout or stderr of the cell (eg. print statements).",m.some(E=>this.outputHasErrors(E))&&(u=!0)),l.set(g,{cellOutput:b,consoleOutput:f})}if(l.size===0)return{status:"success",message:"Stale cells have been run. No output was returned."};let p=["Review the output of the cells. The CellId is the key of the result object.",u?"There are errors in the cells. Please fix them by using the edit notebook tool and the given CellIds.":"You may edit the notebook further with the given CellIds."];return{status:"success",cellsToOutput:Object.fromEntries(l),message:d===""?void 0:d,next_steps:p}});this.postExecutionDelay=(t==null?void 0:t.postExecutionDelay)??pu}outputHasErrors(t){let{output:e}=t;return e.mimetype==="application/vnd.marimo+error"||e.mimetype==="application/vnd.marimo+traceback"}formatOutputString(t){let e="",{outputType:a,processedContent:r,imageUrl:s,output:n}=t;return a==="text"?(e+=`Output:
`,r?e+=r:typeof n.data=="string"?e+=n.data:e+=JSON.stringify(n.data)):a==="media"&&(e+=`Media Output: Contains ${n.mimetype} content`,s&&(e+=`
Image URL: ${s}`)),e}async waitForCellsToFinish(t,e,a,r){let s=o=>e.every(i=>{let l=o.cellRuntime[i];return(l==null?void 0:l.status)!=="running"&&(l==null?void 0:l.status)!=="queued"}),n=async()=>(r>0&&await new Promise(o=>setTimeout(o,r)),!0);if(s(t.get(Ge)))return await n();try{return await Promise.race([Wn(Ge,s),new Promise((o,i)=>setTimeout(()=>i(Error("timeout")),a))]),await n()}catch{return!1}}};function gu(t){let e=t.baseDescription;return t.whenToUse&&(e+=`

## When to use:
- ${t.whenToUse.join(`
- `)}`),t.avoidIf&&(e+=`

## Avoid if:
- ${t.avoidIf.join(`
- `)}`),t.prerequisites&&(e+=`

## Prerequisites:
- ${t.prerequisites.join(`
- `)}`),t.sideEffects&&(e+=`

## Side effects:
- ${t.sideEffects.join(`
- `)}`),t.additionalInfo&&(e+=`

## Additional info:
- ${t.additionalInfo}`),e}var vn,Ft;function yu(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(o){n[o]=r[o]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(o,i){return i(t,e,o)||o},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const _r=new(vn=ei(),Ft=class{constructor(t=[]){L(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e,a){var i;let r=this.getToolOrThrow(t),s=r.handler,n=r.schema,o=r.outputSchema;try{let l=await n.safeParseAsync(e);if(l.error)throw new we(`Tool ${t} returned invalid input: ${Dr(l.error)}`,"INVALID_ARGUMENTS",!0,"Please check the arguments and try again.");let d=l.data,u=await s(d,a),p=await o.safeParseAsync(u);if(p.error){let g=Dr(p.error);throw Error(`Tool ${t} returned invalid output: ${g}`)}return{tool_name:t,result:p.data,error:null}}catch(l){return l instanceof we?{tool_name:t,result:null,error:l.toStructuredString()}:{tool_name:t,result:null,error:new we(l instanceof Error?l.message:String(l),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((i=l==null?void 0:l.constructor)==null?void 0:i.name)??typeof l}).toStructuredString()}}}getToolSchemas(t){return[...this.tools.values()].filter(e=>e.mode.includes(t)).map(e=>({name:e.name,description:gu(e.description),parameters:Fr(e.schema),source:"frontend",mode:e.mode}))}},yu(Ft.prototype,"getToolSchemas",[vn],Object.getOwnPropertyDescriptor(Ft.prototype,"getToolSchemas"),Ft.prototype),Ft)([new cu,new fu]);function br(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let o=s.target.result;a(e==="base64"?o.slice(o.indexOf(",")+1):o)}}})}function vu(t){return Promise.all(t.map(e=>br(e,"base64").then(a=>[e.name,a])))}function _u(t){return t.length>50?`${t.slice(0,50)}...`:t}async function bu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await br(e,"dataUrl")})))}function xu(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function wu(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function _n(t){let e=await tu({input:wu(t.flatMap(r=>r.parts))});function a(r,s){return s?{...r,parts:[...r.parts,...e.attachments]}:r}return{...e.body,uiMessages:t.map((r,s)=>a(r,s===t.length-1))}}async function bn({invokeAiTool:t,addToolOutput:e,toolCall:a,toolContext:r}){try{if(_r.has(a.toolName)){let s=await _r.invoke(a.toolName,a.input,r);e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}else{let s=await t({toolName:a.toolName,arguments:a.input??{}});e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}}catch(s){oe.error("Tool call failed:",s),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${s instanceof Error?s.message:String(s)}`})}}function ku(t){var i;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],o=n.type==="text"&&((i=n.text)==null?void 0:i.trim().length)>0;return oe.warn("All tool calls completed: %s",s),s&&!o}function Cu(t){return _i.define({combine:e=>e[0]??t})}var xn=Cu({}),xr=Yt.define(),ba=Yt.define(),Eu=50,wr=Jt.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(ba)||n.is(xr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(xr)){let o=n.value.trim();o&&(a.prompts=[o,...t.prompts.filter(i=>i!==o)].slice(0,Eu),(s=(r=e.state.facet(xn)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(ba)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),Tu=t=>{let e=t.state.field(wr),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:ba.of({index:r,originalText:s})}),!0},Iu=t=>{let e=t.state.field(wr);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:ba.of({index:r,originalText:e.originalText})}),!0};const wn=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:xr.of(e)}),!0):!1};function Su(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[wr.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),xn.of(e??{})];return a&&r.push(Kt.of([{key:"ArrowUp",run:Tu},{key:"ArrowDown",run:Iu}])),r}const kr=Yt.define(),Ke=Jt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(kr)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}}),Ou=Jt.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Au=Yt.define();Jt.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Au)){a||(a=(r=new Map(t),!0));for(let[n,o]of s.value)r.set(n,o)}return r}});const Ru=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=kr.of(new Map(s.map(i=>[i.uri,i])));a.view&&a.view.dispatch({effects:n});let o=s.map(i=>({label:`@${i.name}`,displayLabel:i.name,detail:i.uri,info:i.description||void 0,type:i.mimeType?"constant":"variable",boost:i.description?100:0,...e==null?void 0:e(i),apply:(l,d,u,p)=>{l.dispatch({changes:{from:u,to:p,insert:`@${i.uri} `}})}}));return{from:r.from,options:o}},Nu=/@[\w-]+:\/\/(?!\/)[^\s]+/;function st(t){return t.matchAll(new RegExp(Nu.source,"g"))}var Mu=class extends Br{constructor(e,a){super();L(this,"resource");L(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(Ou,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",o=>{o.preventDefault(),o.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",o=>{o.preventDefault(),o.stopPropagation(),n(this.resource)}),e}},Pu=class extends Br{constructor(e,a){super();L(this,"uri");L(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function kn(t){let e=t.state.field(Ke),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let o of st(n)){let i=r+o.index,l=o[0].slice(1),d=e.get(l);d?a.push(Ta.replace({widget:new Mu(d,t)}).range(i,i+o[0].length)):a.push(Ta.replace({widget:new Pu(l,t)}).range(i,i+o[0].length))}}return Ta.set(a)}const ju=xi.fromClass(class{constructor(t){L(this,"decorations");this.decorations=kn(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(kr))))&&(this.decorations=kn(t.view))}},{decorations:t=>t.decorations});function Lu(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function $u(t,e,a,r=0){for(let s of st(t)){let n=r+s.index,o=n+s[0].length;if(e>=n&&e<=o){let i=s[0].slice(1),l=a.get(i);if(l)return{resource:l,start:n,end:o}}}return null}function Du(t){return wi((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=$u(s,a,e.state.field(Ke),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??Lu)(n.resource)}}:null})}function Zu(t,e){let a=t.field(Ke),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(st(n));if(o.length===0)return null;for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function Fu(t,e){let a=t.field(Ke),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),o=Array.from(st(n));if(o.length===0)return null;let i=o[0];if(!i||i.index!==0)return null;let l=e,d=e+i[0].length,u=i[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function Cn(t,e){let a=t.field(Ke),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(st(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function zu(t,e){let a=t.field(Ke),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),o=Array.from(st(n)),i=null;for(let l of o){let d=s.from+l.index,u=d+l[0].length,p=l[0].slice(1);a.has(p)&&u<=e&&(e>u?i=u:e===u&&(i=d))}return i}function Uu(t,e){let a=t.field(Ke),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),o=Array.from(st(n));for(let i of o){let l=s.from+i.index,d=l+i[0].length,u=i[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const Vu=vi.transactionFilter.of(t=>{var r;let e=t.annotation(bi.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(Ke),n=t.startState.doc,o=!1,i=0,l=[];if(t.changes.iterChanges((d,u,p,g,h)=>{let b=h.toString(),f=d;if(/^\s+$/.test(b)){l.push({from:d,to:u,insert:b});return}let c=n.lineAt(f),m=n.sliceString(c.from,c.to),_=Array.from(st(m)),E=!1,C=!1;for(let P of _){let D=c.from+P.index,M=D+P[0].length,H=P[0].slice(1);if(s.has(H)){if(f===D){let j=f>0?n.sliceString(f-1,f):"";j!==""&&j!==" "&&j!==`
`&&j!=="	"&&(E=!0)}if(f===M){let j=f<n.length?n.sliceString(f,f+1):"";(j===""||j!==" "&&j!==`
`&&j!=="	")&&(C=!0)}}}let I=b;E&&(I=` ${I}`,i+=1),C&&(I=` ${I}`,i+=1),I!==b&&(o=!0),l.push({from:d,to:u,insert:I})}),o)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+i,head:t.selection.main.head+i}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=Zu(t.startState,a.head):e==="delete.forward"&&(s=Fu(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,o=null;if(n<s){let i=Cn(t.startState,s);o=i&&s>i.from?i.from:zu(t.startState,s)}else if(n>s){let i=Cn(t.startState,s);o=i&&s<i.to?i.to:Uu(t.startState,s)}if(o!==null&&o!==n)return[{selection:{anchor:o},scrollIntoView:!0}]}return t}),qu=qr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var En="_none_",Bu=[{uri:"",name:"No resources",type:En,data:{}}],Wu={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function Ju(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:Ru(async()=>{let s=mt(a).getAllItems();return s.length===0?Bu:s},s=>{var n;return s.type===En?Wu:((n=mt(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Vr.high(Kt.of([{key:"Tab",run:s=>Ei(s)}])),mn.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:Qd().createCompletionSource()})]:[],ju,Vu,Ke.init(()=>{let s=mt(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),qu,Du({createTooltip:s=>{let n=mt(a).getProvider(s.type);if(!n)return oe.warn("No provider found for resource",s),zt(s.description||s.name);let o=n.formatCompletion(s),i=s.description||s.name;if(!(o!=null&&o.info))return zt(i);if(typeof o.info=="string")return zt(o.info);let l=o.info(o);return l?"dom"in l?{dom:l.dom}:"then"in l?(oe.warn("info is a promise. This is not supported",l),zt(i)):{dom:l}:zt(i)}})]}function zt(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var Cr=Ea(),O=ka(yi(),1);const Tn=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let o=fi()?n.metaKey:n.ctrlKey;o&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&o&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},Ku=t=>{let e=(0,Cr.c)(9),{isLoading:a,onAccept:r,onDecline:s,runCell:n}=t,o;e[0]!==a||e[1]!==r||e[2]!==n?(o=(0,O.jsx)(In,{isLoading:a,onAccept:r,size:"xs",runCell:n}),e[0]=a,e[1]=r,e[2]=n,e[3]=o):o=e[3];let i;e[4]===s?i=e[5]:(i=(0,O.jsx)(Sn,{onDecline:s,size:"xs"}),e[4]=s,e[5]=i);let l;return e[6]!==o||e[7]!==i?(l=(0,O.jsxs)(O.Fragment,{children:[o,i]}),e[6]=o,e[7]=i,e[8]=l):l=e[8],l},In=t=>{let e=(0,Cr.c)(33),{isLoading:a,onAccept:r,multipleCompletions:s,size:n,buttonStyles:o,acceptShortcut:i,runCell:l,playButtonStyles:d,borderless:u}=t,p=s===void 0?!1:s,g=n===void 0?"sm":n,h=u===void 0?!1:u,b;e[0]!==r||e[1]!==l?(b=()=>{r(),l&&l()},e[0]=r,e[1]=l,e[2]=b):b=e[2];let f=b,c=p?"Accept all":"Accept";if(l){let C=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${h&&"border-none rounded-md rounded-r-none"} ${o}`,I;e[3]===i?I=e[4]:(I=i&&(0,O.jsx)(Oa,{className:"ml-1 inline",shortcut:i}),e[3]=i,e[4]=I);let P;e[5]!==a||e[6]!==r||e[7]!==g||e[8]!==C||e[9]!==I||e[10]!==c?(P=(0,O.jsxs)(Qe,{variant:"text",size:g,disabled:a,onClick:r,className:C,children:[c,I]}),e[5]=a,e[6]=r,e[7]=g,e[8]=C,e[9]=I,e[10]=c,e[11]=P):P=e[11];let D=p?"Accept and run all cells":"Accept and run cell",M=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${h&&"border-0 border-l"} ${d}`,H;e[12]===Symbol.for("react.memo_cache_sentinel")?(H=(0,O.jsx)(Di,{className:"h-2.5 w-2.5"}),e[12]=H):H=e[12];let j;e[13]!==f||e[14]!==a||e[15]!==g||e[16]!==M?(j=(0,O.jsx)(Qe,{variant:"text",size:g,disabled:a,onClick:f,className:M,children:H}),e[13]=f,e[14]=a,e[15]=g,e[16]=M,e[17]=j):j=e[17];let F;e[18]!==j||e[19]!==D?(F=(0,O.jsx)(Bi,{content:D,children:j}),e[18]=j,e[19]=D,e[20]=F):F=e[20];let K;return e[21]!==F||e[22]!==P?(K=(0,O.jsxs)("div",{className:"flex",children:[P,F]}),e[21]=F,e[22]=P,e[23]=K):K=e[23],K}let m=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${o}`,_;e[24]===i?_=e[25]:(_=i&&(0,O.jsx)(Oa,{className:"ml-1 inline",shortcut:i}),e[24]=i,e[25]=_);let E;return e[26]!==a||e[27]!==r||e[28]!==g||e[29]!==m||e[30]!==_||e[31]!==c?(E=(0,O.jsxs)(Qe,{variant:"text",size:g,disabled:a,onClick:r,className:m,children:[c,_]}),e[26]=a,e[27]=r,e[28]=g,e[29]=m,e[30]=_,e[31]=c,e[32]=E):E=e[32],E},Sn=t=>{let e=(0,Cr.c)(8),{onDecline:a,multipleCompletions:r,size:s,className:n,declineShortcut:o,borderless:i}=t,l=r===void 0?!1:r,d=s===void 0?"sm":s,u=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${(i===void 0?!1:i)&&"border-none rounded-md"} ${n}`,p=l&&" all",g;e[0]===o?g=e[1]:(g=o&&(0,O.jsx)(Oa,{className:"ml-1 inline",shortcut:o}),e[0]=o,e[1]=g);let h;return e[2]!==a||e[3]!==d||e[4]!==u||e[5]!==p||e[6]!==g?(h=(0,O.jsxs)(Qe,{variant:"text",size:d,onClick:a,className:u,children:["Reject",p,g]}),e[2]=a,e[3]=d,e[4]=u,e[5]=p,e[6]=g,e[7]=h):h=e[7],h};var Yu=class extends er{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},On=Ea(),Hu=ti("marimo:ai-language","python",ai),An="marimo:ai-prompt-history",Rn=new Qn(Ve(k()),()=>[]);const Gu=t=>{let e=(0,On.c)(82),{onClose:a}=t,r=Rr(),[s,n]=(0,A.useState)(""),{deleteAllStagedCells:o,clearStagedCells:i,onStream:l,addStagedCell:d}=gn(r),[u,p]=qn(Hu),g=gi(),{invokeAiTool:h,sendRun:b}=Si(),f=Jn(Zt),c=(0,A.useRef)(null),{createNewCell:m,prepareForRun:_}=Lr(),E;e[0]!==d||e[1]!==m||e[2]!==_||e[3]!==b||e[4]!==r?(E={store:r,addStagedCell:d,createNewCell:m,prepareForRun:_,sendRun:b},e[0]=d,e[1]=m,e[2]=_,e[3]=b,e[4]=r,e[5]=E):E=e[5];let C=E,I;if(e[6]!==u||e[7]!==l||e[8]!==g){let Ee;e[10]===u?Ee=e[11]:(Ee=async qt=>{let Fn=await _n(qt.messages);return{body:{...qt,...Fn,code:"",prompt:"",language:u}}},e[10]=u,e[11]=Ee);let He;e[12]===l?He=e[13]:(He=qt=>{l(qt)},e[12]=l,e[13]=He),I=new Yu({api:g.getAiURL("completion").toString(),headers:g.headers(),prepareSendMessagesRequest:Ee},He),e[6]=u,e[7]=l,e[8]=g,e[9]=I}else I=e[9];let{sendMessage:P,stop:D,status:M,addToolOutput:H}=ln({experimental_throttle:100,transport:I,onToolCall:async Ee=>{let{toolCall:He}=Ee;await bn({invokeAiTool:h,addToolOutput:j,toolCall:{toolName:He.toolName,toolCallId:He.toolCallId,input:He.input},toolContext:C})},onError:Qu}),j=H,F=M==="streaming"||M==="submitted",K=f.size>0,X;e[14]!==o||e[15]!==s||e[16]!==F||e[17]!==P?(X=()=>{var Ee;F||((Ee=c.current)!=null&&Ee.view&&wn(c.current.view),o(),P({text:s}))},e[14]=o,e[15]=s,e[16]=F,e[17]=P,e[18]=X):X=e[18];let W=X,J;e[19]===Symbol.for("react.memo_cache_sentinel")?(J=(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(ao,{className:"size-4 mr-2"}),"Python"]}),e[19]=J):J=e[19];let te=J,ie;e[20]===Symbol.for("react.memo_cache_sentinel")?(ie=(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(Gn,{className:"size-4 mr-2"}),"SQL"]}),e[20]=ie):ie=e[20];let ae=ie,Ye=u==="python"?te:ae,ke;e[21]===Symbol.for("react.memo_cache_sentinel")?(ke=(0,O.jsx)(Ni,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[21]=ke):ke=e[21];let ye;e[22]===Ye?ye=e[23]:(ye=(0,O.jsx)(ji,{asChild:!0,children:(0,O.jsxs)(Qe,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[Ye,ke]})}),e[22]=Ye,e[23]=ye);let be,De;e[24]===Symbol.for("react.memo_cache_sentinel")?(be=(0,O.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),De=(0,O.jsx)(Pi,{}),e[24]=be,e[25]=De):(be=e[24],De=e[25]);let Ne;e[26]===p?Ne=e[27]:(Ne=(0,O.jsx)(Jr,{onClick:()=>p("python"),children:te}),e[26]=p,e[27]=Ne);let Ce;e[28]===p?Ce=e[29]:(Ce=(0,O.jsx)(Jr,{onClick:()=>p("sql"),children:ae}),e[28]=p,e[29]=Ce);let Ze;e[30]!==Ne||e[31]!==Ce?(Ze=(0,O.jsxs)(Li,{align:"center",children:[be,De,Ne,Ce]}),e[30]=Ne,e[31]=Ce,e[32]=Ze):Ze=e[32];let nt;e[33]!==ye||e[34]!==Ze?(nt=(0,O.jsxs)($i,{modal:!1,children:[ye,Ze]}),e[33]=ye,e[34]=Ze,e[35]=nt):nt=e[35];let Tt=nt,ht;e[36]!==i||e[37]!==a?(ht=()=>{i(),a()},e[36]=i,e[37]=a,e[38]=ht):ht=e[38];let Fe=ht,it;e[39]===o?it=e[40]:(it=()=>{o()},e[39]=o,e[40]=it);let B=it,U;e[41]===Symbol.for("react.memo_cache_sentinel")?(U=(0,O.jsx)(Fi,{className:"size-4 text-(--blue-11) mr-2"}),e[41]=U):U=e[41];let G;e[42]!==o||e[43]!==a?(G=()=>{o(),a()},e[42]=o,e[43]=a,e[44]=G):G=e[44];let V;e[45]===Symbol.for("react.memo_cache_sentinel")?(V=Ee=>{n(Ee)},e[45]=V):V=e[45];let me;e[46]!==Fe||e[47]!==B||e[48]!==K||e[49]!==F?(me=Tn({handleAcceptCompletion:Fe,handleDeclineCompletion:B,isLoading:F,hasCompletion:K}),e[46]=Fe,e[47]=B,e[48]=K,e[49]=F,e[50]=me):me=e[50];let he;e[51]!==s||e[52]!==W||e[53]!==G||e[54]!==me?(he=(0,O.jsx)(Nn,{inputRef:c,onClose:G,value:s,onChange:V,onSubmit:W,onKeyDown:me}),e[51]=s,e[52]=W,e[53]=G,e[54]=me,e[55]=he):he=e[55];let re;e[56]!==F||e[57]!==D?(re=F&&(0,O.jsxs)(Qe,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:D,children:[(0,O.jsx)(Zi,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[56]=F,e[57]=D,e[58]=re):re=e[58];let ne;e[59]===Symbol.for("react.memo_cache_sentinel")?(ne=(0,O.jsx)(so,{className:"size-4"}),e[59]=ne):ne=e[59];let ce;e[60]===W?ce=e[61]:(ce=(0,O.jsx)(Qe,{variant:"text",size:"sm",onClick:W,title:"Submit",children:ne}),e[60]=W,e[61]=ce);let ot;e[62]===Symbol.for("react.memo_cache_sentinel")?(ot=(0,O.jsx)(Ri,{className:"size-4"}),e[62]=ot):ot=e[62];let ze;e[63]===a?ze=e[64]:(ze=(0,O.jsx)(Qe,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:ot}),e[63]=a,e[64]=ze);let lt;e[65]!==he||e[66]!==re||e[67]!==ce||e[68]!==ze?(lt=(0,O.jsxs)("div",{className:"flex items-center px-3",children:[U,he,re,ce,ze]}),e[65]=he,e[66]=re,e[67]=ce,e[68]=ze,e[69]=lt):lt=e[69];let le=lt,fe;e[70]===Symbol.for("react.memo_cache_sentinel")?(fe=Ur("flex flex-col w-full py-2"),e[70]=fe):fe=e[70];let Me;e[71]===K?Me=e[72]:(Me=!K&&(0,O.jsx)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1 mt-2",children:(0,O.jsxs)("span",{children:["You can mention"," ",(0,O.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,O.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names. Code from other cells is automatically included."]})}),e[71]=K,e[72]=Me);let ft;e[73]===Symbol.for("react.memo_cache_sentinel")?(ft=(0,O.jsx)(Ai,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[73]=ft):ft=e[73];let Pe;e[74]===Tt?Pe=e[75]:(Pe=(0,O.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[Tt,ft]}),e[74]=Tt,e[75]=Pe);let gt;e[76]!==Me||e[77]!==Pe?(gt=(0,O.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[Me,Pe]}),e[76]=Me,e[77]=Pe,e[78]=gt):gt=e[78];let Vt;return e[79]!==le||e[80]!==gt?(Vt=(0,O.jsxs)("div",{className:fe,children:[le,gt]}),e[79]=le,e[80]=gt,e[81]=Vt):Vt=e[81],Vt},Nn=t=>{let e=(0,On.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:o,onSubmit:i,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:p,maxHeight:g}=t,h=i,b=d,f=Rr(),{theme:c}=qi(),m;e[0]===p?m=e[1]:(m=ie=>p?ru([p.triggerCompletionRegex],p.completions)(ie):null,e[0]=p,e[1]=m);let _=Bn(m),E,C,I,P;if(e[2]!==_||e[3]!==u||e[4]!==f){let ie=Vi();e[9]===Symbol.for("react.memo_cache_sentinel")?(E=Ii({}),e[9]=E):E=e[9],C=ie,I=Ju({language:ie.language,store:f,onAddFiles:u}),P=ie.language.data.of({autocomplete:_}),e[2]=_,e[3]=u,e[4]=f,e[5]=E,e[6]=C,e[7]=I,e[8]=P}else E=e[5],C=e[6],I=e[7],P=e[8];let D;e[10]===Symbol.for("react.memo_cache_sentinel")?(D=Su({storage:{load:Xu,save:ec}}),e[10]=D):D=e[10];let M;e[11]===Symbol.for("react.memo_cache_sentinel")?(M=eo(),e[11]=M):M=e[11];let H;e[12]===h?H=e[13]:(H=Vr.highest(Kt.of([{preventDefault:!0,stopPropagation:!0,any:(ie,ae)=>{let Ye=ae.metaKey||ae.ctrlKey||ae.shiftKey;if(ae.key==="Enter"&&!Ye)return h(ae,ie.state.doc.toString()),ae.preventDefault(),ae.stopPropagation(),!0;if(ae.key==="Enter"&&ae.shiftKey){let ke=ie.state.selection.main.from;return ie.dispatch({changes:{from:ke,to:ke,insert:`
`},selection:{anchor:ke+1,head:ke+1}}),ae.preventDefault(),ae.stopPropagation(),!0}return!1}}])),e[12]=h,e[13]=H);let j;e[14]===b?j=e[15]:(j=Kt.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(b(),!0)}]),e[14]=b,e[15]=j);let F;e[16]!==E||e[17]!==C||e[18]!==I||e[19]!==P||e[20]!==H||e[21]!==j?(F=[E,C,I,P,D,qr.lineWrapping,M,H,j],e[16]=E,e[17]=C,e[18]=I,e[19]=P,e[20]=H,e[21]=j,e[22]=F):F=e[22];let K=F,X;e[23]===n?X=e[24]:(X=Ur("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=X);let W=c==="dark"?"dark":"light",J=r||"Generate with AI, @ to include context",te;return e[25]!==K||e[26]!==s||e[27]!==g||e[28]!==o||e[29]!==l||e[30]!==X||e[31]!==W||e[32]!==J||e[33]!==a?(te=(0,O.jsx)(to,{ref:s,className:X,width:"100%",maxHeight:g,value:a,basicSetup:!1,extensions:K,onChange:o,onKeyDown:l,theme:W,placeholder:J}),e[25]=K,e[26]=s,e[27]=g,e[28]=o,e[29]=l,e[30]=X,e[31]=W,e[32]=J,e[33]=a,e[34]=te):te=e[34],te};function Qu(t){Kr({title:"Generate with AI failed",description:Ji(t)})}function Xu(){return Rn.get(An)}function ec(t){return Rn.set(An,t)}export{mt as C,Xl as D,er as E,no as O,eu as S,Ud as T,Zt as _,Sn as a,Xd as b,_n as c,bn as d,ku as f,_r as g,vu as h,Ku as i,ro as k,bu as l,br as m,Nn as n,Tn as o,xu as p,In as r,wn as s,Gu as t,_u as u,fn as v,ln as w,su as x,gn as y};
