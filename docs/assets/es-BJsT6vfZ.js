import{i as W}from"./useEvent-DlWF5OMa.js";import{bn as B,ri as $,y as G}from"./cells-CmJW_FeD.js";import{t as v}from"./requests-C0HaHO6a.js";function R({moduleName:e,variableName:t,onAddImport:r,appStore:n=W}){if(t in n.get(B))return!1;let{cellData:a,cellIds:i}=n.get(G),o=RegExp(`import[ 	]+${e}[ 	]+as[ 	]+${t}`,"g");for(let l of i.inOrderIds)if(o.test(a[l].code))return!1;return r(`import ${e} as ${t}`),!0}function Q({autoInstantiate:e,createNewCell:t,fromCellId:r,before:n}){let a=v(),i=null;return R({moduleName:"marimo",variableName:"mo",onAddImport:o=>{i=$.create(),t({cellId:r??"__end__",before:n??!1,code:o,lastCodeRun:e?o:void 0,newCellId:i,skipIfCodeExists:!0,autoFocus:!1}),e&&a.sendRun({cellIds:[i],codes:[o]})}})?i:null}function X({autoInstantiate:e,createNewCell:t,fromCellId:r}){let n=v(),a=null;return R({moduleName:"altair",variableName:"alt",onAddImport:i=>{a=$.create(),t({cellId:r??"__end__",before:!1,code:i,lastCodeRun:e?i:void 0,newCellId:a,skipIfCodeExists:!0,autoFocus:!1}),e&&n.sendRun({cellIds:[a],codes:[i]})}})?a:null}function J(e,t){if(e.match(/^[a-z]+:\/\//i))return e;if(e.match(/^\/\//))return window.location.protocol+e;if(e.match(/^[a-z]+:/i))return e;let r=document.implementation.createHTMLDocument(),n=r.createElement("base"),a=r.createElement("a");return r.head.appendChild(n),r.body.appendChild(a),t&&(n.href=t),a.href=e,a.href}const K=(()=>{let e=0,t=()=>`0000${(Math.random()*36**4<<0).toString(36)}`.slice(-4);return()=>(e+=1,`u${t()}${e}`)})();function d(e){let t=[];for(let r=0,n=e.length;r<n;r++)t.push(e[r]);return t}var g=null;function I(e={}){return g||(e.includeStyleProperties?(g=e.includeStyleProperties,g):(g=d(window.getComputedStyle(document.documentElement)),g))}function p(e,t){let r=(e.ownerDocument.defaultView||window).getComputedStyle(e).getPropertyValue(t);return r?parseFloat(r.replace("px","")):0}function Y(e){let t=p(e,"border-left-width"),r=p(e,"border-right-width");return e.clientWidth+t+r}function Z(e){let t=p(e,"border-top-width"),r=p(e,"border-bottom-width");return e.clientHeight+t+r}function P(e,t={}){return{width:t.width||Y(e),height:t.height||Z(e)}}function ee(){let e,t;try{t=process}catch{}let r=t&&t.env?t.env.devicePixelRatio:null;return r&&(e=parseInt(r,10),Number.isNaN(e)&&(e=1)),e||window.devicePixelRatio||1}var u=16384;function te(e){(e.width>u||e.height>u)&&(e.width>u&&e.height>u?e.width>e.height?(e.height*=u/e.width,e.width=u):(e.width*=u/e.height,e.height=u):e.width>u?(e.height*=u/e.width,e.width=u):(e.width*=u/e.height,e.height=u))}function w(e){return new Promise((t,r)=>{let n=new Image;n.onload=()=>{n.decode().then(()=>{requestAnimationFrame(()=>t(n))})},n.onerror=r,n.crossOrigin="anonymous",n.decoding="async",n.src=e})}async function re(e){return Promise.resolve().then(()=>new XMLSerializer().serializeToString(e)).then(encodeURIComponent).then(t=>`data:image/svg+xml;charset=utf-8,${t}`)}async function ne(e,t,r){let n="http://www.w3.org/2000/svg",a=document.createElementNS(n,"svg"),i=document.createElementNS(n,"foreignObject");return a.setAttribute("width",`${t}`),a.setAttribute("height",`${r}`),a.setAttribute("viewBox",`0 0 ${t} ${r}`),i.setAttribute("width","100%"),i.setAttribute("height","100%"),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("externalResourcesRequired","true"),a.appendChild(i),i.appendChild(e),re(a)}const s=(e,t)=>{if(e instanceof t)return!0;let r=Object.getPrototypeOf(e);return r===null?!1:r.constructor.name===t.name||s(r,t)};function ae(e){let t=e.getPropertyValue("content");return`${e.cssText} content: '${t.replace(/'|"/g,"")}';`}function ie(e,t){return I(t).map(r=>`${r}: ${e.getPropertyValue(r)}${e.getPropertyPriority(r)?" !important":""};`).join(" ")}function oe(e,t,r,n){let a=`.${e}:${t}`,i=r.cssText?ae(r):ie(r,n);return document.createTextNode(`${a}{${i}}`)}function N(e,t,r,n){let a=window.getComputedStyle(e,r),i=a.getPropertyValue("content");if(i===""||i==="none")return;let o=K();try{t.className=`${t.className} ${o}`}catch{return}let l=document.createElement("style");l.appendChild(oe(o,r,a,n)),t.appendChild(l)}function le(e,t,r){N(e,t,":before",r),N(e,t,":after",r)}var T="application/font-woff",A="image/jpeg",ce={woff:T,woff2:T,ttf:"application/font-truetype",eot:"application/vnd.ms-fontobject",png:"image/png",jpg:A,jpeg:A,gif:"image/gif",tiff:"image/tiff",svg:"image/svg+xml",webp:"image/webp"};function se(e){let t=/\.([^./]*?)$/g.exec(e);return t?t[1]:""}function E(e){return ce[se(e).toLowerCase()]||""}function ue(e){return e.split(/,/)[1]}function S(e){return e.search(/^(data:)/)!==-1}function k(e,t){return`data:${t};base64,${e}`}async function L(e,t,r){let n=await fetch(e,t);if(n.status===404)throw Error(`Resource "${n.url}" not found`);let a=await n.blob();return new Promise((i,o)=>{let l=new FileReader;l.onerror=o,l.onloadend=()=>{try{i(r({res:n,result:l.result}))}catch(c){o(c)}},l.readAsDataURL(a)})}var C={};function de(e,t,r){let n=e.replace(/\?.*/,"");return r&&(n=e),/ttf|otf|eot|woff2?/i.test(n)&&(n=n.replace(/.*\//,"")),t?`[${t}]${n}`:n}async function x(e,t,r){let n=de(e,t,r.includeQueryParams);if(C[n]!=null)return C[n];r.cacheBust&&(e+=(/\?/.test(e)?"&":"?")+new Date().getTime());let a;try{a=k(await L(e,r.fetchRequestInit,({res:i,result:o})=>(t||(t=i.headers.get("Content-Type")||""),ue(o))),t)}catch(i){a=r.imagePlaceholder||"";let o=`Failed to fetch resource: ${e}`;i&&(o=typeof i=="string"?i:i.message),o&&console.warn(o)}return C[n]=a,a}async function he(e){let t=e.toDataURL();return t==="data:,"?e.cloneNode(!1):w(t)}async function fe(e,t){if(e.currentSrc){let n=document.createElement("canvas"),a=n.getContext("2d");return n.width=e.clientWidth,n.height=e.clientHeight,a==null||a.drawImage(e,0,0,n.width,n.height),w(n.toDataURL())}let r=e.poster;return w(await x(r,E(r),t))}async function me(e,t){var r;try{if((r=e==null?void 0:e.contentDocument)!=null&&r.body)return await y(e.contentDocument.body,t,!0)}catch{}return e.cloneNode(!1)}async function ge(e,t){return s(e,HTMLCanvasElement)?he(e):s(e,HTMLVideoElement)?fe(e,t):s(e,HTMLIFrameElement)?me(e,t):e.cloneNode(F(e))}var pe=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SLOT",F=e=>e.tagName!=null&&e.tagName.toUpperCase()==="SVG";async function we(e,t,r){var a;if(F(t))return t;let n=[];return n=pe(e)&&e.assignedNodes?d(e.assignedNodes()):s(e,HTMLIFrameElement)&&((a=e.contentDocument)!=null&&a.body)?d(e.contentDocument.body.childNodes):d((e.shadowRoot??e).childNodes),n.length===0||s(e,HTMLVideoElement)||await n.reduce((i,o)=>i.then(()=>y(o,r)).then(l=>{l&&t.appendChild(l)}),Promise.resolve()),t}function ye(e,t,r){let n=t.style;if(!n)return;let a=window.getComputedStyle(e);a.cssText?(n.cssText=a.cssText,n.transformOrigin=a.transformOrigin):I(r).forEach(i=>{let o=a.getPropertyValue(i);i==="font-size"&&o.endsWith("px")&&(o=`${Math.floor(parseFloat(o.substring(0,o.length-2)))-.1}px`),s(e,HTMLIFrameElement)&&i==="display"&&o==="inline"&&(o="block"),i==="d"&&t.getAttribute("d")&&(o=`path(${t.getAttribute("d")})`),n.setProperty(i,o,a.getPropertyPriority(i))})}function be(e,t){s(e,HTMLTextAreaElement)&&(t.innerHTML=e.value),s(e,HTMLInputElement)&&t.setAttribute("value",e.value)}function Ee(e,t){if(s(e,HTMLSelectElement)){let r=t,n=Array.from(r.children).find(a=>e.value===a.getAttribute("value"));n&&n.setAttribute("selected","")}}function Se(e,t,r){return s(t,Element)&&(ye(e,t,r),le(e,t,r),be(e,t),Ee(e,t)),t}async function Ce(e,t){let r=e.querySelectorAll?e.querySelectorAll("use"):[];if(r.length===0)return e;let n={};for(let i=0;i<r.length;i++){let o=r[i].getAttribute("xlink:href");if(o){let l=e.querySelector(o),c=document.querySelector(o);!l&&c&&!n[o]&&(n[o]=await y(c,t,!0))}}let a=Object.values(n);if(a.length){let i="http://www.w3.org/1999/xhtml",o=document.createElementNS(i,"svg");o.setAttribute("xmlns",i),o.style.position="absolute",o.style.width="0",o.style.height="0",o.style.overflow="hidden",o.style.display="none";let l=document.createElementNS(i,"defs");o.appendChild(l);for(let c=0;c<a.length;c++)l.appendChild(a[c]);e.appendChild(o)}return e}async function y(e,t,r){return!r&&t.filter&&!t.filter(e)?null:Promise.resolve(e).then(n=>ge(n,t)).then(n=>we(e,n,t)).then(n=>Se(e,n,t)).then(n=>Ce(n,t))}var H=/url\((['"]?)([^'"]+?)\1\)/g,xe=/url\([^)]+\)\s*format\((["']?)([^"']+)\1\)/g,$e=/src:\s*(?:url\([^)]+\)\s*format\([^)]+\)[,;]\s*)+/g;function ve(e){let t=e.replace(/([.*+?^${}()|\[\]\/\\])/g,"\\$1");return RegExp(`(url\\(['"]?)(${t})(['"]?\\))`,"g")}function Re(e){let t=[];return e.replace(H,(r,n,a)=>(t.push(a),r)),t.filter(r=>!S(r))}async function Ie(e,t,r,n,a){try{let i=r?J(t,r):t,o=E(t),l;return l=a?k(await a(i),o):await x(i,o,n),e.replace(ve(t),`$1${l}$3`)}catch{}return e}function Pe(e,{preferredFontFormat:t}){return t?e.replace($e,r=>{for(;;){let[n,,a]=xe.exec(r)||[];if(!a)return"";if(a===t)return`src: ${n};`}}):e}function M(e){return e.search(H)!==-1}async function D(e,t,r){if(!M(e))return e;let n=Pe(e,r);return Re(n).reduce((a,i)=>a.then(o=>Ie(o,i,t,r)),Promise.resolve(n))}async function f(e,t,r){var a;let n=(a=t.style)==null?void 0:a.getPropertyValue(e);if(n){let i=await D(n,null,r);return t.style.setProperty(e,i,t.style.getPropertyPriority(e)),!0}return!1}async function Ne(e,t){await f("background",e,t)||await f("background-image",e,t),await f("mask",e,t)||await f("-webkit-mask",e,t)||await f("mask-image",e,t)||await f("-webkit-mask-image",e,t)}async function Te(e,t){let r=s(e,HTMLImageElement);if(!(r&&!S(e.src))&&!(s(e,SVGImageElement)&&!S(e.href.baseVal)))return;let n=r?e.src:e.href.baseVal,a=await x(n,E(n),t);await new Promise((i,o)=>{e.onload=i,e.onerror=t.onImageErrorHandler?(...c)=>{try{i(t.onImageErrorHandler(...c))}catch(h){o(h)}}:o;let l=e;l.decode&&(l.decode=i),l.loading==="lazy"&&(l.loading="eager"),r?(e.srcset="",e.src=a):e.href.baseVal=a})}async function Ae(e,t){let r=d(e.childNodes).map(n=>V(n,t));await Promise.all(r).then(()=>e)}async function V(e,t){s(e,Element)&&(await Ne(e,t),await Te(e,t),await Ae(e,t))}function ke(e,t){let{style:r}=e;t.backgroundColor&&(r.backgroundColor=t.backgroundColor),t.width&&(r.width=`${t.width}px`),t.height&&(r.height=`${t.height}px`);let n=t.style;return n!=null&&Object.keys(n).forEach(a=>{r[a]=n[a]}),e}var O={};async function _(e){let t=O[e];return t??(t={url:e,cssText:await(await fetch(e)).text()},O[e]=t,t)}async function j(e,t){let r=e.cssText,n=/url\(["']?([^"')]+)["']?\)/g,a=(r.match(/url\([^)]+\)/g)||[]).map(async i=>{let o=i.replace(n,"$1");return o.startsWith("https://")||(o=new URL(o,e.url).href),L(o,t.fetchRequestInit,({result:l})=>(r=r.replace(i,`url(${l})`),[i,l]))});return Promise.all(a).then(()=>r)}function U(e){if(e==null)return[];let t=[],r=e.replace(/(\/\*[\s\S]*?\*\/)/gi,""),n=RegExp("((@.*?keyframes [\\s\\S]*?){([\\s\\S]*?}\\s*?)})","gi");for(;;){let o=n.exec(r);if(o===null)break;t.push(o[0])}r=r.replace(n,"");let a=/@import[\s\S]*?url\([^)]*\)[\s\S]*?;/gi,i=RegExp("((\\s*?(?:\\/\\*[\\s\\S]*?\\*\\/)?\\s*?@media[\\s\\S]*?){([\\s\\S]*?)}\\s*?})|(([\\s\\S]*?){([\\s\\S]*?)})","gi");for(;;){let o=a.exec(r);if(o===null){if(o=i.exec(r),o===null)break;a.lastIndex=i.lastIndex}else i.lastIndex=a.lastIndex;t.push(o[0])}return t}async function Le(e,t){let r=[],n=[];return e.forEach(a=>{if("cssRules"in a)try{d(a.cssRules||[]).forEach((i,o)=>{if(i.type===CSSRule.IMPORT_RULE){let l=o+1,c=i.href,h=_(c).then(m=>j(m,t)).then(m=>U(m).forEach(b=>{try{a.insertRule(b,b.startsWith("@import")?l+=1:a.cssRules.length)}catch(z){console.error("Error inserting rule from remote css",{rule:b,error:z})}})).catch(m=>{console.error("Error loading remote css",m.toString())});n.push(h)}})}catch(i){let o=e.find(l=>l.href==null)||document.styleSheets[0];a.href!=null&&n.push(_(a.href).then(l=>j(l,t)).then(l=>U(l).forEach(c=>{o.insertRule(c,o.cssRules.length)})).catch(l=>{console.error("Error loading remote stylesheet",l)})),console.error("Error inlining remote css file",i)}}),Promise.all(n).then(()=>(e.forEach(a=>{if("cssRules"in a)try{d(a.cssRules||[]).forEach(i=>{r.push(i)})}catch(i){console.error(`Error while reading CSS rules from ${a.href}`,i)}}),r))}function Fe(e){return e.filter(t=>t.type===CSSRule.FONT_FACE_RULE).filter(t=>M(t.style.getPropertyValue("src")))}async function He(e,t){if(e.ownerDocument==null)throw Error("Provided element is not within a Document");return Fe(await Le(d(e.ownerDocument.styleSheets),t))}function q(e){return e.trim().replace(/["']/g,"")}function Me(e){let t=new Set;function r(n){(n.style.fontFamily||getComputedStyle(n).fontFamily).split(",").forEach(a=>{t.add(q(a))}),Array.from(n.children).forEach(a=>{a instanceof HTMLElement&&r(a)})}return r(e),t}async function De(e,t){let r=await He(e,t),n=Me(e);return(await Promise.all(r.filter(a=>n.has(q(a.style.fontFamily))).map(a=>{let i=a.parentStyleSheet?a.parentStyleSheet.href:null;return D(a.cssText,i,t)}))).join(`
`)}async function Ve(e,t){let r=t.fontEmbedCSS==null?t.skipFonts?null:await De(e,t):t.fontEmbedCSS;if(r){let n=document.createElement("style"),a=document.createTextNode(r);n.appendChild(a),e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n)}}async function Oe(e,t={}){let{width:r,height:n}=P(e,t),a=await y(e,t,!0);return await Ve(a,t),await V(a,t),ke(a,t),await ne(a,r,n)}async function _e(e,t={}){let{width:r,height:n}=P(e,t),a=await w(await Oe(e,t)),i=document.createElement("canvas"),o=i.getContext("2d"),l=t.pixelRatio||ee(),c=t.canvasWidth||r,h=t.canvasHeight||n;return i.width=c*l,i.height=h*l,t.skipAutoScale||te(i),i.style.width=`${c}`,i.style.height=`${h}`,t.backgroundColor&&(o.fillStyle=t.backgroundColor,o.fillRect(0,0,i.width,i.height)),o.drawImage(a,0,0,i.width,i.height),i}async function je(e,t={}){return(await _e(e,t)).toDataURL()}export{X as n,Q as r,je as t};
