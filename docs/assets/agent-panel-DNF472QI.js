var fn=Object.defineProperty;var Ca=t=>{throw TypeError(t)};var gn=(t,e,a)=>e in t?fn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var H=(t,e,a)=>gn(t,typeof e!="symbol"?e+"":e,a),qt=(t,e,a)=>e.has(t)||Ca("Cannot "+a);var te=(t,e,a)=>(qt(t,e,"read from private field"),a?a.call(t):e.get(t)),Oe=(t,e,a)=>e.has(t)?Ca("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,a),Be=(t,e,a,s)=>(qt(t,e,"write to private field"),s?s.call(t,a):e.set(t,a),a),Te=(t,e,a)=>(qt(t,e,"access private method"),a);var Ia=(t,e,a,s)=>({set _(n){Be(t,e,n,a)},get _(){return te(t,e,s)}});var he,en,at,Lt,mt,pt,st,nt,ce,cn,dn,un,mn,pn,ut,tn;import{s as Ta}from"./chunk-LvLJmgfZ.js";import{d as Aa,i as Wt,l as ft,n as oe,p as xn,u as Ra}from"./useEvent-DlWF5OMa.js";import{t as vn}from"./react-BGmjiNul.js";import{G as yn,In as _n,Jn as Vt,Jr as Bt,Un as bn,Zr as wn,_n as kn,ln as jn,on as Nn,zt as Kt}from"./cells-CmJW_FeD.js";import"./react-dom-C9fstfnp.js";import{P as Sn,R as Jt}from"./zod-Cg4WLWh2.js";import{t as be}from"./compiler-runtime-DeeZ7FnK.js";import{i as Cn}from"./useLifecycle-CmDXEyIC.js";import{t as Ht}from"./capitalize-DQeWKRGx.js";import"./tooltip-CrRUCOBw.js";import{c as In,d as Ge,f as Ma}from"./hotkeys-uKX61F1_.js";import"./config-CENq_7Pd.js";import{t as Tn}from"./jsx-runtime-DN_bIXfG.js";import{t as le}from"./button-B8cGZzP5.js";import{t as xe}from"./cn-C1rgT0yh.js";import{at as An}from"./dist-CAcX026F.js";import{E as Oa,t as Ea}from"./JsonOutput-DlwRx3jE.js";import{f as Rn}from"./once-CTiSlR1m.js";import"./cjs-Bj40p_Np.js";import"./main-CwSdzVhm.js";import"./useNonce-EAuSVK-5.js";import{r as Mn}from"./requests-C0HaHO6a.js";import{t as rt}from"./createLucideIcon-CW2xpJ57.js";import{C as On,O as En,k as Zn,m as Pn,n as $n,x as Fn}from"./add-cell-with-ai-DEdol3w0.js";import{i as gt,n as Un,r as zn}from"./chat-components-BQ_d4LQG.js";import{i as xt}from"./ai-model-dropdown-C-5PlP5A.js";import{_ as Dn,a as Za,h as Pa,i as $a,n as Fa,r as Ua,s as za,t as Da}from"./select-D9lTzMzP.js";import"./download-C_slsU-7.js";import{t as La}from"./markdown-renderer-DjqhqmES.js";import{t as qa}from"./circle-check-big-OIMTUpe6.js";import{a as Ln,d as qn,f as Wn,p as Vn,r as Bn,s as Kn,t as Jn,u as Hn}from"./dropdown-menu-BP4_BZLr.js";import{i as Yn,n as Gn,r as Qn,t as Xn}from"./file-video-camera-CZUg-nFA.js";import{t as er}from"./file-BnFXtaZZ.js";import{n as tr,t as Yt}from"./spinner-C1czjtp7.js";import{a as ar}from"./MarimoErrorOutput-DAK6volb.js";import{t as sr}from"./plug-Bp1OpH-w.js";import{t as nr}from"./refresh-cw-Din9uFKE.js";import{t as Wa}from"./rotate-ccw-CF2xzGPz.js";import{r as rr}from"./input-Bkl2Yfmh.js";import{t as ir}from"./square-leQTJTJJ.js";import{c as or}from"./datasource-CCq9qyVG.js";import{t as lr}from"./badge-DAnNhy3O.js";import"./dist-HGZzCB0y.js";import"./dist-CVj-_Iiz.js";import"./dist-BVf1IY4_.js";import"./dist-Cq_4nPfh.js";import"./dist-RKnr9SNh.js";import{t as cr}from"./uuid-ClFZlR7U.js";import{t as vt}from"./use-toast-Bzf3rpev.js";import{r as dr}from"./useTheme-BSVRc0kJ.js";import"./Combination-D1TsGrBC.js";import{i as ur,t as yt}from"./tooltip-CvjcEpZC.js";import"./dates-CdsE1R40.js";import{i as Va,r as Ba,t as Ka}from"./popover-DtnzNVk-.js";import"./vega-loader.browser-C8wT63Va.js";import"./defaultLocale-BLUna9fQ.js";import"./defaultLocale-DzliDDTm.js";import{t as mr}from"./copy-icon-jWsqdLn1.js";import"./purify.es-N-2faAGj.js";import{a as pr,i as hr,n as fr,r as gr}from"./multi-map-CQd4MZr5.js";import{a as xr}from"./cell-link-D7bPw7Fz.js";import{n as vr}from"./error-banner-Cq4Yn1WZ.js";import"./chunk-OGVTOU66-DQphfHw1.js";import"./katex-dFZM4X_7.js";import"./marked.esm-BZNXs5FA.js";import"./es-BJsT6vfZ.js";import{t as yr}from"./esm-D2_Kx6xF.js";import{n as _r}from"./dist-vjCyCXRJ.js";import{t as Ja}from"./empty-state-H6r25Wek.js";import{t as br}from"./state-D4d80DfQ.js";var wr=rt("arrow-down",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]),kr=rt("circle-stop",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["rect",{x:"9",y:"9",width:"6",height:"6",rx:"1",key:"1ssd4o"}]]),jr=rt("shield-check",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),it=rt("wifi-off",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}],["path",{d:"M5 12.859a10 10 0 0 1 5.17-2.69",key:"1dl1wf"}],["path",{d:"M19 12.859a10 10 0 0 0-2.007-1.523",key:"4k23kn"}],["path",{d:"M2 8.82a15 15 0 0 1 4.177-2.643",key:"1grhjp"}],["path",{d:"M22 8.82a15 15 0 0 0-11.288-3.764",key:"z3jwby"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]),Gt=rt("wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]),q;(function(t){t.assertEqual=n=>{};function e(n){}t.assertIs=e;function a(n){throw Error()}t.assertNever=a,t.arrayToEnum=n=>{let i={};for(let r of n)i[r]=r;return i},t.getValidEnumValues=n=>{let i=t.objectKeys(n).filter(l=>typeof n[n[l]]!="number"),r={};for(let l of i)r[l]=n[l];return t.objectValues(r)},t.objectValues=n=>t.objectKeys(n).map(function(i){return n[i]}),t.objectKeys=typeof Object.keys=="function"?n=>Object.keys(n):n=>{let i=[];for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&i.push(r);return i},t.find=(n,i)=>{for(let r of n)if(i(r))return r},t.isInteger=typeof Number.isInteger=="function"?n=>Number.isInteger(n):n=>typeof n=="number"&&Number.isFinite(n)&&Math.floor(n)===n;function s(n,i=" | "){return n.map(r=>typeof r=="string"?`'${r}'`:r).join(i)}t.joinValues=s,t.jsonStringifyReplacer=(n,i)=>typeof i=="bigint"?i.toString():i})(q||(q={}));var Nr;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(Nr||(Nr={}));const S=q.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),Ue=t=>{switch(typeof t){case"undefined":return S.undefined;case"string":return S.string;case"number":return Number.isNaN(t)?S.nan:S.number;case"boolean":return S.boolean;case"function":return S.function;case"bigint":return S.bigint;case"symbol":return S.symbol;case"object":return Array.isArray(t)?S.array:t===null?S.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?S.promise:typeof Map<"u"&&t instanceof Map?S.map:typeof Set<"u"&&t instanceof Set?S.set:typeof Date<"u"&&t instanceof Date?S.date:S.object;default:return S.unknown}},g=q.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var ve=class an extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=s=>{this.issues=[...this.issues,s]},this.addIssues=(s=[])=>{this.issues=[...this.issues,...s]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(i){return i.message},s={_errors:[]},n=i=>{for(let r of i.issues)if(r.code==="invalid_union")r.unionErrors.map(n);else if(r.code==="invalid_return_type")n(r.returnTypeError);else if(r.code==="invalid_arguments")n(r.argumentsError);else if(r.path.length===0)s._errors.push(a(r));else{let l=s,c=0;for(;c<r.path.length;){let d=r.path[c];c===r.path.length-1?(l[d]=l[d]||{_errors:[]},l[d]._errors.push(a(r))):l[d]=l[d]||{_errors:[]},l=l[d],c++}}};return n(this),s}static assert(e){if(!(e instanceof an))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,q.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},s=[];for(let n of this.issues)if(n.path.length>0){let i=n.path[0];a[i]=a[i]||[],a[i].push(e(n))}else s.push(e(n));return{formErrors:s,fieldErrors:a}}get formErrors(){return this.flatten()}};ve.create=t=>new ve(t);var ot=(t,e)=>{let a;switch(t.code){case g.invalid_type:a=t.received===S.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case g.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,q.jsonStringifyReplacer)}`;break;case g.unrecognized_keys:a=`Unrecognized key(s) in object: ${q.joinValues(t.keys,", ")}`;break;case g.invalid_union:a="Invalid input";break;case g.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${q.joinValues(t.options)}`;break;case g.invalid_enum_value:a=`Invalid enum value. Expected ${q.joinValues(t.options)}, received '${t.received}'`;break;case g.invalid_arguments:a="Invalid function arguments";break;case g.invalid_return_type:a="Invalid function return type";break;case g.invalid_date:a="Invalid date";break;case g.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:q.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case g.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case g.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case g.custom:a="Invalid input";break;case g.invalid_intersection_types:a="Intersection results could not be merged";break;case g.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case g.not_finite:a="Number must be finite";break;default:a=e.defaultError,q.assertNever(t)}return{message:a}},Sr=ot;function Qt(){return Sr}const Xt=t=>{let{data:e,path:a,errorMaps:s,issueData:n}=t,i=[...a,...n.path||[]],r={...n,path:i};if(n.message!==void 0)return{...n,path:i,message:n.message};let l="",c=s.filter(d=>!!d).slice().reverse();for(let d of c)l=d(r,{data:e,defaultError:l}).message;return{...n,path:i,message:l}};function k(t,e){let a=Qt(),s=Xt({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===ot?void 0:ot].filter(n=>!!n)});t.common.issues.push(s)}var fe=class sn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let s=[];for(let n of a){if(n.status==="aborted")return E;n.status==="dirty"&&e.dirty(),s.push(n.value)}return{status:e.value,value:s}}static async mergeObjectAsync(e,a){let s=[];for(let n of a){let i=await n.key,r=await n.value;s.push({key:i,value:r})}return sn.mergeObjectSync(e,s)}static mergeObjectSync(e,a){let s={};for(let n of a){let{key:i,value:r}=n;if(i.status==="aborted"||r.status==="aborted")return E;i.status==="dirty"&&e.dirty(),r.status==="dirty"&&e.dirty(),i.value!=="__proto__"&&(r.value!==void 0||n.alwaysSet)&&(s[i.value]=r.value)}return{status:e.value,value:s}}};const E=Object.freeze({status:"aborted"}),ea=t=>({status:"dirty",value:t}),pe=t=>({status:"valid",value:t}),Ha=t=>t.status==="aborted",Ya=t=>t.status==="dirty",Qe=t=>t.status==="valid",_t=t=>typeof Promise<"u"&&t instanceof Promise;var T;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(T||(T={}));var Ae=class{constructor(t,e,a,s){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=s}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},Ga=(t,e)=>{if(Qe(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new ve(t.common.issues)),this._error}}};function $(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:s,description:n}=t;if(e&&(a||s))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:n}:{errorMap:(i,r)=>{let{message:l}=t;return i.code==="invalid_enum_value"?{message:l??r.defaultError}:r.data===void 0?{message:l??s??r.defaultError}:i.code==="invalid_type"?{message:l??a??r.defaultError}:{message:r.defaultError}},description:n}}var D=class{get description(){return this._def.description}_getType(t){return Ue(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:Ue(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new fe,ctx:{common:t.parent.common,data:t.data,parsedType:Ue(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(_t(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ue(t)};return Ga(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,s;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ue(t)};if(!this["~standard"].async)try{let n=this._parseSync({data:t,path:[],parent:e});return Qe(n)?{value:n.value}:{issues:e.common.issues}}catch(n){(s=(a=n==null?void 0:n.message)==null?void 0:a.toLowerCase())!=null&&s.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(n=>Qe(n)?{value:n.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:Ue(t)},s=this._parse({data:t,path:a.path,parent:a});return Ga(a,await(_t(s)?s:Promise.resolve(s)))}refine(t,e){let a=s=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(s):e;return this._refinement((s,n)=>{let i=t(s),r=()=>n.addIssue({code:g.custom,...a(s)});return typeof Promise<"u"&&i instanceof Promise?i.then(l=>l?!0:(r(),!1)):i?!0:(r(),!1)})}refinement(t,e){return this._refinement((a,s)=>t(a)?!0:(s.addIssue(typeof e=="function"?e(a,s):e),!1))}_refinement(t){return new Ee({schema:this,typeName:Z.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Ze.create(this,this._def)}nullable(){return Je.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return et.create(this)}promise(){return lt.create(this,this._def)}or(t){return jt.create([this,t],this._def)}and(t){return Nt.create(this,t,this._def)}transform(t){return new Ee({...$(this._def),schema:this,typeName:Z.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new At({...$(this._def),innerType:this,defaultValue:e,typeName:Z.ZodDefault})}brand(){return new as({typeName:Z.ZodBranded,type:this,...$(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new Rt({...$(this._def),innerType:this,catchValue:e,typeName:Z.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return ss.create(this,t)}readonly(){return Mt.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},Cr=/^c[^\s-]{8,}$/i,Ir=/^[0-9a-z]+$/,Tr=/^[0-9A-HJKMNP-TV-Z]{26}$/i,Ar=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,Rr=/^[a-z0-9_-]{21}$/i,Mr=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Or=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,Er=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Zr="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",Qa,Pr=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,$r=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Fr=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,Ur=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,zr=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Dr=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,Xa="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",Lr=RegExp(`^${Xa}$`);function es(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function qr(t){return RegExp(`^${es(t)}$`)}function Wr(t){let e=`${Xa}T${es(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function Vr(t,e){return!!((e==="v4"||!e)&&Pr.test(t)||(e==="v6"||!e)&&Fr.test(t))}function Br(t,e){if(!Mr.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let s=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),n=JSON.parse(atob(s));return!(typeof n!="object"||!n||"typ"in n&&(n==null?void 0:n.typ)!=="JWT"||!n.alg||e&&n.alg!==e)}catch{return!1}}function Kr(t,e){return!!((e==="v4"||!e)&&$r.test(t)||(e==="v6"||!e)&&Ur.test(t))}var bt=class dt extends D{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==S.string){let n=this._getOrReturnCtx(e);return k(n,{code:g.invalid_type,expected:S.string,received:n.parsedType}),E}let a=new fe,s;for(let n of this._def.checks)if(n.kind==="min")e.data.length<n.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:g.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="max")e.data.length>n.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:g.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!1,message:n.message}),a.dirty());else if(n.kind==="length"){let i=e.data.length>n.value,r=e.data.length<n.value;(i||r)&&(s=this._getOrReturnCtx(e,s),i?k(s,{code:g.too_big,maximum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}):r&&k(s,{code:g.too_small,minimum:n.value,type:"string",inclusive:!0,exact:!0,message:n.message}),a.dirty())}else if(n.kind==="email")Er.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"email",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="emoji")Qa||(Qa=new RegExp(Zr,"u")),Qa.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"emoji",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="uuid")Ar.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"uuid",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="nanoid")Rr.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"nanoid",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid")Cr.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"cuid",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="cuid2")Ir.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"cuid2",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="ulid")Tr.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"ulid",code:g.invalid_string,message:n.message}),a.dirty());else if(n.kind==="url")try{new URL(e.data)}catch{s=this._getOrReturnCtx(e,s),k(s,{validation:"url",code:g.invalid_string,message:n.message}),a.dirty()}else n.kind==="regex"?(n.regex.lastIndex=0,n.regex.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"regex",code:g.invalid_string,message:n.message}),a.dirty())):n.kind==="trim"?e.data=e.data.trim():n.kind==="includes"?e.data.includes(n.value,n.position)||(s=this._getOrReturnCtx(e,s),k(s,{code:g.invalid_string,validation:{includes:n.value,position:n.position},message:n.message}),a.dirty()):n.kind==="toLowerCase"?e.data=e.data.toLowerCase():n.kind==="toUpperCase"?e.data=e.data.toUpperCase():n.kind==="startsWith"?e.data.startsWith(n.value)||(s=this._getOrReturnCtx(e,s),k(s,{code:g.invalid_string,validation:{startsWith:n.value},message:n.message}),a.dirty()):n.kind==="endsWith"?e.data.endsWith(n.value)||(s=this._getOrReturnCtx(e,s),k(s,{code:g.invalid_string,validation:{endsWith:n.value},message:n.message}),a.dirty()):n.kind==="datetime"?Wr(n).test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{code:g.invalid_string,validation:"datetime",message:n.message}),a.dirty()):n.kind==="date"?Lr.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{code:g.invalid_string,validation:"date",message:n.message}),a.dirty()):n.kind==="time"?qr(n).test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{code:g.invalid_string,validation:"time",message:n.message}),a.dirty()):n.kind==="duration"?Or.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"duration",code:g.invalid_string,message:n.message}),a.dirty()):n.kind==="ip"?Vr(e.data,n.version)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"ip",code:g.invalid_string,message:n.message}),a.dirty()):n.kind==="jwt"?Br(e.data,n.alg)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"jwt",code:g.invalid_string,message:n.message}),a.dirty()):n.kind==="cidr"?Kr(e.data,n.version)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"cidr",code:g.invalid_string,message:n.message}),a.dirty()):n.kind==="base64"?zr.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"base64",code:g.invalid_string,message:n.message}),a.dirty()):n.kind==="base64url"?Dr.test(e.data)||(s=this._getOrReturnCtx(e,s),k(s,{validation:"base64url",code:g.invalid_string,message:n.message}),a.dirty()):q.assertNever(n);return{status:a.value,value:e.data}}_regex(e,a,s){return this.refinement(n=>e.test(n),{validation:a,code:g.invalid_string,...T.errToObj(s)})}_addCheck(e){return new dt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...T.errToObj(e)})}url(e){return this._addCheck({kind:"url",...T.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...T.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...T.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...T.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...T.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...T.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...T.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...T.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...T.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...T.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...T.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...T.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...T.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...T.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...T.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...T.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...T.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...T.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...T.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...T.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...T.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...T.errToObj(a)})}nonempty(e){return this.min(1,T.errToObj(e))}trim(){return new dt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new dt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new dt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};bt.create=t=>new bt({checks:[],typeName:Z.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...$(t)});function Jr(t,e){let a=(t.toString().split(".")[1]||"").length,s=(e.toString().split(".")[1]||"").length,n=a>s?a:s;return Number.parseInt(t.toFixed(n).replace(".",""))%Number.parseInt(e.toFixed(n).replace(".",""))/10**n}var ta=class wa extends D{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==S.number){let n=this._getOrReturnCtx(e);return k(n,{code:g.invalid_type,expected:S.number,received:n.parsedType}),E}let a,s=new fe;for(let n of this._def.checks)n.kind==="int"?q.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:g.invalid_type,expected:"integer",received:"float",message:n.message}),s.dirty()):n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),k(a,{code:g.too_small,minimum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),s.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),k(a,{code:g.too_big,maximum:n.value,type:"number",inclusive:n.inclusive,exact:!1,message:n.message}),s.dirty()):n.kind==="multipleOf"?Jr(e.data,n.value)!==0&&(a=this._getOrReturnCtx(e,a),k(a,{code:g.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):n.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),k(a,{code:g.not_finite,message:n.message}),s.dirty()):q.assertNever(n);return{status:s.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,T.toString(a))}gt(e,a){return this.setLimit("min",e,!1,T.toString(a))}lte(e,a){return this.setLimit("max",e,!0,T.toString(a))}lt(e,a){return this.setLimit("max",e,!1,T.toString(a))}setLimit(e,a,s,n){return new wa({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:s,message:T.toString(n)}]})}_addCheck(e){return new wa({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:T.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:T.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:T.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:T.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:T.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&q.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let s of this._def.checks){if(s.kind==="finite"||s.kind==="int"||s.kind==="multipleOf")return!0;s.kind==="min"?(a===null||s.value>a)&&(a=s.value):s.kind==="max"&&(e===null||s.value<e)&&(e=s.value)}return Number.isFinite(a)&&Number.isFinite(e)}};ta.create=t=>new ta({checks:[],typeName:Z.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...$(t)});var aa=class ka extends D{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==S.bigint)return this._getInvalidInput(e);let a,s=new fe;for(let n of this._def.checks)n.kind==="min"?(n.inclusive?e.data<n.value:e.data<=n.value)&&(a=this._getOrReturnCtx(e,a),k(a,{code:g.too_small,type:"bigint",minimum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty()):n.kind==="max"?(n.inclusive?e.data>n.value:e.data>=n.value)&&(a=this._getOrReturnCtx(e,a),k(a,{code:g.too_big,type:"bigint",maximum:n.value,inclusive:n.inclusive,message:n.message}),s.dirty()):n.kind==="multipleOf"?e.data%n.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),k(a,{code:g.not_multiple_of,multipleOf:n.value,message:n.message}),s.dirty()):q.assertNever(n);return{status:s.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return k(a,{code:g.invalid_type,expected:S.bigint,received:a.parsedType}),E}gte(e,a){return this.setLimit("min",e,!0,T.toString(a))}gt(e,a){return this.setLimit("min",e,!1,T.toString(a))}lte(e,a){return this.setLimit("max",e,!0,T.toString(a))}lt(e,a){return this.setLimit("max",e,!1,T.toString(a))}setLimit(e,a,s,n){return new ka({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:s,message:T.toString(n)}]})}_addCheck(e){return new ka({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:T.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:T.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:T.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:T.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:T.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};aa.create=t=>new aa({checks:[],typeName:Z.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...$(t)});var sa=class extends D{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==S.boolean){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.boolean,received:e.parsedType}),E}return pe(t.data)}};sa.create=t=>new sa({typeName:Z.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...$(t)});var na=class nn extends D{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==S.date){let n=this._getOrReturnCtx(e);return k(n,{code:g.invalid_type,expected:S.date,received:n.parsedType}),E}if(Number.isNaN(e.data.getTime()))return k(this._getOrReturnCtx(e),{code:g.invalid_date}),E;let a=new fe,s;for(let n of this._def.checks)n.kind==="min"?e.data.getTime()<n.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:g.too_small,message:n.message,inclusive:!0,exact:!1,minimum:n.value,type:"date"}),a.dirty()):n.kind==="max"?e.data.getTime()>n.value&&(s=this._getOrReturnCtx(e,s),k(s,{code:g.too_big,message:n.message,inclusive:!0,exact:!1,maximum:n.value,type:"date"}),a.dirty()):q.assertNever(n);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new nn({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:T.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:T.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};na.create=t=>new na({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:Z.ZodDate,...$(t)});var ra=class extends D{_parse(t){if(this._getType(t)!==S.symbol){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.symbol,received:e.parsedType}),E}return pe(t.data)}};ra.create=t=>new ra({typeName:Z.ZodSymbol,...$(t)});var wt=class extends D{_parse(t){if(this._getType(t)!==S.undefined){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.undefined,received:e.parsedType}),E}return pe(t.data)}};wt.create=t=>new wt({typeName:Z.ZodUndefined,...$(t)});var kt=class extends D{_parse(t){if(this._getType(t)!==S.null){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.null,received:e.parsedType}),E}return pe(t.data)}};kt.create=t=>new kt({typeName:Z.ZodNull,...$(t)});var ia=class extends D{constructor(){super(...arguments),this._any=!0}_parse(t){return pe(t.data)}};ia.create=t=>new ia({typeName:Z.ZodAny,...$(t)});var Xe=class extends D{constructor(){super(...arguments),this._unknown=!0}_parse(t){return pe(t.data)}};Xe.create=t=>new Xe({typeName:Z.ZodUnknown,...$(t)});var ze=class extends D{_parse(t){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.never,received:e.parsedType}),E}};ze.create=t=>new ze({typeName:Z.ZodNever,...$(t)});var oa=class extends D{_parse(t){if(this._getType(t)!==S.undefined){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.void,received:e.parsedType}),E}return pe(t.data)}};oa.create=t=>new oa({typeName:Z.ZodVoid,...$(t)});var et=class zt extends D{_parse(e){let{ctx:a,status:s}=this._processInputParams(e),n=this._def;if(a.parsedType!==S.array)return k(a,{code:g.invalid_type,expected:S.array,received:a.parsedType}),E;if(n.exactLength!==null){let r=a.data.length>n.exactLength.value,l=a.data.length<n.exactLength.value;(r||l)&&(k(a,{code:r?g.too_big:g.too_small,minimum:l?n.exactLength.value:void 0,maximum:r?n.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:n.exactLength.message}),s.dirty())}if(n.minLength!==null&&a.data.length<n.minLength.value&&(k(a,{code:g.too_small,minimum:n.minLength.value,type:"array",inclusive:!0,exact:!1,message:n.minLength.message}),s.dirty()),n.maxLength!==null&&a.data.length>n.maxLength.value&&(k(a,{code:g.too_big,maximum:n.maxLength.value,type:"array",inclusive:!0,exact:!1,message:n.maxLength.message}),s.dirty()),a.common.async)return Promise.all([...a.data].map((r,l)=>n.type._parseAsync(new Ae(a,r,a.path,l)))).then(r=>fe.mergeArray(s,r));let i=[...a.data].map((r,l)=>n.type._parseSync(new Ae(a,r,a.path,l)));return fe.mergeArray(s,i)}get element(){return this._def.type}min(e,a){return new zt({...this._def,minLength:{value:e,message:T.toString(a)}})}max(e,a){return new zt({...this._def,maxLength:{value:e,message:T.toString(a)}})}length(e,a){return new zt({...this._def,exactLength:{value:e,message:T.toString(a)}})}nonempty(e){return this.min(1,e)}};et.create=(t,e)=>new et({type:t,minLength:null,maxLength:null,exactLength:null,typeName:Z.ZodArray,...$(e)});function tt(t){if(t instanceof we){let e={};for(let a in t.shape){let s=t.shape[a];e[a]=Ze.create(tt(s))}return new we({...t._def,shape:()=>e})}else return t instanceof et?new et({...t._def,type:tt(t.element)}):t instanceof Ze?Ze.create(tt(t.unwrap())):t instanceof Je?Je.create(tt(t.unwrap())):t instanceof Ke?Ke.create(t.items.map(e=>tt(e))):t}var we=class Ne extends D{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:q.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==S.object){let c=this._getOrReturnCtx(e);return k(c,{code:g.invalid_type,expected:S.object,received:c.parsedType}),E}let{status:a,ctx:s}=this._processInputParams(e),{shape:n,keys:i}=this._getCached(),r=[];if(!(this._def.catchall instanceof ze&&this._def.unknownKeys==="strip"))for(let c in s.data)i.includes(c)||r.push(c);let l=[];for(let c of i){let d=n[c],u=s.data[c];l.push({key:{status:"valid",value:c},value:d._parse(new Ae(s,u,s.path,c)),alwaysSet:c in s.data})}if(this._def.catchall instanceof ze){let c=this._def.unknownKeys;if(c==="passthrough")for(let d of r)l.push({key:{status:"valid",value:d},value:{status:"valid",value:s.data[d]}});else if(c==="strict")r.length>0&&(k(s,{code:g.unrecognized_keys,keys:r}),a.dirty());else if(c!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let c=this._def.catchall;for(let d of r){let u=s.data[d];l.push({key:{status:"valid",value:d},value:c._parse(new Ae(s,u,s.path,d)),alwaysSet:d in s.data})}}return s.common.async?Promise.resolve().then(async()=>{let c=[];for(let d of l){let u=await d.key,m=await d.value;c.push({key:u,value:m,alwaysSet:d.alwaysSet})}return c}).then(c=>fe.mergeObjectSync(a,c)):fe.mergeObjectSync(a,l)}get shape(){return this._def.shape()}strict(e){return T.errToObj,new Ne({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,s)=>{var i,r;let n=((r=(i=this._def).errorMap)==null?void 0:r.call(i,a,s).message)??s.defaultError;return a.code==="unrecognized_keys"?{message:T.errToObj(e).message??n}:{message:n}}}})}strip(){return new Ne({...this._def,unknownKeys:"strip"})}passthrough(){return new Ne({...this._def,unknownKeys:"passthrough"})}extend(e){return new Ne({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Ne({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:Z.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Ne({...this._def,catchall:e})}pick(e){let a={};for(let s of q.objectKeys(e))e[s]&&this.shape[s]&&(a[s]=this.shape[s]);return new Ne({...this._def,shape:()=>a})}omit(e){let a={};for(let s of q.objectKeys(this.shape))e[s]||(a[s]=this.shape[s]);return new Ne({...this._def,shape:()=>a})}deepPartial(){return tt(this)}partial(e){let a={};for(let s of q.objectKeys(this.shape)){let n=this.shape[s];e&&!e[s]?a[s]=n:a[s]=n.optional()}return new Ne({...this._def,shape:()=>a})}required(e){let a={};for(let s of q.objectKeys(this.shape))if(e&&!e[s])a[s]=this.shape[s];else{let n=this.shape[s];for(;n instanceof Ze;)n=n._def.innerType;a[s]=n}return new Ne({...this._def,shape:()=>a})}keyof(){return ts(q.objectKeys(this.shape))}};we.create=(t,e)=>new we({shape:()=>t,unknownKeys:"strip",catchall:ze.create(),typeName:Z.ZodObject,...$(e)}),we.strictCreate=(t,e)=>new we({shape:()=>t,unknownKeys:"strict",catchall:ze.create(),typeName:Z.ZodObject,...$(e)}),we.lazycreate=(t,e)=>new we({shape:t,unknownKeys:"strip",catchall:ze.create(),typeName:Z.ZodObject,...$(e)});var jt=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function s(n){for(let r of n)if(r.result.status==="valid")return r.result;for(let r of n)if(r.result.status==="dirty")return e.common.issues.push(...r.ctx.common.issues),r.result;let i=n.map(r=>new ve(r.ctx.common.issues));return k(e,{code:g.invalid_union,unionErrors:i}),E}if(e.common.async)return Promise.all(a.map(async n=>{let i={...e,common:{...e.common,issues:[]},parent:null};return{result:await n._parseAsync({data:e.data,path:e.path,parent:i}),ctx:i}})).then(s);{let n,i=[];for(let l of a){let c={...e,common:{...e.common,issues:[]},parent:null},d=l._parseSync({data:e.data,path:e.path,parent:c});if(d.status==="valid")return d;d.status==="dirty"&&!n&&(n={result:d,ctx:c}),c.common.issues.length&&i.push(c.common.issues)}if(n)return e.common.issues.push(...n.ctx.common.issues),n.result;let r=i.map(l=>new ve(l));return k(e,{code:g.invalid_union,unionErrors:r}),E}}get options(){return this._def.options}};jt.create=(t,e)=>new jt({options:t,typeName:Z.ZodUnion,...$(e)});var De=t=>t instanceof St?De(t.schema):t instanceof Ee?De(t.innerType()):t instanceof Ct?[t.value]:t instanceof It?t.options:t instanceof Tt?q.objectValues(t.enum):t instanceof At?De(t._def.innerType):t instanceof wt?[void 0]:t instanceof kt?[null]:t instanceof Ze?[void 0,...De(t.unwrap())]:t instanceof Je?[null,...De(t.unwrap())]:t instanceof as||t instanceof Mt?De(t.unwrap()):t instanceof Rt?De(t._def.innerType):[],Hr=class rn extends D{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==S.object)return k(a,{code:g.invalid_type,expected:S.object,received:a.parsedType}),E;let s=this.discriminator,n=a.data[s],i=this.optionsMap.get(n);return i?a.common.async?i._parseAsync({data:a.data,path:a.path,parent:a}):i._parseSync({data:a.data,path:a.path,parent:a}):(k(a,{code:g.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),E)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,s){let n=new Map;for(let i of a){let r=De(i.shape[e]);if(!r.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let l of r){if(n.has(l))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(l)}`);n.set(l,i)}}return new rn({typeName:Z.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:n,...$(s)})}};function la(t,e){let a=Ue(t),s=Ue(e);if(t===e)return{valid:!0,data:t};if(a===S.object&&s===S.object){let n=q.objectKeys(e),i=q.objectKeys(t).filter(l=>n.indexOf(l)!==-1),r={...t,...e};for(let l of i){let c=la(t[l],e[l]);if(!c.valid)return{valid:!1};r[l]=c.data}return{valid:!0,data:r}}else if(a===S.array&&s===S.array){if(t.length!==e.length)return{valid:!1};let n=[];for(let i=0;i<t.length;i++){let r=t[i],l=e[i],c=la(r,l);if(!c.valid)return{valid:!1};n.push(c.data)}return{valid:!0,data:n}}else return a===S.date&&s===S.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var Nt=class extends D{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),s=(n,i)=>{if(Ha(n)||Ha(i))return E;let r=la(n.value,i.value);return r.valid?((Ya(n)||Ya(i))&&e.dirty(),{status:e.value,value:r.data}):(k(a,{code:g.invalid_intersection_types}),E)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([n,i])=>s(n,i)):s(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};Nt.create=(t,e,a)=>new Nt({left:t,right:e,typeName:Z.ZodIntersection,...$(a)});var Ke=class on extends D{_parse(e){let{status:a,ctx:s}=this._processInputParams(e);if(s.parsedType!==S.array)return k(s,{code:g.invalid_type,expected:S.array,received:s.parsedType}),E;if(s.data.length<this._def.items.length)return k(s,{code:g.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),E;!this._def.rest&&s.data.length>this._def.items.length&&(k(s,{code:g.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let n=[...s.data].map((i,r)=>{let l=this._def.items[r]||this._def.rest;return l?l._parse(new Ae(s,i,s.path,r)):null}).filter(i=>!!i);return s.common.async?Promise.all(n).then(i=>fe.mergeArray(a,i)):fe.mergeArray(a,n)}get items(){return this._def.items}rest(e){return new on({...this._def,rest:e})}};Ke.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new Ke({items:t,typeName:Z.ZodTuple,rest:null,...$(e)})};var Yr=class ja extends D{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:s}=this._processInputParams(e);if(s.parsedType!==S.object)return k(s,{code:g.invalid_type,expected:S.object,received:s.parsedType}),E;let n=[],i=this._def.keyType,r=this._def.valueType;for(let l in s.data)n.push({key:i._parse(new Ae(s,l,s.path,l)),value:r._parse(new Ae(s,s.data[l],s.path,l)),alwaysSet:l in s.data});return s.common.async?fe.mergeObjectAsync(a,n):fe.mergeObjectSync(a,n)}get element(){return this._def.valueType}static create(e,a,s){return a instanceof D?new ja({keyType:e,valueType:a,typeName:Z.ZodRecord,...$(s)}):new ja({keyType:bt.create(),valueType:e,typeName:Z.ZodRecord,...$(a)})}},ca=class extends D{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==S.map)return k(a,{code:g.invalid_type,expected:S.map,received:a.parsedType}),E;let s=this._def.keyType,n=this._def.valueType,i=[...a.data.entries()].map(([r,l],c)=>({key:s._parse(new Ae(a,r,a.path,[c,"key"])),value:n._parse(new Ae(a,l,a.path,[c,"value"]))}));if(a.common.async){let r=new Map;return Promise.resolve().then(async()=>{for(let l of i){let c=await l.key,d=await l.value;if(c.status==="aborted"||d.status==="aborted")return E;(c.status==="dirty"||d.status==="dirty")&&e.dirty(),r.set(c.value,d.value)}return{status:e.value,value:r}})}else{let r=new Map;for(let l of i){let c=l.key,d=l.value;if(c.status==="aborted"||d.status==="aborted")return E;(c.status==="dirty"||d.status==="dirty")&&e.dirty(),r.set(c.value,d.value)}return{status:e.value,value:r}}}};ca.create=(t,e,a)=>new ca({valueType:e,keyType:t,typeName:Z.ZodMap,...$(a)});var da=class Na extends D{_parse(e){let{status:a,ctx:s}=this._processInputParams(e);if(s.parsedType!==S.set)return k(s,{code:g.invalid_type,expected:S.set,received:s.parsedType}),E;let n=this._def;n.minSize!==null&&s.data.size<n.minSize.value&&(k(s,{code:g.too_small,minimum:n.minSize.value,type:"set",inclusive:!0,exact:!1,message:n.minSize.message}),a.dirty()),n.maxSize!==null&&s.data.size>n.maxSize.value&&(k(s,{code:g.too_big,maximum:n.maxSize.value,type:"set",inclusive:!0,exact:!1,message:n.maxSize.message}),a.dirty());let i=this._def.valueType;function r(c){let d=new Set;for(let u of c){if(u.status==="aborted")return E;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let l=[...s.data.values()].map((c,d)=>i._parse(new Ae(s,c,s.path,d)));return s.common.async?Promise.all(l).then(c=>r(c)):r(l)}min(e,a){return new Na({...this._def,minSize:{value:e,message:T.toString(a)}})}max(e,a){return new Na({...this._def,maxSize:{value:e,message:T.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};da.create=(t,e)=>new da({valueType:t,minSize:null,maxSize:null,typeName:Z.ZodSet,...$(e)});var Gr=class Dt extends D{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==S.function)return k(a,{code:g.invalid_type,expected:S.function,received:a.parsedType}),E;function s(l,c){return Xt({data:l,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Qt(),ot].filter(d=>!!d),issueData:{code:g.invalid_arguments,argumentsError:c}})}function n(l,c){return Xt({data:l,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Qt(),ot].filter(d=>!!d),issueData:{code:g.invalid_return_type,returnTypeError:c}})}let i={errorMap:a.common.contextualErrorMap},r=a.data;if(this._def.returns instanceof lt){let l=this;return pe(async function(...c){let d=new ve([]),u=await l._def.args.parseAsync(c,i).catch(p=>{throw d.addIssue(s(c,p)),d}),m=await Reflect.apply(r,this,u);return await l._def.returns._def.type.parseAsync(m,i).catch(p=>{throw d.addIssue(n(m,p)),d})})}else{let l=this;return pe(function(...c){let d=l._def.args.safeParse(c,i);if(!d.success)throw new ve([s(c,d.error)]);let u=Reflect.apply(r,this,d.data),m=l._def.returns.safeParse(u,i);if(!m.success)throw new ve([n(u,m.error)]);return m.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Dt({...this._def,args:Ke.create(e).rest(Xe.create())})}returns(e){return new Dt({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,s){return new Dt({args:e||Ke.create([]).rest(Xe.create()),returns:a||Xe.create(),typeName:Z.ZodFunction,...$(s)})}},St=class extends D{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};St.create=(t,e)=>new St({getter:t,typeName:Z.ZodLazy,...$(e)});var Ct=class extends D{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return k(e,{received:e.data,code:g.invalid_literal,expected:this._def.value}),E}return{status:"valid",value:t.data}}get value(){return this._def.value}};Ct.create=(t,e)=>new Ct({value:t,typeName:Z.ZodLiteral,...$(e)});function ts(t,e){return new It({values:t,typeName:Z.ZodEnum,...$(e)})}var It=class Sa extends D{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),s=this._def.values;return k(a,{expected:q.joinValues(s),received:a.parsedType,code:g.invalid_type}),E}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),s=this._def.values;return k(a,{received:a.data,code:g.invalid_enum_value,options:s}),E}return pe(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return Sa.create(e,{...this._def,...a})}exclude(e,a=this._def){return Sa.create(this.options.filter(s=>!e.includes(s)),{...this._def,...a})}};It.create=ts;var Tt=class extends D{_parse(t){let e=q.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==S.string&&a.parsedType!==S.number){let s=q.objectValues(e);return k(a,{expected:q.joinValues(s),received:a.parsedType,code:g.invalid_type}),E}if(this._cache||(this._cache=new Set(q.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let s=q.objectValues(e);return k(a,{received:a.data,code:g.invalid_enum_value,options:s}),E}return pe(t.data)}get enum(){return this._def.values}};Tt.create=(t,e)=>new Tt({values:t,typeName:Z.ZodNativeEnum,...$(e)});var lt=class extends D{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==S.promise&&e.common.async===!1?(k(e,{code:g.invalid_type,expected:S.promise,received:e.parsedType}),E):pe((e.parsedType===S.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};lt.create=(t,e)=>new lt({type:t,typeName:Z.ZodPromise,...$(e)});var Ee=class extends D{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===Z.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),s=this._def.effect||null,n={addIssue:i=>{k(a,i),i.fatal?e.abort():e.dirty()},get path(){return a.path}};if(n.addIssue=n.addIssue.bind(n),s.type==="preprocess"){let i=s.transform(a.data,n);if(a.common.async)return Promise.resolve(i).then(async r=>{if(e.value==="aborted")return E;let l=await this._def.schema._parseAsync({data:r,path:a.path,parent:a});return l.status==="aborted"?E:l.status==="dirty"||e.value==="dirty"?ea(l.value):l});{if(e.value==="aborted")return E;let r=this._def.schema._parseSync({data:i,path:a.path,parent:a});return r.status==="aborted"?E:r.status==="dirty"||e.value==="dirty"?ea(r.value):r}}if(s.type==="refinement"){let i=r=>{let l=s.refinement(r,n);if(a.common.async)return Promise.resolve(l);if(l instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return r};if(a.common.async===!1){let r=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return r.status==="aborted"?E:(r.status==="dirty"&&e.dirty(),i(r.value),{status:e.value,value:r.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(r=>r.status==="aborted"?E:(r.status==="dirty"&&e.dirty(),i(r.value).then(()=>({status:e.value,value:r.value}))))}if(s.type==="transform")if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!Qe(i))return E;let r=s.transform(i.value,n);if(r instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:r}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>Qe(i)?Promise.resolve(s.transform(i.value,n)).then(r=>({status:e.value,value:r})):E);q.assertNever(s)}};Ee.create=(t,e,a)=>new Ee({schema:t,typeName:Z.ZodEffects,effect:e,...$(a)}),Ee.createWithPreprocess=(t,e,a)=>new Ee({schema:e,effect:{type:"preprocess",transform:t},typeName:Z.ZodEffects,...$(a)});var Ze=class extends D{_parse(t){return this._getType(t)===S.undefined?pe(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Ze.create=(t,e)=>new Ze({innerType:t,typeName:Z.ZodOptional,...$(e)});var Je=class extends D{_parse(t){return this._getType(t)===S.null?pe(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Je.create=(t,e)=>new Je({innerType:t,typeName:Z.ZodNullable,...$(e)});var At=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===S.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};At.create=(t,e)=>new At({innerType:t,typeName:Z.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...$(e)});var Rt=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},s=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return _t(s)?s.then(n=>({status:"valid",value:n.status==="valid"?n.value:this._def.catchValue({get error(){return new ve(a.common.issues)},input:a.data})})):{status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new ve(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};Rt.create=(t,e)=>new Rt({innerType:t,typeName:Z.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...$(e)});var ua=class extends D{_parse(t){if(this._getType(t)!==S.nan){let e=this._getOrReturnCtx(t);return k(e,{code:g.invalid_type,expected:S.nan,received:e.parsedType}),E}return{status:"valid",value:t.data}}};ua.create=t=>new ua({typeName:Z.ZodNaN,...$(t)});var as=class extends D{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},ss=class ln extends D{_parse(e){let{status:a,ctx:s}=this._processInputParams(e);if(s.common.async)return(async()=>{let n=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?E:n.status==="dirty"?(a.dirty(),ea(n.value)):this._def.out._parseAsync({data:n.value,path:s.path,parent:s})})();{let n=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return n.status==="aborted"?E:n.status==="dirty"?(a.dirty(),{status:"dirty",value:n.value}):this._def.out._parseSync({data:n.value,path:s.path,parent:s})}}static create(e,a){return new ln({in:e,out:a,typeName:Z.ZodPipeline})}},Mt=class extends D{_parse(t){let e=this._def.innerType._parse(t),a=s=>(Qe(s)&&(s.value=Object.freeze(s.value)),s);return _t(e)?e.then(s=>a(s)):a(e)}unwrap(){return this._def.innerType}};Mt.create=(t,e)=>new Mt({innerType:t,typeName:Z.ZodReadonly,...$(e)}),we.lazycreate;var Z;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(Z||(Z={}));var h=bt.create,ke=ta.create;ua.create,aa.create;var Re=sa.create;na.create,ra.create,wt.create,kt.create,ia.create;var _=Xe.create;ze.create,oa.create;var Q=et.create,y=we.create;we.strictCreate;var Y=jt.create;Hr.create,Nt.create,Ke.create;var b=Yr.create;ca.create,da.create,Gr.create,St.create;var N=Ct.create;It.create,Tt.create,lt.create,Ee.create,Ze.create,Je.create,Ee.createWithPreprocess,ss.create;const Le={authenticate:"authenticate",initialize:"initialize",session_cancel:"session/cancel",session_load:"session/load",session_new:"session/new",session_prompt:"session/prompt",session_set_mode:"session/set_mode",session_set_model:"session/set_model"},Pe={fs_read_text_file:"fs/read_text_file",fs_write_text_file:"fs/write_text_file",session_request_permission:"session/request_permission",session_update:"session/update",terminal_create:"terminal/create",terminal_kill:"terminal/kill",terminal_output:"terminal/output",terminal_release:"terminal/release",terminal_wait_for_exit:"terminal/wait_for_exit"},ns=y({_meta:b(_()).optional(),content:h(),path:h(),sessionId:h()}),rs=y({_meta:b(_()).optional(),limit:ke().optional().nullable(),line:ke().optional().nullable(),path:h(),sessionId:h()}),is=y({_meta:b(_()).optional(),sessionId:h(),terminalId:h()}),os=y({_meta:b(_()).optional(),sessionId:h(),terminalId:h()}),ls=y({_meta:b(_()).optional(),sessionId:h(),terminalId:h()}),cs=y({_meta:b(_()).optional(),sessionId:h(),terminalId:h()}),Qr=b(_()),Xr=Y([N("assistant"),N("user")]),ei=y({_meta:b(_()).optional(),mimeType:h().optional().nullable(),text:h(),uri:h()}),ti=y({_meta:b(_()).optional(),blob:h(),mimeType:h().optional().nullable(),uri:h()}),ds=Y([N("read"),N("edit"),N("delete"),N("move"),N("search"),N("execute"),N("think"),N("fetch"),N("switch_mode"),N("other")]),us=Y([N("pending"),N("in_progress"),N("completed"),N("failed")]),ai=y({_meta:b(_()).optional()}),si=y({_meta:b(_()).optional(),content:h()}),ni=y({_meta:b(_()).optional(),outcome:Y([y({outcome:N("cancelled")}),y({optionId:h(),outcome:N("selected")})])}),ri=y({_meta:b(_()).optional(),terminalId:h()}),ii=y({_meta:b(_()).optional()}),oi=y({_meta:b(_()).optional(),exitCode:ke().optional().nullable(),signal:h().optional().nullable()}),li=y({_meta:b(_()).optional()}),ci=b(_()),di=y({_meta:b(_()).optional(),sessionId:h()}),ui=b(_()),mi=y({_meta:b(_()).optional(),methodId:h()}),pi=y({_meta:b(_()).optional(),modeId:h(),sessionId:h()}),hi=y({_meta:b(_()).optional(),modelId:h(),sessionId:h()}),fi=b(_()),ms=y({_meta:b(_()).optional(),name:h(),value:h()}),Me=y({_meta:b(_()).optional(),audience:Q(Xr).optional().nullable(),lastModified:h().optional().nullable(),priority:ke().optional().nullable()}),ps=Y([ei,ti]),gi=y({_meta:b(_()).optional()}),xi=y({meta:_().optional()}),vi=y({_meta:b(_()).optional(),stopReason:Y([N("end_turn"),N("max_tokens"),N("max_turn_requests"),N("refusal"),N("cancelled")])}),yi=y({_meta:b(_()).optional()}),_i=b(_()),hs=h(),bi=b(_()),wi=y({hint:h()}),ki=y({_meta:b(_()).optional(),kind:Y([N("allow_once"),N("allow_always"),N("reject_once"),N("reject_always")]),name:h(),optionId:h()}),ma=Y([y({content:Y([y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),text:h(),type:N("text")}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),data:h(),mimeType:h(),type:N("image"),uri:h().optional().nullable()}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),data:h(),mimeType:h(),type:N("audio")}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),description:h().optional().nullable(),mimeType:h().optional().nullable(),name:h(),size:ke().optional().nullable(),title:h().optional().nullable(),type:N("resource_link"),uri:h()}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),resource:ps,type:N("resource")})]),type:N("content")}),y({_meta:b(_()).optional(),newText:h(),oldText:h().optional().nullable(),path:h(),type:N("diff")}),y({terminalId:h(),type:N("terminal")})]),pa=y({_meta:b(_()).optional(),line:ke().optional().nullable(),path:h()}),fs=y({_meta:b(_()).optional(),name:h(),value:h()}),ji=y({_meta:b(_()).optional(),exitCode:ke().optional().nullable(),signal:h().optional().nullable()}),Ni=y({_meta:b(_()).optional(),readTextFile:Re().optional(),writeTextFile:Re().optional()}),Si=y({args:Q(h()),command:h(),env:Q(fs),name:h()}),gs=Y([y({headers:Q(ms),name:h(),type:N("http"),url:h()}),y({headers:Q(ms),name:h(),type:N("sse"),url:h()}),Si]),Ot=Y([y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),text:h(),type:N("text")}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),data:h(),mimeType:h(),type:N("image"),uri:h().optional().nullable()}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),data:h(),mimeType:h(),type:N("audio")}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),description:h().optional().nullable(),mimeType:h().optional().nullable(),name:h(),size:ke().optional().nullable(),title:h().optional().nullable(),type:N("resource_link"),uri:h()}),y({_meta:b(_()).optional(),annotations:Me.optional().nullable(),resource:ps,type:N("resource")})]),Ci=y({_meta:b(_()).optional(),description:h().optional().nullable(),id:h(),name:h()}),Ii=y({_meta:b(_()).optional(),http:Re().optional(),sse:Re().optional()}),Ti=y({_meta:b(_()).optional(),audio:Re().optional(),embeddedContext:Re().optional(),image:Re().optional()}),Ai=y({_meta:b(_()).optional(),description:h().optional().nullable(),modelId:h(),name:h()}),Ri=y({_meta:b(_()).optional(),description:h().optional().nullable(),id:hs,name:h()}),xs=y({_meta:b(_()).optional(),availableModels:Q(Ai),currentModelId:h()}),vs=y({_meta:b(_()).optional(),availableModes:Q(Ri),currentModeId:h()}),Mi=y({_meta:b(_()).optional(),content:h(),priority:Y([N("high"),N("medium"),N("low")]),status:Y([N("pending"),N("in_progress"),N("completed")])}),Oi=wi,Ei=Y([di,ui]),ys=y({_meta:b(_()).optional(),args:Q(h()).optional(),command:h(),cwd:h().optional().nullable(),env:Q(fs).optional(),outputByteLimit:ke().optional().nullable(),sessionId:h()}),Zi=y({_meta:b(_()).optional(),exitStatus:ji.optional().nullable(),output:h(),truncated:Re()}),Pi=y({_meta:b(_()).optional(),cwd:h(),mcpServers:Q(gs)}),$i=y({_meta:b(_()).optional(),cwd:h(),mcpServers:Q(gs),sessionId:h()}),Fi=y({_meta:b(_()).optional(),prompt:Q(Ot),sessionId:h()}),Ui=y({_meta:b(_()).optional(),models:xs.optional().nullable(),modes:vs.optional().nullable(),sessionId:h()}),zi=y({_meta:b(_()).optional(),models:xs.optional().nullable(),modes:vs.optional().nullable()}),Di=y({_meta:b(_()).optional(),content:Q(ma).optional().nullable(),kind:ds.optional().nullable(),locations:Q(pa).optional().nullable(),rawInput:b(_()).optional(),rawOutput:b(_()).optional(),status:us.optional().nullable(),title:h().optional().nullable(),toolCallId:h()}),Li=y({_meta:b(_()).optional(),fs:Ni.optional(),terminal:Re().optional()}),qi=y({_meta:b(_()).optional(),loadSession:Re().optional(),mcpCapabilities:Ii.optional(),promptCapabilities:Ti.optional()}),Wi=y({_meta:b(_()).optional(),description:h(),input:Oi.optional().nullable(),name:h()}),Vi=Y([ai,si,ni,ri,Zi,ii,oi,li,ci]),_s=y({_meta:b(_()).optional(),options:Q(ki),sessionId:h(),toolCall:Di}),Bi=y({_meta:b(_()).optional(),clientCapabilities:Li.optional(),protocolVersion:ke()}),Ki=y({_meta:b(_()).optional(),agentCapabilities:qi.optional(),authMethods:Q(Ci).optional(),protocolVersion:ke()}),bs=y({_meta:b(_()).optional(),sessionId:h(),update:Y([y({content:Ot,sessionUpdate:N("user_message_chunk")}),y({content:Ot,sessionUpdate:N("agent_message_chunk")}),y({content:Ot,sessionUpdate:N("agent_thought_chunk")}),y({_meta:b(_()).optional(),content:Q(ma).optional(),kind:Y([N("read"),N("edit"),N("delete"),N("move"),N("search"),N("execute"),N("think"),N("fetch"),N("switch_mode"),N("other")]).optional(),locations:Q(pa).optional(),rawInput:b(_()).optional(),rawOutput:b(_()).optional(),sessionUpdate:N("tool_call"),status:Y([N("pending"),N("in_progress"),N("completed"),N("failed")]).optional(),title:h(),toolCallId:h()}),y({_meta:b(_()).optional(),content:Q(ma).optional().nullable(),kind:ds.optional().nullable(),locations:Q(pa).optional().nullable(),rawInput:b(_()).optional(),rawOutput:b(_()).optional(),sessionUpdate:N("tool_call_update"),status:us.optional().nullable(),title:h().optional().nullable(),toolCallId:h()}),y({_meta:b(_()).optional(),entries:Q(Mi),sessionUpdate:N("plan")}),y({availableCommands:Q(Wi),sessionUpdate:N("available_commands_update")}),y({currentModeId:hs,sessionUpdate:N("current_mode_update")})])});Y([Y([ns,rs,_s,ys,is,os,ls,cs,Qr]),Vi,Ei,Y([Bi,mi,Pi,$i,pi,Fi,hi,fi]),Y([Ki,gi,Ui,zi,xi,vi,yi,_i]),Y([bs,bi])]);function Ji(t,e){let a=new TextEncoder,s=new TextDecoder;return{readable:new ReadableStream({async start(n){let i="",r=e.getReader();try{for(;;){let{value:l,done:c}=await r.read();if(c)break;if(!l)continue;i+=s.decode(l,{stream:!0});let d=i.split(`
`);i=d.pop()||"";for(let u of d){let m=u.trim();if(m)try{let p=JSON.parse(m);n.enqueue(p)}catch(p){console.error("Failed to parse JSON message:",m,p)}}}}finally{r.releaseLock(),n.close()}}}),writable:new WritableStream({async write(n){let i=JSON.stringify(n)+`
`,r=t.getWriter();try{await r.write(a.encode(i))}finally{r.releaseLock()}}})}}var Hi=(en=class{constructor(t,e){Oe(this,he);let a=t(this);Be(this,he,new Yi(async(s,n)=>{var i,r,l,c,d,u,m;switch(s){case Pe.fs_write_text_file:{let p=ns.parse(n);return(i=a.writeTextFile)==null?void 0:i.call(a,p)}case Pe.fs_read_text_file:{let p=rs.parse(n);return(r=a.readTextFile)==null?void 0:r.call(a,p)}case Pe.session_request_permission:{let p=_s.parse(n);return a.requestPermission(p)}case Pe.terminal_create:{let p=ys.parse(n);return(l=a.createTerminal)==null?void 0:l.call(a,p)}case Pe.terminal_output:{let p=is.parse(n);return(c=a.terminalOutput)==null?void 0:c.call(a,p)}case Pe.terminal_release:{let p=os.parse(n);return await((d=a.releaseTerminal)==null?void 0:d.call(a,p))??{}}case Pe.terminal_wait_for_exit:{let p=ls.parse(n);return(u=a.waitForTerminalExit)==null?void 0:u.call(a,p)}case Pe.terminal_kill:{let p=cs.parse(n);return await((m=a.killTerminal)==null?void 0:m.call(a,p))??{}}default:if(s.startsWith("_")){let p=s.substring(1);if(!a.extMethod)throw je.methodNotFound(s);return a.extMethod(p,n)}throw je.methodNotFound(s)}},async(s,n)=>{switch(s){case Pe.session_update:{let i=bs.parse(n);return a.sessionUpdate(i)}default:if(s.startsWith("_")){let i=s.substring(1);return a.extNotification?a.extNotification(i,n):void 0}throw je.methodNotFound(s)}},e))}async initialize(t){return await te(this,he).sendRequest(Le.initialize,t)}async newSession(t){return await te(this,he).sendRequest(Le.session_new,t)}async loadSession(t){return await te(this,he).sendRequest(Le.session_load,t)??{}}async setSessionMode(t){return await te(this,he).sendRequest(Le.session_set_mode,t)??{}}async setSessionModel(t){return await te(this,he).sendRequest(Le.session_set_model,t)??{}}async authenticate(t){return await te(this,he).sendRequest(Le.authenticate,t)??{}}async prompt(t){return await te(this,he).sendRequest(Le.session_prompt,t)}async cancel(t){return await te(this,he).sendNotification(Le.session_cancel,t)}async extMethod(t,e){return await te(this,he).sendRequest(`_${t}`,e)}async extNotification(t,e){return await te(this,he).sendNotification(`_${t}`,e)}},he=new WeakMap,en),Yi=(tn=class{constructor(t,e,a){Oe(this,ce);Oe(this,at,new Map);Oe(this,Lt,0);Oe(this,mt);Oe(this,pt);Oe(this,st);Oe(this,nt,Promise.resolve());Be(this,mt,t),Be(this,pt,e),Be(this,st,a),Te(this,ce,cn).call(this)}async sendRequest(t,e){let a=Ia(this,Lt)._++,s=new Promise((n,i)=>{te(this,at).set(a,{resolve:n,reject:i})});return await Te(this,ce,ut).call(this,{jsonrpc:"2.0",id:a,method:t,params:e}),s}async sendNotification(t,e){await Te(this,ce,ut).call(this,{jsonrpc:"2.0",method:t,params:e})}},at=new WeakMap,Lt=new WeakMap,mt=new WeakMap,pt=new WeakMap,st=new WeakMap,nt=new WeakMap,ce=new WeakSet,cn=async function(){let t=te(this,st).readable.getReader();try{for(;;){let{value:e,done:a}=await t.read();if(a)break;if(e)try{Te(this,ce,dn).call(this,e)}catch(s){console.error("Unexpected error during message processing:",e,s),"id"in e&&e.id!==void 0&&Te(this,ce,ut).call(this,{jsonrpc:"2.0",id:e.id,error:{code:-32700,message:"Parse error"}})}}}finally{t.releaseLock()}},dn=async function(t){if("method"in t&&"id"in t){let e=await Te(this,ce,un).call(this,t.method,t.params);"error"in e&&console.error("Error handling request",t,e.error),await Te(this,ce,ut).call(this,{jsonrpc:"2.0",id:t.id,...e})}else if("method"in t){let e=await Te(this,ce,mn).call(this,t.method,t.params);"error"in e&&console.error("Error handling notification",t,e.error)}else"id"in t?Te(this,ce,pn).call(this,t):console.error("Invalid message",{message:t})},un=async function(t,e){try{return{result:await te(this,mt).call(this,t,e)??null}}catch(a){if(a instanceof je)return a.toResult();if(a instanceof ve)return je.invalidParams(a.format()).toResult();let s;(a instanceof Error||typeof a=="object"&&a&&"message"in a&&typeof a.message=="string")&&(s=a.message);try{return je.internalError(s?JSON.parse(s):{}).toResult()}catch{return je.internalError({details:s}).toResult()}}},mn=async function(t,e){try{return await te(this,pt).call(this,t,e),{result:null}}catch(a){if(a instanceof je)return a.toResult();if(a instanceof ve)return je.invalidParams(a.format()).toResult();let s;(a instanceof Error||typeof a=="object"&&a&&"message"in a&&typeof a.message=="string")&&(s=a.message);try{return je.internalError(s?JSON.parse(s):{}).toResult()}catch{return je.internalError({details:s}).toResult()}}},pn=function(t){let e=te(this,at).get(t.id);e?("result"in t?e.resolve(t.result):"error"in t&&e.reject(t.error),te(this,at).delete(t.id)):console.error("Got response to unknown request",t.id)},ut=async function(t){return Be(this,nt,te(this,nt).then(async()=>{let e=te(this,st).writable.getWriter();try{await e.write(t)}finally{e.releaseLock()}}).catch(e=>{console.error("ACP write error:",e)})),te(this,nt)},tn),je=class Ve extends Error{constructor(a,s,n){super(s);H(this,"code");H(this,"data");this.code=a,this.name="RequestError",this.data=n}static parseError(a){return new Ve(-32700,"Parse error",a)}static invalidRequest(a){return new Ve(-32600,"Invalid request",a)}static methodNotFound(a){return new Ve(-32601,"Method not found",{method:a})}static invalidParams(a){return new Ve(-32602,"Invalid params",a)}static internalError(a){return new Ve(-32603,"Internal error",a)}static authRequired(a){return new Ve(-32e3,"Authentication required",a)}static resourceNotFound(a){return new Ve(-32002,"Resource not found",a&&{uri:a})}toResult(){return{error:{code:this.code,message:this.message,data:this.data}}}toErrorResponse(){return{code:this.code,message:this.message,data:this.data}}},Gi=class{constructor(){H(this,"promise");H(this,"resolve");H(this,"reject");this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}},Et=class hn extends Error{constructor(a,s){super(a.message);H(this,"code");H(this,"data");H(this,"id");this.name="JsonRpcError",this.code=a.code,this.data=a.data,this.id=s}static isJsonRpcError(a){return a instanceof hn}toJSON(){return{jsonrpc:"2.0",id:this.id??null,error:{code:this.code,message:this.message,data:this.data}}}};const Qi={PARSE_ERROR:-32700,INVALID_REQUEST:-32600,METHOD_NOT_FOUND:-32601,INVALID_PARAMS:-32602,INTERNAL_ERROR:-32603};var Xi=class{constructor(t,e){H(this,"agent");H(this,"options");H(this,"pendingPermissions",new Map);this.agent=t,this.options=e}async sessionUpdate(t){this.options.onSessionNotification(t)}async writeTextFile(t){if(this.options.writeTextFile)return this.options.writeTextFile(t);throw Error("Write text file handler not implemented")}async readTextFile(t){if(this.options.readTextFile)return this.options.readTextFile(t);throw Error("Read text file handler not implemented")}async requestPermission(t){let e=`${Date.now()}-${Math.random()}`,a=new Gi;return this.pendingPermissions.set(e,a),this.options.onRequestPermission({...t,deferredId:e}),a.promise}resolvePermission(t,e){let a=this.pendingPermissions.get(t);a&&(this.pendingPermissions.delete(t),a.resolve(e))}rejectPermission(t,e){let a=this.pendingPermissions.get(t);a&&(this.pendingPermissions.delete(t),a.reject(e))}};function eo(t){if(t instanceof Et)return t;if(t instanceof Error)return new Et({code:Qi.INTERNAL_ERROR,message:t.message,data:t.stack});if(t&&typeof t=="object"&&"code"in t&&"message"in t&&typeof t.code=="number"&&typeof t.message=="string"){let e=t;return new Et({code:e.code,message:e.message,data:e.data},void 0)}return null}var to=class{constructor(t,e){H(this,"agent");H(this,"callbacks");this.agent=t,this.callbacks=e}handleCatchRpcError(t){return e=>{var s,n;let a=eo(e);throw a?(console.error(`[acp] JSON-RPC error in ${t}:`,a),(n=(s=this.callbacks).on_rpc_error)==null||n.call(s,a),a):e}}extMethod(t,e){return this.agent.extMethod?this.agent.extMethod(t,e):Promise.resolve({})}extNotification(t,e){return this.agent.extNotification?this.agent.extNotification(t,e):Promise.resolve()}async setSessionMode(t){var a,s,n,i,r,l;(s=(a=this.callbacks).on_setSessionMode_start)==null||s.call(a,t);let e=await((i=(n=this.agent).setSessionMode)==null?void 0:i.call(n,t).catch(this.handleCatchRpcError("setSessionMode")));return(l=(r=this.callbacks).on_setSessionMode_response)==null||l.call(r,e,t),e}async setSessionModel(t){var a,s,n,i,r,l;(s=(a=this.callbacks).on_setSessionModel_start)==null||s.call(a,t);let e=await((i=(n=this.agent).setSessionModel)==null?void 0:i.call(n,t).catch(this.handleCatchRpcError("setSessionModel")));return(l=(r=this.callbacks).on_setSessionModel_response)==null||l.call(r,e,t),e}async initialize(t){var a,s,n,i;(s=(a=this.callbacks).on_initialize_start)==null||s.call(a,t);let e=await this.agent.initialize(t).catch(this.handleCatchRpcError("initialize"));return(i=(n=this.callbacks).on_initialize_response)==null||i.call(n,e,t),e}async newSession(t){var a,s,n,i;(s=(a=this.callbacks).on_newSession_start)==null||s.call(a,t);let e=await this.agent.newSession(t).catch(this.handleCatchRpcError("newSession"));return(i=(n=this.callbacks).on_newSession_response)==null||i.call(n,e,t),e}async loadSession(t){var e,a,s,n;if((a=(e=this.callbacks).on_loadSession_start)==null||a.call(e,t),this.agent.loadSession){let i=await this.agent.loadSession(t).catch(this.handleCatchRpcError("loadSession"));return(n=(s=this.callbacks).on_loadSession_response)==null||n.call(s,i,t),i}throw Error("Agent does not support loadSession capability")}async authenticate(t){var e,a,s,n;(a=(e=this.callbacks).on_authenticate_start)==null||a.call(e,t),await this.agent.authenticate(t).catch(this.handleCatchRpcError("authenticate")),(n=(s=this.callbacks).on_authenticate_response)==null||n.call(s,void 0,t)}async prompt(t){var a,s,n,i;(s=(a=this.callbacks).on_prompt_start)==null||s.call(a,t);let e=await this.agent.prompt(t).catch(this.handleCatchRpcError("prompt"));return(i=(n=this.callbacks).on_prompt_response)==null||i.call(n,e,t),e}async cancel(t){var e,a,s,n;(a=(e=this.callbacks).on_cancel_start)==null||a.call(e,t),await this.agent.cancel(t).catch(this.handleCatchRpcError("cancel")),(n=(s=this.callbacks).on_cancel_response)==null||n.call(s,void 0,t)}};const ao=globalThis.ReadableStream,so=globalThis.WritableStream;function no(){return globalThis.ReadableStream!==void 0&&globalThis.WritableStream!==void 0}function ro(t){return new so({write(e){t.readyState===WebSocket.OPEN&&t.send(e)},close(){t.close()},abort(){t.close()}})}function io(t){let e=new ao({start(s){t.onmessage=n=>{if(n.data instanceof ArrayBuffer)s.enqueue(new Uint8Array(n.data));else if(n.data instanceof Uint8Array)s.enqueue(n.data);else{let i=new TextEncoder;s.enqueue(i.encode(`${n.data}
`))}},t.onclose=()=>{s.close()},t.onerror=n=>{s.error(n)}},cancel(){t.close()}}),a=async function*(){let s=e.getReader();try{for(;;){let{value:n,done:i}=await s.read();if(i)break;yield n}}finally{s.releaseLock()}return void 0};return e.values=a,e[Symbol.asyncIterator]=a,e}no()||console.warn("Streams API not supported in this browser. Consider using a polyfill.");var oo=class{constructor(t){H(this,"managers",new Map);H(this,"options");H(this,"currentUrl",null);this.options=t}async connect(t){this.currentUrl=t;let e=this.managers.get(t);if(e){if(e.getConnectionState()==="connected"){let a=e.getStreams();if(a)return a}}else e=new lo({url:t,onConnectionStateChange:a=>this.options.onConnectionStateChange(a,t),onError:a=>this.options.onError(a,t),reconnectAttempts:this.options.reconnectAttempts,reconnectDelay:this.options.reconnectDelay}),this.managers.set(t,e);return await e.connect()}disconnect(t){if(t){let e=this.managers.get(t);e&&(e.disconnect(),this.managers.delete(t))}else{for(let[e,a]of this.managers.entries())a.disconnect(),this.managers.delete(e);this.currentUrl=null}}getCurrentUrl(){return this.currentUrl}getConnectionState(t){let e=t||this.currentUrl;if(!e)return"disconnected";let a=this.managers.get(e);return a?a.getConnectionState():"disconnected"}getActiveConnections(){return Array.from(this.managers.keys()).filter(t=>{var e;return((e=this.managers.get(t))==null?void 0:e.getConnectionState())==="connected"})}},lo=class{constructor(t){H(this,"ws",null);H(this,"options");H(this,"reconnectCount",0);H(this,"reconnectTimer",null);H(this,"readableStream",null);H(this,"writableStream",null);this.options={reconnectAttempts:3,reconnectDelay:1e3,...t}}async connect(){this.updateConnectionState({status:"connecting",url:this.options.url});try{return this.ws=new WebSocket(this.options.url),new Promise((t,e)=>{if(!this.ws){e(Error("WebSocket not initialized"));return}this.ws.onopen=()=>{this.reconnectCount=0,this.updateConnectionState({status:"connected",url:this.options.url}),this.ws&&(this.readableStream=io(this.ws),this.writableStream=ro(this.ws),t({readable:this.readableStream,writable:this.writableStream}))},this.ws.onerror=a=>{let s=Error("WebSocket connection error");this.options.onError(s),this.updateConnectionState({status:"error",error:s.message,url:this.options.url}),e(s)},this.ws.onclose=()=>{this.updateConnectionState({status:"disconnected",url:this.options.url}),this.attemptReconnect()}})}catch(t){let e=t instanceof Error?t:Error(String(t));throw this.options.onError(e),this.updateConnectionState({status:"error",error:e.message,url:this.options.url}),e}}disconnect(){this.reconnectTimer&&(this.reconnectTimer=(clearTimeout(this.reconnectTimer),null)),this.ws&&(this.ws=(this.ws.close(),null)),this.readableStream=null,this.writableStream=null,this.updateConnectionState({status:"disconnected"})}attemptReconnect(){let t=this.options.reconnectAttempts??3;this.reconnectCount<t&&(this.reconnectCount++,this.reconnectTimer=setTimeout(async()=>{try{await this.connect()}catch{}},this.options.reconnectDelay))}updateConnectionState(t){this.options.onConnectionStateChange(t)}getConnectionState(){if(!this.ws)return"disconnected";switch(this.ws.readyState){case WebSocket.CONNECTING:return"connecting";case WebSocket.OPEN:return"connected";case WebSocket.CLOSING:case WebSocket.CLOSED:return"disconnected";default:return"error"}}getStreams(){return this.readableStream&&this.writableStream?{readable:this.readableStream,writable:this.writableStream}:null}},ws=t=>{let e,a=new Set,s=(l,c)=>{let d=typeof l=="function"?l(e):l;if(!Object.is(d,e)){let u=e;e=c??(typeof d!="object"||!d)?d:Object.assign({},e,d),a.forEach(m=>m(e,u))}},n=()=>e,i={setState:s,getState:n,getInitialState:()=>r,subscribe:l=>(a.add(l),()=>a.delete(l))},r=e=t(s,n,i);return i},co=(t=>t?ws(t):ws),M=Ta(vn(),1),uo=t=>t;function mo(t,e=uo){let a=M.useSyncExternalStore(t.subscribe,M.useCallback(()=>e(t.getState()),[t,e]),M.useCallback(()=>e(t.getInitialState()),[t,e]));return M.useDebugValue(a),a}var ks=t=>{let e=co(t),a=s=>mo(e,s);return Object.assign(a,e),a};const po=(t=>t?ks(t):ks)((t,e)=>({connections:{},activeConnectionUrl:null,connectionState:{status:"disconnected"},agentCapabilities:null,activeSessionId:null,notifications:{},sessionModes:{},setConnection:(a,s,n)=>{t(i=>{var r,l;return{connections:{...i.connections,[a]:{url:a,state:s,capabilities:n??((r=i.connections[a])==null?void 0:r.capabilities)??null}},...i.activeConnectionUrl===a&&{connectionState:s,agentCapabilities:n??((l=i.connections[a])==null?void 0:l.capabilities)??null}}})},setActiveConnection:a=>{t(s=>{let n=a?s.connections[a]:null;return{activeConnectionUrl:a,connectionState:(n==null?void 0:n.state)??{status:"disconnected"},agentCapabilities:(n==null?void 0:n.capabilities)??null}})},removeConnection:a=>{t(s=>{let n={...s.connections};delete n[a];let i=s.activeConnectionUrl===a?null:s.activeConnectionUrl,r=i?n[i]:null;return{connections:n,activeConnectionUrl:i,connectionState:(r==null?void 0:r.state)??{status:"disconnected"},agentCapabilities:(r==null?void 0:r.capabilities)??null}})},setConnectionState:a=>{t({connectionState:a});let{activeConnectionUrl:s}=e();s&&e().setConnection(s,a)},setAgentCapabilities:a=>{t({agentCapabilities:a});let{activeConnectionUrl:s}=e();s&&e().setConnection(s,e().connectionState,a)},setActiveSessionId:a=>{t({activeSessionId:a})},setActiveModeId:(a,s)=>{t(n=>{let i=n.sessionModes[a];return{sessionModes:{...n.sessionModes,[a]:{...i,currentModeId:s}}}})},setModeState:(a,s)=>{t(n=>({sessionModes:{...n.sessionModes,[a]:s}}))},addNotification:a=>{var l;let s=e().notifications,n;if(n=a.type==="session_notification"&&((l=a.data)!=null&&l.sessionId)?a.data.sessionId:e().activeSessionId,!n)return;let i={...a,id:`${Date.now()}-${Math.random()}`,timestamp:Date.now()},r=s[n]||[];t({notifications:{...s,[n]:[...r,i]}})},clearNotifications:a=>{if(a){let s={...e().notifications};delete s[a],t({notifications:s})}else t({notifications:{}})},getActiveNotifications:()=>{let{activeSessionId:a,notifications:s}=e();return a&&s[a]||[]},getActiveConnection:()=>{let{activeConnectionUrl:a,connections:s}=e();return a&&s[a]||null},getConnection:a=>{let{connections:s}=e();return s[a]||{url:a,state:{status:"disconnected"},capabilities:null}}}));var ho=typeof window<"u"?M.useLayoutEffect:M.useEffect;function qe(t){let e=(0,M.useRef)(()=>{throw Error("Cannot call an event handler while rendering.")});return ho(()=>{e.current=t},[t]),(0,M.useCallback)((...a)=>{var s;return(s=e.current)==null?void 0:s.call(e,...a)},[e])}function fo(t){let{wsUrl:e,autoConnect:a=!0,reconnectAttempts:s=3,reconnectDelay:n=2e3,clientOptions:i={}}=t,{getConnection:r,notifications:l,activeSessionId:c,agentCapabilities:d,sessionModes:u,setActiveModeId:m,setModeState:p,setActiveSessionId:f,setConnection:x,setActiveConnection:v,addNotification:w,clearNotifications:j}=po(),[C,A]=(0,M.useState)(null),[I,O]=(0,M.useState)(null),[U,L]=(0,M.useState)(!1),[V,K]=(0,M.useState)([]),B=(0,M.useRef)(null),P=(0,M.useRef)(null),F=(0,M.useRef)(null),ue=(0,M.useRef)(!1),X=qe((W,G)=>{x(G,W),w({type:"connection_change",data:W})}),me=qe((W,G)=>{w({type:"error",data:W})}),ge=qe(W=>{w({type:"session_notification",data:W}),W.update.sessionUpdate==="available_commands_update"&&K(W.update.availableCommands)}),de=qe(W=>{A(W)}),ye=qe(async()=>{B.current||(B.current=new oo({onConnectionStateChange:X,onError:me,reconnectAttempts:s,reconnectDelay:n})),v(e);let{readable:W,writable:G}=await B.current.connect(e);O(new to(new Hi(J=>{let ee=new Xi(J,{...i,onRequestPermission:ie=>{var R;(R=i==null?void 0:i.onRequestPermission)==null||R.call(i,ie),de(ie)},onSessionNotification:ie=>{var R;(R=i==null?void 0:i.onSessionNotification)==null||R.call(i,ie),ge(ie)},onRpcError:ie=>{var R;(R=i==null?void 0:i.onRpcError)==null||R.call(i,ie),me(ie,e)}});return P.current=ee,ee},Ji(G,W)),{on_initialize_response:J=>{let ee=J.agentCapabilities;console.log("[acp] Agent capabilities",ee),x(e,r(e).state,ee)},on_newSession_response:J=>{console.log("[acp] New session created",J);let ee=J.sessionId;f(ee),p(ee,J.modes)},on_loadSession_response:(J,ee)=>{console.log("[acp] Session resumed",ee);let ie=ee.sessionId;f(ie),p(ie,J.modes)},on_prompt_start:J=>{for(let ee of J.prompt)w({type:"session_notification",data:{sessionId:J.sessionId,update:{sessionUpdate:"user_message_chunk",content:ee}}})},on_setSessionMode_start:J=>{console.log("[acp] Session mode set",J);let ee=J.sessionId;m(ee,J.modeId)},on_rpc_error:J=>me(J,e)}))}),Se=qe(W=>{let G=W||e;B.current&&(W?B.current.disconnect(W):(B.current.disconnect(G),B.current=null,P.current=null,O(null))),W||(A(null),K([]),ue.current=!1,F.current=null,L(!1))}),Ce=qe(W=>{if(C&&P.current){let G=C.deferredId;G&&P.current.resolvePermission(G,W)}A(null)}),Ie=qe(W=>{if(C&&P.current){let G=C.deferredId;G&&P.current.rejectPermission(G,W)}A(null)});return(0,M.useEffect)(()=>(f(null),a&&ye().catch(console.error),()=>{Se()}),[a,e]),{connect:ye,disconnect:Se,connectionState:r(e).state,activeSessionId:c,notifications:c&&l[c]||[],isSessionLoading:U,clearNotifications:j,pendingPermission:C,setActiveSessionId:f,resolvePermission:Ce,rejectPermission:Ie,agent:I,agentCapabilities:d,sessionMode:c?u[c]:null,availableCommands:V}}function go(t,e){if(!t)throw Error(e)}function xo(t){let e=[];for(let a of t){let s=e[e.length-1];s&&vo(s.at(0),a)?s.push(a):e.push([a])}return e}var js=["tool_call","tool_call_update"];function vo(t,e){return t?t.type==="session_notification"&&e.type==="session_notification"?js.includes(t.data.update.sessionUpdate)&&js.includes(e.data.update.sessionUpdate)?!0:t.data.update.sessionUpdate===e.data.update.sessionUpdate:t.type===e.type:!1}function yo(t){var a;let e=new Map;for(let s of t)e.has(s.toolCallId)||e.set(s.toolCallId,[]),(a=e.get(s.toolCallId))==null||a.push(s);return Array.from(e.values()).map(s=>{var i;let n=s.at(0);return go(!!(n!=null&&n.toolCallId),"Tool call ID is required"),{...n,toolCallId:n.toolCallId,status:(i=s.at(-1))==null?void 0:i.status,rawOutput:Object.assign({},...s.map(r=>r.rawOutput)),locations:s.flatMap(r=>r.locations||[]),content:s.flatMap(r=>r.content||[])}})}var _o=be(),o=Ta(Tn(),1);const Ns=(0,M.memo)(t=>{let e=(0,_o.c)(10),{theme:a}=dr(),s;e[0]===t.original?s=e[1]:(s=_r({original:t.original,mergeControls:!1,collapseUnchanged:{margin:3,minSize:4}}),e[0]=t.original,e[1]=s);let n;e[2]===s?n=e[3]:(n=[An.lineWrapping,s],e[2]=s,e[3]=n);let i=n,r;e[4]===Symbol.for("react.memo_cache_sentinel")?(r={"--marimo-code-editor-font-size":"10px"},e[4]=r):r=e[4];let l;e[5]===Symbol.for("react.memo_cache_sentinel")?(l={lineNumbers:!1,foldGutter:!1,dropCursor:!1,highlightActiveLineGutter:!1,allowMultipleSelections:!1,indentOnInput:!1,bracketMatching:!1,closeBrackets:!1,autocompletion:!1},e[5]=l):l=e[5];let c=a==="dark"?"dark":"light",d;return e[6]!==i||e[7]!==t.modified||e[8]!==c?(d=(0,o.jsx)(yr,{className:"cm font-mono",style:r,extensions:i,readOnly:!0,basicSetup:l,theme:c,value:t.modified}),e[6]=i,e[7]=t.modified,e[8]=c,e[9]=d):d=e[9],d});Ns.displayName="ReadonlyDiff";function bo(t){let e=t[0];return e.sessionUpdate==="tool_call"||e.sessionUpdate==="tool_call_update"}function wo(t){return t[0].sessionUpdate==="agent_thought_chunk"}function ko(t){return t[0].sessionUpdate==="user_message_chunk"}function jo(t){return t[0].sessionUpdate==="agent_message_chunk"}function No(t){return t[0].sessionUpdate==="plan"}var ne=be();function So(t){if(t.length===0)return t;let e=[],a=null;for(let s of t)s.type==="text"?a===null?a=s.text:a+=s.text:(a!==null&&(e.push({type:"text",text:a}),a=null),e.push(s));return a!==null&&e.push({type:"text",text:a}),e}const Co=t=>{let e=(0,ne.c)(14),a=t.data,s=t.data.message;if(s.includes("WebSocket"))return null;a instanceof Et&&(s=`${typeof a.data=="string"?a.data:JSON.stringify(a.data)} (code: ${a.code})`);let n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,o.jsx)("div",{className:"flex-shrink-0",children:(0,o.jsx)(Vt,{className:"h-5 w-5 text-[var(--red-11)]"})}),e[0]=n):n=e[0];let i;e[1]===Symbol.for("react.memo_cache_sentinel")?(i=(0,o.jsx)("div",{className:"flex items-center gap-2 mb-2",children:(0,o.jsx)("h4",{className:"text-sm font-medium text-[var(--red-11)]",children:"Agent Error"})}),e[1]=i):i=e[1];let r;e[2]===s?r=e[3]:(r=(0,o.jsx)("div",{className:"text-sm text-[var(--red-11)] leading-relaxed mb-3",children:s}),e[2]=s,e[3]=r);let l;e[4]===t.onRetry?l=e[5]:(l=t.onRetry&&(0,o.jsxs)(le,{size:"xs",variant:"outline",onClick:t.onRetry,className:"text-[var(--red-11)] border-[var(--red-6)] hover:bg-[var(--red-3)]",children:[(0,o.jsx)(Wa,{className:"h-3 w-3 mr-1"}),"Retry"]}),e[4]=t.onRetry,e[5]=l);let c;e[6]===t.onDismiss?c=e[7]:(c=t.onDismiss&&(0,o.jsxs)(le,{size:"xs",variant:"ghost",onClick:t.onDismiss,className:"text-[var(--red-10)] hover:bg-[var(--red-3)]",children:[(0,o.jsx)(Pa,{className:"h-3 w-3 mr-1"}),"Dismiss"]}),e[6]=t.onDismiss,e[7]=c);let d;e[8]!==l||e[9]!==c?(d=(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[l,c]}),e[8]=l,e[9]=c,e[10]=d):d=e[10];let u;return e[11]!==r||e[12]!==d?(u=(0,o.jsx)("div",{className:"border border-[var(--red-6)] bg-[var(--red-2)] rounded-lg p-4 my-2","data-block-type":"error",children:(0,o.jsxs)("div",{className:"flex items-start gap-3",children:[n,(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[i,r,d]})]})}),e[11]=r,e[12]=d,e[13]=u):u=e[13],u},ha=()=>{let t=(0,ne.c)(1),e;return t[0]===Symbol.for("react.memo_cache_sentinel")?(e=(0,o.jsx)("div",{className:"flex-1 flex items-center justify-center h-full min-h-[200px] flex-col",children:(0,o.jsxs)("div",{className:"text-center space-y-3",children:[(0,o.jsx)("div",{className:"w-12 h-12 mx-auto rounded-full bg-[var(--blue-3)] flex items-center justify-center",children:(0,o.jsx)(gt,{className:"h-6 w-6 text-[var(--blue-10)]"})}),(0,o.jsxs)("div",{children:[(0,o.jsx)("h3",{className:"text-lg font-medium text-foreground mb-1",children:"Agent is connected"}),(0,o.jsx)("p",{className:"text-sm text-muted-foreground",children:"You can start chatting with your agent now"})]})]})}),t[0]=e):e=t[0],e},Io=t=>{let e=(0,ne.c)(34),{status:a}=t.data;if(t.isConnected&&t.isOnlyBlock){let A;return e[0]===Symbol.for("react.memo_cache_sentinel")?(A=(0,o.jsx)(ha,{}),e[0]=A):A=e[0],A}let s;e[1]===a?s=e[2]:(s=(()=>{switch(a){case"connected":return{icon:(0,o.jsx)(Gt,{className:"h-4 w-4"}),title:"Connected to Agent",message:"Successfully established connection with the AI agent",bgColor:"bg-[var(--blue-2)]",borderColor:"border-[var(--blue-6)]",textColor:"text-[var(--blue-11)]",iconColor:"text-[var(--blue-10)]"};case"disconnected":return{icon:(0,o.jsx)(it,{className:"h-4 w-4"}),title:"Disconnected from Agent",message:"Connection to the AI agent has been lost",bgColor:"bg-[var(--amber-2)]",borderColor:"border-[var(--amber-6)]",textColor:"text-[var(--amber-11)]",iconColor:"text-[var(--amber-10)]"};case"connecting":return{icon:(0,o.jsx)(Gt,{className:"h-4 w-4 animate-pulse"}),title:"Connecting to Agent",message:"Establishing connection with the AI agent...",bgColor:"bg-[var(--gray-2)]",borderColor:"border-[var(--gray-6)]",textColor:"text-[var(--gray-11)]",iconColor:"text-[var(--gray-10)]"};case"error":return{icon:(0,o.jsx)(it,{className:"h-4 w-4"}),title:"Connection Error",message:"Failed to connect to the AI agent",bgColor:"bg-[var(--red-2)]",borderColor:"border-[var(--red-6)]",textColor:"text-[var(--red-11)]",iconColor:"text-[var(--red-10)]"};default:return{icon:(0,o.jsx)(it,{className:"h-4 w-4"}),title:"Connection Status Changed",message:`Agent connection status: ${a}`,bgColor:"bg-[var(--gray-2)]",borderColor:"border-[var(--gray-6)]",textColor:"text-[var(--gray-11)]",iconColor:"text-[var(--gray-10)]"}}})(),e[1]=a,e[2]=s);let n=s,i=a==="disconnected"||a==="error",r=`border ${n.borderColor} ${n.bgColor} rounded-lg p-3 my-2`,l=`flex-shrink-0 ${n.iconColor}`,c;e[3]!==n.icon||e[4]!==l?(c=(0,o.jsx)("div",{className:l,children:n.icon}),e[3]=n.icon,e[4]=l,e[5]=c):c=e[5];let d=`text-sm font-medium ${n.textColor}`,u;e[6]!==n.title||e[7]!==d?(u=(0,o.jsx)("h4",{className:d,children:n.title}),e[6]=n.title,e[7]=d,e[8]=u):u=e[8];let m;e[9]===t.timestamp?m=e[10]:(m=t.timestamp&&(0,o.jsx)("span",{className:"text-xs text-muted-foreground",children:new Date(t.timestamp).toLocaleTimeString()}),e[9]=t.timestamp,e[10]=m);let p;e[11]!==u||e[12]!==m?(p=(0,o.jsxs)("div",{className:"flex items-center gap-2 mb-1",children:[u,m]}),e[11]=u,e[12]=m,e[13]=p):p=e[13];let f=`text-sm ${n.textColor} opacity-90 mb-2`,x;e[14]!==n.message||e[15]!==f?(x=(0,o.jsx)("div",{className:f,children:n.message}),e[14]=n.message,e[15]=f,e[16]=x):x=e[16];let v;e[17]!==n.bgColor||e[18]!==n.borderColor||e[19]!==n.textColor||e[20]!==t.onRetry||e[21]!==i?(v=i&&t.onRetry&&(0,o.jsxs)(le,{size:"xs",variant:"outline",onClick:t.onRetry,className:`${n.textColor} ${n.borderColor} hover:${n.bgColor}`,children:[(0,o.jsx)(Wa,{className:"h-3 w-3 mr-1"}),"Retry Connection"]}),e[17]=n.bgColor,e[18]=n.borderColor,e[19]=n.textColor,e[20]=t.onRetry,e[21]=i,e[22]=v):v=e[22];let w;e[23]!==v||e[24]!==p||e[25]!==x?(w=(0,o.jsxs)("div",{className:"flex-1 min-w-0",children:[p,x,v]}),e[23]=v,e[24]=p,e[25]=x,e[26]=w):w=e[26];let j;e[27]!==w||e[28]!==c?(j=(0,o.jsxs)("div",{className:"flex items-start gap-3",children:[c,w]}),e[27]=w,e[28]=c,e[29]=j):j=e[29];let C;return e[30]!==a||e[31]!==r||e[32]!==j?(C=(0,o.jsx)("div",{className:r,"data-block-type":"connection-change","data-status":a,children:j}),e[30]=a,e[31]=r,e[32]=j,e[33]=C):C=e[33],C},To=t=>{let e=(0,ne.c)(7),a=t.startTimestamp/1e3,s=t.endTimestamp/1e3,n=`Thought for ${Math.round(s-a)||"1"}s`,i;e[0]===t.data?i=e[1]:(i=t.data.map(Wo),e[0]=t.data,e[1]=i);let r;e[2]===i?r=e[3]:(r=(0,o.jsx)("div",{className:"flex flex-col gap-2 text-muted-foreground",children:(0,o.jsx)(Zt,{data:i})}),e[2]=i,e[3]=r);let l;return e[4]!==n||e[5]!==r?(l=(0,o.jsx)("div",{className:"text-xs text-muted-foreground",children:(0,o.jsx)(xa,{title:n,children:r})}),e[4]=n,e[5]=r,e[6]=l):l=e[6],l},Ao=t=>{let e=(0,ne.c)(14),a,s,n,i;if(e[0]!==t.data){let c=t.data.flatMap(Vo);c=Rn(c,Bo),n="rounded-lg border bg-background p-2 text-xs";let d=(0,o.jsxs)("span",{className:"font-medium text-muted-foreground",children:["To-dos"," ",(0,o.jsx)("span",{className:"font-normal text-muted-foreground",children:c.length})]});e[5]===d?i=e[6]:(i=(0,o.jsx)("div",{className:"flex items-center justify-between mb-2",children:d}),e[5]=d,e[6]=i),a="flex flex-col gap-1",s=c.map(Ko),e[0]=t.data,e[1]=a,e[2]=s,e[3]=n,e[4]=i}else a=e[1],s=e[2],n=e[3],i=e[4];let r;e[7]!==a||e[8]!==s?(r=(0,o.jsx)("ul",{className:a,children:s}),e[7]=a,e[8]=s,e[9]=r):r=e[9];let l;return e[10]!==n||e[11]!==i||e[12]!==r?(l=(0,o.jsxs)("div",{className:n,children:[i,r]}),e[10]=n,e[11]=i,e[12]=r,e[13]=l):l=e[13],l},Ro=t=>{let e=(0,ne.c)(4),a;e[0]===t.data?a=e[1]:(a=t.data.map(Jo),e[0]=t.data,e[1]=a);let s;return e[2]===a?s=e[3]:(s=(0,o.jsx)("div",{className:"flex flex-col gap-2 text-muted-foreground border p-2 bg-background rounded break-words overflow-x-hidden",children:(0,o.jsx)(Zt,{data:a})}),e[2]=a,e[3]=s),s},Mo=t=>{let e=(0,ne.c)(4),a;e[0]===t.data?a=e[1]:(a=So(t.data.map(Ho)),e[0]=t.data,e[1]=a);let s=a,n;return e[2]===s?n=e[3]:(n=(0,o.jsx)("div",{className:"flex flex-col gap-2",children:(0,o.jsx)(Zt,{data:s})}),e[2]=s,e[3]=n),n},Zt=t=>{let e=(0,ne.c)(5),a=Yo,s;if(e[0]!==t.data){let i;e[2]===Symbol.for("react.memo_cache_sentinel")?(i=(r,l)=>(0,o.jsx)(M.Fragment,{children:a(r)},`${r.type}-${l}`),e[2]=i):i=e[2],s=t.data.map(i),e[0]=t.data,e[1]=s}else s=e[1];let n;return e[3]===s?n=e[4]:(n=(0,o.jsx)("div",{children:s}),e[3]=s,e[4]=n),n},Oo=t=>{let e=(0,ne.c)(3),a=`data:${t.data.mimeType};base64,${t.data.data}`,s=t.data.uri??"",n;return e[0]!==a||e[1]!==s?(n=(0,o.jsx)("img",{src:a,alt:s}),e[0]=a,e[1]=s,e[2]=n):n=e[2],n},Eo=t=>{let e=(0,ne.c)(3),a=`data:${t.data.mimeType};base64,${t.data.data}`,s;e[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)("track",{kind:"captions"}),e[0]=s):s=e[0];let n;return e[1]===a?n=e[2]:(n=(0,o.jsx)("audio",{src:a,controls:!0,children:s}),e[1]=a,e[2]=n),n},Zo=t=>{let e=(0,ne.c)(12);if("text"in t.data.resource){let a;e[0]===t.data.resource.mimeType?a=e[1]:(a=t.data.resource.mimeType&&(0,o.jsx)(fa,{mimeType:t.data.resource.mimeType}),e[0]=t.data.resource.mimeType,e[1]=a);let s;e[2]!==t.data.resource.uri||e[3]!==a?(s=(0,o.jsx)(Va,{children:(0,o.jsxs)("span",{className:"flex items-center gap-1 hover:bg-muted rounded-md px-1",children:[a,t.data.resource.uri]})}),e[2]=t.data.resource.uri,e[3]=a,e[4]=s):s=e[4];let n;e[5]===Symbol.for("react.memo_cache_sentinel")?(n=(0,o.jsx)("span",{className:"text-muted-foreground text-xs mb-1 italic",children:"Formatted for agents, not humans."}),e[5]=n):n=e[5];let i;e[6]!==t.data.resource.mimeType||e[7]!==t.data.resource.text?(i=(0,o.jsxs)(Ba,{className:"max-h-96 overflow-y-auto scrollbar-thin whitespace-pre-wrap w-full max-w-[500px]",children:[n,t.data.resource.mimeType==="text/plain"?(0,o.jsx)("pre",{className:"text-xs whitespace-pre-wrap p-2 bg-muted rounded-md break-words",children:t.data.resource.text}):(0,o.jsx)(La,{content:t.data.resource.text})]}),e[6]=t.data.resource.mimeType,e[7]=t.data.resource.text,e[8]=i):i=e[8];let r;return e[9]!==s||e[10]!==i?(r=(0,o.jsxs)(Ka,{children:[s,i]}),e[9]=s,e[10]=i,e[11]=r):r=e[11],r}},Po=t=>{var i;let e=(0,ne.c)(19);if(t.data.uri.startsWith("http")){let r;return e[0]!==t.data.name||e[1]!==t.data.uri?(r=(0,o.jsx)("a",{href:t.data.uri,target:"_blank",rel:"noopener noreferrer",className:"text-link hover:underline px-1",children:t.data.name}),e[0]=t.data.name,e[1]=t.data.uri,e[2]=r):r=e[2],r}if((i=t.data.mimeType)!=null&&i.startsWith("image/")){let r;e[3]===t.data.mimeType?r=e[4]:(r=(0,o.jsx)(fa,{mimeType:t.data.mimeType}),e[3]=t.data.mimeType,e[4]=r);let l=t.data.name||t.data.title||t.data.uri,c;e[5]!==r||e[6]!==l?(c=(0,o.jsx)(Va,{children:(0,o.jsxs)("span",{className:"flex items-center gap-1 hover:bg-muted rounded-md px-1 cursor-pointer",children:[r,l]})}),e[5]=r,e[6]=l,e[7]=c):c=e[7];let d=t.data.name||t.data.title||"Image",u;e[8]!==t.data.uri||e[9]!==d?(u=(0,o.jsx)(Ba,{className:"w-auto max-w-[500px] p-2",children:(0,o.jsx)("img",{src:t.data.uri,alt:d,className:"max-w-full max-h-96 object-contain"})}),e[8]=t.data.uri,e[9]=d,e[10]=u):u=e[10];let m;return e[11]!==c||e[12]!==u?(m=(0,o.jsx)("div",{children:(0,o.jsxs)(Ka,{children:[c,u]})}),e[11]=c,e[12]=u,e[13]=m):m=e[13],m}let a;e[14]===t.data.mimeType?a=e[15]:(a=t.data.mimeType&&(0,o.jsx)(fa,{mimeType:t.data.mimeType}),e[14]=t.data.mimeType,e[15]=a);let s=t.data.name||t.data.title||t.data.uri,n;return e[16]!==a||e[17]!==s?(n=(0,o.jsxs)("span",{className:"flex items-center gap-1 px-1",children:[a,s]}),e[16]=a,e[17]=s,e[18]=n):n=e[18],n},fa=t=>{let e=(0,ne.c)(6);if(t.mimeType.startsWith("image/")){let s;return e[0]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(Gn,{className:"h-2 w-2 flex-shrink-0"}),e[0]=s):s=e[0],s}if(t.mimeType.startsWith("audio/")){let s;return e[1]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(Qn,{className:"h-2 w-2 flex-shrink-0"}),e[1]=s):s=e[1],s}if(t.mimeType.startsWith("video/")){let s;return e[2]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(Xn,{className:"h-2 w-2 flex-shrink-0"}),e[2]=s):s=e[2],s}if(t.mimeType.startsWith("text/")){let s;return e[3]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(bn,{className:"h-2 w-2 flex-shrink-0"}),e[3]=s):s=e[3],s}if(t.mimeType.startsWith("application/")){let s;return e[4]===Symbol.for("react.memo_cache_sentinel")?(s=(0,o.jsx)(Yn,{className:"h-2 w-2 flex-shrink-0"}),e[4]=s):s=e[4],s}let a;return e[5]===Symbol.for("react.memo_cache_sentinel")?(a=(0,o.jsx)(er,{className:"h-2 w-2 flex-shrink-0"}),e[5]=a):a=e[5],a},$o=t=>{let e=(0,ne.c)(11);if(t.data.length===0)return null;let a=t.data[0].sessionUpdate,s;e[0]!==a||e[1]!==t.endTimestamp||e[2]!==t.isLastBlock||e[3]!==t.startTimestamp?(s=l=>{if(bo(l))return(0,o.jsx)(Uo,{data:l,isLastBlock:t.isLastBlock});if(wo(l))return(0,o.jsx)(To,{startTimestamp:t.startTimestamp,endTimestamp:t.endTimestamp,data:l});if(ko(l))return(0,o.jsx)(Ro,{data:l});if(jo(l))return(0,o.jsx)(Mo,{data:l});if(No(l))return(0,o.jsx)(Ao,{data:l});if(a==="available_commands_update")return null;if(a==="current_mode_update"){let c=l.at(-1);return(c==null?void 0:c.sessionUpdate)==="current_mode_update"?(0,o.jsx)(Fo,{data:c}):null}return(0,o.jsx)(xa,{title:l[0].sessionUpdate,children:(0,o.jsx)(Ea,{data:l,format:"tree",className:"max-h-64"})})},e[0]=a,e[1]=t.endTimestamp,e[2]=t.isLastBlock,e[3]=t.startTimestamp,e[4]=s):s=e[4];let n=s,i;e[5]!==t.data||e[6]!==n?(i=n(t.data),e[5]=t.data,e[6]=n,e[7]=i):i=e[7];let r;return e[8]!==a||e[9]!==i?(r=(0,o.jsx)("div",{className:"flex flex-col text-sm gap-2","data-block-type":a,children:i}),e[8]=a,e[9]=i,e[10]=r):r=e[10],r},Fo=t=>{let e=(0,ne.c)(2),{currentModeId:a}=t.data,s;return e[0]===a?s=e[1]:(s=(0,o.jsxs)("div",{children:["Mode: ",a]}),e[0]=a,e[1]=s),s},Uo=t=>{let e=(0,ne.c)(9),a,s;if(e[0]!==t.data||e[1]!==t.isLastBlock){let i=yo(t.data);a="flex flex-col text-muted-foreground overflow-x-hidden";let r;e[4]===t.isLastBlock?r=e[5]:(r=l=>(0,o.jsx)(xa,{status:l.status==="completed"?"success":l.status==="failed"?"error":(l.status==="in_progress"||l.status==="pending")&&!t.isLastBlock?"loading":void 0,title:(0,o.jsx)("span",{"data-tool-data":JSON.stringify(l),children:Do(zo(l))}),defaultIcon:(0,o.jsx)(or,{className:"h-3 w-3"}),children:(0,o.jsx)(Cs,{data:l})},l.toolCallId),e[4]=t.isLastBlock,e[5]=r),s=i.map(r),e[0]=t.data,e[1]=t.isLastBlock,e[2]=a,e[3]=s}else a=e[2],s=e[3];let n;return e[6]!==a||e[7]!==s?(n=(0,o.jsx)("div",{className:a,children:s}),e[6]=a,e[7]=s,e[8]=n):n=e[8],n},Ss=t=>{let e=(0,ne.c)(4),a;e[0]===t.data?a=e[1]:(a=t.data.map(Go),e[0]=t.data,e[1]=a);let s;return e[2]===a?s=e[3]:(s=(0,o.jsx)("div",{className:"flex flex-col gap-2 text-muted-foreground",children:a}),e[2]=a,e[3]=s),s};function zo(t){var n;let e=t.title;e==='"undefined"'&&(e=void 0);let a=e||yn.startCase(t.kind||"")||"Tool call",s=(n=t.locations)==null?void 0:n[0];return s&&!a.includes(s.path)?`${a}: ${s.path}`:a}function Do(t){return t.startsWith("`")&&t.endsWith("`")?(0,o.jsx)("i",{children:t.slice(1,-1)}):t}const Lo=t=>{let e=(0,ne.c)(6);if(t.data.length<=1)return null;let a,s;if(e[0]!==t.data){let i=t.data.map(Qo);a="flex flex-col gap-2",s=i.join(`
`),e[0]=t.data,e[1]=a,e[2]=s}else a=e[1],s=e[2];let n;return e[3]!==a||e[4]!==s?(n=(0,o.jsx)("div",{className:a,children:s}),e[3]=a,e[4]=s,e[5]=n):n=e[5],n},Cs=t=>{let e=(0,ne.c)(30),{content:a,locations:s,status:n,kind:i,rawInput:r}=t.data,l;e[0]===a?l=e[1]:(l=a==null?void 0:a.filter(Xo).map(el),e[0]=a,e[1]=l);let c=l,d;e[2]===a?d=e[3]:(d=a==null?void 0:a.filter(tl),e[2]=a,e[3]=d);let u=d,m=n==="failed",p=s&&s.length>0;if(!a&&!p&&r){let A;e[4]===r?A=e[5]:(A=qo.safeParse(r),e[4]=r,e[5]=A);let I=A;if(I.success){let U;return e[6]!==I.data.abs_path||e[7]!==I.data.new_string||e[8]!==I.data.old_string?(U=(0,o.jsx)(Ss,{data:[{type:"diff",oldText:I.data.old_string,newText:I.data.new_string,path:I.data.abs_path}]}),e[6]=I.data.abs_path,e[7]=I.data.new_string,e[8]=I.data.old_string,e[9]=U):U=e[9],U}let O;return e[10]===r?O=e[11]:(O=(0,o.jsx)("pre",{className:"bg-[var(--slate-2)] p-1 text-muted-foreground border border-[var(--slate-4)] rounded text-xs overflow-auto scrollbar-thin max-h-64",children:(0,o.jsx)(Ea,{data:r,format:"tree"})}),e[10]=r,e[11]=O),O}let f=!c||c.length===0,x=!u||u.length===0;if(f&&x&&p){let A=i||"",I;e[12]===A?I=e[13]:(I=Ht(A),e[12]=A,e[13]=I);let O;e[14]===s?O=e[15]:(O=s==null?void 0:s.map(al).join(", "),e[14]=s,e[15]=O);let U;return e[16]!==I||e[17]!==O?(U=(0,o.jsx)("div",{className:"flex flex-col gap-2 pr-2",children:(0,o.jsxs)("span",{className:"text-xs text-muted-foreground",children:[I," ",O]})}),e[16]=I,e[17]=O,e[18]=U):U=e[18],U}let v;e[19]===s?v=e[20]:(v=s&&(0,o.jsx)(Lo,{data:s}),e[19]=s,e[20]=v);let w;e[21]===c?w=e[22]:(w=c&&(0,o.jsx)(Zt,{data:c}),e[21]=c,e[22]=w);let j;e[23]!==u||e[24]!==m?(j=u&&!m&&(0,o.jsx)(Ss,{data:u}),e[23]=u,e[24]=m,e[25]=j):j=e[25];let C;return e[26]!==v||e[27]!==w||e[28]!==j?(C=(0,o.jsxs)("div",{className:"flex flex-col gap-2 pr-2",children:[v,w,j]}),e[26]=v,e[27]=w,e[28]=j,e[29]=C):C=e[29],C};var qo=Sn({abs_path:Jt(),old_string:Jt(),new_string:Jt()});function Wo(t){return t.content}function Vo(t){return t.entries}function Bo(t){return t.content}function Ko(t,e){return(0,o.jsxs)("li",{className:`
              flex items-center gap-2 px-2 py-1 rounded
            `,children:[(0,o.jsx)("input",{type:"checkbox",checked:t.status==="completed",readOnly:!0,className:"accent-primary h-4 w-4 rounded border border-muted-foreground/30",tabIndex:-1}),(0,o.jsx)("span",{className:xe("text-xs",t.status==="completed"&&"line-through text-muted-foreground"),children:t.content})]},`${t.status}-${e}`)}function Jo(t){return t.content}function Ho(t){return t.content}function Yo(t){return t.type==="text"?(0,o.jsx)(La,{content:t.text}):t.type==="image"?(0,o.jsx)(Oo,{data:t}):t.type==="audio"?(0,o.jsx)(Eo,{data:t}):t.type==="resource"?(0,o.jsx)(Zo,{data:t}):t.type==="resource_link"?(0,o.jsx)(Po,{data:t}):(Cn(t),null)}function Go(t){return(0,o.jsxs)("div",{className:"border rounded-md overflow-hidden bg-[var(--gray-2)] overflow-y-auto scrollbar-thin max-h-64",children:[(0,o.jsx)("div",{className:"px-2 py-1 bg-[var(--gray-2)] border-b text-xs font-medium text-[var(--gray-11)]",children:t.path}),(0,o.jsx)(Ns,{original:t.oldText||"",modified:t.newText||""})]},t.path)}function Qo(t){return t.line?`${t.path}:${t.line}`:t.path}function Xo(t){return t.type==="content"}function el(t){return t.content}function tl(t){return t.type==="diff"}function al(t){return t.path}var ga=be();const xa=t=>{let e=(0,ga.c)(31),{title:a,children:s,status:n,index:i,defaultIcon:r}=t,l=i===void 0?0:i,c;e[0]!==r||e[1]!==n?(c=()=>{switch(n){case"loading":return(0,o.jsx)(tr,{className:"h-3 w-3 animate-spin"});case"error":return(0,o.jsx)(Vt,{className:"h-3 w-3 text-destructive"});case"success":return(0,o.jsx)(qa,{className:"h-3 w-3 text-[var(--blue-9)]"});default:return r}},e[0]=r,e[1]=n,e[2]=c):c=e[2];let d=c,u=`tool-${l}`,m=n==="error"&&"text-destructive/80",p=n==="success"&&"text-[var(--blue-8)]",f;e[3]!==m||e[4]!==p?(f=xe("py-1 text-xs border-border shadow-none! ring-0! bg-muted hover:bg-muted/30 px-2 gap-1 rounded-sm [&[data-state=open]>svg]:rotate-180",m,p),e[3]=m,e[4]=p,e[5]=f):f=e[5];let x;e[6]===d?x=e[7]:(x=d(),e[6]=d,e[7]=x);let v;e[8]===a?v=e[9]:(v=(0,o.jsx)("code",{className:"font-mono text-xs truncate",children:a}),e[8]=a,e[9]=v);let w;e[10]!==x||e[11]!==v?(w=(0,o.jsxs)("span",{className:"flex items-center gap-1",children:[x,v]}),e[10]=x,e[11]=v,e[12]=w):w=e[12];let j;e[13]!==f||e[14]!==w?(j=(0,o.jsx)(pr,{className:f,children:w}),e[13]=f,e[14]=w,e[15]=j):j=e[15];let C;e[16]!==s||e[17]!==n?(C=n!=="error"&&(0,o.jsx)("div",{className:"text-xs font-medium text-muted-foreground mb-1",children:s}),e[16]=s,e[17]=n,e[18]=C):C=e[18];let A;e[19]!==s||e[20]!==n?(A=n==="error"&&(0,o.jsx)("div",{className:"bg-destructive/10 border border-destructive/20 rounded-md p-3 text-xs text-destructive",children:s}),e[19]=s,e[20]=n,e[21]=A):A=e[21];let I;e[22]!==C||e[23]!==A?(I=(0,o.jsx)(gr,{className:"p-2",children:(0,o.jsxs)("div",{className:"space-y-3 max-h-64 overflow-y-auto scrollbar-thin",children:[C,A]})}),e[22]=C,e[23]=A,e[24]=I):I=e[24];let O;e[25]!==j||e[26]!==I?(O=(0,o.jsxs)(hr,{value:"tool-call",className:"border-0",children:[j,I]}),e[25]=j,e[26]=I,e[27]=O):O=e[27];let U;return e[28]!==O||e[29]!==u?(U=(0,o.jsx)(fr,{type:"single",collapsible:!0,className:"w-full",children:O},u),e[28]=O,e[29]=u,e[30]=U):U=e[30],U},Is=(0,M.memo)(t=>{let e=(0,ga.c)(16),{status:a,className:s}=t,n;e[0]===a?n=e[1]:(n=()=>{switch(a){case"connected":return{icon:(0,o.jsx)(Gt,{className:"h-3 w-3"}),label:"Connected",variant:"default",className:"bg-[var(--blue-3)] text-[var(--blue-11)] border-[var(--blue-5)]"};case"connecting":return{icon:(0,o.jsx)(sr,{className:"h-3 w-3 animate-pulse"}),label:"Connecting",variant:"secondary",className:"bg-[var(--yellow-3)] text-[var(--yellow-11)] border-[var(--yellow-5)]"};case"disconnected":return{icon:(0,o.jsx)(it,{className:"h-3 w-3"}),label:"Disconnected",variant:"outline",className:"bg-[var(--red-3)] text-[var(--red-11)] border-[var(--red-5)]"};default:return{icon:(0,o.jsx)(it,{className:"h-3 w-3"}),label:a||"Unknown",variant:"outline",className:"bg-[var(--gray-3)] text-[var(--gray-11)] border-[var(--gray-5)]"}}},e[0]=a,e[1]=n);let i=n,r,l,c,d;e[2]!==s||e[3]!==i?(l=i(),r=lr,c=l.variant,d=xe(l.className,s),e[2]=s,e[3]=i,e[4]=r,e[5]=l,e[6]=c,e[7]=d):(r=e[4],l=e[5],c=e[6],d=e[7]);let u;e[8]===l.label?u=e[9]:(u=(0,o.jsx)("span",{className:"ml-1 text-xs font-medium",children:l.label}),e[8]=l.label,e[9]=u);let m;return e[10]!==r||e[11]!==l.icon||e[12]!==c||e[13]!==d||e[14]!==u?(m=(0,o.jsxs)(r,{variant:c,className:d,children:[l.icon,u]}),e[10]=r,e[11]=l.icon,e[12]=c,e[13]=d,e[14]=u,e[15]=m):m=e[15],m});Is.displayName="ConnectionStatus";const Ts=(0,M.memo)(t=>{let e=(0,ga.c)(14),{permission:a,onResolve:s}=t,n,i;e[0]===Symbol.for("react.memo_cache_sentinel")?(n=(0,o.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,o.jsx)(jr,{className:"h-4 w-4 text-[var(--amber-11)]"}),(0,o.jsx)("h3",{className:"text-sm font-medium text-[var(--amber-11)]",children:"Permission Request"})]}),i=(0,o.jsx)("p",{className:"text-sm text-[var(--amber-11)] mb-3",children:"The AI agent is requesting permission to proceed:"}),e[0]=n,e[1]=i):(n=e[0],i=e[1]);let r;e[2]===a.toolCall?r=e[3]:(r=(0,o.jsx)(Cs,{data:a.toolCall}),e[2]=a.toolCall,e[3]=r);let l;if(e[4]!==s||e[5]!==a.options){let u;e[7]===s?u=e[8]:(u=m=>(0,o.jsxs)(le,{size:"xs",variant:"text",className:m.kind.startsWith("allow")?"text-[var(--blue-10)]":"text-[var(--red-10)]",onClick:()=>s({outcome:{outcome:"selected",optionId:m.optionId}}),children:[m.kind.startsWith("allow")&&(0,o.jsx)(qa,{className:"h-3 w-3 mr-1"}),m.kind.startsWith("reject")&&(0,o.jsx)(Vt,{className:"h-3 w-3 mr-1"}),m.name]},m.optionId),e[7]=s,e[8]=u),l=a.options.map(u),e[4]=s,e[5]=a.options,e[6]=l}else l=e[6];let c;e[9]===l?c=e[10]:(c=(0,o.jsx)("div",{className:"flex gap-2",children:l}),e[9]=l,e[10]=c);let d;return e[11]!==r||e[12]!==c?(d=(0,o.jsxs)("div",{className:"border border-[var(--amber-8)] bg-[var(--amber-2)] rounded-lg p-2",children:[n,i,r,c]}),e[11]=r,e[12]=c,e[13]=d):d=e[13],d});Ts.displayName="PermissionRequest";var sl=be();function nl(){let t=(0,sl.c)(3),{addCommand:e}=br(),{openApplication:a}=jn(),s;return t[0]!==e||t[1]!==a?(s={sendCommand:n=>{a("terminal"),e(n)}},t[0]=e,t[1]=a,t[2]=s):s=t[2],s}var As=1;const ct=wn("marimo:acp:sessions:v1",{sessions:[],activeTabId:null},kn),va=xn(t=>{let e=t(ct);return e.activeTabId&&e.sessions.find(a=>a.tabId===e.activeTabId)||null},(t,e,a)=>{e(ct,s=>({...s,activeTabId:a}))});function rl(){return`tab_${cr()}`}function Rs(t,e=20){return t.length<=e?t:`${t.slice(0,e-3)}...`}function il(t,e){let a=Os(e.agentId),s=Date.now(),n=e.firstMessage?Rs(e.firstMessage.trim()):`New ${e.agentId} session`,i=rl();if(a==="single"){let r=t.sessions.filter(c=>c.agentId===e.agentId),l=t.sessions.filter(c=>c.agentId!==e.agentId);if(r.length>0){let c=r[0],d={agentId:e.agentId,title:n,createdAt:s,lastUsedAt:s,tabId:c.tabId,externalAgentSessionId:null,selectedModel:e.model??c.selectedModel??null};return{...t,sessions:[...l.slice(0,As-1),d],activeTabId:d.tabId}}}return{...t,sessions:[...t.sessions.slice(0,As-1),{agentId:e.agentId,tabId:i,title:n,createdAt:s,lastUsedAt:s,externalAgentSessionId:null,selectedModel:e.model??null}],activeTabId:i}}function ol(t,e){let a=t.sessions.filter(s=>s.tabId!==e);return{sessions:a,activeTabId:t.activeTabId===e?a.length>0?a[a.length-1].tabId:null:t.activeTabId}}function ll(t,e){let a=t.activeTabId;return a?{...t,sessions:t.sessions.map(s=>s.tabId===a?{...s,title:Rs(e)}:s)}:t}function cl(t,e){return{...t,sessions:t.sessions.map(a=>a.tabId===e?{...a,lastUsedAt:Date.now()}:a)}}function Ms(t,e){let a=t.activeTabId;return a?{...t,sessions:t.sessions.map(s=>s.tabId===a?{...s,externalAgentSessionId:e,lastUsedAt:Date.now()}:s)}:t}function dl(){return["claude","gemini","codex","opencode"]}function ul(t){return Ht(t)}function ml(t){return Pt[t].webSocketUrl}var Pt={claude:{port:3017,command:"npx @zed-industries/claude-code-acp",webSocketUrl:"ws://localhost:3017/message",sessionSupport:"single"},gemini:{port:3019,command:"npx @google/gemini-cli --experimental-acp",webSocketUrl:"ws://localhost:3019/message",sessionSupport:"single"},codex:{port:3021,command:"npx @zed-industries/codex-acp",webSocketUrl:"ws://localhost:3021/message",sessionSupport:"single"},opencode:{port:3023,command:"npx opencode-ai acp",webSocketUrl:"ws://localhost:3023/message",sessionSupport:"single"}};function Os(t){return Pt[t].sessionSupport}function pl(t){let e=Pt[t].port,a=Pt[t].command;return`npx stdio-to-ws "${In()?`cmd /c ${a}`:a}" --port ${e}`}var Es=be(),hl=new Set(["opencode"]),Zs=(0,M.memo)(t=>{let e=(0,Es.c)(38),{agentId:a,showCopy:s,className:n}=t,i=s===void 0?!0:s,r;e[0]===a?r=e[1]:(r=pl(a),e[0]=a,e[1]=r);let l=r,c;e[2]===a?c=e[3]:(c=ul(a),e[2]=a,e[3]=c);let d=c,u=Ra(Nn),{sendCommand:m}=nl(),p;e[4]!==l||e[5]!==m?(p=()=>{m(l)},e[4]=l,e[5]=m,e[6]=p):p=e[6];let f=p,x;e[7]===n?x=e[8]:(x=xe("space-y-2",n),e[7]=n,e[8]=x);let v;e[9]===a?v=e[10]:(v=(0,o.jsx)(xt,{provider:a,className:"h-4 w-4"}),e[9]=a,e[10]=v);let w;e[11]===a?w=e[12]:(w=hl.has(a)&&(0,o.jsx)("span",{className:"text-muted-foreground ml-1",children:"(beta)"}),e[11]=a,e[12]=w);let j;e[13]!==d||e[14]!==w?(j=(0,o.jsxs)("span",{className:"font-medium text-sm",children:[d,w]}),e[13]=d,e[14]=w,e[15]=j):j=e[15];let C;e[16]!==v||e[17]!==j?(C=(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[v,j]}),e[16]=v,e[17]=j,e[18]=C):C=e[18];let A;e[19]===Symbol.for("react.memo_cache_sentinel")?(A=(0,o.jsx)(ar,{className:"h-4 w-4 mt-0.5 text-muted-foreground flex-shrink-0"}),e[19]=A):A=e[19];let I;e[20]===l?I=e[21]:(I=(0,o.jsx)("code",{className:"text-xs font-mono break-words flex-1 whitespace-pre-wrap",children:l}),e[20]=l,e[21]=I);let O;e[22]!==l||e[23]!==i?(O=i&&(0,o.jsx)(le,{size:"xs",variant:"outline",className:"border",children:(0,o.jsx)(mr,{value:l,className:"h-3 w-3"})}),e[22]=l,e[23]=i,e[24]=O):O=e[24];let U;e[25]!==u.terminal||e[26]!==f?(U=u.terminal&&(0,o.jsx)(yt,{content:"Run in terminal",delayDuration:100,children:(0,o.jsx)(le,{onClick:f,title:"Send to terminal",size:"xs",variant:"outline",children:(0,o.jsx)(_n,{className:"h-3 w-3"})})}),e[25]=u.terminal,e[26]=f,e[27]=U):U=e[27];let L;e[28]!==O||e[29]!==U?(L=(0,o.jsxs)("div",{className:"flex items-center gap-1 flex-shrink-0",children:[O,U]}),e[28]=O,e[29]=U,e[30]=L):L=e[30];let V;e[31]!==I||e[32]!==L?(V=(0,o.jsx)("div",{className:"bg-muted/50 rounded-md p-2 border",children:(0,o.jsxs)("div",{className:"flex items-start gap-2 text-xs",children:[A,I,L]})}),e[31]=I,e[32]=L,e[33]=V):V=e[33];let K;return e[34]!==V||e[35]!==x||e[36]!==C?(K=(0,o.jsxs)("div",{className:x,children:[C,V]}),e[34]=V,e[35]=x,e[36]=C,e[37]=K):K=e[37],K});Zs.displayName="AgentDocItem";const $t=(0,M.memo)(t=>{let e=(0,Es.c)(22),{title:a,description:s,agents:n,showCopy:i,className:r}=t,l;e[0]===n?l=e[1]:(l=n===void 0?dl():n,e[0]=n,e[1]=l);let c=l,d=i===void 0?!0:i,u;e[2]===r?u=e[3]:(u=xe("space-y-4",r),e[2]=r,e[3]=u);let m;e[4]===a?m=e[5]:(m=(0,o.jsx)("h3",{className:"font-medium text-sm",children:a}),e[4]=a,e[5]=m);let p;e[6]===s?p=e[7]:(p=(0,o.jsx)("p",{className:"text-xs text-muted-foreground",children:s}),e[6]=s,e[7]=p);let f;e[8]!==m||e[9]!==p?(f=(0,o.jsxs)("div",{className:"space-y-2",children:[m,p]}),e[8]=m,e[9]=p,e[10]=f):f=e[10];let x;if(e[11]!==c||e[12]!==d){let j;e[14]===d?j=e[15]:(j=C=>(0,o.jsx)(Zs,{agentId:C,showCopy:d},C),e[14]=d,e[15]=j),x=c.map(j),e[11]=c,e[12]=d,e[13]=x}else x=e[13];let v;e[16]===x?v=e[17]:(v=(0,o.jsx)("div",{className:"space-y-3",children:x}),e[16]=x,e[17]=v);let w;return e[18]!==u||e[19]!==f||e[20]!==v?(w=(0,o.jsxs)("div",{className:u,children:[f,v]}),e[18]=u,e[19]=f,e[20]=v,e[21]=w):w=e[21],w});$t.displayName="AgentDocs";var Ps=be(),fl=[{id:"claude",displayName:"Claude",iconId:"anthropic"},{id:"gemini",displayName:"Gemini",iconId:"google"},{id:"codex",displayName:"Codex",iconId:"openai"},{id:"opencode",displayName:"OpenCode",iconId:"opencode"}],$s=(0,M.memo)(t=>{let e=(0,Ps.c)(42),{agent:a,onSelect:s,existingSessions:n,filename:i}=t,r=Os(a.id),l=n.some(L=>L.agentId===a.id),c=r==="single"&&l,d=c?`Reset ${a.displayName} session`:`New ${a.displayName} session`;if(c){let L;e[0]!==a.id||e[1]!==s?(L=()=>s(a.id),e[0]=a.id,e[1]=s,e[2]=L):L=e[2];let V;e[3]===a.iconId?V=e[4]:(V=(0,o.jsx)(xt,{provider:a.iconId,className:"h-3 w-3 mr-2"}),e[3]=a.iconId,e[4]=V);let K;e[5]===d?K=e[6]:(K=(0,o.jsx)("span",{children:d}),e[5]=d,e[6]=K);let B;e[7]!==V||e[8]!==K?(B=(0,o.jsxs)("div",{className:"flex items-center w-full",children:[V,K]}),e[7]=V,e[8]=K,e[9]=B):B=e[9];let P;return e[10]!==L||e[11]!==B?(P=(0,o.jsx)(Ln,{onClick:L,className:"cursor-pointer",children:B}),e[10]=L,e[11]=B,e[12]=P):P=e[12],P}let u;e[13]!==a.id||e[14]!==s?(u=()=>s(a.id),e[13]=a.id,e[14]=s,e[15]=u):u=e[15];let m;e[16]===a.iconId?m=e[17]:(m=(0,o.jsx)(xt,{provider:a.iconId,className:"h-3 w-3 mr-2"}),e[16]=a.iconId,e[17]=m);let p;e[18]===d?p=e[19]:(p=(0,o.jsx)("span",{children:d}),e[18]=d,e[19]=p);let f;e[20]!==m||e[21]!==p?(f=(0,o.jsxs)("div",{className:"flex items-center w-full",children:[m,p]}),e[20]=m,e[21]=p,e[22]=f):f=e[22];let x;e[23]!==u||e[24]!==f?(x=(0,o.jsx)(Wn,{showChevron:!1,className:"cursor-pointer",onClick:u,children:f}),e[23]=u,e[24]=f,e[25]=x):x=e[25];let v=a.displayName,w;e[26]===Symbol.for("react.memo_cache_sentinel")?(w=(0,o.jsx)("br",{}),e[26]=w):w=e[26];let j;e[27]===i?j=e[28]:(j=Kt.dirname(i??""),e[27]=i,e[28]=j);let C;e[29]===j?C=e[30]:(C=(0,o.jsx)("code",{className:"bg-muted font-mono",children:j}),e[29]=j,e[30]=C);let A;e[31]!==a.displayName||e[32]!==C?(A=(0,o.jsxs)("div",{className:"text-xs font-medium text-muted-foreground mb-3",children:["To start a ",v," agent, run the following command in your terminal.",w,"Note: This must be in the directory"," ",C]}),e[31]=a.displayName,e[32]=C,e[33]=A):A=e[33];let I;e[34]===a.id?I=e[35]:(I=(0,o.jsx)($t,{agents:[a.id],showCopy:!0}),e[34]=a.id,e[35]=I);let O;e[36]!==A||e[37]!==I?(O=(0,o.jsx)(Kn,{children:(0,o.jsx)(qn,{className:"w-120",children:(0,o.jsxs)("div",{className:"px-2 py-2",children:[A,I]})})}),e[36]=A,e[37]=I,e[38]=O):O=e[38];let U;return e[39]!==O||e[40]!==x?(U=(0,o.jsxs)(Hn,{children:[x,O]}),e[39]=O,e[40]=x,e[41]=U):U=e[41],U});$s.displayName="AgentMenuItem";const Ft=(0,M.memo)(t=>{let e=(0,Ps.c)(21),{onSessionCreated:a,className:s}=t,n=xr(),[i,r]=ft(ct),l=Aa(va),[c,d]=(0,M.useState)(!1),u;e[0]!==a||e[1]!==i||e[2]!==l||e[3]!==r?(u=async A=>{let I=il(i,{agentId:A});r(I),l(I.activeTabId),d(!1),a==null||a(A)},e[0]=a,e[1]=i,e[2]=l,e[3]=r,e[4]=u):u=e[4];let m=oe(u),p;e[5]===s?p=e[6]:(p=xe("h-6 gap-1 px-2 text-xs bg-muted/30 hover:bg-muted/50 border border-border border-y-0 rounded-none focus-visible:ring-0",s),e[5]=s,e[6]=p);let f,x;e[7]===Symbol.for("react.memo_cache_sentinel")?(f=(0,o.jsx)("span",{children:"New session"}),x=(0,o.jsx)(Dn,{className:"h-3 w-3"}),e[7]=f,e[8]=x):(f=e[7],x=e[8]);let v;e[9]===p?v=e[10]:(v=(0,o.jsx)(Vn,{asChild:!0,children:(0,o.jsxs)(le,{variant:"ghost",size:"sm",className:p,children:[f,x]})}),e[9]=p,e[10]=v);let w;e[11]!==n||e[12]!==m||e[13]!==i?(w=fl.map(A=>(0,o.jsx)($s,{agent:A,onSelect:m,existingSessions:i.sessions,filename:n},A.id)),e[11]=n,e[12]=m,e[13]=i,e[14]=w):w=e[14];let j;e[15]===w?j=e[16]:(j=(0,o.jsx)(Bn,{align:"start",className:"w-fit",children:w}),e[15]=w,e[16]=j);let C;return e[17]!==c||e[18]!==v||e[19]!==j?(C=(0,o.jsxs)(Jn,{open:c,onOpenChange:d,children:[v,j]}),e[17]=c,e[18]=v,e[19]=j,e[20]=C):C=e[20],C});Ft.displayName="AgentSelector";var gl=be();const Fs=(0,M.memo)(t=>{let e=(0,gl.c)(18),{sessionModels:a,onModelChange:s,disabled:n}=t;if(!a||a.availableModels.length===0)return null;let{availableModels:i,currentModelId:r}=a,l;if(e[0]!==i||e[1]!==r){let x;e[3]===r?x=e[4]:(x=v=>v.modelId===r,e[3]=r,e[4]=x),l=i.find(x),e[0]=i,e[1]=r,e[2]=l}else l=e[2];let c=(l==null?void 0:l.name)??r,d;e[5]===c?d=e[6]:(d=(0,o.jsx)(za,{className:"h-6 text-xs border-border shadow-none! ring-0! bg-muted hover:bg-muted/30 py-0 px-2 gap-1",children:c}),e[5]=c,e[6]=d);let u;e[7]===Symbol.for("react.memo_cache_sentinel")?(u=(0,o.jsx)(Za,{children:"Model"}),e[7]=u):u=e[7];let m;e[8]===i?m=e[9]:(m=i.map(xl),e[8]=i,e[9]=m);let p;e[10]===m?p=e[11]:(p=(0,o.jsx)(Fa,{children:(0,o.jsxs)(Ua,{children:[u,m]})}),e[10]=m,e[11]=p);let f;return e[12]!==r||e[13]!==n||e[14]!==s||e[15]!==d||e[16]!==p?(f=(0,o.jsxs)(Da,{value:r,onValueChange:s,disabled:n,children:[d,p]}),e[12]=r,e[13]=n,e[14]=s,e[15]=d,e[16]=p,e[17]=f):f=e[17],f});Fs.displayName="ModelSelector";function xl(t,e){return(0,o.jsx)($a,{value:t.modelId,className:"text-xs",children:(0,o.jsxs)("div",{className:"flex flex-col",children:[(0,o.jsxs)("span",{children:[t.name,e===0&&(0,o.jsx)("span",{className:"text-muted-foreground ml-1",children:"(default)"})]}),t.description&&(0,o.jsx)("span",{className:"text-muted-foreground text-xs pt-1 block",children:t.description})]})},t.modelId)}var vl=be(),Us=(0,M.memo)(t=>{let e=(0,vl.c)(10),{isVisible:a,onScrollToBottom:s,className:n}=t;if(!a)return null;let i;e[0]===n?i=e[1]:(i=xe("absolute bottom-2 right-6 z-10 animate-in fade-in-0 zoom-in-95 duration-200",n),e[0]=n,e[1]=i);let r,l,c;e[2]===Symbol.for("react.memo_cache_sentinel")?(r=xe("h-8 w-8 p-0 rounded-full","bg-background/90 backdrop-blur-sm","border border-border/50","shadow-md shadow-black/10","hover:bg-background hover:shadow-black/15","transition-all duration-200","focus:outline-none focus:ring-2 focus:ring-primary/50"),l=(0,o.jsx)(wr,{className:"h-4 w-4"}),c=(0,o.jsx)("span",{className:"sr-only",children:"Scroll to bottom"}),e[2]=r,e[3]=l,e[4]=c):(r=e[2],l=e[3],c=e[4]);let d;e[5]===s?d=e[6]:(d=(0,o.jsxs)(le,{variant:"secondary",size:"sm",onClick:s,className:r,children:[l,c]}),e[5]=s,e[6]=d);let u;return e[7]!==i||e[8]!==d?(u=(0,o.jsx)("div",{className:i,children:d}),e[7]=i,e[8]=d,e[9]=u):u=e[9],u});Us.displayName="ScrollToBottomButton";var yl=Us,Ut=be(),zs=(0,M.memo)(t=>{let e=(0,Ut.c)(23),{session:a,isActive:s,onSelect:n,onClose:i}=t,r=s&&"bg-background border-b-0 relative z-1",l;e[0]===r?l=e[1]:(l=xe("flex items-center gap-1 px-2 py-1 text-xs border-r border-border bg-muted/30 hover:bg-muted/50 cursor-pointer min-w-0",r),e[0]=r,e[1]=l);let c;e[2]!==n||e[3]!==a.tabId?(c=()=>n(a.tabId),e[2]=n,e[3]=a.tabId,e[4]=c):c=e[4];let d;e[5]===a.agentId?d=e[6]:(d=(0,o.jsx)("span",{className:"text-muted-foreground text-[10px] font-medium",children:(0,o.jsx)(xt,{provider:a.agentId,className:"h-3 w-3"})}),e[5]=a.agentId,e[6]=d);let u;e[7]===a.title?u=e[8]:(u=(0,o.jsx)("span",{className:"truncate",title:a.title,children:a.title}),e[7]=a.title,e[8]=u);let m;e[9]!==d||e[10]!==u?(m=(0,o.jsxs)("div",{className:"flex items-center gap-1 min-w-0 flex-1",children:[d,u]}),e[9]=d,e[10]=u,e[11]=m):m=e[11];let p;e[12]!==i||e[13]!==a.tabId?(p=w=>{w.stopPropagation(),i(a.tabId)},e[12]=i,e[13]=a.tabId,e[14]=p):p=e[14];let f;e[15]===Symbol.for("react.memo_cache_sentinel")?(f=(0,o.jsx)(Pa,{className:"h-3 w-3"}),e[15]=f):f=e[15];let x;e[16]===p?x=e[17]:(x=(0,o.jsx)(le,{variant:"ghost",size:"sm",className:"h-4 w-4 p-0 hover:bg-destructive/20 hover:text-destructive flex-shrink-0",onClick:p,children:f}),e[16]=p,e[17]=x);let v;return e[18]!==l||e[19]!==c||e[20]!==m||e[21]!==x?(v=(0,o.jsxs)("div",{className:l,onClick:c,children:[m,x]}),e[18]=l,e[19]=c,e[20]=m,e[21]=x,e[22]=v):v=e[22],v});zs.displayName="SessionTab";var Ds=(0,M.memo)(t=>{let e=(0,Ut.c)(11),{sessions:a,activeTabId:s,onSelectSession:n,onCloseSession:i}=t,r;if(e[0]!==s||e[1]!==i||e[2]!==n||e[3]!==a){let c;e[5]!==s||e[6]!==i||e[7]!==n?(c=d=>(0,o.jsx)(zs,{session:d,isActive:d.tabId===s,onSelect:n,onClose:i},d.tabId),e[5]=s,e[6]=i,e[7]=n,e[8]=c):c=e[8],r=a.map(c),e[0]=s,e[1]=i,e[2]=n,e[3]=a,e[4]=r}else r=e[4];let l;return e[9]===r?l=e[10]:(l=(0,o.jsx)("div",{className:"flex min-w-0 flex-1 overflow-x-auto",children:r}),e[9]=r,e[10]=l),l});Ds.displayName="SessionList";var Ls=(0,M.memo)(t=>{let e=(0,Ut.c)(5),{className:a}=t,s;e[0]===a?s=e[1]:(s=xe("flex items-center border-b bg-muted/20",a),e[0]=a,e[1]=s);let n;e[2]===Symbol.for("react.memo_cache_sentinel")?(n=(0,o.jsx)(Ft,{className:"h-6"}),e[2]=n):n=e[2];let i;return e[3]===s?i=e[4]:(i=(0,o.jsx)("div",{className:s,children:n}),e[3]=s,e[4]=i),i});Ls.displayName="EmptySessionTabs";const ya=(0,M.memo)(t=>{let e=(0,Ut.c)(18),{className:a}=t,[s,n]=ft(ct),i=Aa(va),r;e[0]!==i||e[1]!==n?(r=w=>{i(w),n(j=>cl(j,w))},e[0]=i,e[1]=n,e[2]=r):r=e[2];let l=oe(r),c;e[3]===n?c=e[4]:(c=w=>{n(j=>ol(j,w))},e[3]=n,e[4]=c);let d=oe(c),{sessions:u,activeTabId:m}=s;if(u.length===0){let w;return e[5]===a?w=e[6]:(w=(0,o.jsx)(Ls,{className:a}),e[5]=a,e[6]=w),w}let p;e[7]===a?p=e[8]:(p=xe("flex items-center border-b bg-muted/20 overflow-hidden",a),e[7]=a,e[8]=p);let f;e[9]!==m||e[10]!==d||e[11]!==l||e[12]!==u?(f=(0,o.jsx)(Ds,{sessions:u,activeTabId:m,onSelectSession:l,onCloseSession:d}),e[9]=m,e[10]=d,e[11]=l,e[12]=u,e[13]=f):f=e[13];let x;e[14]===Symbol.for("react.memo_cache_sentinel")?(x=(0,o.jsx)(Ft,{className:"h-6 flex-shrink-0"}),e[14]=x):x=e[14];let v;return e[15]!==p||e[16]!==f?(v=(0,o.jsxs)("div",{className:p,children:[f,x]}),e[15]=p,e[16]=f,e[17]=v):v=e[17],v});ya.displayName="SessionTabs";var _l=be();const bl=t=>{let e=(0,_l.c)(14),{notifications:a,isConnected:s,onRetryConnection:n,onRetryLastAction:i,onDismissError:r}=t,l,c,d;if(e[0]!==s||e[1]!==a||e[2]!==r||e[3]!==n||e[4]!==i){l=xo(a),l=l.filter((f,x)=>Ws(f)&&f[0].data.update.sessionUpdate==="available_commands_update"?!1:x===l.length-1?!0:!qs(f));let p=(f,x)=>{if(f.length===0)return null;if(wl(f)){let v=f[f.length-1];return(0,o.jsx)(Co,{data:v.data,onRetry:i,onDismiss:r?()=>r(v.id):void 0},v.id)}if(qs(f)){let v=f[f.length-1];return(0,o.jsx)(Io,{data:v.data,isConnected:s,isOnlyBlock:l.length===1,onRetry:n,timestamp:v.timestamp},v.id)}if(Ws(f)){let v=f[0].timestamp,w=f[f.length-1].timestamp;return(0,o.jsx)($o,{data:f.map(kl),startTimestamp:v,endTimestamp:w,isLastBlock:x})}return"Unknown notification type"};c="flex flex-col gap-4 px-2 pb-10 flex-1",d=l.map((f,x)=>(0,o.jsx)(M.Fragment,{children:p(f,x===l.length-1)},f[0].id)),e[0]=s,e[1]=a,e[2]=r,e[3]=n,e[4]=i,e[5]=l,e[6]=c,e[7]=d}else l=e[5],c=e[6],d=e[7];let u;e[8]===l.length?u=e[9]:(u=l.length===0&&(0,o.jsx)(ha,{}),e[8]=l.length,e[9]=u);let m;return e[10]!==c||e[11]!==d||e[12]!==u?(m=(0,o.jsxs)("div",{className:c,children:[d,u]}),e[10]=c,e[11]=d,e[12]=u,e[13]=m):m=e[13],m};function wl(t){return t[0].type==="error"}function qs(t){return t[0].type==="connection_change"}function Ws(t){return t[0].type==="session_notification"}function kl(t){return t.data.update}async function jl(t){let e=[];for(let a of t)try{let s=await Pn(a,"dataUrl");e.push({type:"resource_link",uri:s,mimeType:a.type,name:a.name})}catch(s){Ge.error("Error converting file to resource link",{fileName:a.name,error:s})}return e}async function Nl(t){let e=[];for(let a of t)e.push({type:"resource_link",uri:a.url,mimeType:a.mediaType,name:a.filename??a.url});return e}async function Sl(t){let e=[],a=[];if(!t.includes("@"))return{contextBlocks:e,attachmentBlocks:a};try{let s=On(Wt),n=s.parseAllContextIds(t);if(n.length===0)return{contextBlocks:e,attachmentBlocks:a};let i=s.formatContextForAI(n);i.trim()&&e.push({type:"resource",resource:{uri:"context.md",mimeType:"text/plain",text:i}});try{let r=await s.getAttachmentsForContext(n);if(r.length>0){let l=await Nl(r);a.push(...l),Ge.debug("Added AI context attachments",{count:r.length})}}catch(r){Ge.error("Error getting AI context attachments",{error:r})}Ge.debug("Parsed context for agent",{contextIds:n,contextLength:i.length,attachmentCount:a.length})}catch(s){Ge.error("Error parsing context for agent",{error:s})}return{contextBlocks:e,attachmentBlocks:a}}function Cl(t){return`
  I am currently editing a marimo notebook.
  You can read or write to the notebook at ${t}

  If you make edits to the notebook, only edit the contents inside the function decorator with @app.cell.
  marimo will automatically handle adding the parameters and return statement of the function. For example,
  for each edit, just return:

  \`\`\`
  @app.cell
  def _():
    <your code here>
    return
  \`\`\`

  ## Marimo fundamentals

  Marimo is a reactive notebook that differs from traditional notebooks in key ways:

  - Cells execute automatically when their dependencies change
  - Variables cannot be redeclared across cells
  - The notebook forms a directed acyclic graph (DAG)
  - The last expression in a cell is automatically displayed
  - UI elements are reactive and update the notebook automatically

  ## Code Requirements

  1. All code must be complete and runnable
  2. Follow consistent coding style throughout
  3. Include descriptive variable names and helpful comments
  4. Import all modules in the first cell, always including \`import marimo as mo\`
  5. Never redeclare variables across cells
  6. Ensure no cycles in notebook dependency graph
  7. The last expression in a cell is automatically displayed, just like in Jupyter notebooks.
  8. Don't include comments in markdown cells
  9. Don't include comments in SQL cells
  10. Never define anything using \`global\`.

  ## Reactivity

  Marimo's reactivity means:

  - When a variable changes, all cells that use that variable automatically re-execute
  - UI elements trigger updates when their values change without explicit callbacks
  - UI element values are accessed through \`.value\` attribute
  - You cannot access a UI element's value in the same cell where it's defined
  - Cells prefixed with an underscore (e.g. _my_var) are local to the cell and cannot be accessed by other cells

  ## Best Practices

  <data_handling>
  - Use polars for data manipulation
  - Implement proper data validation
  - Handle missing values appropriately
  - Use efficient data structures
  - A variable in the last expression of a cell is automatically displayed as a table
  </data_handling>

  <visualization>
  - For matplotlib: use plt.gca() as the last expression instead of plt.show()
  - For plotly: return the figure object directly
  - For altair: return the chart object directly. Add tooltips where appropriate. You can pass polars dataframes directly to altair.
  - Include proper labels, titles, and color schemes
  - Make visualizations interactive where appropriate
  </visualization>

  <ui_elements>
  - Access UI element values with .value attribute (e.g., slider.value)
  - Create UI elements in one cell and reference them in later cells
  - Create intuitive layouts with mo.hstack(), mo.vstack(), and mo.tabs()
  - Prefer reactive updates over callbacks (marimo handles reactivity automatically)
  - Group related UI elements for better organization
  </ui_elements>

  <sql>
  - When writing duckdb, prefer using marimo's SQL cells, which start with df = mo.sql(f"""<your query>""") for DuckDB, or df = mo.sql(f"""<your query>""", engine=engine) for other SQL engines.
  - See the SQL with duckdb example for an example on how to do this
  - Don't add comments in cells that use mo.sql()
  - Consider using \`vega_datasets\` for common example datasets
  </sql>

  ## Troubleshooting

  Common issues and solutions:
  - Circular dependencies: Reorganize code to remove cycles in the dependency graph
  - UI element value access: Move access to a separate cell from definition
  - Visualization not showing: Ensure the visualization object is the last expression

  ## Available UI elements

  - \`mo.ui.altair_chart(altair_chart)\`
  - \`mo.ui.button(value=None, kind='primary')\`
  - \`mo.ui.run_button(label=None, tooltip=None, kind='primary')\`
  - \`mo.ui.checkbox(label='', value=False)\`
  - \`mo.ui.date(value=None, label=None, full_width=False)\`
  - \`mo.ui.dropdown(options, value=None, label=None, full_width=False)\`
  - \`mo.ui.file(label='', multiple=False, full_width=False)\`
  - \`mo.ui.number(value=None, label=None, full_width=False)\`
  - \`mo.ui.radio(options, value=None, label=None, full_width=False)\`
  - \`mo.ui.refresh(options: List[str], default_interval: str)\`
  - \`mo.ui.slider(start, stop, value=None, label=None, full_width=False, step=None)\`
  - \`mo.ui.range_slider(start, stop, value=None, label=None, full_width=False, step=None)\`
  - \`mo.ui.table(data, columns=None, on_select=None, sortable=True, filterable=True)\`
  - \`mo.ui.text(value='', label=None, full_width=False)\`
  - \`mo.ui.text_area(value='', label=None, full_width=False)\`
  - \`mo.ui.data_explorer(df)\`
  - \`mo.ui.dataframe(df)\`
  - \`mo.ui.plotly(plotly_figure)\`
  - \`mo.ui.tabs(elements: dict[str, mo.ui.Element])\`
  - \`mo.ui.array(elements: list[mo.ui.Element])\`
  - \`mo.ui.form(element: mo.ui.Element, label='', bordered=True)\`

  ## Layout and utility functions

  - \`mo.md(text)\` - display markdown
  - \`mo.stop(predicate, output=None)\` - stop execution conditionally
  - \`mo.output.append(value)\` - append to the output when it is not the last expression
  - \`mo.output.replace(value)\` - replace the output when it is not the last expression
  - \`mo.Html(html)\` - display HTML
  - \`mo.image(image)\` - display an image
  - \`mo.hstack(elements)\` - stack elements horizontally
  - \`mo.vstack(elements)\` - stack elements vertically
  - \`mo.tabs(elements)\` - create a tabbed interface



  ## Examples

  <example title="Markdown ccell">
  ${We([`
  mo.md("""
  # Hello world
  This is a _markdown_ **cell**.
  """)
    `])}
  </example>

  <example title="Basic UI with reactivity">
  ${We([`
  import marimo as mo
  import altair as alt
  import polars as pl
  import numpy as np
    `,`
  n_points = mo.ui.slider(10, 100, value=50, label="Number of points")
  n_points
    `,`
  x = np.random.rand(n_points.value)
  y = np.random.rand(n_points.value)

  df = pl.DataFrame({"x": x, "y": y})

  chart = alt.Chart(df).mark_circle(opacity=0.7).encode(
      x=alt.X('x', title='X axis'),
      y=alt.Y('y', title='Y axis')
  ).properties(
      title=f"Scatter plot with {n_points.value} points",
      width=400,
      height=300
  )

  chart
    `])}
  </example>

  <example title="Data explorer">
  ${We([`
  import marimo as mo
  import polars as pl
  from vega_datasets import data
    `,`
  cars_df = pl.DataFrame(data.cars())
  mo.ui.data_explorer(cars_df)
    `])}
  </example>

  <example title="Multiple UI elements">
  ${We([`
  import marimo as mo
  import polars as pl
  import altair as alt
    `,`
  iris = pl.read_csv("hf://datasets/scikit-learn/iris/Iris.csv")
    `,`
  species_selector = mo.ui.dropdown(
      options=["All"] + iris["Species"].unique().to_list(),
      value="All",
      label="Species",
  )
  x_feature = mo.ui.dropdown(
      options=iris.select(pl.col(pl.Float64, pl.Int64)).columns,
      value="SepalLengthCm",
      label="X Feature",
  )
  y_feature = mo.ui.dropdown(
      options=iris.select(pl.col(pl.Float64, pl.Int64)).columns,
      value="SepalWidthCm",
      label="Y Feature",
  )
  mo.hstack([species_selector, x_feature, y_feature])
    `,`
  filtered_data = iris if species_selector.value == "All" else iris.filter(pl.col("Species") == species_selector.value)

  chart = alt.Chart(filtered_data).mark_circle().encode(
      x=alt.X(x_feature.value, title=x_feature.value),
      y=alt.Y(y_feature.value, title=y_feature.value),
      color='Species'
  ).properties(
      title=f"{y_feature.value} vs {x_feature.value}",
      width=500,
      height=400
  )

  chart
    `])}
  </example>

  <example title="Conditional Outputs">
  ${We([`
  mo.stop(not data.value, mo.md("No data to display"))

  if mode.value == "scatter":
    mo.output.replace(render_scatter(data.value))
  else:
    mo.output.replace(render_bar_chart(data.value))
    `])}
  </example>

  <example title="Interactive chart with Altair">
  ${We([`
  import marimo as mo
  import altair as alt
  import polars as pl
    `,`# Load dataset
  weather = pl.read_csv("https://raw.githubusercontent.com/vega/vega-datasets/refs/heads/main/data/weather.csv")
  weather_dates = weather.with_columns(
      pl.col("date").str.strptime(pl.Date, format="%Y-%m-%d")
  )
  _chart = (
      alt.Chart(weather_dates)
      .mark_point()
      .encode(
          x="date:T",
          y="temp_max",
          color="location",
      )
  )
  `,`chart = mo.ui.altair_chart(_chart)
chart`,`
  # Display the selection
  chart.value`])}
  </example>

  <example title="Run Button Example">
  ${We(["import marimo as mo",`
  first_button = mo.ui.run_button(label="Option 1")
  second_button = mo.ui.run_button(label="Option 2")
  [first_button, second_button]`,`
  if first_button.value:
      print("You chose option 1!")
  elif second_button.value:
      print("You chose option 2!")
  else:
      print("Click a button!")`])}
  </example>

  <example title="SQL with duckdb">
  ${We([`import marimo as mo
  import polars as pl`,"weather = pl.read_csv('https://raw.githubusercontent.com/vega/vega-datasets/refs/heads/main/data/weather.csv')",`seattle_weather_df = mo.sql(
      f"""
      SELECT * FROM weather WHERE location = 'Seattle';
      """
  )`])}
  </example>`}function We(t){let e=a=>a.trim().split(`
`).map(s=>("    "+s).trimEnd()).join(`
`);return t.map(a=>`
  @app.cell
  def _():
  ${e(a)}
      return
  `).join("")}var $e=be(),re=Ge.get("agents"),Il=["image/*","text/*"],Vs=(0,M.memo)(t=>{let e=(0,$e.c)(4),{currentAgentId:a}=t,s;e[0]===a?s=e[1]:(s=Ht(a),e[0]=a,e[1]=s);let n;return e[2]===s?n=e[3]:(n=(0,o.jsx)("span",{className:"text-sm font-medium",children:s}),e[2]=s,e[3]=n),n});Vs.displayName="AgentTitle";var Bs=(0,M.memo)(t=>{let e=(0,$e.c)(4),{connectionState:a,onConnect:s,onDisconnect:n}=t,i=a.status==="connected",r=i?n:s,l=a.status==="connecting",c=i?"Disconnect":"Connect",d;return e[0]!==r||e[1]!==l||e[2]!==c?(d=(0,o.jsx)(le,{variant:"outline",size:"xs",onClick:r,disabled:l,children:c}),e[0]=r,e[1]=l,e[2]=c,e[3]=d):d=e[3],d});Bs.displayName="ConnectionControl";var Ks=(0,M.memo)(t=>{let e=(0,$e.c)(9),{currentAgentId:a,connectionStatus:s,shouldShowConnectionControl:n}=t,i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,o.jsx)(gt,{className:"h-4 w-4 text-muted-foreground"}),e[0]=i):i=e[0];let r;e[1]===a?r=e[2]:(r=a&&(0,o.jsx)(Vs,{currentAgentId:a}),e[1]=a,e[2]=r);let l;e[3]!==s||e[4]!==n?(l=n&&(0,o.jsx)(Is,{status:s}),e[3]=s,e[4]=n,e[5]=l):l=e[5];let c;return e[6]!==r||e[7]!==l?(c=(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[i,r,l]}),e[6]=r,e[7]=l,e[8]=c):c=e[8],c});Ks.displayName="HeaderInfo";var _a=(0,M.memo)(t=>{let e=(0,$e.c)(19),{connectionState:a,currentAgentId:s,onConnect:n,onDisconnect:i,onRestartThread:r,hasActiveSession:l,shouldShowConnectionControl:c}=t,d;e[0]!==a.status||e[1]!==s||e[2]!==c?(d=(0,o.jsx)(Ks,{currentAgentId:s,connectionStatus:a.status,shouldShowConnectionControl:c}),e[0]=a.status,e[1]=s,e[2]=c,e[3]=d):d=e[3];let u;e[4]!==a.status||e[5]!==l||e[6]!==r?(u=l&&a.status==="connected"&&r&&(0,o.jsxs)(le,{variant:"outline",size:"xs",onClick:r,title:"Restart thread (create new session)",children:[(0,o.jsx)(nr,{className:"h-3 w-3 mr-1"}),"Restart"]}),e[4]=a.status,e[5]=l,e[6]=r,e[7]=u):u=e[7];let m;e[8]!==a||e[9]!==n||e[10]!==i||e[11]!==c?(m=c&&(0,o.jsx)(Bs,{connectionState:a,onConnect:n,onDisconnect:i}),e[8]=a,e[9]=n,e[10]=i,e[11]=c,e[12]=m):m=e[12];let p;e[13]!==u||e[14]!==m?(p=(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[u,m]}),e[13]=u,e[14]=m,e[15]=p):p=e[15];let f;return e[16]!==d||e[17]!==p?(f=(0,o.jsxs)("div",{className:"flex border-b px-3 py-2 justify-between shrink-0 items-center",children:[d,p]}),e[16]=d,e[17]=p,e[18]=f):f=e[18],f});_a.displayName="AgentPanelHeader";var Js=(0,M.memo)(t=>{let e=(0,$e.c)(15),{currentAgentId:a,connectionState:s,onConnect:n,onDisconnect:i}=t,r=Ra(Bt),l;e[0]!==s||e[1]!==a||e[2]!==n||e[3]!==i?(l=(0,o.jsx)(_a,{connectionState:s,currentAgentId:a,onConnect:n,onDisconnect:i,hasActiveSession:!1}),e[0]=s,e[1]=a,e[2]=n,e[3]=i,e[4]=l):l=e[4];let c;e[5]===Symbol.for("react.memo_cache_sentinel")?(c=(0,o.jsx)(ya,{}),e[5]=c):c=e[5];let d;e[6]===Symbol.for("react.memo_cache_sentinel")?(d=(0,o.jsx)(Ja,{title:"No Agent Sessions",description:"Create a new session to start a conversation",action:(0,o.jsx)(Ft,{className:"border-y-1 rounded"}),icon:(0,o.jsx)(gt,{})}),e[6]=d):d=e[6];let u;e[7]!==s.status||e[8]!==r?(u=s.status==="disconnected"&&(0,o.jsx)($t,{className:"border-t pt-6",title:"Connect to an agent",description:(0,o.jsxs)(o.Fragment,{children:["Start agents by running these commands in your terminal:",(0,o.jsx)("br",{}),"Note: This must be in the directory"," ",Kt.dirname(r??"")]})}),e[7]=s.status,e[8]=r,e[9]=u):u=e[9];let m;e[10]===u?m=e[11]:(m=(0,o.jsx)("div",{className:"flex-1 flex items-center justify-center p-6",children:(0,o.jsxs)("div",{className:"max-w-md w-full space-y-6",children:[d,u]})}),e[10]=u,e[11]=m);let p;return e[12]!==l||e[13]!==m?(p=(0,o.jsxs)("div",{className:"flex flex-col h-full",children:[l,c,m]}),e[12]=l,e[13]=m,e[14]=p):p=e[14],p});Js.displayName="EmptyState";var Hs=(0,M.memo)(t=>{let e=(0,$e.c)(10),{isLoading:a,isRequestingPermission:s,onStop:n}=t;if(!a)return null;let i;e[0]===Symbol.for("react.memo_cache_sentinel")?(i=(0,o.jsx)(Yt,{size:"small",className:"text-primary"}),e[0]=i):i=e[0];let r;e[1]===s?r=e[2]:(r=(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[i,s?(0,o.jsx)("span",{children:"Waiting for permission to continue..."}):(0,o.jsx)("span",{children:"Agent is working..."})]}),e[1]=s,e[2]=r);let l,c;e[3]===Symbol.for("react.memo_cache_sentinel")?(l=(0,o.jsx)(kr,{className:"h-3 w-3 mr-1"}),c=(0,o.jsx)("span",{className:"text-xs",children:"Stop"}),e[3]=l,e[4]=c):(l=e[3],c=e[4]);let d;e[5]===n?d=e[6]:(d=(0,o.jsx)("div",{className:"flex items-center gap-2",children:(0,o.jsxs)(le,{size:"sm",variant:"outline",onClick:n,className:"h-6 px-2",children:[l,c]})}),e[5]=n,e[6]=d);let u;return e[7]!==r||e[8]!==d?(u=(0,o.jsx)("div",{className:"px-3 py-2 border-t bg-muted/30 flex-shrink-0",children:(0,o.jsxs)("div",{className:"flex items-center justify-between text-xs text-muted-foreground",children:[r,d]})}),e[7]=r,e[8]=d,e[9]=u):u=e[9],u});Hs.displayName="LoadingIndicator";var Ys=(0,M.memo)(t=>{let e=(0,$e.c)(69),{isLoading:a,activeSessionId:s,promptValue:n,commands:i,onPromptValueChange:r,onPromptSubmit:l,onAddFiles:c,onStop:d,fileInputRef:u,sessionMode:m,onModeChange:p,sessionModels:f,onModelChange:x}=t,v=(0,M.useRef)(null),w;e:{if(!i){w=void 0;break e}let se;e[0]===Symbol.for("react.memo_cache_sentinel")?(se=/^\/(\w+)?/,e[0]=se):se=e[0];let Ye;e[1]===i?Ye=e[2]:(Ye=i.map(Al),e[1]=i,e[2]=Ye);let ht;e[3]===Ye?ht=e[4]:(ht={triggerCompletionRegex:se,completions:Ye},e[3]=Ye,e[4]=ht),w=ht}let j=w,C;e[5]!==l||e[6]!==n?(C=()=>{n.trim()&&l(void 0,n)},e[5]=l,e[6]=n,e[7]=C):C=e[7];let A=oe(C),I;e[8]===Symbol.for("react.memo_cache_sentinel")?(I=()=>{Fn(v)},e[8]=I):I=e[8];let O=oe(I),U=(a||!s)&&"opacity-50 pointer-events-none",L;e[9]===U?L=e[10]:(L=xe("px-3 py-2 min-h-[80px]",U),e[9]=U,e[10]=L);let V=a?Ma.NOOP:r,K=a?"Processing...":"Ask anything, @ to include context about tables or dataframes",B=a?"opacity-50 pointer-events-none":"",P;e[11]!==c||e[12]!==l||e[13]!==j||e[14]!==n||e[15]!==V||e[16]!==K||e[17]!==B?(P=(0,o.jsx)($n,{inputRef:v,value:n,onChange:V,onSubmit:l,additionalCompletions:j,onClose:Ma.NOOP,onAddFiles:c,placeholder:K,className:B,maxHeight:"120px"}),e[11]=c,e[12]=l,e[13]=j,e[14]=n,e[15]=V,e[16]=K,e[17]=B,e[18]=P):P=e[18];let F;e[19]!==L||e[20]!==P?(F=(0,o.jsx)("div",{className:L,children:P}),e[19]=L,e[20]=P,e[21]=F):F=e[21];let ue;e[22]!==p||e[23]!==m?(ue=m&&p&&(0,o.jsx)(Gs,{sessionMode:m,onModeChange:p}),e[22]=p,e[23]=m,e[24]=ue):ue=e[24];let X;e[25]!==s||e[26]!==a||e[27]!==x||e[28]!==f?(X=f&&x&&s&&(0,o.jsx)(Fs,{sessionModels:f,onModelChange:x,disabled:a}),e[25]=s,e[26]=a,e[27]=x,e[28]=f,e[29]=X):X=e[29];let me;e[30]!==ue||e[31]!==X?(me=(0,o.jsxs)("div",{className:"flex items-center gap-2",children:[ue,X]}),e[30]=ue,e[31]=X,e[32]=me):me=e[32];let ge;e[33]===Symbol.for("react.memo_cache_sentinel")?(ge=(0,o.jsx)(Zn,{className:"h-3.5 w-3.5"}),e[33]=ge):ge=e[33];let de;e[34]!==O||e[35]!==a?(de=(0,o.jsx)(yt,{content:"Add context",children:(0,o.jsx)(le,{variant:"text",size:"icon",onClick:O,disabled:a,children:ge})}),e[34]=O,e[35]=a,e[36]=de):de=e[36];let ye;e[37]===u?ye=e[38]:(ye=()=>{var se;return(se=u.current)==null?void 0:se.click()},e[37]=u,e[38]=ye);let Se;e[39]===Symbol.for("react.memo_cache_sentinel")?(Se=(0,o.jsx)(zn,{className:"h-3.5 w-3.5"}),e[39]=Se):Se=e[39];let Ce;e[40]!==a||e[41]!==ye?(Ce=(0,o.jsx)(yt,{content:"Attach a file",children:(0,o.jsx)(le,{variant:"text",size:"icon",className:"cursor-pointer",onClick:ye,title:"Attach a file",disabled:a,children:Se})}),e[40]=a,e[41]=ye,e[42]=Ce):Ce=e[42];let Ie;e[43]===c?Ie=e[44]:(Ie=se=>{se.target.files&&c([...se.target.files])},e[43]=c,e[44]=Ie);let W;e[45]===Symbol.for("react.memo_cache_sentinel")?(W=Il.join(","),e[45]=W):W=e[45];let G;e[46]!==u||e[47]!==Ie?(G=(0,o.jsx)(rr,{ref:u,type:"file",multiple:!0,hidden:!0,onChange:Ie,accept:W}),e[46]=u,e[47]=Ie,e[48]=G):G=e[48];let J=a?"Stop":"Submit",ee=a?d:A,ie=a?!1:!n.trim(),R;e[49]===a?R=e[50]:(R=a?(0,o.jsx)(ir,{className:"h-3 w-3 fill-current"}):(0,o.jsx)(En,{className:"h-3 w-3"}),e[49]=a,e[50]=R);let z;e[51]!==ee||e[52]!==ie||e[53]!==R?(z=(0,o.jsx)(le,{variant:"text",size:"sm",className:"h-6 w-6 p-0 hover:bg-muted/30 cursor-pointer",onClick:ee,disabled:ie,children:R}),e[51]=ee,e[52]=ie,e[53]=R,e[54]=z):z=e[54];let ae;e[55]!==J||e[56]!==z?(ae=(0,o.jsx)(yt,{content:J,children:z}),e[55]=J,e[56]=z,e[57]=ae):ae=e[57];let _e;e[58]!==de||e[59]!==Ce||e[60]!==G||e[61]!==ae?(_e=(0,o.jsxs)("div",{className:"flex flex-row",children:[de,Ce,G,ae]}),e[58]=de,e[59]=Ce,e[60]=G,e[61]=ae,e[62]=_e):_e=e[62];let Fe;e[63]!==me||e[64]!==_e?(Fe=(0,o.jsx)(ur,{children:(0,o.jsxs)("div",{className:"px-3 py-2 border-t border-border/20 flex flex-row items-center justify-between",children:[me,_e]})}),e[63]=me,e[64]=_e,e[65]=Fe):Fe=e[65];let He;return e[66]!==F||e[67]!==Fe?(He=(0,o.jsxs)("div",{className:"border-t bg-background flex-shrink-0",children:[F,Fe]}),e[66]=F,e[67]=Fe,e[68]=He):He=e[68],He});Ys.displayName="PromptArea";var Gs=(0,M.memo)(t=>{let e=(0,$e.c)(28),{sessionMode:a,onModeChange:s}=t,n,i,r,l,c,d,u,m,p;if(e[0]!==s||e[1]!==(a==null?void 0:a.availableModes)||e[2]!==(a==null?void 0:a.currentModeId)){p=Symbol.for("react.early_return_sentinel");e:{let w=(a==null?void 0:a.availableModes)||[],j=a==null?void 0:a.currentModeId;if(w.length===0){p=null;break e}let C=w.map(Rl),A;e[12]===j?A=e[13]:(A=O=>O.value===j,e[12]=j,e[13]=A);let I=C.find(A);r=Da,d=j,u=s,m=(0,o.jsx)(za,{className:"h-6 text-xs border-border shadow-none! ring-0! bg-muted hover:bg-muted/30 py-0 px-2 gap-1 capitalize",children:(I==null?void 0:I.label)??j}),i=Fa,n=Ua,e[14]===Symbol.for("react.memo_cache_sentinel")?(l=(0,o.jsx)(Za,{children:"Agent Mode"}),e[14]=l):l=e[14],c=C.map(Ml)}e[0]=s,e[1]=a==null?void 0:a.availableModes,e[2]=a==null?void 0:a.currentModeId,e[3]=n,e[4]=i,e[5]=r,e[6]=l,e[7]=c,e[8]=d,e[9]=u,e[10]=m,e[11]=p}else n=e[3],i=e[4],r=e[5],l=e[6],c=e[7],d=e[8],u=e[9],m=e[10],p=e[11];if(p!==Symbol.for("react.early_return_sentinel"))return p;let f;e[15]!==n||e[16]!==l||e[17]!==c?(f=(0,o.jsxs)(n,{children:[l,c]}),e[15]=n,e[16]=l,e[17]=c,e[18]=f):f=e[18];let x;e[19]!==i||e[20]!==f?(x=(0,o.jsx)(i,{children:f}),e[19]=i,e[20]=f,e[21]=x):x=e[21];let v;return e[22]!==r||e[23]!==d||e[24]!==u||e[25]!==m||e[26]!==x?(v=(0,o.jsxs)(r,{value:d,onValueChange:u,children:[m,x]}),e[22]=r,e[23]=d,e[24]=u,e[25]=m,e[26]=x,e[27]=v):v=e[27],v});Gs.displayName="ModeSelector";var Qs=(0,M.memo)(t=>{let e=(0,$e.c)(33),{hasNotifications:a,agentId:s,connectionState:n,notifications:i,pendingPermission:r,onResolvePermission:l,onRetryConnection:c,onRetryLastAction:d,sessionId:u}=t,[m,p]=(0,M.useState)(!0),f=(0,M.useRef)(null),x=n.status==="disconnected",v;e[0]===Symbol.for("react.memo_cache_sentinel")?(v=()=>{let X=f.current;if(!X)return;let{scrollTop:me,scrollHeight:ge,clientHeight:de}=X;p(ge>de?Math.abs(ge-de-me)<5:!0)},e[0]=v):v=e[0];let w=oe(v),j;e[1]===Symbol.for("react.memo_cache_sentinel")?(j=()=>{let X=f.current;X&&X.scrollTo({top:X.scrollHeight,behavior:"smooth"})},e[1]=j):j=e[1];let C=oe(j),A,I;e[2]!==m||e[3]!==i.length||e[4]!==C?(A=()=>{if(m&&i.length>0){let X=setTimeout(C,100);return()=>clearTimeout(X)}},I=[i.length,m,C],e[2]=m,e[3]=i.length,e[4]=C,e[5]=A,e[6]=I):(A=e[5],I=e[6]),(0,M.useEffect)(A,I);let O;e[7]!==s||e[8]!==n.status||e[9]!==a||e[10]!==x||e[11]!==i||e[12]!==c||e[13]!==d?(O=()=>a?(0,o.jsx)(bl,{isConnected:n.status==="connected",notifications:i,onRetryConnection:c,onRetryLastAction:d}):n.status==="connected"?(0,o.jsx)(ha,{}):(0,o.jsxs)("div",{className:"flex items-center justify-center h-full min-h-[200px] flex-col",children:[(0,o.jsx)(Ja,{title:"Waiting for agent",description:"Your AI agent will appear here when active",icon:(0,o.jsx)(gt,{})}),x&&s&&(0,o.jsx)($t,{className:"border-t pt-6 px-5",title:"Make sure you're connected to an agent",description:"Run this command in your terminal:",agents:[s]}),x&&(0,o.jsx)(le,{variant:"outline",onClick:c,type:"button",className:"mt-4",children:"Retry"})]}),e[7]=s,e[8]=n.status,e[9]=a,e[10]=x,e[11]=i,e[12]=c,e[13]=d,e[14]=O):O=e[14];let U=O,L;e[15]!==l||e[16]!==r?(L=r&&(0,o.jsx)("div",{className:"p-3 border-b",children:(0,o.jsx)(Ts,{permission:r,onResolve:l})}),e[15]=l,e[16]=r,e[17]=L):L=e[17];let V;e[18]===u?V=e[19]:(V=u&&(0,o.jsxs)("div",{className:"text-xs text-muted-foreground mb-2 px-2",children:["Session ID: ",u]}),e[18]=u,e[19]=V);let K;e[20]===U?K=e[21]:(K=U(),e[20]=U,e[21]=K);let B;e[22]!==w||e[23]!==V||e[24]!==K?(B=(0,o.jsxs)("div",{ref:f,className:"flex-1 bg-muted/20 w-full flex flex-col overflow-y-auto p-2",onScroll:w,children:[V,K]}),e[22]=w,e[23]=V,e[24]=K,e[25]=B):B=e[25];let P=!m&&a,F;e[26]!==C||e[27]!==P?(F=(0,o.jsx)(yl,{isVisible:P,onScrollToBottom:C}),e[26]=C,e[27]=P,e[28]=F):F=e[28];let ue;return e[29]!==F||e[30]!==L||e[31]!==B?(ue=(0,o.jsxs)("div",{className:"flex-1 flex flex-col overflow-hidden flex-shrink-0 relative",children:[L,B,F]}),e[29]=F,e[30]=L,e[31]=B,e[32]=ue):ue=e[32],ue});Qs.displayName="ChatContent";var ba="_skip_auto_connect_";function Xs(){let t=Wt.get(Bt);if(!t)throw Error("Please save the notebook and refresh the browser to use the agent");return Kt.dirname(t)}var Tl=()=>{let[t,e]=(0,M.useState)(!1),[a,s]=(0,M.useState)(null),[n,i]=(0,M.useState)(""),[r,l]=(0,M.useState)(),[c,d]=(0,M.useState)(null),u=(0,M.useRef)(null),[m]=ft(va),[p,f]=ft(ct),x=m?ml(m.agentId):ba,{sendUpdateFile:v,sendFileDetails:w}=Mn(),j=(0,M.useRef)(!1),{connect:C,disconnect:A,setActiveSessionId:I,connectionState:O,notifications:U,pendingPermission:L,availableCommands:V,resolvePermission:K,sessionMode:B,activeSessionId:P,agent:F,clearNotifications:ue}=fo({wsUrl:x,clientOptions:{readTextFile:R=>(re.debug("Agent requesting file read",{path:R.path}),w({path:R.path}).then(z=>({content:z.contents||""}))),writeTextFile:R=>(re.debug("Agent requesting file write",{path:R.path,contentLength:R.content.length}),v({path:R.path,contents:R.content}).then(()=>({})))},autoConnect:!1});(0,M.useEffect)(()=>{F==null||F.initialize({protocolVersion:1,clientCapabilities:{fs:{readTextFile:!0,writeTextFile:!0}}})},[F]),(0,M.useEffect)(()=>{if(I(null),x!==ba)return re.debug("Auto-connecting to agent",{sessionId:P}),C().catch(R=>{re.error("Failed to connect to agent",{error:R})}),()=>{}},[x]);let X=oe(async()=>{if(F){j.current=!0;try{P&&(await F.cancel({sessionId:P}).catch(ae=>{re.error("Failed to cancel active session",{error:ae})}),ue(P),I(null));let R=(m==null?void 0:m.selectedModel)??null;re.debug("Creating new agent session",{model:R});let z=await F.newSession({cwd:Xs(),mcpServers:[],_meta:R?{model:R}:void 0});z.models&&(re.debug("Session models received",{models:z.models}),d(z.models)),f(ae=>Ms(ae,z.sessionId))}finally{j.current=!1}}}),me=oe(async R=>{if(F){if(re.debug("Resuming agent session",{sessionId:R}),!F.loadSession)throw Error("Agent does not support loading sessions");j.current=!0;try{let z=await F.loadSession({sessionId:R,cwd:Xs(),mcpServers:[]});z!=null&&z.models&&(re.debug("Session models received",{models:z.models}),d(z.models)),f(ae=>Ms(ae,R))}finally{j.current=!1}}}),ge=O.status==="connected",de=m==null?void 0:m.externalAgentSessionId;(0,M.useEffect)(()=>{!ge||!m||!F||P&&de||j.current||(async()=>{let R=de??P;try{if(R)try{await me(R)}catch(z){re.error("Failed to resume session",{sessionId:R,error:z}),await X()}else await X();s(null)}catch(z){re.error("Failed to create or resume session:",z),s(z instanceof Error?z:String(z))}})()},[ge,F,de,P]);let ye=oe(async(R,z)=>{if(!P||!F||t)return;re.debug("Submitting prompt to agent",{sessionId:P}),e(!0),i(""),l(void 0),m!=null&&m.title.startsWith("New ")&&f(se=>ll(se,z));let ae=Wt.get(Bt);if(!ae){vt({title:"Notebook must be named",description:"Please name the notebook to use the agent",variant:"danger"});return}let _e=[{type:"text",text:z}],{contextBlocks:Fe,attachmentBlocks:He}=await Sl(z);if(_e.push(...Fe,...He),r&&r.length>0){let se=await jl(r);_e.push(...se)}U.some(se=>se.type==="session_notification"&&se.data.update.sessionUpdate==="user_message_chunk")||_e.push({type:"resource_link",uri:ae,mimeType:"text/x-python",name:ae},{type:"resource",resource:{uri:"marimo_rules.md",mimeType:"text/plain",text:Cl(ae)}});try{await F.prompt({sessionId:P,prompt:_e})}catch(se){re.error("Failed to send prompt",{error:se})}finally{e(!1)}}),Se=oe(async()=>{!P||!F||(await F.cancel({sessionId:P}),e(!1))}),Ce=oe(R=>{R.length!==0&&l(z=>[...z??[],...R])}),Ie=oe(R=>{r&&l(r.filter(z=>z!==R))}),W=oe(()=>{re.debug("Manual connect requested",{currentStatus:O.status}),C()}),G=oe(()=>{re.debug("Manual disconnect requested",{sessionId:P,currentStatus:O.status}),A()}),J=oe(R=>{var z;if(re.debug("Model change requested",{modelId:R,sessionId:P}),!F||!P){vt({title:"Cannot change model",description:"Please connect to an agent with an active session first",variant:"danger"});return}(z=F.setSessionModel)==null||z.call(F,{sessionId:P,modelId:R}),d(ae=>ae?{...ae,currentModelId:R}:null)}),ee=oe(R=>{var z;if(re.debug("Mode change requested",{sessionId:P,mode:R}),!F){vt({title:"Agent not connected",description:"Please connect to an agent to change the mode",variant:"danger"});return}if(!F.setSessionMode){vt({title:"Mode change not supported",description:"The agent does not support mode changes",variant:"danger"});return}(z=F.setSessionMode)==null||z.call(F,{sessionId:P,modeId:R})}),ie=U.length>0;return p.sessions.length>0?(0,o.jsxs)("div",{className:"flex flex-col flex-1 overflow-hidden mo-agent-panel",children:[(0,o.jsx)(_a,{connectionState:O,currentAgentId:m==null?void 0:m.agentId,onConnect:W,onDisconnect:G,onRestartThread:X,hasActiveSession:!0,shouldShowConnectionControl:x!==ba}),(0,o.jsx)(ya,{}),a?(0,o.jsx)(vr,{className:"w-3/4 mx-auto mt-10",error:a,action:(0,o.jsx)(le,{variant:"linkDestructive",size:"sm",onClick:()=>s(null),children:"Dismiss"})}):O.status==="connecting"?(0,o.jsx)(Oa,{milliseconds:200,children:(0,o.jsxs)("div",{className:"flex items-center justify-center h-full min-h-[200px] flex-col",children:[(0,o.jsx)(Yt,{size:"medium",className:"text-primary"}),(0,o.jsx)("span",{className:"text-sm text-muted-foreground",children:"Connecting to the agent..."})]})}):de==null&&O.status==="connected"?(0,o.jsx)(Oa,{milliseconds:200,children:(0,o.jsxs)("div",{className:"flex items-center justify-center h-full min-h-[200px] flex-col",children:[(0,o.jsx)(Yt,{size:"medium",className:"text-primary"}),(0,o.jsx)("span",{className:"text-sm text-muted-foreground",children:"Creating a new session..."})]})}):(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(Qs,{agentId:m==null?void 0:m.agentId,sessionId:(m==null?void 0:m.externalAgentSessionId)??null,hasNotifications:ie,connectionState:O,notifications:U,pendingPermission:L,onResolvePermission:R=>{re.debug("Resolving permission request",{sessionId:P,option:R}),K(R)},onRetryConnection:W},P),(0,o.jsx)(Hs,{isLoading:t,isRequestingPermission:!!L,onStop:Se}),r&&r.length>0&&(0,o.jsx)("div",{className:"flex flex-row gap-1 flex-wrap p-3 border-t",children:r.map(R=>(0,o.jsx)(Un,{file:R,onRemove:()=>Ie(R)},R.name))}),(0,o.jsx)(Ys,{isLoading:t,activeSessionId:P,promptValue:n,onPromptValueChange:i,onPromptSubmit:ye,onAddFiles:Ce,onStop:Se,fileInputRef:u,commands:V,sessionMode:B,onModeChange:ee,sessionModels:c,onModelChange:J})]})]}):(0,o.jsx)(Js,{currentAgentId:m==null?void 0:m.agentId,connectionState:O,onConnect:W,onDisconnect:G})};function Al(t){return{label:`/${t.name}`,info:t.description}}function Rl(t){return{value:t.id,label:t.name,subtitle:t.description??""}}function Ml(t){return(0,o.jsx)($a,{value:t.value,className:"text-xs",children:(0,o.jsxs)("div",{className:"flex flex-col",children:[t.label,t.subtitle&&(0,o.jsx)("div",{className:"text-muted-foreground text-xs pt-1 block",children:t.subtitle})]})},t.value)}export{Tl as default};
