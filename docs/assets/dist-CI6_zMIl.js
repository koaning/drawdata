import{$t as G,A as Se,At as On,Bt as Bn,F as oe,Ft as En,Gt as lt,H as Ce,I as In,It as qn,Jt as P,Lt as S,Mt as m,Ot as Fn,Pt as ct,Qt as Pn,Tt as Wn,Ut as zn,Vt as W,Wt as De,X as Le,Xt as Te,Yt as ht,Zt as Vn,_t as $n,at as w,ct as Re,en as Oe,ht as X,it as Nn,j as ut,kt as Be,lt as Jn,nn as Hn,o as ft,ot as Un,qt as C,rt as k,tn as F,xt as jn,z,zt as f}from"./dist-CAcX026F.js";var dt=e=>{let{state:t}=e,n=t.doc.lineAt(t.selection.main.from),r=Ie(e.state,n.from);return r.line?Gn(e):r.block?Xn(e):!1};function Ee(e,t){return({state:n,dispatch:r})=>{if(n.readOnly)return!1;let o=e(t,n);return o?(r(n.update(o)),!0):!1}}var Gn=Ee(Qn,0),mt=Ee(pt,0),Xn=Ee((e,t)=>pt(e,t,Zn(t)),0);function Ie(e,t){let n=e.languageDataAt("commentTokens",t,1);return n.length?n[0]:{}}var Y=50;function Yn(e,{open:t,close:n},r,o){let i=e.sliceDoc(r-Y,r),s=e.sliceDoc(o,o+Y),a=/\s*$/.exec(i)[0].length,l=/^\s*/.exec(s)[0].length,h=i.length-a;if(i.slice(h-t.length,h)==t&&s.slice(l,l+n.length)==n)return{open:{pos:r-a,margin:a&&1},close:{pos:o+l,margin:l&&1}};let c,u;o-r<=2*Y?c=u=e.sliceDoc(r,o):(c=e.sliceDoc(r,r+Y),u=e.sliceDoc(o-Y,o));let d=/^\s*/.exec(c)[0].length,p=/\s*$/.exec(u)[0].length,v=u.length-p-n.length;return c.slice(d,d+t.length)==t&&u.slice(v,v+n.length)==n?{open:{pos:r+d+t.length,margin:/\s/.test(c.charAt(d+t.length))?1:0},close:{pos:o-p-n.length,margin:/\s/.test(u.charAt(v-1))?1:0}}:null}function Zn(e){let t=[];for(let n of e.selection.ranges){let r=e.doc.lineAt(n.from),o=n.to<=r.to?r:e.doc.lineAt(n.to);o.from>r.from&&o.from==n.to&&(o=n.to==r.to+1?r:e.doc.lineAt(n.to-1));let i=t.length-1;i>=0&&t[i].to>r.from?t[i].to=o.to:t.push({from:r.from+/^\s*/.exec(r.text)[0].length,to:o.to})}return t}function pt(e,t,n=t.selection.ranges){let r=n.map(i=>Ie(t,i.from).block);if(!r.every(i=>i))return null;let o=n.map((i,s)=>Yn(t,r[s],i.from,i.to));if(e!=2&&!o.every(i=>i))return{changes:t.changes(n.map((i,s)=>o[s]?[]:[{from:i.from,insert:r[s].open+" "},{from:i.to,insert:" "+r[s].close}]))};if(e!=1&&o.some(i=>i)){let i=[];for(let s=0,a;s<o.length;s++)if(a=o[s]){let l=r[s],{open:h,close:c}=a;i.push({from:h.pos-l.open.length,to:h.pos+h.margin},{from:c.pos-c.margin,to:c.pos+l.close.length})}return{changes:i}}return null}function Qn(e,t,n=t.selection.ranges){let r=[],o=-1;for(let{from:i,to:s}of n){let a=r.length,l=1e9,h=Ie(t,i).line;if(h){for(let c=i;c<=s;){let u=t.doc.lineAt(c);if(u.from>o&&(i==s||s>u.from)){o=u.from;let d=/^\s*/.exec(u.text)[0].length,p=d==u.length,v=u.text.slice(d,d+h.length)==h?d:-1;d<u.text.length&&d<l&&(l=d),r.push({line:u,comment:v,token:h,indent:d,empty:p,single:!1})}c=u.to+1}if(l<1e9)for(let c=a;c<r.length;c++)r[c].indent<r[c].line.text.length&&(r[c].indent=l);r.length==a+1&&(r[a].single=!0)}}if(e!=2&&r.some(i=>i.comment<0&&(!i.empty||i.single))){let i=[];for(let{line:a,token:l,indent:h,empty:c,single:u}of r)(u||!c)&&i.push({from:a.from+h,insert:l+" "});let s=t.changes(i);return{changes:s,selection:t.selection.map(s,1)}}else if(e!=1&&r.some(i=>i.comment>=0)){let i=[];for(let{line:s,comment:a,token:l}of r)if(a>=0){let h=s.from+a,c=h+l.length;s.text[c-s.from]==" "&&c++,i.push({from:h,to:c})}return{changes:i}}return null}var qe=ct.define(),Kn=ct.define(),_n=W.define(),gt=W.define({combine(e){return G(e,{minDepth:100,newGroupDelay:500,joinToEvent:(t,n)=>n},{minDepth:Math.max,newGroupDelay:Math.min,joinToEvent:(t,n)=>(r,o)=>t(r,o)||n(r,o)})}}),Fe=P.define({create(){return Z.empty},update(e,t){let n=t.state.facet(gt),r=t.annotation(qe);if(r){let l=E.fromTransaction(t,r.selection),h=r.side,c=h==0?e.undone:e.done;return c=l?ae(c,c.length,n.minDepth,l):yt(c,t.startState.selection),new Z(h==0?r.rest:c,h==0?c:r.rest)}let o=t.annotation(Kn);if((o=="full"||o=="before")&&(e=e.isolate()),t.annotation(Te.addToHistory)===!1)return t.changes.empty?e:e.addMapping(t.changes.desc);let i=E.fromTransaction(t),s=t.annotation(Te.time),a=t.annotation(Te.userEvent);return i?e=e.addChanges(i,s,a,n,t):t.selection&&(e=e.addSelection(t.startState.selection,s,a,n.newGroupDelay)),(o=="full"||o=="after")&&(e=e.isolate()),e},toJSON(e){return{done:e.done.map(t=>t.toJSON()),undone:e.undone.map(t=>t.toJSON())}},fromJSON(e){return new Z(e.done.map(E.fromJSON),e.undone.map(E.fromJSON))}});function er(e={}){return[Fe,gt.of(e),w.domEventHandlers({beforeinput(t,n){let r=t.inputType=="historyUndo"?Pe:t.inputType=="historyRedo"?se:null;return r?(t.preventDefault(),r(n)):!1}})]}var tr=Fe;function ie(e,t){return function({state:n,dispatch:r}){if(!t&&n.readOnly)return!1;let o=n.field(Fe,!1);if(!o)return!1;let i=o.pop(e,n,t);return i?(r(i),!0):!1}}var Pe=ie(0,!1),se=ie(1,!1),nr=ie(0,!0),rr=ie(1,!0),E=class te{constructor(t,n,r,o,i){this.changes=t,this.effects=n,this.mapped=r,this.startSelection=o,this.selectionsAfter=i}setSelAfter(t){return new te(this.changes,this.effects,this.mapped,this.startSelection,t)}toJSON(){var t,n,r;return{changes:(t=this.changes)==null?void 0:t.toJSON(),mapped:(n=this.mapped)==null?void 0:n.toJSON(),startSelection:(r=this.startSelection)==null?void 0:r.toJSON(),selectionsAfter:this.selectionsAfter.map(o=>o.toJSON())}}static fromJSON(t){return new te(t.changes&&qn.fromJSON(t.changes),[],t.mapped&&En.fromJSON(t.mapped),t.startSelection&&f.fromJSON(t.startSelection),t.selectionsAfter.map(f.fromJSON))}static fromTransaction(t,n){let r=D;for(let o of t.startState.facet(_n)){let i=o(t);i.length&&(r=r.concat(i))}return!r.length&&t.changes.empty?null:new te(t.changes.invert(t.startState.doc),r,void 0,n||t.startState.selection,D)}static selection(t){return new te(void 0,D,void 0,void 0,t)}};function ae(e,t,n,r){let o=t+1>n+20?t-n-1:0,i=e.slice(o,t);return i.push(r),i}function or(e,t){let n=[],r=!1;return e.iterChangedRanges((o,i)=>n.push(o,i)),t.iterChangedRanges((o,i,s,a)=>{for(let l=0;l<n.length;){let h=n[l++],c=n[l++];a>=h&&s<=c&&(r=!0)}}),r}function ir(e,t){return e.ranges.length==t.ranges.length&&e.ranges.filter((n,r)=>n.empty!=t.ranges[r].empty).length===0}function vt(e,t){return e.length?t.length?e.concat(t):e:t}var D=[],sr=200;function yt(e,t){if(e.length){let n=e[e.length-1],r=n.selectionsAfter.slice(Math.max(0,n.selectionsAfter.length-sr));return r.length&&r[r.length-1].eq(t)?e:(r.push(t),ae(e,e.length-1,1e9,n.setSelAfter(r)))}else return[E.selection([t])]}function ar(e){let t=e[e.length-1],n=e.slice();return n[e.length-1]=t.setSelAfter(t.selectionsAfter.slice(0,t.selectionsAfter.length-1)),n}function We(e,t){if(!e.length)return e;let n=e.length,r=D;for(;n;){let o=lr(e[n-1],t,r);if(o.changes&&!o.changes.empty||o.effects.length){let i=e.slice(0,n);return i[n-1]=o,i}else t=o.mapped,n--,r=o.selectionsAfter}return r.length?[E.selection(r)]:D}function lr(e,t,n){let r=vt(e.selectionsAfter.length?e.selectionsAfter.map(a=>a.map(t)):D,n);if(!e.changes)return E.selection(r);let o=e.changes.map(t),i=t.mapDesc(e.changes,!0),s=e.mapped?e.mapped.composeDesc(i):i;return new E(o,C.mapEffects(e.effects,t),s,e.startSelection.map(i),r)}var cr=/^(input\.type|delete)($|\.)/,Z=class ne{constructor(t,n,r=0,o=void 0){this.done=t,this.undone=n,this.prevTime=r,this.prevUserEvent=o}isolate(){return this.prevTime?new ne(this.done,this.undone):this}addChanges(t,n,r,o,i){let s=this.done,a=s[s.length-1];return s=a&&a.changes&&!a.changes.empty&&t.changes&&(!r||cr.test(r))&&(!a.selectionsAfter.length&&n-this.prevTime<o.newGroupDelay&&o.joinToEvent(i,or(a.changes,t.changes))||r=="input.type.compose")?ae(s,s.length-1,o.minDepth,new E(t.changes.compose(a.changes),vt(C.mapEffects(t.effects,a.changes),a.effects),a.mapped,a.startSelection,D)):ae(s,s.length,o.minDepth,t),new ne(s,D,n,r)}addSelection(t,n,r,o){let i=this.done.length?this.done[this.done.length-1].selectionsAfter:D;return i.length>0&&n-this.prevTime<o&&r==this.prevUserEvent&&r&&/^select($|\.)/.test(r)&&ir(i[i.length-1],t)?this:new ne(yt(this.done,t),this.undone,n,r)}addMapping(t){return new ne(We(this.done,t),We(this.undone,t),this.prevTime,this.prevUserEvent)}pop(t,n,r){let o=t==0?this.done:this.undone;if(o.length==0)return null;let i=o[o.length-1],s=i.selectionsAfter[0]||n.selection;if(r&&i.selectionsAfter.length)return n.update({selection:i.selectionsAfter[i.selectionsAfter.length-1],annotations:qe.of({side:t,rest:ar(o),selection:s}),userEvent:t==0?"select.undo":"select.redo",scrollIntoView:!0});if(i.changes){let a=o.length==1?D:o.slice(0,o.length-1);return i.mapped&&(a=We(a,i.mapped)),n.update({changes:i.changes,selection:i.startSelection,effects:i.effects,annotations:qe.of({side:t,rest:a,selection:s}),filter:!1,userEvent:t==0?"undo":"redo",scrollIntoView:!0})}else return null}};Z.empty=new Z(D,D);var hr=[{key:"Mod-z",run:Pe,preventDefault:!0},{key:"Mod-y",mac:"Mod-Shift-z",run:se,preventDefault:!0},{linux:"Ctrl-Shift-z",run:se,preventDefault:!0},{key:"Mod-u",run:nr,preventDefault:!0},{key:"Alt-u",mac:"Mod-Shift-u",run:rr,preventDefault:!0}];function V(e,t){return f.create(e.ranges.map(t),e.mainIndex)}function T(e,t){return e.update({selection:t,scrollIntoView:!0,userEvent:"select"})}function R({state:e,dispatch:t},n){let r=V(e.selection,n);return r.eq(e.selection,!0)?!1:(t(T(e,r)),!0)}function le(e,t){return f.cursor(t?e.to:e.from)}function ze(e,t){return R(e,n=>n.empty?e.moveByChar(n,t):le(n,t))}function b(e){return e.textDirectionAt(e.state.selection.main.head)==Nn.LTR}var Ve=e=>ze(e,!b(e)),wt=e=>ze(e,b(e)),ur=e=>ze(e,!1);function kt(e,t){return R(e,n=>n.empty?e.moveByGroup(n,t):le(n,t))}var fr=e=>kt(e,!b(e)),dr=e=>kt(e,b(e));typeof Intl<"u"&&Intl.Segmenter;function mr(e,t,n){if(t.type.prop(n))return!0;let r=t.to-t.from;return r&&(r>2||/[^\s,.;:]/.test(e.sliceDoc(t.from,t.to)))||t.firstChild}function ce(e,t,n){let r=Ce(e).resolveInner(t.head),o=n?Le.closedBy:Le.openedBy;for(let l=t.head;;){let h=n?r.childAfter(l):r.childBefore(l);if(!h)break;mr(e,h,o)?r=h:l=n?h.to:h.from}let i=r.type.prop(o),s,a;return a=i&&(s=n?z(e,r.from,1):z(e,r.to,-1))&&s.matched?n?s.end.to:s.end.from:n?r.to:r.from,f.cursor(a,n?-1:1)}var pr=e=>R(e,t=>ce(e.state,t,!b(e))),gr=e=>R(e,t=>ce(e.state,t,b(e)));function xt(e,t){return R(e,n=>{if(!n.empty)return le(n,t);let r=e.moveVertically(n,t);return r.head==n.head?e.moveToLineBoundary(n,t):r})}var bt=e=>xt(e,!1),At=e=>xt(e,!0);function Mt(e){let t=e.scrollDOM.clientHeight<e.scrollDOM.scrollHeight-2,n=0,r=0,o;if(t){for(let i of e.state.facet(w.scrollMargins)){let s=i(e);s!=null&&s.top&&(n=Math.max(s==null?void 0:s.top,n)),s!=null&&s.bottom&&(r=Math.max(s==null?void 0:s.bottom,r))}o=e.scrollDOM.clientHeight-n-r}else o=(e.dom.ownerDocument.defaultView||window).innerHeight;return{marginTop:n,marginBottom:r,selfScroll:t,height:Math.max(e.defaultLineHeight,o-5)}}function St(e,t){let n=Mt(e),{state:r}=e,o=V(r.selection,s=>s.empty?e.moveVertically(s,t,n.height):le(s,t));if(o.eq(r.selection))return!1;let i;if(n.selfScroll){let s=e.coordsAtPos(r.selection.main.head),a=e.scrollDOM.getBoundingClientRect(),l=a.top+n.marginTop,h=a.bottom-n.marginBottom;s&&s.top>l&&s.bottom<h&&(i=w.scrollIntoView(o.main.head,{y:"start",yMargin:s.top-l}))}return e.dispatch(T(r,o),{effects:i}),!0}var Ct=e=>St(e,!1),$e=e=>St(e,!0);function I(e,t,n){let r=e.lineBlockAt(t.head),o=e.moveToLineBoundary(t,n);if(o.head==t.head&&o.head!=(n?r.to:r.from)&&(o=e.moveToLineBoundary(t,n,!1)),!n&&o.head==r.from&&r.length){let i=/^\s*/.exec(e.state.sliceDoc(r.from,Math.min(r.from+100,r.to)))[0].length;i&&t.head!=r.from+i&&(o=f.cursor(r.from+i))}return o}var Dt=e=>R(e,t=>I(e,t,!0)),Lt=e=>R(e,t=>I(e,t,!1)),vr=e=>R(e,t=>I(e,t,!b(e))),yr=e=>R(e,t=>I(e,t,b(e))),wr=e=>R(e,t=>f.cursor(e.lineBlockAt(t.head).from,1)),kr=e=>R(e,t=>f.cursor(e.lineBlockAt(t.head).to,-1));function xr(e,t,n){let r=!1,o=V(e.selection,i=>{let s=z(e,i.head,-1)||z(e,i.head,1)||i.head>0&&z(e,i.head-1,1)||i.head<e.doc.length&&z(e,i.head+1,-1);if(!s||!s.end)return i;r=!0;let a=s.start.from==i.head?s.end.to:s.end.from;return n?f.range(i.anchor,a):f.cursor(a)});return r?(t(T(e,o)),!0):!1}var br=({state:e,dispatch:t})=>xr(e,t,!1);function L(e,t){let n=V(e.state.selection,r=>{let o=t(r);return f.range(r.anchor,o.head,o.goalColumn,o.bidiLevel||void 0)});return n.eq(e.state.selection)?!1:(e.dispatch(T(e.state,n)),!0)}function Tt(e,t){return L(e,n=>e.moveByChar(n,t))}var Rt=e=>Tt(e,!b(e)),Ot=e=>Tt(e,b(e));function Bt(e,t){return L(e,n=>e.moveByGroup(n,t))}var Ar=e=>Bt(e,!b(e)),Mr=e=>Bt(e,b(e)),Sr=e=>L(e,t=>ce(e.state,t,!b(e))),Cr=e=>L(e,t=>ce(e.state,t,b(e)));function Et(e,t){return L(e,n=>e.moveVertically(n,t))}var It=e=>Et(e,!1),qt=e=>Et(e,!0);function Ft(e,t){return L(e,n=>e.moveVertically(n,t,Mt(e).height))}var Pt=e=>Ft(e,!1),Wt=e=>Ft(e,!0),Dr=e=>L(e,t=>I(e,t,!0)),Lr=e=>L(e,t=>I(e,t,!1)),Tr=e=>L(e,t=>I(e,t,!b(e))),Rr=e=>L(e,t=>I(e,t,b(e))),Or=e=>L(e,t=>f.cursor(e.lineBlockAt(t.head).from)),Br=e=>L(e,t=>f.cursor(e.lineBlockAt(t.head).to)),zt=({state:e,dispatch:t})=>(t(T(e,{anchor:0})),!0),Vt=({state:e,dispatch:t})=>(t(T(e,{anchor:e.doc.length})),!0),$t=({state:e,dispatch:t})=>(t(T(e,{anchor:e.selection.main.anchor,head:0})),!0),Nt=({state:e,dispatch:t})=>(t(T(e,{anchor:e.selection.main.anchor,head:e.doc.length})),!0),Er=({state:e,dispatch:t})=>(t(e.update({selection:{anchor:0,head:e.doc.length},userEvent:"select"})),!0),Ir=({state:e,dispatch:t})=>{let n=ue(e).map(({from:r,to:o})=>f.range(r,Math.min(o+1,e.doc.length)));return t(e.update({selection:f.create(n),userEvent:"select"})),!0},qr=({state:e,dispatch:t})=>{let n=V(e.selection,r=>{let o=Ce(e),i=o.resolveStack(r.from,1);if(r.empty){let s=o.resolveStack(r.from,-1);s.node.from>=i.node.from&&s.node.to<=i.node.to&&(i=s)}for(let s=i;s;s=s.next){let{node:a}=s;if((a.from<r.from&&a.to>=r.to||a.to>r.to&&a.from<=r.from)&&s.next)return f.range(a.to,a.from)}return r});return n.eq(e.selection)?!1:(t(T(e,n)),!0)};function Jt(e,t){let{state:n}=e,r=n.selection,o=n.selection.ranges.slice();for(let i of n.selection.ranges){let s=n.doc.lineAt(i.head);if(t?s.to<e.state.doc.length:s.from>0)for(let a=i;;){let l=e.moveVertically(a,t);if(l.head<s.from||l.head>s.to){o.some(h=>h.head==l.head)||o.push(l);break}else{if(l.head==a.head)break;a=l}}}return o.length==r.ranges.length?!1:(e.dispatch(T(n,f.create(o,o.length-1))),!0)}var Fr=e=>Jt(e,!1),Pr=e=>Jt(e,!0),Ht=({state:e,dispatch:t})=>{let n=e.selection,r=null;return n.ranges.length>1?r=f.create([n.main]):n.main.empty||(r=f.create([f.cursor(n.main.head)])),r?(t(T(e,r)),!0):!1};function Q(e,t){if(e.state.readOnly)return!1;let n="delete.selection",{state:r}=e,o=r.changeByRange(i=>{let{from:s,to:a}=i;if(s==a){let l=t(i);l<s?(n="delete.backward",l=he(e,l,!1)):l>s&&(n="delete.forward",l=he(e,l,!0)),s=Math.min(s,l),a=Math.max(a,l)}else s=he(e,s,!1),a=he(e,a,!0);return s==a?{range:i}:{changes:{from:s,to:a},range:f.cursor(s,s<i.head?-1:1)}});return o.changes.empty?!1:(e.dispatch(r.update(o,{scrollIntoView:!0,userEvent:n,effects:n=="delete.selection"?w.announce.of(r.phrase("Selection deleted")):void 0})),!0)}function he(e,t,n){if(e instanceof w)for(let r of e.state.facet(w.atomicRanges).map(o=>o(e)))r.between(t,t,(o,i)=>{o<t&&i>t&&(t=n?i:o)});return t}var Ut=(e,t,n)=>Q(e,r=>{let o=r.from,{state:i}=e,s=i.doc.lineAt(o),a,l;if(n&&!t&&o>s.from&&o<s.from+200&&!/[^ \t]/.test(a=s.text.slice(0,o-s.from))){if(a[a.length-1]=="	")return o-1;let h=Oe(a,i.tabSize)%Se(i)||Se(i);for(let c=0;c<h&&a[a.length-1-c]==" ";c++)o--;l=o}else l=F(s.text,o-s.from,t,t)+s.from,l==o&&s.number!=(t?i.doc.lines:1)?l+=t?1:-1:!t&&/[\ufe00-\ufe0f]/.test(s.text.slice(l-s.from,o-s.from))&&(l=F(s.text,l-s.from,!1,!1)+s.from);return l}),Ne=e=>Ut(e,!1,!0),jt=e=>Ut(e,!0,!1),Gt=(e,t)=>Q(e,n=>{let r=n.head,{state:o}=e,i=o.doc.lineAt(r),s=o.charCategorizer(r);for(let a=null;;){if(r==(t?i.to:i.from)){r==n.head&&i.number!=(t?o.doc.lines:1)&&(r+=t?1:-1);break}let l=F(i.text,r-i.from,t)+i.from,h=i.text.slice(Math.min(r,l)-i.from,Math.max(r,l)-i.from),c=s(h);if(a!=null&&c!=a)break;(h!=" "||r!=n.head)&&(a=c),r=l}return r}),Xt=e=>Gt(e,!1),Wr=e=>Gt(e,!0),zr=e=>Q(e,t=>{let n=e.lineBlockAt(t.head).to;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}),Vr=e=>Q(e,t=>{let n=e.moveToLineBoundary(t,!1).head;return t.head>n?n:Math.max(0,t.head-1)}),$r=e=>Q(e,t=>{let n=e.moveToLineBoundary(t,!0).head;return t.head<n?n:Math.min(e.state.doc.length,t.head+1)}),Nr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(r=>({changes:{from:r.from,to:r.to,insert:ht.of(["",""])},range:f.cursor(r.from)}));return t(e.update(n,{scrollIntoView:!0,userEvent:"input"})),!0},Jr=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=e.changeByRange(r=>{if(!r.empty||r.from==0||r.from==e.doc.length)return{range:r};let o=r.from,i=e.doc.lineAt(o),s=o==i.from?o-1:F(i.text,o-i.from,!1)+i.from,a=o==i.to?o+1:F(i.text,o-i.from,!0)+i.from;return{changes:{from:s,to:a,insert:e.doc.slice(o,a).append(e.doc.slice(s,o))},range:f.cursor(a)}});return n.changes.empty?!1:(t(e.update(n,{scrollIntoView:!0,userEvent:"move.character"})),!0)};function ue(e){let t=[],n=-1;for(let r of e.selection.ranges){let o=e.doc.lineAt(r.from),i=e.doc.lineAt(r.to);if(!r.empty&&r.to==i.from&&(i=e.doc.lineAt(r.to-1)),n>=o.number){let s=t[t.length-1];s.to=i.to,s.ranges.push(r)}else t.push({from:o.from,to:i.to,ranges:[r]});n=i.number+1}return t}function Yt(e,t,n){if(e.readOnly)return!1;let r=[],o=[];for(let i of ue(e)){if(n?i.to==e.doc.length:i.from==0)continue;let s=e.doc.lineAt(n?i.to+1:i.from-1),a=s.length+1;if(n){r.push({from:i.to,to:s.to},{from:i.from,insert:s.text+e.lineBreak});for(let l of i.ranges)o.push(f.range(Math.min(e.doc.length,l.anchor+a),Math.min(e.doc.length,l.head+a)))}else{r.push({from:s.from,to:i.from},{from:i.to,insert:e.lineBreak+s.text});for(let l of i.ranges)o.push(f.range(l.anchor-a,l.head-a))}}return r.length?(t(e.update({changes:r,scrollIntoView:!0,selection:f.create(o,e.selection.mainIndex),userEvent:"move.line"})),!0):!1}var Hr=({state:e,dispatch:t})=>Yt(e,t,!1),Ur=({state:e,dispatch:t})=>Yt(e,t,!0);function Zt(e,t,n){if(e.readOnly)return!1;let r=[];for(let i of ue(e))n?r.push({from:i.from,insert:e.doc.slice(i.from,i.to)+e.lineBreak}):r.push({from:i.to,insert:e.lineBreak+e.doc.slice(i.from,i.to)});let o=e.changes(r);return t(e.update({changes:o,selection:e.selection.map(o,n?1:-1),scrollIntoView:!0,userEvent:"input.copyline"})),!0}var jr=({state:e,dispatch:t})=>Zt(e,t,!1),Gr=({state:e,dispatch:t})=>Zt(e,t,!0),Xr=e=>{if(e.state.readOnly)return!1;let{state:t}=e,n=t.changes(ue(t).map(({from:o,to:i})=>(o>0?o--:i<t.doc.length&&i++,{from:o,to:i}))),r=V(t.selection,o=>{let i;if(e.lineWrapping){let s=e.lineBlockAt(o.head),a=e.coordsAtPos(o.head,o.assoc||1);a&&(i=s.bottom+e.documentTop-a.bottom+e.defaultLineHeight/2)}return e.moveVertically(o,!0,i)}).map(n);return e.dispatch({changes:n,selection:r,scrollIntoView:!0,userEvent:"delete.line"}),!0};function Yr(e,t){if(/\(\)|\[\]|\{\}/.test(e.sliceDoc(t-1,t+1)))return{from:t,to:t};let n=Ce(e).resolveInner(t),r=n.childBefore(t),o=n.childAfter(t),i;return r&&o&&r.to<=t&&o.from>=t&&(i=r.type.prop(Le.closedBy))&&i.indexOf(o.name)>-1&&e.doc.lineAt(r.to).from==e.doc.lineAt(o.from).from&&!/\S/.test(e.sliceDoc(r.to,o.from))?{from:r.to,to:o.from}:null}var Je=Qt(!1),Zr=Qt(!0);function Qt(e){return({state:t,dispatch:n})=>{if(t.readOnly)return!1;let r=t.changeByRange(o=>{let{from:i,to:s}=o,a=t.doc.lineAt(i),l=!e&&i==s&&Yr(t,i);e&&(i=s=(s<=a.to?a:t.doc.lineAt(s)).to);let h=new ft(t,{simulateBreak:i,simulateDoubleBreak:!!l}),c=ut(h,i);for(c??(c=Oe(/^\s*/.exec(t.doc.lineAt(i).text)[0],t.tabSize));s<a.to&&/\s/.test(a.text[s-a.from]);)s++;l?{from:i,to:s}=l:i>a.from&&i<a.from+100&&!/\S/.test(a.text.slice(0,i))&&(i=a.from);let u=["",oe(t,c)];return l&&u.push(oe(t,h.lineIndent(a.from,-1))),{changes:{from:i,to:s,insert:ht.of(u)},range:f.cursor(i+1+u[1].length)}});return n(t.update(r,{scrollIntoView:!0,userEvent:"input"})),!0}}function He(e,t){let n=-1;return e.changeByRange(r=>{let o=[];for(let s=r.from;s<=r.to;){let a=e.doc.lineAt(s);a.number>n&&(r.empty||r.to>a.from)&&(t(a,o,r),n=a.number),s=a.to+1}let i=e.changes(o);return{changes:o,range:f.range(i.mapPos(r.anchor,1),i.mapPos(r.head,1))}})}var Kt=({state:e,dispatch:t})=>{if(e.readOnly)return!1;let n=Object.create(null),r=new ft(e,{overrideIndentation:i=>n[i]??-1}),o=He(e,(i,s,a)=>{let l=ut(r,i.from);if(l==null)return;/\S/.test(i.text)||(l=0);let h=/^\s*/.exec(i.text)[0],c=oe(e,l);(h!=c||a.from<i.from+h.length)&&(n[i.from]=l,s.push({from:i.from,to:i.from+h.length,insert:c}))});return o.changes.empty||t(e.update(o,{userEvent:"indent"})),!0},fe=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(He(e,(n,r)=>{r.push({from:n.from,insert:e.facet(In)})}),{userEvent:"input.indent"})),!0),Ue=({state:e,dispatch:t})=>e.readOnly?!1:(t(e.update(He(e,(n,r)=>{let o=/^\s*/.exec(n.text)[0];if(!o)return;let i=Oe(o,e.tabSize),s=0,a=oe(e,Math.max(0,i-Se(e)));for(;s<o.length&&s<a.length&&o.charCodeAt(s)==a.charCodeAt(s);)s++;r.push({from:n.from+s,to:n.from+o.length,insert:a.slice(s)})}),{userEvent:"delete.dedent"})),!0),Qr=e=>(e.setTabFocusMode(),!0),Kr=({state:e,dispatch:t})=>e.selection.ranges.some(n=>!n.empty)?fe({state:e,dispatch:t}):(t(e.update(e.replaceSelection("	"),{scrollIntoView:!0,userEvent:"input"})),!0),_r=[{key:"Ctrl-b",run:Ve,shift:Rt,preventDefault:!0},{key:"Ctrl-f",run:wt,shift:Ot},{key:"Ctrl-p",run:bt,shift:It},{key:"Ctrl-n",run:At,shift:qt},{key:"Ctrl-a",run:wr,shift:Or},{key:"Ctrl-e",run:kr,shift:Br},{key:"Ctrl-d",run:jt},{key:"Ctrl-h",run:Ne},{key:"Ctrl-k",run:zr},{key:"Ctrl-Alt-h",run:Xt},{key:"Ctrl-o",run:Nr},{key:"Ctrl-t",run:Jr},{key:"Ctrl-v",run:$e}],eo=[{key:"ArrowLeft",run:Ve,shift:Rt,preventDefault:!0},{key:"Mod-ArrowLeft",mac:"Alt-ArrowLeft",run:fr,shift:Ar,preventDefault:!0},{mac:"Cmd-ArrowLeft",run:vr,shift:Tr,preventDefault:!0},{key:"ArrowRight",run:wt,shift:Ot,preventDefault:!0},{key:"Mod-ArrowRight",mac:"Alt-ArrowRight",run:dr,shift:Mr,preventDefault:!0},{mac:"Cmd-ArrowRight",run:yr,shift:Rr,preventDefault:!0},{key:"ArrowUp",run:bt,shift:It,preventDefault:!0},{mac:"Cmd-ArrowUp",run:zt,shift:$t},{mac:"Ctrl-ArrowUp",run:Ct,shift:Pt},{key:"ArrowDown",run:At,shift:qt,preventDefault:!0},{mac:"Cmd-ArrowDown",run:Vt,shift:Nt},{mac:"Ctrl-ArrowDown",run:$e,shift:Wt},{key:"PageUp",run:Ct,shift:Pt},{key:"PageDown",run:$e,shift:Wt},{key:"Home",run:Lt,shift:Lr,preventDefault:!0},{key:"Mod-Home",run:zt,shift:$t},{key:"End",run:Dt,shift:Dr,preventDefault:!0},{key:"Mod-End",run:Vt,shift:Nt},{key:"Enter",run:Je,shift:Je},{key:"Mod-a",run:Er},{key:"Backspace",run:Ne,shift:Ne,preventDefault:!0},{key:"Delete",run:jt,preventDefault:!0},{key:"Mod-Backspace",mac:"Alt-Backspace",run:Xt,preventDefault:!0},{key:"Mod-Delete",mac:"Alt-Delete",run:Wr,preventDefault:!0},{mac:"Mod-Backspace",run:Vr,preventDefault:!0},{mac:"Mod-Delete",run:$r,preventDefault:!0}].concat(_r.map(e=>({mac:e.key,run:e.run,shift:e.shift}))),to=[{key:"Alt-ArrowLeft",mac:"Ctrl-ArrowLeft",run:pr,shift:Sr},{key:"Alt-ArrowRight",mac:"Ctrl-ArrowRight",run:gr,shift:Cr},{key:"Alt-ArrowUp",run:Hr},{key:"Shift-Alt-ArrowUp",run:jr},{key:"Alt-ArrowDown",run:Ur},{key:"Shift-Alt-ArrowDown",run:Gr},{key:"Mod-Alt-ArrowUp",run:Fr},{key:"Mod-Alt-ArrowDown",run:Pr},{key:"Escape",run:Ht},{key:"Mod-Enter",run:Zr},{key:"Alt-l",mac:"Ctrl-l",run:Ir},{key:"Mod-i",run:qr,preventDefault:!0},{key:"Mod-[",run:Ue},{key:"Mod-]",run:fe},{key:"Mod-Alt-\\",run:Kt},{key:"Shift-Mod-k",run:Xr},{key:"Shift-Mod-\\",run:br},{key:"Mod-/",run:dt},{key:"Alt-A",run:mt},{key:"Ctrl-m",mac:"Shift-Alt-m",run:Qr}].concat(eo),no={key:"Tab",run:fe,shift:Ue},_t=class{constructor(e,t,n){this.from=e,this.to=t,this.diagnostic=n}},K=class Tn{constructor(t,n,r){this.diagnostics=t,this.panel=n,this.selected=r}static init(t,n,r){let o=r.facet(B).markerFilter;o&&(t=o(t,r));let i=t.slice().sort((p,v)=>p.from-v.from||p.to-v.to),s=new lt,a=[],l=0,h=r.doc.iter(),c=0,u=r.doc.length;for(let p=0;;){let v=p==i.length?null:i[p];if(!v&&!a.length)break;let y,x;if(a.length)y=l,x=a.reduce((g,O)=>Math.min(g,O.to),v&&v.from>y?v.from:1e8);else{if(y=v.from,y>u)break;x=v.to,a.push(v),p++}for(;p<i.length;){let g=i[p];if(g.from==y&&(g.to>g.from||g.to==y))a.push(g),p++,x=Math.min(g.to,x);else{x=Math.min(g.from,x);break}}x=Math.min(x,u);let re=!1;if(a.some(g=>g.from==y&&(g.to==x||x==u))&&(re=y==x,!re&&x-y<10)){let g=y-(c+h.value.length);g>0&&(h.next(g),c=y);for(let O=y;;){if(O>=x){re=!0;break}if(!h.lineBreak&&c+h.value.length>O)break;O=c+h.value.length,c+=h.value.length,h.next()}}let st=un(a);if(re)s.add(y,y,k.widget({widget:new ho(st),diagnostics:a.slice()}));else{let g=a.reduce((O,at)=>at.markClass?O+" "+at.markClass:O,"");s.add(y,x,k.mark({class:"cm-lintRange cm-lintRange-"+st+g,diagnostics:a.slice(),inclusiveEnd:a.some(O=>O.to>x)}))}if(l=x,l==u)break;for(let g=0;g<a.length;g++)a[g].to<=l&&a.splice(g--,1)}let d=s.finish();return new Tn(d,n,$(d))}};function $(e,t=null,n=0){let r=null;return e.between(n,1e9,(o,i,{spec:s})=>{if(!(t&&s.diagnostics.indexOf(t)<0))if(!r)r=new _t(o,i,t||s.diagnostics[0]);else{if(s.diagnostics.indexOf(r.diagnostic)<0)return!1;r=new _t(r.from,i,r.diagnostic)}}),r}function en(e,t){let n=t.pos,r=t.end||n,o=e.state.facet(B).hideOn(e,n,r);if(o!=null)return o;let i=e.startState.doc.lineAt(t.pos);return!!(e.effects.some(s=>s.is(de))||e.changes.touchesRange(i.from,Math.max(i.to,r)))}function tn(e,t){return e.field(A,!1)?t:t.concat(C.appendConfig.of(mn))}function nn(e,t){return{effects:tn(e,[de.of(t)])}}var de=C.define(),je=C.define(),rn=C.define(),A=P.define({create(){return new K(k.none,null,null)},update(e,t){if(t.docChanged&&e.diagnostics.size){let n=e.diagnostics.map(t.changes),r=null,o=e.panel;if(e.selected){let i=t.changes.mapPos(e.selected.from,1);r=$(n,e.selected.diagnostic,i)||$(n,null,i)}!n.size&&o&&t.state.facet(B).autoPanel&&(o=null),e=new K(n,o,r)}for(let n of t.effects)if(n.is(de)){let r=t.state.facet(B).autoPanel?n.value.length?Ge.open:null:e.panel;e=K.init(n.value,r,t.state)}else n.is(je)?e=new K(e.diagnostics,n.value?Ge.open:null,e.selected):n.is(rn)&&(e=new K(e.diagnostics,e.panel,n.value));return e},provide:e=>[Be.from(e,t=>t.panel),w.decorations.from(e,t=>t.diagnostics)]}),ro=k.mark({class:"cm-lintRange cm-lintRange-active"});function oo(e,t,n){let{diagnostics:r}=e.state.field(A),o,i=-1,s=-1;r.between(t-(n<0?1:0),t+(n>0?1:0),(l,h,{spec:c})=>{if(t>=l&&t<=h&&(l==h||(t>l||n>0)&&(t<h||n<0)))return o=c.diagnostics,i=l,s=h,!1});let a=e.state.facet(B).tooltipFilter;return o&&a&&(o=a(o,e.state)),o?{pos:i,end:s,above:e.state.doc.lineAt(i).to<s,create(){return{dom:on(e,o)}}}:null}function on(e,t){return m("ul",{class:"cm-tooltip-lint"},t.map(n=>cn(e,n,!1)))}var io=e=>{let t=e.state.field(A,!1);(!t||!t.panel)&&e.dispatch({effects:tn(e.state,[je.of(!0)])});let n=X(e,Ge.open);return n&&n.dom.querySelector(".cm-panel-lint ul").focus(),!0},sn=e=>{let t=e.state.field(A,!1);return!t||!t.panel?!1:(e.dispatch({effects:je.of(!1)}),!0)},so=[{key:"Mod-Shift-m",run:io,preventDefault:!0},{key:"F8",run:e=>{let t=e.state.field(A,!1);if(!t)return!1;let n=e.state.selection.main,r=t.diagnostics.iter(n.to+1);return!r.value&&(r=t.diagnostics.iter(0),!r.value||r.from==n.from&&r.to==n.to)?!1:(e.dispatch({selection:{anchor:r.from,head:r.to},scrollIntoView:!0}),!0)}}],ao=Re.fromClass(class{constructor(e){this.view=e,this.timeout=-1,this.set=!0;let{delay:t}=e.state.facet(B);this.lintTime=Date.now()+t,this.run=this.run.bind(this),this.timeout=setTimeout(this.run,t)}run(){clearTimeout(this.timeout);let e=Date.now();if(e<this.lintTime-10)this.timeout=setTimeout(this.run,this.lintTime-e);else{this.set=!1;let{state:t}=this.view,{sources:n}=t.facet(B);n.length&&lo(n.map(r=>Promise.resolve(r(this.view))),r=>{this.view.state.doc==t.doc&&this.view.dispatch(nn(this.view.state,r.reduce((o,i)=>o.concat(i))))},r=>{Wn(this.view.state,r)})}}update(e){let t=e.state.facet(B);(e.docChanged||t!=e.startState.facet(B)||t.needsRefresh&&t.needsRefresh(e))&&(this.lintTime=Date.now()+t.delay,this.set||(this.set=!0,this.timeout=setTimeout(this.run,t.delay)))}force(){this.set&&(this.lintTime=Date.now(),this.run())}destroy(){clearTimeout(this.timeout)}});function lo(e,t,n){let r=[],o=-1;for(let i of e)i.then(s=>{r.push(s),clearTimeout(o),r.length==e.length?t(r):o=setTimeout(()=>t(r),200)},n)}var B=W.define({combine(e){return{sources:e.map(t=>t.source).filter(t=>t!=null),...G(e.map(t=>t.config),{delay:750,markerFilter:null,tooltipFilter:null,needsRefresh:null,hideOn:()=>null},{delay:Math.max,markerFilter:an,tooltipFilter:an,needsRefresh:(t,n)=>t?n?r=>t(r)||n(r):t:n,hideOn:(t,n)=>t?n?(r,o,i)=>t(r,o,i)||n(r,o,i):t:n,autoPanel:(t,n)=>t||n})}}});function an(e,t){return e?t?(n,r)=>t(e(n,r),r):e:t}function co(e,t={}){return[B.of({source:e,config:t}),ao,mn]}function ln(e){let t=[];if(e)e:for(let{name:n}of e){for(let r=0;r<n.length;r++){let o=n[r];if(/[a-zA-Z]/.test(o)&&!t.some(i=>i.toLowerCase()==o.toLowerCase())){t.push(o);continue e}}t.push("")}return t}function cn(e,t,n){var o;let r=n?ln(t.actions):[];return m("li",{class:"cm-diagnostic cm-diagnostic-"+t.severity},m("span",{class:"cm-diagnosticText"},t.renderMessage?t.renderMessage(e):t.message),(o=t.actions)==null?void 0:o.map((i,s)=>{let a=!1,l=d=>{if(d.preventDefault(),a)return;a=!0;let p=$(e.state.field(A).diagnostics,t);p&&i.apply(e,p.from,p.to)},{name:h}=i,c=r[s]?h.indexOf(r[s]):-1,u=c<0?h:[h.slice(0,c),m("u",h.slice(c,c+1)),h.slice(c+1)];return m("button",{type:"button",class:"cm-diagnosticAction"+(i.markClass?" "+i.markClass:""),onclick:l,onmousedown:l,"aria-label":` Action: ${h}${c<0?"":` (access key "${r[s]})"`}.`},u)}),t.source&&m("div",{class:"cm-diagnosticSource"},t.source))}var ho=class extends Jn{constructor(e){super(),this.sev=e}eq(e){return e.sev==this.sev}toDOM(){return m("span",{class:"cm-lintPoint cm-lintPoint-"+this.sev})}},hn=class{constructor(e,t){this.diagnostic=t,this.id="item_"+Math.floor(Math.random()*4294967295).toString(16),this.dom=cn(e,t,!0),this.dom.id=this.id,this.dom.setAttribute("role","option")}},Ge=class Rn{constructor(t){this.view=t,this.items=[];let n=o=>{if(o.keyCode==27)sn(this.view),this.view.focus();else if(o.keyCode==38||o.keyCode==33)this.moveSelection((this.selectedIndex-1+this.items.length)%this.items.length);else if(o.keyCode==40||o.keyCode==34)this.moveSelection((this.selectedIndex+1)%this.items.length);else if(o.keyCode==36)this.moveSelection(0);else if(o.keyCode==35)this.moveSelection(this.items.length-1);else if(o.keyCode==13)this.view.focus();else if(o.keyCode>=65&&o.keyCode<=90&&this.selectedIndex>=0){let{diagnostic:i}=this.items[this.selectedIndex],s=ln(i.actions);for(let a=0;a<s.length;a++)if(s[a].toUpperCase().charCodeAt(0)==o.keyCode){let l=$(this.view.state.field(A).diagnostics,i);l&&i.actions[a].apply(t,l.from,l.to)}}else return;o.preventDefault()},r=o=>{for(let i=0;i<this.items.length;i++)this.items[i].dom.contains(o.target)&&this.moveSelection(i)};this.list=m("ul",{tabIndex:0,role:"listbox","aria-label":this.view.state.phrase("Diagnostics"),onkeydown:n,onclick:r}),this.dom=m("div",{class:"cm-panel-lint"},this.list,m("button",{type:"button",name:"close","aria-label":this.view.state.phrase("close"),onclick:()=>sn(this.view)},"\xD7")),this.update()}get selectedIndex(){let t=this.view.state.field(A).selected;if(!t)return-1;for(let n=0;n<this.items.length;n++)if(this.items[n].diagnostic==t.diagnostic)return n;return-1}update(){let{diagnostics:t,selected:n}=this.view.state.field(A),r=0,o=!1,i=null,s=new Set;for(t.between(0,this.view.state.doc.length,(a,l,{spec:h})=>{for(let c of h.diagnostics){if(s.has(c))continue;s.add(c);let u=-1,d;for(let p=r;p<this.items.length;p++)if(this.items[p].diagnostic==c){u=p;break}u<0?(d=new hn(this.view,c),this.items.splice(r,0,d),o=!0):(d=this.items[u],u>r&&(this.items.splice(r,u-r),o=!0)),n&&d.diagnostic==n.diagnostic?d.dom.hasAttribute("aria-selected")||(d.dom.setAttribute("aria-selected","true"),i=d):d.dom.hasAttribute("aria-selected")&&d.dom.removeAttribute("aria-selected"),r++}});r<this.items.length&&!(this.items.length==1&&this.items[0].diagnostic.from<0);)o=!0,this.items.pop();this.items.length==0&&(this.items.push(new hn(this.view,{from:-1,to:-1,severity:"info",message:this.view.state.phrase("No diagnostics")})),o=!0),i?(this.list.setAttribute("aria-activedescendant",i.id),this.view.requestMeasure({key:this,read:()=>({sel:i.dom.getBoundingClientRect(),panel:this.list.getBoundingClientRect()}),write:({sel:a,panel:l})=>{let h=l.height/this.list.offsetHeight;a.top<l.top?this.list.scrollTop-=(l.top-a.top)/h:a.bottom>l.bottom&&(this.list.scrollTop+=(a.bottom-l.bottom)/h)}})):this.selectedIndex<0&&this.list.removeAttribute("aria-activedescendant"),o&&this.sync()}sync(){let t=this.list.firstChild;function n(){let r=t;t=r.nextSibling,r.remove()}for(let r of this.items)if(r.dom.parentNode==this.list){for(;t!=r.dom;)n();t=r.dom.nextSibling}else this.list.insertBefore(r.dom,t);for(;t;)n()}moveSelection(t){if(this.selectedIndex<0)return;let n=$(this.view.state.field(A).diagnostics,this.items[t].diagnostic);n&&this.view.dispatch({selection:{anchor:n.from,head:n.to},scrollIntoView:!0,effects:rn.of(n)})}static open(t){return new Rn(t)}};function me(e,t='viewBox="0 0 40 40"'){return`url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" ${t}>${encodeURIComponent(e)}</svg>')`}function pe(e){return me(`<path d="m0 2.5 l2 -1.5 l1 0 l2 1.5 l1 0" stroke="${e}" fill="none" stroke-width=".7"/>`,'width="6" height="3"')}var uo=w.baseTheme({".cm-diagnostic":{padding:"3px 6px 3px 8px",marginLeft:"-1px",display:"block",whiteSpace:"pre-wrap"},".cm-diagnostic-error":{borderLeft:"5px solid #d11"},".cm-diagnostic-warning":{borderLeft:"5px solid orange"},".cm-diagnostic-info":{borderLeft:"5px solid #999"},".cm-diagnostic-hint":{borderLeft:"5px solid #66d"},".cm-diagnosticAction":{font:"inherit",border:"none",padding:"2px 4px",backgroundColor:"#444",color:"white",borderRadius:"3px",marginLeft:"8px",cursor:"pointer"},".cm-diagnosticSource":{fontSize:"70%",opacity:.7},".cm-lintRange":{backgroundPosition:"left bottom",backgroundRepeat:"repeat-x",paddingBottom:"0.7px"},".cm-lintRange-error":{backgroundImage:pe("#d11")},".cm-lintRange-warning":{backgroundImage:pe("orange")},".cm-lintRange-info":{backgroundImage:pe("#999")},".cm-lintRange-hint":{backgroundImage:pe("#66d")},".cm-lintRange-active":{backgroundColor:"#ffdd9980"},".cm-tooltip-lint":{padding:0,margin:0},".cm-lintPoint":{position:"relative","&:after":{content:'""',position:"absolute",bottom:0,left:"-2px",borderLeft:"3px solid transparent",borderRight:"3px solid transparent",borderBottom:"4px solid #d11"}},".cm-lintPoint-warning":{"&:after":{borderBottomColor:"orange"}},".cm-lintPoint-info":{"&:after":{borderBottomColor:"#999"}},".cm-lintPoint-hint":{"&:after":{borderBottomColor:"#66d"}},".cm-panel.cm-panel-lint":{position:"relative","& ul":{maxHeight:"100px",overflowY:"auto","& [aria-selected]":{backgroundColor:"#ddd","& u":{textDecoration:"underline"}},"&:focus [aria-selected]":{background_fallback:"#bdf",backgroundColor:"Highlight",color_fallback:"white",color:"HighlightText"},"& u":{textDecoration:"none"},padding:0,margin:0},"& [name=close]":{position:"absolute",top:"0",right:"2px",background:"inherit",border:"none",font:"inherit",padding:0,margin:0}}});function fo(e){return e=="error"?4:e=="warning"?3:e=="info"?2:1}function un(e){let t="hint",n=1;for(let r of e){let o=fo(r.severity);o>n&&(n=o,t=r.severity)}return t}var fn=class extends Un{constructor(e){super(),this.diagnostics=e,this.severity=un(e)}toDOM(e){let t=document.createElement("div");t.className="cm-lint-marker cm-lint-marker-"+this.severity;let n=this.diagnostics,r=e.state.facet(ge).tooltipFilter;return r&&(n=r(n,e.state)),n.length&&(t.onmouseover=()=>po(e,t,n)),t}};function mo(e,t){let n=r=>{let o=t.getBoundingClientRect();if(!(r.clientX>o.left-10&&r.clientX<o.right+10&&r.clientY>o.top-10&&r.clientY<o.bottom+10)){for(let i=r.target;i;i=i.parentNode)if(i.nodeType==1&&i.classList.contains("cm-tooltip-lint"))return;window.removeEventListener("mousemove",n),e.state.field(dn)&&e.dispatch({effects:Ye.of(null)})}};window.addEventListener("mousemove",n)}function po(e,t,n){function r(){let s=e.elementAtHeight(t.getBoundingClientRect().top+5-e.documentTop);e.coordsAtPos(s.from)&&e.dispatch({effects:Ye.of({pos:s.from,above:!1,clip:!1,create(){return{dom:on(e,n),getCoords:()=>t.getBoundingClientRect()}}})}),t.onmouseout=t.onmousemove=null,mo(e,t)}let{hoverTime:o}=e.state.facet(ge),i=setTimeout(r,o);t.onmouseout=()=>{clearTimeout(i),t.onmouseout=t.onmousemove=null},t.onmousemove=()=>{clearTimeout(i),i=setTimeout(r,o)}}function go(e,t){let n=Object.create(null);for(let o of t){let i=e.lineAt(o.from);(n[i.from]||(n[i.from]=[])).push(o)}let r=[];for(let o in n)r.push(new fn(n[o]).range(+o));return De.of(r,!0)}var vo=$n({class:"cm-gutter-lint",markers:e=>e.state.field(Xe),widgetMarker:(e,t,n)=>{let r=[];return e.state.field(Xe).between(n.from,n.to,(o,i,s)=>{o>n.from&&o<n.to&&r.push(...s.diagnostics)}),r.length?new fn(r):null}}),Xe=P.define({create(){return De.empty},update(e,t){e=e.map(t.changes);let n=t.state.facet(ge).markerFilter;for(let r of t.effects)if(r.is(de)){let o=r.value;n&&(o=n(o||[],t.state)),e=go(t.state.doc,o.slice(0))}return e}}),Ye=C.define(),dn=P.define({create(){return null},update(e,t){return e&&t.docChanged&&(e=en(t,e)?null:{...e,pos:t.changes.mapPos(e.pos)}),t.effects.reduce((n,r)=>r.is(Ye)?r.value:n,e)},provide:e=>On.from(e)}),yo=w.baseTheme({".cm-gutter-lint":{width:"1.4em","& .cm-gutterElement":{padding:".2em"}},".cm-lint-marker":{width:"1em",height:"1em"},".cm-lint-marker-info":{content:me('<path fill="#aaf" stroke="#77e" stroke-width="6" stroke-linejoin="round" d="M5 5L35 5L35 35L5 35Z"/>')},".cm-lint-marker-warning":{content:me('<path fill="#fe8" stroke="#fd7" stroke-width="6" stroke-linejoin="round" d="M20 6L37 35L3 35Z"/>')},".cm-lint-marker-error":{content:me('<circle cx="20" cy="20" r="15" fill="#f87" stroke="#f43" stroke-width="6"/>')}}),mn=[A,w.decorations.compute([A],e=>{let{selected:t,panel:n}=e.field(A);return!t||!n||t.from==t.to?k.none:k.set([ro.range(t.from,t.to)])}),jn(oo,{hideOn:en}),uo],ge=W.define({combine(e){return G(e,{hoverTime:300,markerFilter:null,tooltipFilter:null})}});function wo(e={}){return[ge.of(e),Xe,vo,yo,dn]}function ko(e,t){let n=e.field(A,!1);if(n&&n.diagnostics.size){let r=[],o=[],i=-1;for(let s=De.iter([n.diagnostics]);;s.next()){for(let a=0;a<r.length;a++)(!s.value||s.value.spec.diagnostics.indexOf(r[a])<0)&&(t(r[a],o[a],i),r.splice(a,1),o.splice(a--,1));if(!s.value)break;for(let a of s.value.spec.diagnostics)r.indexOf(a)<0&&(r.push(a),o.push(s.from));i=s.to}}}var pn=typeof String.prototype.normalize=="function"?e=>e.normalize("NFKD"):e=>e,N=class{constructor(e,t,n=0,r=e.length,o,i){this.test=i,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(n,r),this.bufferStart=n,this.normalize=o?s=>o(pn(s)):pn,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return Vn(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Hn(e),n=this.bufferStart+this.bufferPos;this.bufferPos+=Pn(e);let r=this.normalize(t);if(r.length)for(let o=0,i=n;;o++){let s=r.charCodeAt(o),a=this.match(s,i,this.bufferPos+this.bufferStart);if(o==r.length-1){if(a)return this.value=a,this;break}i==n&&o<t.length&&t.charCodeAt(o)==s&&i++}}}match(e,t,n){let r=null;for(let o=0;o<this.matches.length;o+=2){let i=this.matches[o],s=!1;this.query.charCodeAt(i)==e&&(i==this.query.length-1?r={from:this.matches[o+1],to:n}:(this.matches[o]++,s=!0)),s||(this.matches.splice(o,2),o-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?r={from:t,to:n}:this.matches.push(1,t)),r&&this.test&&!this.test(r.from,r.to,this.buffer,this.bufferStart)&&(r=null),r}};typeof Symbol<"u"&&(N.prototype[Symbol.iterator]=function(){return this});var gn={from:-1,to:-1,match:/.*/.exec("")},Ze="gm"+(/x/.unicode==null?"":"u"),Qe=class{constructor(e,t,n,r=0,o=e.length){if(this.text=e,this.to=o,this.curLine="",this.done=!1,this.value=gn,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new yn(e,t,n,r,o);this.re=new RegExp(t,Ze+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.iter=e.iter(),this.curLineStart=e.lineAt(r).from,this.matchPos=ve(e,r),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let n=this.curLineStart+t.index,r=n+t[0].length;if(this.matchPos=ve(this.text,r+(n==r?1:0)),n==this.curLineStart+this.curLine.length&&this.nextLine(),(n<r||n>this.value.to)&&(!this.test||this.test(n,r,t)))return this.value={from:n,to:r,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}},Ke=new WeakMap,vn=class Me{constructor(t,n){this.from=t,this.text=n}get to(){return this.from+this.text.length}static get(t,n,r){let o=Ke.get(t);if(!o||o.from>=r||o.to<=n){let a=new Me(n,t.sliceString(n,r));return Ke.set(t,a),a}if(o.from==n&&o.to==r)return o;let{text:i,from:s}=o;return s>n&&(i=t.sliceString(n,s)+i,s=n),o.to<r&&(i+=t.sliceString(o.to,r)),Ke.set(t,new Me(s,i)),new Me(n,i.slice(n-s,r-s))}},yn=class{constructor(e,t,n,r,o){this.text=e,this.to=o,this.done=!1,this.value=gn,this.matchPos=ve(e,r),this.re=new RegExp(t,Ze+(n!=null&&n.ignoreCase?"i":"")),this.test=n==null?void 0:n.test,this.flat=vn.get(e,r,this.chunkEnd(r+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let n=this.flat.from+t.index,r=n+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(n,r,t)))return this.value={from:n,to:r,match:t},this.matchPos=ve(this.text,r+(n==r?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=vn.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}};typeof Symbol<"u"&&(Qe.prototype[Symbol.iterator]=yn.prototype[Symbol.iterator]=function(){return this});function xo(e){try{return new RegExp(e,Ze),!0}catch{return!1}}function ve(e,t){if(t>=e.length)return t;let n=e.lineAt(t),r;for(;t<n.to&&(r=n.text.charCodeAt(t-n.from))>=56320&&r<57344;)t++;return t}function _e(e){let t=m("input",{class:"cm-textfield",name:"line",value:String(e.state.doc.lineAt(e.state.selection.main.head).number)}),n=m("form",{class:"cm-gotoLine",onkeydown:o=>{o.keyCode==27?(o.preventDefault(),e.dispatch({effects:_.of(!1)}),e.focus()):o.keyCode==13&&(o.preventDefault(),r())},onsubmit:o=>{o.preventDefault(),r()}},m("label",e.state.phrase("Go to line"),": ",t)," ",m("button",{class:"cm-button",type:"submit"},e.state.phrase("go")),m("button",{name:"close",onclick:()=>{e.dispatch({effects:_.of(!1)}),e.focus()},"aria-label":e.state.phrase("close"),type:"button"},["\xD7"]));function r(){let o=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!o)return;let{state:i}=e,s=i.doc.lineAt(i.selection.main.head),[,a,l,h,c]=o,u=h?+h.slice(1):0,d=l?+l:s.number;if(l&&c){let y=d/100;a&&(y=y*(a=="-"?-1:1)+s.number/i.doc.lines),d=Math.round(i.doc.lines*y)}else l&&a&&(d=d*(a=="-"?-1:1)+s.number);let p=i.doc.line(Math.max(1,Math.min(i.doc.lines,d))),v=f.cursor(p.from+Math.max(0,Math.min(u,p.length)));e.dispatch({effects:[_.of(!1),w.scrollIntoView(v.from,{y:"center"})],selection:v}),e.focus()}return{dom:n}}var _=C.define(),wn=P.define({create(){return!0},update(e,t){for(let n of t.effects)n.is(_)&&(e=n.value);return e},provide:e=>Be.from(e,t=>t?_e:null)}),bo=e=>{let t=X(e,_e);if(!t){let n=[_.of(!0)];e.state.field(wn,!1)??n.push(C.appendConfig.of([wn,Ao])),e.dispatch({effects:n}),t=X(e,_e)}return t&&t.dom.querySelector("input").select(),!0},Ao=w.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px",position:"relative","& label":{fontSize:"80%"},"& [name=close]":{position:"absolute",top:"0",bottom:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:"0"}}}),Mo={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},kn=W.define({combine(e){return G(e,Mo,{highlightWordAroundCursor:(t,n)=>t||n,minSelectionLength:Math.min,maxMatches:Math.min})}});function So(e){let t=[Ro,To];return e&&t.push(kn.of(e)),t}var Co=k.mark({class:"cm-selectionMatch"}),Do=k.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function xn(e,t,n,r){return(n==0||e(t.sliceDoc(n-1,n))!=S.Word)&&(r==t.doc.length||e(t.sliceDoc(r,r+1))!=S.Word)}function Lo(e,t,n,r){return e(t.sliceDoc(n,n+1))==S.Word&&e(t.sliceDoc(r-1,r))==S.Word}var To=Re.fromClass(class{constructor(e){this.decorations=this.getDeco(e)}update(e){(e.selectionSet||e.docChanged||e.viewportChanged)&&(this.decorations=this.getDeco(e.view))}getDeco(e){let t=e.state.facet(kn),{state:n}=e,r=n.selection;if(r.ranges.length>1)return k.none;let o=r.main,i,s=null;if(o.empty){if(!t.highlightWordAroundCursor)return k.none;let l=n.wordAt(o.head);if(!l)return k.none;s=n.charCategorizer(o.head),i=n.sliceDoc(l.from,l.to)}else{let l=o.to-o.from;if(l<t.minSelectionLength||l>200)return k.none;if(t.wholeWords){if(i=n.sliceDoc(o.from,o.to),s=n.charCategorizer(o.head),!(xn(s,n,o.from,o.to)&&Lo(s,n,o.from,o.to)))return k.none}else if(i=n.sliceDoc(o.from,o.to),!i)return k.none}let a=[];for(let l of e.visibleRanges){let h=new N(n.doc,i,l.from,l.to);for(;!h.next().done;){let{from:c,to:u}=h.value;if((!s||xn(s,n,c,u))&&(o.empty&&c<=o.from&&u>=o.to?a.push(Do.range(c,u)):(c>=o.to||u<=o.from)&&a.push(Co.range(c,u)),a.length>t.maxMatches))return k.none}}return k.set(a)}},{decorations:e=>e.decorations}),Ro=w.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),Oo=({state:e,dispatch:t})=>{let{selection:n}=e,r=f.create(n.ranges.map(o=>e.wordAt(o.head)||f.cursor(o.head)),n.mainIndex);return r.eq(n)?!1:(t(e.update({selection:r})),!0)};function Bo(e,t){let{main:n,ranges:r}=e.selection,o=e.wordAt(n.head),i=o&&o.from==n.from&&o.to==n.to;for(let s=!1,a=new N(e.doc,t,r[r.length-1].to);;)if(a.next(),a.done){if(s)return null;a=new N(e.doc,t,0,Math.max(0,r[r.length-1].from-1)),s=!0}else{if(s&&r.some(l=>l.from==a.value.from))continue;if(i){let l=e.wordAt(a.value.from);if(!l||l.from!=a.value.from||l.to!=a.value.to)continue}return a.value}}var bn=({state:e,dispatch:t})=>{let{ranges:n}=e.selection;if(n.some(i=>i.from===i.to))return Oo({state:e,dispatch:t});let r=e.sliceDoc(n[0].from,n[0].to);if(e.selection.ranges.some(i=>e.sliceDoc(i.from,i.to)!=r))return!1;let o=Bo(e,r);return o?(t(e.update({selection:e.selection.addRange(f.range(o.from,o.to),!1),effects:w.scrollIntoView(o.to)})),!0):!1},J=W.define({combine(e){return G(e,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:t=>new Ho(t),scrollToMatch:t=>w.scrollIntoView(t)})}}),et=class{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||xo(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,n)=>n=="n"?`
`:n=="r"?"\r":n=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new Fo(this):new Io(this)}getCursor(e,t=0,n){let r=e.doc?e:Bn.create({doc:e});return n??(n=r.doc.length),this.regexp?U(this,r,t,n):H(this,r,t,n)}},An=class{constructor(e){this.spec=e}};function H(e,t,n,r){return new N(t.doc,e.unquoted,n,r,e.caseSensitive?void 0:o=>o.toLowerCase(),e.wholeWord?Eo(t.doc,t.charCategorizer(t.selection.main.head)):void 0)}function Eo(e,t){return(n,r,o,i)=>((i>n||i+o.length<r)&&(i=Math.max(0,n-2),o=e.sliceString(i,Math.min(e.length,r+2))),(t(ye(o,n-i))!=S.Word||t(we(o,n-i))!=S.Word)&&(t(we(o,r-i))!=S.Word||t(ye(o,r-i))!=S.Word))}var Io=class extends An{constructor(e){super(e)}nextMatch(e,t,n){let r=H(this.spec,e,n,e.doc.length).nextOverlapping();if(r.done){let o=Math.min(e.doc.length,t+this.spec.unquoted.length);r=H(this.spec,e,0,o).nextOverlapping()}return r.done||r.value.from==t&&r.value.to==n?null:r.value}prevMatchInRange(e,t,n){for(let r=n;;){let o=Math.max(t,r-1e4-this.spec.unquoted.length),i=H(this.spec,e,o,r),s=null;for(;!i.nextOverlapping().done;)s=i.value;if(s)return s;if(o==t)return null;r-=1e4}}prevMatch(e,t,n){let r=this.prevMatchInRange(e,0,t);return r||(r=this.prevMatchInRange(e,Math.max(0,n-this.spec.unquoted.length),e.doc.length)),r&&(r.from!=t||r.to!=n)?r:null}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let n=H(this.spec,e,0,e.doc.length),r=[];for(;!n.next().done;){if(r.length>=t)return null;r.push(n.value)}return r}highlight(e,t,n,r){let o=H(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(n+this.spec.unquoted.length,e.doc.length));for(;!o.next().done;)r(o.value.from,o.value.to)}};function U(e,t,n,r){return new Qe(t.doc,e.search,{ignoreCase:!e.caseSensitive,test:e.wholeWord?qo(t.charCategorizer(t.selection.main.head)):void 0},n,r)}function ye(e,t){return e.slice(F(e,t,!1),t)}function we(e,t){return e.slice(t,F(e,t))}function qo(e){return(t,n,r)=>!r[0].length||(e(ye(r.input,r.index))!=S.Word||e(we(r.input,r.index))!=S.Word)&&(e(we(r.input,r.index+r[0].length))!=S.Word||e(ye(r.input,r.index+r[0].length))!=S.Word)}var Fo=class extends An{nextMatch(e,t,n){let r=U(this.spec,e,n,e.doc.length).next();return r.done&&(r=U(this.spec,e,0,t).next()),r.done?null:r.value}prevMatchInRange(e,t,n){for(let r=1;;r++){let o=Math.max(t,n-r*1e4),i=U(this.spec,e,o,n),s=null;for(;!i.next().done;)s=i.value;if(s&&(o==t||s.from>o+10))return s;if(o==t)return null}}prevMatch(e,t,n){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,n,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&]|\d+)/g,(t,n)=>{if(n=="&")return e.match[0];if(n=="$")return"$";for(let r=n.length;r>0;r--){let o=+n.slice(0,r);if(o>0&&o<e.match.length)return e.match[o]+n.slice(r)}return t})}matchAll(e,t){let n=U(this.spec,e,0,e.doc.length),r=[];for(;!n.next().done;){if(r.length>=t)return null;r.push(n.value)}return r}highlight(e,t,n,r){let o=U(this.spec,e,Math.max(0,t-250),Math.min(n+250,e.doc.length));for(;!o.next().done;)r(o.value.from,o.value.to)}},j=C.define(),tt=C.define(),q=P.define({create(e){return new nt(ot(e).create(),null)},update(e,t){for(let n of t.effects)n.is(j)?e=new nt(n.value.create(),e.panel):n.is(tt)&&(e=new nt(e.query,n.value?rt:null));return e},provide:e=>Be.from(e,t=>t.panel)}),nt=class{constructor(e,t){this.query=e,this.panel=t}},Po=k.mark({class:"cm-searchMatch"}),Wo=k.mark({class:"cm-searchMatch cm-searchMatch-selected"}),zo=Re.fromClass(class{constructor(e){this.view=e,this.decorations=this.highlight(e.state.field(q))}update(e){let t=e.state.field(q);(t!=e.startState.field(q)||e.docChanged||e.selectionSet||e.viewportChanged)&&(this.decorations=this.highlight(t))}highlight({query:e,panel:t}){if(!t||!e.spec.valid)return k.none;let{view:n}=this,r=new lt;for(let o=0,i=n.visibleRanges,s=i.length;o<s;o++){let{from:a,to:l}=i[o];for(;o<s-1&&l>i[o+1].from-500;)l=i[++o].to;e.highlight(n.state,a,l,(h,c)=>{let u=n.state.selection.ranges.some(d=>d.from==h&&d.to==c);r.add(h,c,u?Wo:Po)})}return r.finish()}},{decorations:e=>e.decorations});function ee(e){return t=>{let n=t.state.field(q,!1);return n&&n.query.spec.valid?e(t,n):Dn(t)}}var ke=ee((e,{query:t})=>{let{to:n}=e.state.selection.main,r=t.nextMatch(e.state,n,n);if(!r)return!1;let o=f.single(r.from,r.to),i=e.state.facet(J);return e.dispatch({selection:o,effects:[it(e,r),i.scrollToMatch(o.main,e)],userEvent:"select.search"}),Cn(e),!0}),xe=ee((e,{query:t})=>{let{state:n}=e,{from:r}=n.selection.main,o=t.prevMatch(n,r,r);if(!o)return!1;let i=f.single(o.from,o.to),s=e.state.facet(J);return e.dispatch({selection:i,effects:[it(e,o),s.scrollToMatch(i.main,e)],userEvent:"select.search"}),Cn(e),!0}),Vo=ee((e,{query:t})=>{let n=t.matchAll(e.state,1e3);return!n||!n.length?!1:(e.dispatch({selection:f.create(n.map(r=>f.range(r.from,r.to))),userEvent:"select.search.matches"}),!0)}),$o=({state:e,dispatch:t})=>{let n=e.selection;if(n.ranges.length>1||n.main.empty)return!1;let{from:r,to:o}=n.main,i=[],s=0;for(let a=new N(e.doc,e.sliceDoc(r,o));!a.next().done;){if(i.length>1e3)return!1;a.value.from==r&&(s=i.length),i.push(f.range(a.value.from,a.value.to))}return t(e.update({selection:f.create(i,s),userEvent:"select.search.matches"})),!0},Mn=ee((e,{query:t})=>{let{state:n}=e,{from:r,to:o}=n.selection.main;if(n.readOnly)return!1;let i=t.nextMatch(n,r,r);if(!i)return!1;let s=i,a=[],l,h,c=[];s.from==r&&s.to==o&&(h=n.toText(t.getReplacement(s)),a.push({from:s.from,to:s.to,insert:h}),s=t.nextMatch(n,s.from,s.to),c.push(w.announce.of(n.phrase("replaced match on line $",n.doc.lineAt(r).number)+".")));let u=e.state.changes(a);return s&&(l=f.single(s.from,s.to).map(u),c.push(it(e,s)),c.push(n.facet(J).scrollToMatch(l.main,e))),e.dispatch({changes:u,selection:l,effects:c,userEvent:"input.replace"}),!0}),No=ee((e,{query:t})=>{if(e.state.readOnly)return!1;let n=t.matchAll(e.state,1e9).map(o=>{let{from:i,to:s}=o;return{from:i,to:s,insert:t.getReplacement(o)}});if(!n.length)return!1;let r=e.state.phrase("replaced $ matches",n.length)+".";return e.dispatch({changes:n,effects:w.announce.of(r),userEvent:"input.replace.all"}),!0});function rt(e){return e.state.facet(J).createPanel(e)}function ot(e,t){let n=e.selection.main,r=n.empty||n.to>n.from+100?"":e.sliceDoc(n.from,n.to);if(t&&!r)return t;let o=e.facet(J);return new et({search:(t==null?void 0:t.literal)??o.literal?r:r.replace(/\n/g,"\\n"),caseSensitive:(t==null?void 0:t.caseSensitive)??o.caseSensitive,literal:(t==null?void 0:t.literal)??o.literal,regexp:(t==null?void 0:t.regexp)??o.regexp,wholeWord:(t==null?void 0:t.wholeWord)??o.wholeWord})}function Sn(e){let t=X(e,rt);return t&&t.dom.querySelector("[main-field]")}function Cn(e){let t=Sn(e);t&&t==e.root.activeElement&&t.select()}var Dn=e=>{let t=e.state.field(q,!1);if(t&&t.panel){let n=Sn(e);if(n&&n!=e.root.activeElement){let r=ot(e.state,t.query.spec);r.valid&&e.dispatch({effects:j.of(r)}),n.focus(),n.select()}}else e.dispatch({effects:[tt.of(!0),t?j.of(ot(e.state,t.query.spec)):C.appendConfig.of(jo)]});return!0},Ln=e=>{let t=e.state.field(q,!1);if(!t||!t.panel)return!1;let n=X(e,rt);return n&&n.dom.contains(e.root.activeElement)&&e.focus(),e.dispatch({effects:tt.of(!1)}),!0},Jo=[{key:"Mod-f",run:Dn,scope:"editor search-panel"},{key:"F3",run:ke,shift:xe,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:ke,shift:xe,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:Ln,scope:"editor search-panel"},{key:"Mod-Shift-l",run:$o},{key:"Mod-Alt-g",run:bo},{key:"Mod-d",run:bn,preventDefault:!0}],Ho=class{constructor(e){this.view=e;let t=this.query=e.state.field(q).query.spec;this.commit=this.commit.bind(this),this.searchField=m("input",{value:t.search,placeholder:M(e,"Find"),"aria-label":M(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=m("input",{value:t.replace,placeholder:M(e,"Replace"),"aria-label":M(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=m("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=m("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=m("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function n(r,o,i){return m("button",{class:"cm-button",name:r,onclick:o,type:"button"},i)}this.dom=m("div",{onkeydown:r=>this.keydown(r),class:"cm-search"},[this.searchField,n("next",()=>ke(e),[M(e,"next")]),n("prev",()=>xe(e),[M(e,"previous")]),n("select",()=>Vo(e),[M(e,"all")]),m("label",null,[this.caseField,M(e,"match case")]),m("label",null,[this.reField,M(e,"regexp")]),m("label",null,[this.wordField,M(e,"by word")]),...e.state.readOnly?[]:[m("br"),this.replaceField,n("replace",()=>Mn(e),[M(e,"replace")]),n("replaceAll",()=>No(e),[M(e,"replace all")])],m("button",{name:"close",onclick:()=>Ln(e),"aria-label":M(e,"close"),type:"button"},["\xD7"])])}commit(){let e=new et({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:j.of(e)}))}keydown(e){Fn(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?xe:ke)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Mn(this.view))}update(e){for(let t of e.transactions)for(let n of t.effects)n.is(j)&&!n.value.eq(this.query)&&this.setQuery(n.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(J).top}};function M(e,t){return e.state.phrase(t)}var be=30,Ae=/[\s\.,:;?!]/;function it(e,{from:t,to:n}){let r=e.state.doc.lineAt(t),o=e.state.doc.lineAt(n).to,i=Math.max(r.from,t-be),s=Math.min(o,n+be),a=e.state.sliceDoc(i,s);if(i!=r.from){for(let l=0;l<be;l++)if(!Ae.test(a[l+1])&&Ae.test(a[l])){a=a.slice(l);break}}if(s!=o){for(let l=a.length-1;l>a.length-be;l--)if(!Ae.test(a[l-1])&&Ae.test(a[l])){a=a.slice(0,l);break}}return w.announce.of(`${e.state.phrase("current match")}. ${a} ${e.state.phrase("on line")} ${r.number}.`)}var Uo=w.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),jo=[q,zn.low(zo),Uo];export{Pe as A,no as C,Ht as D,se as E,mt as O,Kt as S,Kr as T,er as _,bn as a,Ue as b,wo as c,nn as d,ur as f,to as g,Dt as h,Jo as i,dt as k,so as l,Lt as m,et as n,j as o,Ve as p,So as r,ko as s,Qe as t,co as u,tr as v,Je as w,fe as x,hr as y};
